!function(t,e,i){function o(t){function e(t){return"none"===t.display||"hidden"===t.visibility}if(e(t.style))return!1;var i=t.ownerDocument.defaultView;return!e(i.getComputedStyle(t))}function n(t){var e=[];return t.forEach(function(t){"margin"===t||"padding"===t?(e.push(t+"-top"),e.push(t+"-right"),e.push(t+"-bottom"),e.push(t+"-left")):"border"===t?(e.push("border-top-style"),e.push("border-right-style"),e.push("border-bottom-style"),e.push("border-left-style"),e.push("border-top-color"),e.push("border-right-color"),e.push("border-bottom-color"),e.push("border-left-color"),e.push("border-top-width"),e.push("border-right-width"),e.push("border-bottom-width"),e.push("border-left-width")):e.push(t)}),e}e.removeThis=function(){e(this).remove()},e.suppressEvent=function(t){t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())},e.suppressEventIfDisabled=function(t,i){return i=i||e(t.target),!i.isEnabled()&&(e.suppressEvent(t),!0)},e.debounce=function(t,e){e=e!==i?e:250;var o=null;return function(){var i=this,n=arguments;clearTimeout(o),o=setTimeout(function(){t.apply(i,n)},e)}},e.throttle=function(t,e){e=e!==i?e:250;var o,n=null;return function(){var i=this,r=arguments,s=(new Date).getTime(),a=function(){o=s,t.apply(i,r)};o&&o+e>s?(clearTimeout(n),n=setTimeout(function(){a()},e)):a()}},e.negate=function(t){return function(){return!t.apply(this,arguments)}},e.colorOpacity=function(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;for(var i="#",o=0;o<3;o++){var n=parseInt(t.substr(2*o,2),16);n=Math.round(Math.min(Math.max(0,255-(255-n)*e),255)).toString(16),i+=("00"+n).substr(n.length)}return i},e.injectScript=function(t,i){i=i||{};var o=e.Deferred(),n=i.document||window.document,r=n.createElement("script");return e(r).attr("src",t).attr("async",!0).on("load error",function(t){i.removeTag&&n.head.removeChild(r),"error"===t.type?o.reject():o.resolve()}),n.head.appendChild(r),o.promise()},e.injectStyle=function(t,i){i=i||{};var o=(e.Deferred(),i.document||window.document),n=o.createElement("style"),r=e(n);return r.attr("type","text/css").html(t),o.head.appendChild(n),r},e.pxToNumber=function(t){return t?parseFloat(t,10):0},e.resolvedDeferred=function(){var t=e.Deferred();return t.resolve.apply(t,arguments),t},e.resolvedPromise=function(){var t=e.Deferred();return t.resolve.apply(t,arguments),t.promise()},e.promiseAll=function(i,o){o=t.nvl(o,!1),i=t.arrays.ensure(i);var n=e.Deferred();return e.when.apply(e,i).done(function(){o?n.resolve(t.objects.argumentsToArray(arguments)):n.resolve.apply(this,arguments)}).fail(function(){o?n.reject(t.objects.argumentsToArray(arguments)):n.reject.apply(this,arguments)}),n.promise()},e.ajaxJson=function(t){return e.ajax({url:t,dataType:"json",contentType:"application/json; charset=UTF-8"}).fail(function(e,i,o){throw new Error("Error while loading URL '"+t+"'. Error="+o)})},e.fn.nvl=function(t){return!this.length&&t instanceof e?t:this},e.fn.makeElement=function(t,o,n){var r=this.document(!0);if(r===i||t===i)return new Error("missing arguments: document, element");var s=e(t,r);return o&&s.addClass(o),n&&s.text(n),s},e.fn.makeDiv=function(e,i){var o=t.device.unselectableAttribute,n=this.makeElement("<div>",e,i);return o.key&&n.attr(o.key,o.value),n},e.fn.makeSpan=function(t,e){return this.makeElement("<span>",t,e)},e.fn.document=function(t){var i=this.length?this[0].ownerDocument:null;return t?i:e(i)},e.fn.window=function(t){var i=this.document(!0),o=i?i.defaultView:null;return t?o:e(o)},e.fn.activeElement=function(t){var i=this.document(!0),o=i?i.activeElement:null;return t?o:e(o)},e.fn.body=function(){return e("body",this.document(!0))},e.fn.entryPoint=function(t){var e=this.closest(".scout");return t?e[0]:e},e.fn.prependDiv=function(t,e){return this.makeDiv(t,e).prependTo(this)},e.fn.appendDiv=function(t,e){return this.makeDiv(t,e).appendTo(this)},e.fn.prependElement=function(t,e,i){return this.makeElement(t,e,i).prependTo(this)},e.fn.appendElement=function(t,e,i){return this.makeElement(t,e,i).appendTo(this)},e.fn.afterDiv=function(t,e){return this.makeDiv(t,e).insertAfter(this)},e.fn.beforeDiv=function(t,e){return this.makeDiv(t,e).insertBefore(this)},e.fn.appendSpan=function(t,e){return this.makeSpan(t,e).appendTo(this)},e.fn.appendBr=function(t){return this.makeElement("<br>",t).appendTo(this)},e.fn.appendTextNode=function(t){return e(this.document(!0).createTextNode(t)).appendTo(this)},e.fn.makeSVG=function(t,o,n,r){var s=this.document(!0);if(s===i||t===i)return new Error("missing arguments: document, type");var a=e(s.createElementNS("http://www.w3.org/2000/svg",t));return o&&a.attrSVG("class",o),n&&a.text(n),r!==i&&a.attrSVG("id",r),a},e.fn.appendSVG=function(t,e,i,o){return this.makeSVG(t,e,i,o).appendTo(this)},e.fn.attrSVG=function(t,e){return 0===this.length?this:1===this.length?(this[0].setAttribute(t,e),this):this.each(function(){this.setAttribute(t,e)})},e.fn.removeAttrSVG=function(t){return 0===this.length?this:1===this.length?(this[0].removeAttribute(t),this):this.each(function(){this.removeAttribute(t)})},e.fn.attrXLINK=function(t,e){return 0===this.length?this:1===this.length?(this[0].setAttributeNS("http://www.w3.org/1999/xlink","xlink:"+t,e),this):this.each(function(){this.setAttributeNS("http://www.w3.org/1999/xlink","xlink:"+t,e)})},e.fn.addClassSVG=function(i){var o;return 0===this.length?this:1===this.length?(this.hasClassSVG(i)||(o=this[0].getAttribute("class"),this[0].setAttribute("class",t.strings.join(" ",o,i).trim())),this):this.each(function(){e(this).hasClassSVG(i)||(o=this.getAttribute("class"),this.setAttribute("class",t.strings.join(" ",o,i).trim()))})},e.fn.removeClassSVG=function(t){var e;return 0===this.length?this:1===this.length?(e=" "+this[0].getAttribute("class")+" ",this[0].setAttribute("class",e.replace(" "+t+" "," ").trim()),this):this.each(function(){var e=" "+this.getAttribute("class")+" ";this.setAttribute("class",e.replace(" "+t+" "," ").trim())})},e.fn.hasClassSVG=function(t){var e=" "+this[0].getAttribute("class")+" ";return e.indexOf(" "+t+" ")!==-1},e.fn.selectOne=function(){return this.siblings().removeClass("selected"),this.addClass("selected"),this},e.fn.select=function(t){return this.toggleClass("selected",!!t)},e.fn.isSelected=function(){return this.hasClass("selected")},e.fn.setEnabled=function(t){return t=!!t,this.toggleClass("disabled",!t),this.is("button, input, select, textarea, optgroup, option, fieldset")&&this.toggleAttr("disabled",!t),this},e.fn.isEnabled=function(){return!this.hasClass("disabled")},e.fn.setVisible=function(t){var e,i;for(e=0;e<this.length;e++)i=this[e],o(i)!==t&&(t?this.show():this.hide());return this},e.fn.isDisplayNone=function(){return"none"===this.css("display")},e.fn.setTabbable=function(t){return this.attr("tabIndex",t?0:null)},e.fn.icon=function(i){function o(t,i){return t&&!t.is(i.replace(/[<>]/g,""))&&(n.call(this,t),t=null),t||(t=e(i),this.data("$icon",t),this.prepend(t)),t}function n(t){t&&t.remove(),this.removeData("$icon")}var r,s=this.data("$icon");return i?(r=t.icons.parseIconId(i),r.isFontIcon()?o.call(this,s,"<span>").addClass(r.appendCssClass("font-icon")).addClass("icon").text(r.iconCharacter):o.call(this,s,"<img>").attr("src",r.iconUrl).addClass("icon")):n.call(this,s),this},e.fn.placeholder=function(t){return this.toggleAttr("placeholder",!!t,t)},e.fn.isVisible=function(){return o(this[0])},e.fn.isEveryParentVisible=function(){var t=!0;return this.parents().each(function(){if(!e(this).isVisible())return t=!1,!1}),t},e.fn.isAttached=function(){return e.contains(this.document(!0).documentElement,this[0])},e.fn.scrollParent=function(){for(var t=this;t.length>0;){if(t.data("scrollable"))return t;t=t.parent()}return e()},e.fn.scrollParents=function(){for(var t=e(),i=this;i.length>0;)i.data("scrollable")&&t.push(i),i=i.parent();return t},e.fn.animateAVCSD=function(t,e,i,o,n){var r={},s={};return r[t]=e,i&&(s.complete=i),o&&(s.step=o),n&&(s.duration=n),s.queue=!1,this.animate(r,s),this},e.fn.animateSVG=function(t,i,o,n,r){return this.each(function(){var s=parseFloat(e(this).attr(t));if(r){var a=n;n=function(){a&&a.call(this),e(this).removeAttr("tabindex")}}e(this).animate({tabIndex:0},{step:function(e,o){this.setAttribute(t,s+(i-s)*o.pos)},duration:o,complete:n,queue:!1})})},e.fn.addClassForAnimation=function(t,i){var o={classesToRemove:t};i=e.extend({},o,i),this.addClass(t),this.oneAnimationEnd(function(){this.removeClass(i.classesToRemove)}.bind(this))},e.fn.oneAnimationEnd=function(t,e,i){this.one("animationend webkitAnimationEnd",t,e,i)},e.fn.cssWidthAnimated=function(e,i,o){return o=o||{},o.duration=t.nvl(o.duration,300),this.cssWidth(e),this.animate({width:i},o),this},e.fn.cssHeightAnimated=function(e,i,o){return o=o||{},o.duration=t.nvl(o.duration,300),this.cssHeight(e),this.animate({height:i},o),this},e.fn.cssLeftAnimated=function(e,i,o){return o=o||{},o.duration=t.nvl(o.duration,300),this.cssLeft(e),this.animate({left:i},o),this},e.fn.cssTopAnimated=function(e,i,o){return o=o||{},o.duration=t.nvl(o.duration,300),this.cssTop(e),this.animate({top:i},o),this},e.fn.cssAnimated=function(e,i,o){return o=o||{},o.duration=t.nvl(o.duration,300),this.css(e),this.animate(i,o),this},e.fn.widthToContent=function(t){var e=this.outerWidth(),i=this.css("width","auto").outerWidth();return this.cssWidthAnimated(e,i,t),this},e.fn.offsetTo=function(t){var e=t.offset(),i=this.offset();return{top:i.top-e.top,left:i.left-e.left}},e.fn.cssLeft=function(t){return this.cssPxValue("left",t)},e.fn.cssTop=function(t){return this.cssPxValue("top",t)},e.fn.cssBottom=function(t){return this.cssPxValue("bottom",t)},e.fn.cssRight=function(t){return this.cssPxValue("right",t)},e.fn.cssWidth=function(t){return this.cssPxValue("width",t)},e.fn.cssHeight=function(t){return this.cssPxValue("height",t)},e.fn.cssLineHeight=function(t){return this.cssPxValue("line-height",t)},e.fn.cssPxValue=function(t,o){return o===i?e.pxToNumber(this.css(t)):this.css(t,o+"px")},e.fn.cssMarginLeft=function(t){return this.cssPxValue("margin-left",t)},e.fn.cssMarginBottom=function(t){return this.cssPxValue("margin-bottom",t)},e.fn.cssMarginRight=function(t){return this.cssPxValue("margin-right",t)},e.fn.cssMarginTop=function(t){return this.cssPxValue("margin-top",t)},e.fn.cssMarginX=function(t){return t===i?this.cssMarginLeft()+this.cssMarginRight():(this.cssMarginLeft(t),void this.cssMarginRight(t))},e.fn.cssMarginY=function(t){return t===i?this.cssMarginTop()+this.cssMarginBottom():(this.cssMarginTop(t),void this.cssMarginBottom(t))},e.fn.cssPaddingTop=function(t){return this.cssPxValue("padding-top",t)},e.fn.cssBorderBottomWidth=function(t){return this.cssPxValue("border-bottom-width",t)},e.fn.cssBorderLeftWidth=function(t){return this.cssPxValue("border-left-width",t)},e.fn.cssBorderRightWidth=function(t){return this.cssPxValue("border-right-width",t)},e.fn.cssBorderTopWidth=function(t){return this.cssPxValue("border-top-width",t)},e.fn.cssBorderWidthY=function(t){return t===i?this.cssBorderTopWidth()+this.cssBorderBottomWidth():(this.cssBorderTopWidth(t),void this.cssBorderBottomWidth(t))},e.fn.cssBorderWidthX=function(t){return t===i?this.cssBorderLeftWidth()+this.cssBorderRightWidth():(this.cssBorderLeftWidth(t),void this.cssBorderRightWidth(t))},e.fn.innerBottom=function(){return this.position().top+this.outerHeight(!0)-this.cssMarginBottom()-this.cssBorderBottomWidth()},e.fn.innerRight=function(){return this.position().left+this.outerWidth(!0)-this.cssMarginRight()-this.cssBorderRightWidth()},e.fn.copyCss=function(t,e){var i=e.split(" "),o=this;return i=n(i),i.forEach(function(e){o.css(e,t.css(e))}),o},e.fn.copyCssIfGreater=function(t,i){var o=i.split(" "),r=this;return o=n(o),o.forEach(function(i){var o=e.pxToNumber(t.css(i)),n=e.pxToNumber(r.css(i));o>n&&r.css(i,o+"px")}),r},e.fn.copyCssClasses=function(t,e){var i=e.split(" "),o=this;return i.forEach(function(e){t.hasClass(e)&&o.addClass(e)}),o},e.fn.disableSpellcheck=function(){return this.attr("spellcheck",!1)},e.fn.isOrHas=function(t){return this[0]===t||this.has(t).length>0},e.fn.makeDraggable=function(t,e){var i=this;return t=t||i,t.on("mousedown.draggable",function(o){var n=i.offset(),r=o,s=t.width(),a=t.window().width(),l=t.window().height();t.parents().on("mousemove.dragging",function(t){var o=n.top+(t.pageY-r.pageY),h=n.left+(t.pageX-r.pageX);h=Math.max(100-s,h),h=Math.min(a-100,h),o=Math.max(0,o),o=Math.min(l-100,o);var d={top:o,left:h};i.offset(d),e&&e(d)}).on("mouseup.dragging",function(e){t.parents().off(".dragging")}),o.preventDefault()})},e.fn.fadeOutAndRemove=function(o,n){n===i&&"function"==typeof o&&(n=o,o=i),o=t.nvl(o,150),this.stop(!0).fadeOut(o,function(){e(this).remove(),n&&n.call(this)})};var r=e.fn.hide;e.fn.hide=function(){this.trigger("hide");var t=r.apply(this,arguments);return t},e.fn.textOrNbsp=function(e,i){return t.strings.hasText(e)?(this.text(e),i&&this.removeClass(i)):(this.html("&nbsp;"),i&&this.addClass(i)),this},e.fn.htmlOrNbsp=function(e,i){return t.strings.hasText(e)?(this.html(e),i&&this.removeClass(i)):(this.html("&nbsp;"),i&&this.addClass(i)),this},e.fn.toggleAttr=function(t,o,n){return t?(n===i&&(n=t),this.each(function(){var r=e(this);o===i&&(o=r.attr(t)===i),o?r.attr(t,n):r.removeAttr(t)})):this},e.fn.backupSelection=function(){var t=this[0];return t&&t===this.activeElement(!0)?{selectionStart:t.selectionStart,selectionEnd:t.selectionEnd,selectionDirection:t.selectionDirection}:null},e.fn.restoreSelection=function(t){var e=this[0];e&&e===this.activeElement(!0)&&t&&e.setSelectionRange(t.selectionStart,t.selectionEnd,t.selectionDirection)},e.fn.attrOrRemove=function(t,i){i?e(this).attr(t,i):e(this).removeAttr(t)},e.fn.appendAppLink=function(t,e){return this.appendSpan().appLink(t,e)},e.fn.appLink=function(e,i){return i?"object"==typeof i&&i._onAppLinkAction&&(i=i._onAppLinkAction.bind(i)):i=function(e){var i=t.Widget.getWidgetFor(this);i&&i._onAppLinkAction&&i._onAppLinkAction(e)}.bind(this),this.addClass("app-link").attr("tabindex","0").unfocusable().on("click",i),"string"==typeof e?this.attr("data-ref",e):this.text(e.name).attr("data-ref",e.ref),this},e.fn.unfocusable=function(){return this.addClass("unfocusable")},e.fn.selectAllText=function(){var t,e=this.document(!0),i=this.window(!0),o=this[0];return e.body.createTextRange?(t=e.body.createTextRange(),t.moveToElementText(o),void t.select()):void(i.getSelection&&(t=e.createRange(),t.selectNodeContents(o),i.getSelection().removeAllRanges(),i.getSelection().addRange(t)))},e.fn.isContentTruncated=function(){var t=this[0].clientWidth,e=this[0].scrollWidth;if(e>t)return!0;var i=this.attr("style");return this.css("width","auto"),e=this[0].scrollWidth,this.attrOrRemove("style",i),e>t},e.fn.onSingleOrDoubleClick=function(i,o,n){return this.each(function(){var n=this,r=0,s=t.nvl(s,300);e(this).on("click",function(t){r++,1===r&&setTimeout(function(){1===r?i.call(n,t):o.call(n,t),r=0},s)})})},t.sessions=[],t.inherits=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.parent=e},t.nvl=function(){for(var t,e=0;e<arguments.length&&(t=arguments[e],t===i||null===t);e++);return t},t.assertParameter=function(t,e,i){if(!e)throw new Error("Missing required parameter '"+t+"'");if(i&&!(e instanceof i))throw new Error("Parameter '"+t+"' has wrong type")},t.isOneOf=function(){if(arguments.length>=2){var t,e=arguments[0];return t=2===arguments.length&&Array.isArray(arguments[1])?arguments[1]:Array.prototype.slice.call(arguments,1),t.indexOf(e)!==-1}return!1},t.create=function(e,i,o){return t.objectFactory.create(e,i,o)},t.prepareDOM=function(i){if(i=i||document,e("noscript",i).remove(),e("scout-text",i).remove(),t.device.browser===t.Device.Browser.CHROME){var o='<meta name="google" content="notranslate" />',n=e("head > title",i);0===n.length?e("head",i).append(o):n.after(o)}},t._checkBrowserCompability=function(i){var o=t.device;return e.log.info("Detected browser "+o.browser+" version "+o.browserVersion),!(t.nvl(i.checkBrowserCompatibility,!0)&&!o.isSupportedBrowser())||(e(".scout").each(function(){var o=e(this),n=o.appendDiv(),r=t.objects.valueCopy(i);r.checkBrowserCompatibility=!1,n.load("unsupported-browser.html",function(){n.find("button").on("click",function(){n.remove(),t._init(r)})})}),!1)},t._installGlobalJavascriptErrorHandler=function(){window.onerror=function(i,o,n,r,s){function a(t){if(t){if("EvalError"===t.name)return"E1";if("InternalError"===t.name)return"I2";if("RangeError"===t.name)return"A3";if("ReferenceError"===t.name)return"R4";if("SyntaxError"===t.name)return"S5";if("TypeError"===t.name)return"T6";if("URIError"===t.name)return"U7"}return"J0"}try{var l=a(s),h=i+" at "+o+":"+n;if(s&&s.stack&&(h+="\n"+s.stack),h+="\n(Code "+l+")",e.log.error(h),window.console&&window.console.log(h),t.sessions.length>0){var d=t.sessions[0],p={header:d.optText("ui.UnexpectedProblem","Internal UI Error"),body:t.strings.join("\n\n",d.optText("ui.InternalUiErrorMsg",i," ("+d.optText("ui.ErrorCodeX","Code "+l,l)+")"),d.optText("ui.UiInconsistentMsg","")),yesButtonText:d.optText("ui.Reload","Reload"),yesButtonAction:t.reloadPage,noButtonText:d.optText("ui.Ignore","Ignore"),hiddenText:h};d.showFatalMessage(p,l),d.sendLogRequest(h)}}catch(t){throw new Error("Error in global JavaScript error handler: "+t.message+" (original error: "+i+" at "+o+":"+n+")")}}},t._installGlobalMouseDownInterceptor=function(e){e.addEventListener("mousedown",function(e){t.ValueField.invokeValueFieldAboutToBlurByMouseDown(e.target||e.srcElement)},!0)},t._globalAjaxSetup=function(){e.ajaxSetup({beforeSend:function(e){e.setRequestHeader("X-Scout-Correlation-Id",t.numbers.correlationId())}})},t.adapter=function(e,i){var o=t.getSession(i);if(o&&o.modelAdapterRegistry)return o.modelAdapterRegistry[e]},t.getSession=function(e){if(!t.sessions)return null;var i;if(1===t.sessions.length)i=t.sessions[0];else{e=e||0;for(var o=0;o<t.sessions.length;o++)if(t.sessions[o].partId==e){e=o;break}i=t.sessions[e]}return i},t.exportAdapter=function(i,o){function n(t){var i=s.getAdapterData(t);return i=e.extend(!0,{},i)}function r(t,e){var i,o;t._adapterProperties.forEach(function(t){var a=e[t];if(a)if(Array.isArray(a)){var l=[];a.forEach(function(t){i=s.getModelAdapter(t),o=n(t),r(i,o),l.push(o)}),e[t]=l}else i=s.getModelAdapter(a),o=n(a),r(i,o),e[t]=o}),e=t.exportAdapterData(e)}var s=t.getSession(o);if(s&&s.modelAdapterRegistry){var a=s.getModelAdapter(i),l=n(i);return r(a,l),l.type="model",l}},t.reloadPage=function(i){function o(){t.nvl(i.clearBody,!0)&&e("body").html(""),setTimeout(function(){i.redirectUrl?window.location.href=i.redirectUrl:window.location.reload()})}i=i||{},i.schedule?setTimeout(o):o()},t.App=function(){},t.App.prototype.init=function(t){var i=this._bootstrap(t.bootstrap);return e.promiseAll(i).then(function(){this._init(t)}.bind(this))},t.App.prototype._bootstrap=function(t){t=t||{};var e=this._doBootstrap(t),i=[];return e.forEach(function(t){Array.isArray(t)?i.concat(t):t&&i.push(t)}),i},t.App.prototype._doBootstrap=function(e){return[t.logging.bootstrap(),t.device.bootstrap(),t.fonts.bootstrap(e.fonts),t.models.bootstrap(e.modelsUrl),t.locales.bootstrap(e.localesUrl),t.texts.bootstrap(e.textsUrl),t.codes.bootstrap(e.codesUrl)]},t.App.prototype._init=function(i){i=i||{},t._checkBrowserCompability(i)&&(t.polyfills.install(window),t.prepareDOM(),t.objectFactory.init(),t._installGlobalJavascriptErrorHandler(),t._installGlobalMouseDownInterceptor(document),t._globalAjaxSetup(),this.installExtensions(),e(".scout").each(function(o,n){var r=e(n);i.portletPartId=i.portletPartId||r.data("partid")||"0";var s=this._createSession(r,i);t.sessions.push(s)}.bind(this)))},t.App.prototype._createSession=function(i,o){o.locale=o.locale||new t.Locale(t.locales.get("de-CH")),o.$entryPoint=i;var n=t.create("Session",o,{ensureUniqueId:!1}),r=new t.NullWidget;return r.session=n,n.desktop=this._createDesktop(r),n.render(function(){this.onSessionReady(n),n._renderDesktop(),n.layoutValidator.validate(),n.focusManager.validateFocus(),n.ready=!0,e.log.info("Session initialized. Detected "+t.device)}.bind(this)),n},t.App.prototype._createDesktop=function(e){return t.create("Desktop",{parent:e})},t.App.prototype.onSessionReady=function(t){},t.App.prototype.onDesktopReady=function(t){},t.App.prototype.installExtensions=function(){},t.RemoteApp=function(){},t.inherits(t.RemoteApp,t.App),t.RemoteApp.prototype._doBootstrap=function(e){return[t.logging.bootstrap(),t.device.bootstrap(),t.defaultValues.bootstrap(),t.fonts.bootstrap(e.fonts)]},t.RemoteApp.prototype._createSession=function(e,i){i=i||{},i.remote=!0,i.$entryPoint=e;var o=t.create("Session",i,{ensureUniqueId:!1});return o.start(),o},t.RemoteApp.prototype._init=function(e){t.RemoteApp.modifyWidgetPrototype(),t.RemoteApp.modifyTablePrototype(),t.RemoteApp.modifyBooleanColumnPrototype(),t.RemoteApp.parent.prototype._init.call(this,e)},t.RemoteApp.modifyWidgetPrototype=function(){t.objects.replacePrototypeFunction(t.Widget,"_createChild",function(e){function i(t){for(;t;){if(t.modelAdapter)return t.modelAdapter;t=t.parent}return null}if(e instanceof t.Widget)return e;var o=i(this);return o?this.session.getOrCreateWidget(e,this):(e.parent=this,t.create(e))})},t.RemoteApp.modifyTablePrototype=function(){t.objects.replacePrototypeFunction(t.Table,"prepareCellEdit",function(e,i,o){this.openFieldPopupOnCellEdit=t.nvl(o,!1),this.trigger("prepareCellEdit",{column:e,row:i})}),t.objects.replacePrototypeFunction(t.Table,"completeCellEdit",function(t){this.trigger("completeCellEdit",{field:t})}),t.objects.replacePrototypeFunction(t.Table,"cancelCellEdit",function(t){this.trigger("cancelCellEdit",{field:t})})},t.RemoteApp.modifyBooleanColumnPrototype=function(){t.objects.replacePrototypeFunction(t.BooleanColumn,"_toggleCellValue",function(t,e){})},t.Extension=function(){},t.Extension.prototype.extend=function(t,e){var i=t[e],o=this,n=function(){o.extended=this,o.next=i.bind(this),o[e].apply(o,arguments)};t[e]=n},t.Extension.install=function(e){e.forEach(function(e){t.create(e)})},t.ObjectFactory=function(){this.uniqueIdSeqNo=0,this._registry={}},t.ObjectFactory.NAMESPACE_SEPARATOR=".",t.ObjectFactory.MODEL_VARIANT_SEPARATOR=":",t.ObjectFactory.prototype._createObjectByType=function(e,i){if("string"!=typeof e)throw new Error("missing or invalid object type");i=i||{};var o,n='Failed to create object for objectType "'+e+'": ',r=this._registry[e];if(r){if(o=r(i.model),!o)throw new Error(n+"Factory function did not return a valid object")}else{var s=e.split(t.ObjectFactory.NAMESPACE_SEPARATOR),a=s.slice(0,s.length-1),l=s[s.length-1].split(t.ObjectFactory.MODEL_VARIANT_SEPARATOR).slice(0,2),h=l.slice().reverse().join(""),d=t;if(a.length){d=window;for(var p=0;p<a.length;p++)if(d=d[a[p]],!d)throw new Error(n+'Could not resolve namespace "'+a[p]+'"')}if(!d[h]){if(i.variantLenient&&2===l.length)return this._createObjectByType(a.concat(l[0]).join(t.ObjectFactory.NAMESPACE_SEPARATOR),i);throw new Error(n+'Could not find "'+h+'" in namespace "'+a.join(".")+'"')}o=new d[h](i.model)}return o},t.ObjectFactory.prototype.create=function(e,o,n){if("string"==typeof e)n=n||{};else{if(!t.objects.isPlainObject(e))throw new Error("Invalid arguments");if(n=o||{},o=e,!o.objectType)throw new Error('Missing mandatory property "objectType" on model');e=o.objectType}n.model=o;var r=this._createObjectByType(e,n);return t.nvl(n.initObject,!0)&&(o&&(o.id===i&&t.nvl(n.ensureUniqueId,!0)&&(o.id=this.createUniqueId()),o.objectType===i&&t.nvl(n.ensureObjectType,!0)&&(o.objectType=e)),r.init(o)),r.id===i&&t.nvl(n.ensureUniqueId,!0)&&(r.id=this.createUniqueId()),r.objectType===i&&t.nvl(n.ensureObjectType,!0)&&(r.objectType=e),r},t.ObjectFactory.prototype.createUniqueId=function(){return"ui"+(++this.uniqueIdSeqNo).toString()},t.ObjectFactory.prototype.register=function(t,i){e.log.debug("(ObjectFactory) registered create-function for objectType "+t),this._registry[t]=i},t.ObjectFactory.prototype.unregister=function(t){e.log.debug("(ObjectFactory) unregistered objectType "+t),delete this._registry[t]},t.ObjectFactory.prototype.get=function(t){return this._registry[t]},t.ObjectFactory.prototype.init=function(){for(var e in t.objectFactories)t.objectFactories.hasOwnProperty(e)&&this.register(e,t.objectFactories[e])},t.objectFactory=new t.ObjectFactory(t.objectFactories),t.objectFactories={KeyStroke:function(){return new t.Action},KeyStrokeAdapter:function(){return new t.ActionAdapter},ComposerField:function(){return new t.TreeField},ComposerFieldAdapter:function(){return new t.TreeFieldAdapter}},t.LoadingSupport=function(e){if(!e.widget)throw new Error("Option 'widget' not set");this.widget=e.widget,this.$container=e.$container||function(){return this.widget.$container}.bind(this),this.loadingIndicatorDelay=t.nvl(e.loadingIndicatorDelay,250),this._loadingIndicatorTimeoutId},t.LoadingSupport.prototype.setLoadingIndicatorDelay=function(t){this.loadingIndicatorDelay=t},t.LoadingSupport.prototype.renderLoading=function(){if(clearTimeout(this._loadingIndicatorTimeoutId),this.widget)if(this.widget.loading&&!this._$loadingIndicator){var t=function(){this.widget.rendered&&(this.$container().addClass("loading"),this._$loadingIndicator=this.$container().appendDiv("loading-indicator"))}.bind(this);this.loadingIndicatorDelay?this._loadingIndicatorTimeoutId=setTimeout(t,this.loadingIndicatorDelay):t()}else!this.widget.loading&&this._$loadingIndicator&&this._$loadingIndicator.fadeOutAndRemove(function(){this._$loadingIndicator=null,this.widget.rendered&&(this.$container().removeClass("loading"),this.widget.invalidateLayoutTree())}.bind(this))},t.ModelAdapter=function(){this._adapterProperties=[],this.initialized=!1,this.attached=!1,this.destroyed=!1,this.widget,this._remoteProperties=[],this._widgetListener,this._propertyChangeEventFilter=new t.PropertyChangeEventFilter,this._widgetEventTypeFilter=new t.WidgetEventTypeFilter,this.events=new t.EventSupport},t.ModelAdapter.prototype.init=function(t){this._init(t),this.initialized=!0},t.ModelAdapter.prototype._init=function(i){t.assertParameter("id",i.id),t.assertParameter("session",i.session),e.extend(this,i),this.session.registerModelAdapter(this)},t.ModelAdapter.prototype.destroy=function(){this._detachWidget(),this.widget.destroy(),this.widget=null,this.session.unregisterModelAdapter(this),this.destroyed=!0},t.ModelAdapter.prototype.createWidget=function(t,e){var i=this._initModel(t,e);return this.widget=this._createWidget(i),this._attachWidget(),this._postCreateWidget(),this.widget},t.ModelAdapter.prototype._postCreateWidget=function(){},t.ModelAdapter.prototype._initModel=function(o,n){var r=this.session.adapterExportEnabled;if(o=e.extend(r,{},o),t.defaultValues.applyTo(o),o.parent=n,o.modelAdapter=this,o.owner!==i&&(o.owner=this.session.getModelAdapter(o.owner).widget,!o.owner))throw new Error("owner not found.");return this._initProperties(o),o},t.ModelAdapter.prototype._initProperties=function(){},t.ModelAdapter.prototype._createWidget=function(e){var i=t.create(e.objectType,e);return i._addCloneProperties(["modelClass","classId"]),i},t.ModelAdapter.prototype._attachWidget=function(){this._widgetListener||(this._widgetListener={func:this._onWidgetEventInternal.bind(this)},this.widget.addListener(this._widgetListener),this.attached=!0,this.events.trigger("attach"))},t.ModelAdapter.prototype._detachWidget=function(){this._widgetListener&&(this.widget.removeListener(this._widgetListener),this._widgetListener=null,this.attached=!1,this.events.trigger("detach"))},t.ModelAdapter.prototype.goOffline=function(){this.widget.children.forEach(function(t){t.rendered&&t.modelAdapter&&t.modelAdapter.goOffline()},this),this._goOffline()},t.ModelAdapter.prototype._goOffline=function(){},t.ModelAdapter.prototype.goOnline=function(){this.widget.children.forEach(function(t){t.rendered&&t.modelAdapter&&t.modelAdapter.goOnline()},this),this._goOnline()},t.ModelAdapter.prototype._goOnline=function(){},t.ModelAdapter.prototype._isAdapterProperty=function(t){return this._adapterProperties.indexOf(t)>-1},t.ModelAdapter.prototype._isRemoteProperty=function(t){return this._remoteProperties.indexOf(t)>-1},t.ModelAdapter.prototype._addAdapterProperties=function(t){this._addProperties("_adapterProperties",t)},t.ModelAdapter.prototype._addRemoteProperties=function(t){this._addProperties("_remoteProperties",t)},t.ModelAdapter.prototype._addProperties=function(t,e){Array.isArray(e)?this[t]=this[t].concat(e):this[t].push(e)},t.ModelAdapter.prototype._removeAdapterProperties=function(e){Array.isArray(e)?t.arrays.removeAll(this._adapterProperties,e):t.arrays.remove(this._adapterProperties,e)},t.ModelAdapter.prototype._send=function(e,o,n){var r={};arguments.length>2&&(null!==n&&"object"==typeof n?r=n:(r.delay=arguments[2],r.coalesce=arguments[3],r.showBusyIndicator=arguments[4])),n=r;var s=new t.Event(this.id,e,o);n.coalesce!==i&&(s.coalesce=n.coalesce),n.showBusyIndicator!==i&&(s.showBusyIndicator=n.showBusyIndicator),this.session.sendEvent(s,n.delay)},t.ModelAdapter.prototype._sendProperty=function(t,e){var i={};i[t]=e,this._send("property",i)},t.ModelAdapter.prototype.addFilterForWidgetEvent=function(t){this._widgetEventTypeFilter.addFilter(t)},t.ModelAdapter.prototype.addFilterForWidgetEventType=function(t){this._widgetEventTypeFilter.addFilterForEventType(t)},t.ModelAdapter.prototype.addFilterForProperties=function(t){this._propertyChangeEventFilter.addFilterForProperties(t)},t.ModelAdapter.prototype._isPropertyChangeEventFiltered=function(t,e){return this._propertyChangeEventFilter.filter(t,e)},t.ModelAdapter.prototype._isWidgetEventFiltered=function(t){return this._widgetEventTypeFilter.filter(t)},t.ModelAdapter.prototype.resetEventFilters=function(){this._propertyChangeEventFilter.reset(),this._widgetEventTypeFilter.reset()},t.ModelAdapter.prototype._onWidgetPropertyChange=function(t){t.changedProperties.forEach(function(e){var i=t.newProperties[e];this._isPropertyChangeEventFiltered(e,i)||this._isRemoteProperty(e)&&(i&&this._isAdapterProperty(e)&&(i=i.modelAdapter.id),this._callSendProperty(e,i))},this)},t.ModelAdapter.prototype._callSendProperty=function(e,i){var o="_send"+t.strings.toUpperCaseFirstLetter(e);this[o]?this[o](i):this._sendProperty(e,i)},t.ModelAdapter.prototype._onWidgetDestroy=function(){this.destroy()},t.ModelAdapter.prototype._onWidgetEventInternal=function(t){this._isWidgetEventFiltered(t)||this._onWidgetEvent(t)},t.ModelAdapter.prototype._onWidgetEvent=function(t){"destroy"===t.type?this._onWidgetDestroy(t):"propertyChange"===t.type?this._onWidgetPropertyChange(t):t.sendToServer&&(t=e.extend({},t),delete t.source,delete t.sendToServer,this._send(t.type,t))},t.ModelAdapter.prototype._syncPropertiesOnPropertyChange=function(e){Object.keys(e).forEach(function(i){var o=e[i],n="_sync"+t.strings.toUpperCaseFirstLetter(i);this[n]?this[n](o):this.widget.callSetter(i,o)},this)},t.ModelAdapter.prototype.onModelEvent=function(t){t&&("property"===t.type?this.onModelPropertyChange(t):this.onModelAction(t))},t.ModelAdapter.prototype.onModelPropertyChange=function(t){this.addFilterForProperties(t.properties),this._syncPropertiesOnPropertyChange(t.properties)},t.ModelAdapter.prototype.onModelAction=function(t){e.log.warn('Model action "'+t.type+'" is not supported by model-adapter '+this.objectType)},t.ModelAdapter.prototype.toString=function(){return"ModelAdapter[objectType="+this.objectType+" id="+this.id+"]"},t.ModelAdapter.prototype.exportAdapterData=function(t){var e=t.modelClass;if(e){var i=Math.max(0,e.lastIndexOf("$")+1,e.lastIndexOf(".")+1);t.id=e.substring(i)}return delete t.owner,delete t.classId,delete t.modelClass,t},t.Widget=function(){this.session,this.owner,this.parent,this.children=[],this.initialized=!1,this.rendering=!1,this.rendered=!1,this.attached=!1,this.destroyed=!1,this.enabled=!0,this.disabledStyle=t.Widget.DisabledStyle.DEFAULT,this.visible=!0,this.loading=!1,this.$container,this.animateRemoval,this._adapterProperties=[],
this._cloneProperties=["visible","enabled","cssClass"],this._preserveOnPropertyChangeProperties=[],this._postRenderActions=[],this._parentDestroyHandler=this._onParentDestroy.bind(this),this.events=this._createEventSupport(),this.loadingSupport=this._createLoadingSupport(),this.keyStrokeContext=this._createKeyStrokeContext()},t.Widget.DisabledStyle={DEFAULT:0,READ_ONLY:1},t.Widget.prototype.init=function(t){var i=this._jsonModel();e.extend(t,i),this._init(t),this._initKeyStrokeContext(),this.initialized=!0,this.trigger("init")},t.Widget.prototype._init=function(e){if(e=e||{},!e.parent)throw new Error("Parent expected: "+this);if(this.setOwner(e.owner||e.parent),this.setParent(e.parent),this.session=e.session||this.parent.session,!this.session)throw new Error("Session expected: "+this);this.animateRemoval=t.nvl(e.animateRemoval,!1),this._eachProperty(e,function(t,e,o){e!==i&&(o&&(e=this._prepareWidgetProperty(t,e)),this[t]=e)}.bind(this))},t.Widget.prototype._jsonModel=function(){},t.Widget.prototype._createChildren=function(t){if(!t)return null;if(!Array.isArray(t))return this._createChild(t);var e=[];return t.forEach(function(t,i){e[i]=this._createChildren(t)},this),e},t.Widget.prototype._createChild=function(e){return e instanceof t.Widget?e:(e.parent=this,t.create(e))},t.Widget.prototype._initKeyStrokeContext=function(){this.keyStrokeContext&&(this.keyStrokeContext.$scopeTarget=function(){return this.$container}.bind(this),this.keyStrokeContext.$bindTarget=function(){return this.$container}.bind(this))},t.Widget.prototype.destroy=function(){if(!this.destroyed){if(this.animateRemoval&&this.rendered)return this.one("remove",function(){this.destroy()}.bind(this)),void this.remove();this._destroyChildren(this.children.slice().reverse()),this.remove(),this.owner.removeChild(this),this.owner=null,this.parent.removeChild(this),this.parent.off("destroy",this._parentDestroyHandler),this.parent=null,this.destroyed=!0,this.trigger("destroy")}},t.Widget.prototype._destroyChildren=function(e){e&&(e=t.arrays.ensure(e),e.forEach(function(t,e){this._destroyChild(t)},this))},t.Widget.prototype._destroyChild=function(t){t.owner===this&&t.destroy()},t.Widget.prototype.render=function(t){if(e.log.trace("Rendering widget: "+this),!this.initialized)throw new Error("Not initialized: "+this);if(this.rendered)throw new Error("Already rendered: "+this);if(this.destroyed)throw new Error("Widget is destroyed: "+this);this.rendering=!0,this.$parent=t,this._render(t),this._renderProperties(),this._renderInspectorInfo(),this._linkWithDOM(),this.session.keyStrokeManager.installKeyStrokeContext(this.keyStrokeContext),this.rendering=!1,this.rendered=!0,this.attached=!0,this.trigger("render"),this._postRender()},t.Widget.prototype._render=function(t){},t.Widget.prototype._renderProperties=function(){this._renderEnabled(),this._renderVisible(),this._renderCssClass(),this._renderLoading()},t.Widget.prototype._postRender=function(){var t=this._postRenderActions;this._postRenderActions=[],t.forEach(function(t){t()})},t.Widget.prototype.remove=function(){this.rendered&&!this._isRemovalPending()&&(this.animateRemoval?this._removeAnimated():this._removeInternal())},t.Widget.prototype._isRemovalPending=function(){if(this.removalPending)return!0;var t=this.parent;if(!t||t.removing)return!1;for(;t;){if(t.removalPending)return!0;t=t.parent}return!1},t.Widget.prototype._removeInternal=function(){this.rendered&&(e.log.trace("Removing widget: "+this),this.removing=!0,this.children.slice().reverse().forEach(function(t){t.parent===this&&t.remove()},this),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.keyStrokeContext),this._cleanup(),this._remove(),this.$parent=null,this.rendered=!1,this.attached=!1,this.removing=!1,this.trigger("remove"))},t.Widget.prototype._removeAnimated=function(){return t.device.supportsCssAnimation()&&this.$container?(this.session.desktop.destroyPopupsFor(this),this.removalPending=!0,void setTimeout(function(){this.$container.addClass("removed"),this.$container.oneAnimationEnd(function(){this.removalPending=!1,this._removeInternal()}.bind(this))}.bind(this))):void this._removeInternal()},t.Widget.prototype._renderInspectorInfo=function(){this.session.inspector&&t.inspector.applyInfo(this)},t.Widget.prototype._linkWithDOM=function(){this.$container&&this.$container.data("widget",this)},t.Widget.prototype._cleanup=function(){this.$container&&this.session.layoutValidator.cleanupInvalidComponents(this.$container)},t.Widget.prototype._remove=function(){this.$container&&(this.$container.remove(),this.$container=null)},t.Widget.prototype.setOwner=function(e){t.assertParameter("owner",e),e!==this.owner&&(this.owner&&this.owner.removeChild(this),this.owner=e,this.owner.addChild(this))},t.Widget.prototype.setParent=function(e){if(t.assertParameter("parent",e),e!==this.parent){if(this.parent){if(this.parent._isRemovalPending())return void this.parent.one("remove",function(){this.setParent(e)}.bind(this));this.parent.off("destroy",this._parentDestroyHandler),this.parent!==this.owner&&this.parent.removeChild(this)}this.parent=e,this.parent.addChild(this),this.parent.one("destroy",this._parentDestroyHandler)}},t.Widget.prototype.addChild=function(t){e.log.trace("addChild("+t+") to "+this),this.children.indexOf(t)===-1&&this.children.push(t)},t.Widget.prototype.removeChild=function(i){e.log.trace("removeChild("+i+") from "+this),t.arrays.remove(this.children,i)},t.Widget.prototype.isOrHas=function(t){return t===this||this.has(t)},t.Widget.prototype.has=function(t){for(;t;){if(t.parent===this)return!0;t=t.parent}return!1},t.Widget.prototype.setEnabled=function(t){this.setProperty("enabled",t)},t.Widget.prototype._renderEnabled=function(){this.$container&&(this.$container.setEnabled(this.enabled),this._renderDisabledStyle())},t.Widget.prototype.setDisabledStyle=function(t){this.setProperty("disabledStyle",t)},t.Widget.prototype._renderDisabledStyle=function(){this._renderDisabledStyleInternal(this.$container)},t.Widget.prototype._renderDisabledStyleInternal=function(e){if(e){var i=this.enabled;this instanceof t.FormField&&(i=this.enabledComputed),i?e.removeClass("read-only"):e.toggleClass("read-only",this.disabledStyle===t.Widget.DisabledStyle.READ_ONLY)}},t.Widget.prototype.setVisible=function(t){this.setProperty("visible",t)},t.Widget.prototype._renderVisible=function(){this.$container&&this.$container.setVisible(this.visible)},t.Widget.prototype._syncCssClass=function(t){this.rendered&&this._removeCssClass(),this._setProperty("cssClass",t)},t.Widget.prototype._removeCssClass=function(){this.$container&&this.$container.removeClass(this.cssClass)},t.Widget.prototype._renderCssClass=function(){this.$container&&this.$container.addClass(this.cssClass)},t.Widget.prototype.setCssClass=function(t){this.setProperty("cssClass",t)},t.Widget.prototype._createLoadingSupport=function(){return null},t.Widget.prototype.setLoading=function(t){this.setProperty("loading",t)},t.Widget.prototype._renderLoading=function(){this.loadingSupport&&this.loadingSupport.renderLoading()},t.Widget.prototype.pack=function(){if(this.rendered){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.pack()}},t.Widget.prototype.invalidateLayout=function(){if(this.rendered){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.invalidateLayout()}},t.Widget.prototype.validateLayout=function(){if(this.rendered){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.validateLayout()}},t.Widget.prototype.revalidateLayout=function(){if(this.rendered){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.revalidateLayout()}},t.Widget.prototype.invalidateLayoutTree=function(t){if(this.rendered){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.invalidateLayoutTree(t)}},t.Widget.prototype.validateLayoutTree=function(){if(this.rendered){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.validateLayoutTree()}},t.Widget.prototype.revalidateLayoutTree=function(){if(this.rendered){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.revalidateLayoutTree()}},t.Widget.prototype.setLayoutData=function(t){if(this.rendered){if(!this.htmlComp)throw new Error("Function expects a htmlComp property");this.htmlComp.layoutData=t}},t.Widget.prototype._createEventSupport=function(){return new t.EventSupport},t.Widget.prototype.trigger=function(t,e){e=e||{},e.source=this,this.events.trigger(t,e)},t.Widget.prototype.one=function(t,e){this.events.one(t,e)},t.Widget.prototype.on=function(t,e){return this.events.on(t,e)},t.Widget.prototype.off=function(t,e){this.events.off(t,e)},t.Widget.prototype.addListener=function(t){this.events.addListener(t)},t.Widget.prototype.removeListener=function(t){this.events.removeListener(t)},t.Widget.prototype.entryPoint=function(e){if(e=t.nvl(e,this.$container),!e.length)throw new Error("Cannot resolve entryPoint, $element.length is 0 or undefined");return e.entryPoint()},t.Widget.prototype.attach=function(){!this.attached&&this.rendered&&(this._attach(),this._triggerChildrenAfterAttach(this))},t.Widget.prototype._triggerChildrenAfterAttach=function(t){this.children.forEach(function(e){e._afterAttach(t),e._triggerChildrenAfterAttach(t)})},t.Widget.prototype._afterAttach=function(t){},t.Widget.prototype._attach=function(t){this.attached=!0},t.Widget.prototype.detach=function(){this.rendering&&this._postRenderActions.push(this.detach.bind(this)),this.attached&&this.rendered&&!this._isRemovalPending()&&(this._triggerChildrenBeforeDetach(this),this._detach())},t.Widget.prototype._detach=function(){this.attached=!1},t.Widget.prototype._triggerChildrenBeforeDetach=function(t){this.children.forEach(function(e){e._beforeDetach(t),e._triggerChildrenBeforeDetach(t)})},t.Widget.prototype._beforeDetach=function(t){},t.Widget.prototype._createKeyStrokeContext=function(){return null},t.Widget.prototype.updateKeyStrokes=function(t,e){this.unregisterKeyStrokes(e),this.registerKeyStrokes(t)},t.Widget.prototype.registerKeyStrokes=function(e){e=t.arrays.ensure(e),e.forEach(function(t){this.keyStrokeContext.registerKeyStroke(t)},this)},t.Widget.prototype.unregisterKeyStrokes=function(e){e=t.arrays.ensure(e),e.forEach(function(t){this.keyStrokeContext.unregisterKeyStroke(t)},this)},t.Widget.prototype.triggerBulkPropertyChange=function(t,e){var i={newProperties:e,oldProperties:t,changedProperties:[]};for(var o in e)e[o]!==t[o]&&i.changedProperties.push(o);this.trigger("propertyChange",i)},t.Widget.prototype.triggerPropertyChange=function(t,e,i){if(t){var o={},n={};o[t]=e,n[t]=i,this.triggerBulkPropertyChange(o,n)}},t.Widget.prototype._setProperty=function(t,e){if(t){var i=this[t];this[t]=e,this.triggerPropertyChange(t,i,e)}},t.Widget.prototype.setProperty=function(e,i){t.objects.equals(this[e],i)||(i=this._prepareProperty(e,i),this.rendered&&this._callRemoveProperty(e),this._callSetProperty(e,i),this.rendered&&this._callRenderProperty(e))},t.Widget.prototype._prepareProperty=function(t,e){return this._isAdapterProperty(t)?this._prepareWidgetProperty(t,e):e},t.Widget.prototype._prepareWidgetProperty=function(e,i){i=this._createChildren(i);var o=this[e];return o&&Array.isArray(i)&&(o=o.slice(),t.arrays.removeAll(o,i)),this._isPreserveOnPropertyChangeProperty(e)||this._destroyChildren(o),this.link(i),i},t.Widget.prototype._callRemoveProperty=function(e){if(this._isAdapterProperty(e)&&!this._isPreserveOnPropertyChangeProperty(e)){var i=this[e];if(i){var o="_remove"+t.strings.toUpperCaseFirstLetter(e);this[o]?this[o]():this._internalRemoveWidgets(i)}}},t.Widget.prototype._internalRemoveWidgets=function(e){e=t.arrays.ensure(e),e.forEach(function(t){t.remove()})},t.Widget.prototype._callSetProperty=function(e,i){var o="_sync"+t.strings.toUpperCaseFirstLetter(e);this[o]?this[o](i):this._setProperty(e,i)},t.Widget.prototype._callRenderProperty=function(e){var i="_render"+t.strings.toUpperCaseFirstLetter(e);this[i]&&this[i]()},t.Widget.prototype.link=function(e){e&&(e=t.arrays.ensure(e),e.forEach(function(t,e){t.setParent(this)},this))},t.Widget.prototype.glassPaneTargets=function(){return this.rendered?this._glassPaneTargets():t.DeferredGlassPaneTarget.createFor(this,this._glassPaneTargets.bind(this))},t.Widget.prototype._glassPaneTargets=function(){return[this.$container]},t.Widget.prototype.toString=function(){return"Widget[rendered="+this.rendered+(this.$container?" $container="+t.graphics.debugOutput(this.$container):"")+"]"},t.Widget.prototype.resolveTextKeys=function(e){e.forEach(function(e){t.texts.resolveTextProperty(this,e)},this)},t.Widget.prototype.resolveIconIds=function(e){e.forEach(function(e){this[e]=t.icons.resolveIconId(this[e])},this)},t.Widget.prototype._addAdapterProperties=function(t){this._addProperties("_adapterProperties",t)},t.Widget.prototype._isAdapterProperty=function(t){return this._adapterProperties.indexOf(t)>-1},t.Widget.prototype._addCloneProperties=function(t){this._addProperties("_cloneProperties",t)},t.Widget.prototype._isCloneProperty=function(t){return this._cloneProperties.indexOf(t)>-1},t.Widget.prototype._addPreserveOnPropertyChangeProperties=function(t){this._addProperties("_preserveOnPropertyChangeProperties",t)},t.Widget.prototype._isPreserveOnPropertyChangeProperty=function(t){return this._preserveOnPropertyChangeProperties.indexOf(t)>-1},t.Widget.prototype._addProperties=function(t,e){Array.isArray(e)?this[t]=this[t].concat(e):this[t].push(e)},t.Widget.prototype._eachProperty=function(t,e){var o,n,r;for(o in t)this._adapterProperties.indexOf(o)>-1||(n=t[o],e(o,n));for(r=0;r<this._adapterProperties.length;r++)o=this._adapterProperties[r],n=t[o],n!==i&&e(o,n,!0)},t.Widget.prototype._removeAdapterProperties=function(e){Array.isArray(e)?t.arrays.removeAll(this._adapterProperties,e):t.arrays.remove(this._adapterProperties,e)};t.Widget.prototype._send=function(t,i){i=e.extend({},i),i.sendToServer=!0,this.trigger(t,i)};t.Widget.prototype.cloneAndMirror=function(t){var e=this.clone(t);return e.mirror(),e},t.Widget.prototype.original=function(){for(var t=this;t.cloneOf;)t=t.cloneOf;return t},t.Widget.prototype.clone=function(e){var i,o;return e=e||{},o=t.objects.extractProperties(this,e,this._cloneProperties),i=t.create(this.objectType,o),i.cloneOf=this,i},t.Widget.prototype.mirror=function(){if(!this.cloneOf)throw new Error("Widget is not a clone.");this._mirror(this.cloneOf),this.children.forEach(function(t){t.cloneOf&&t.mirror(t.cloneOf)})},t.Widget.prototype._mirror=function(t){this._mirrorListener||(this._mirrorListener={func:this._onMirrorEvent.bind(this)},t.events.addListener(this._mirrorListener),this.one("destroy",function(){this.unmirror(t)}.bind(this)))},t.Widget.prototype.unmirror=function(){this.children.forEach(function(t){t.cloneOf&&t.unmirror(t.cloneOf)}),this._unmirror(this.cloneOf)},t.Widget.prototype._unmirror=function(t){this._mirrorListener&&(t.events.removeListener(this._mirrorListener),this._mirrorListener=null)},t.Widget.prototype._onMirrorEvent=function(t){"propertyChange"===t.type&&this._onMirrorPropertyChange(t)},t.Widget.prototype._onMirrorPropertyChange=function(t){t.changedProperties.forEach(function(e){this.callSetter(e,t.newProperties[e])},this)},t.Widget.prototype._onParentDestroy=function(t){this.destroyed||this.setParent(this.owner)},t.Widget.prototype.callSetter=function(e,i){var o="set"+t.strings.toUpperCaseFirstLetter(e);this[o]?this[o](i):this.setProperty(e,i)},t.Widget.prototype.widget=function(t){function e(t,i){if(t.id===i)return t;var o,n;if(!(t.children&&t.children.length>0))return null;for(o=0;o<t.children.length;o++){if(n=t.children[o],n.id===i)return n;if(n=e(n,i))return n}}return e(this,t)},t.Widget.prototype.getWidgetById=function(t){return this.widget(t)},t.Widget.prototype.requestFocus=function(){return this.rendered?void this.session.focusManager.requestFocus(this.$container):void this._postRenderActions.push(this.requestFocus.bind(this))},t.Widget.getWidgetFor=function(t){for(;t&&t.length>0;){var e=t.data("widget");if(e)return e;t=t.parent()}return null},t.Composite=function(){t.Composite.parent.call(this),this.widgets=[],this._addAdapterProperties(["widgets"])},t.inherits(t.Composite,t.Widget),t.Composite.prototype._render=function(e){this.$container=e.appendDiv(),this.htmlComp=t.HtmlComponent.install(this.$container,this.session)},t.Composite.prototype._renderProperties=function(){t.Composite.parent.prototype._renderProperties.call(this),this._renderWidgets()},t.Composite.prototype.setWidgets=function(t){this.setProperty("widgets",t)},t.Composite.prototype._renderWidgets=function(t){this.widgets.forEach(function(t){t.render(this.$container)},this),this.invalidateLayoutTree()},t.NullWidget=function(){t.NullWidget.parent.call(this),this._addAdapterProperties(["childWidget"])},t.inherits(t.NullWidget,t.Widget),t.NullWidget.prototype.setChildWidget=function(t){this.setProperty("childWidget",t)},t.NullWidgetAdapter=function(){t.NullWidgetAdapter.parent.call(this),this._addAdapterProperties(["childWidget"])},t.inherits(t.NullWidgetAdapter,t.ModelAdapter),t.arrays={ensure:function(t){return t===i||null===t?[]:Array.isArray(t)?t:[t]},init:function(t,e){for(var i=[],o=0;o<t;o++)i[o]=e;return i},remove:function(t,e){if(t){var i=t.indexOf(e);if(i!==-1)return t.splice(i,1),!0}return!1},removeAll:function(t,e){var i=!1;if(!e||0===e.length)return!1;for(var o=t.length-1;o>=0;o--)e.indexOf(t[o])>-1&&(t.splice(o,1),i=!0);return i},replace:function(t,e,i){var o=t.indexOf(e);return o!==-1&&(t[o]=i),o},insert:function(e,i,o){t.arrays.insertArray(e,i,o)},insertArray:function(e,i,o){i=t.arrays.ensure(i),Array.prototype.splice.apply(e,[o,0].concat(i))},move:function(t,e,i){t.splice(i,0,t.splice(e,1)[0])},containsAny:function(t,e){return t=this.ensure(t),e=this.ensure(e),e.some(function(e){return t.indexOf(e)>=0})},containsAll:function(t,e){return t=this.ensure(t),e=this.ensure(e),e.every(function(e){return t.indexOf(e)>=0})},first:function(t){return Array.isArray(t)?t[0]:t},last:function(t){return Array.isArray(t)?t[t.length-1]:t},pushAll:function(t,e){t.push.apply(t,e)},union:function(t,e){var i=[],o={};return t=this.ensure(t),e=this.ensure(e),t.forEach(function(t){var e=t;"object"==typeof t&&(e=t.id),o[e]=t,i.push(t)}),e.forEach(function(t){var e=t;"object"==typeof t&&(e=t.id),e in o||i.push(t)}),i},equalsIgnoreOrder:function(e,i){return e===i||(!(e&&0!==e.length||i&&0!==i.length)||!(!e||!i)&&(e.length===i.length&&t.arrays.containsAll(e,i)))},equals:function(t,e){if(t===e)return!0;if(!(t&&0!==t.length||e&&0!==e.length))return!0;if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},greater:function(t,e){var i=0,o=0;return t&&(i=t.length),e&&(o=e.length),i>o},eachSibling:function(t,e,i){if(t&&i)for(var o=0;o<t.length;o++){var n=t[o];n!==e&&i(n,o)}},findIndex:function(t,e,i){if(!t||!e)return-1;for(var o=0;o<t.length;o++)if(e.call(i,t[o],o,t))return o;return-1},find:function(t,e){if(!t||!e)return null;for(var i=0;i<t.length;i++){var o=t[i];if(e(o,i))return o}},findFrom:function(e,i,o,n){return n?t.arrays.findFromPrev(e,i,o):t.arrays.findFromNext(e,i,o)},findFromNext:function(t,e,i){if(!t||!i)return null;for(var o=e;o<t.length;o++){var n=t[o];if(i(n,o))return n}},findFromPrev:function(t,e,i){if(!t||!i)return null;for(var o=e;o>=0;o--){var n=t[o];if(i(n,o))return n}},format:function(e,i,o){if(!e||0===e.length)return"";for(var n="",r=0;r<e.length;r++){var s=e[r];i&&r>0&&r<e.length&&(n+=i),o&&(s=t.strings.encode(s)),n+=s}return n},formatEncoded:function(e,i){return t.arrays.format(e,i,!0)},max:function(t){return Math.max.apply(Math,t)},min:function(t){return Math.min.apply(Math,t)},$indexOf:function(t,e){for(var i=0;i<t.length;i++)if(t[i][0]===e[0])return i},$remove:function(e,i){var o=t.arrays.$indexOf(e,i);o>=0&&e.splice(o,1)},$:function(t){return e(t).map(function(){return this[0]})}},t.Code=function(){this.active,this.id,this.parent,this.children=[]},t.Code.prototype.init=function(e){if(t.assertParameter("id",e.id),this.active=e.active,this.id=e.id,this._text=e.text,this.modelClass=e.modelClass,e.texts){if(this._text)throw new Error("Either set texts or text property, not both.");var i=t.codes.registerTexts(this,e.texts);this._text=t.texts.buildKey(i)}},t.Code.prototype.text=function(e){var i=e;return"object"==typeof e&&(i=e.languageTag),t.texts.resolveText(this._text,i)},t.CodeType=function(){this.id,this.codes=[],this.codeMap={}},t.CodeType.prototype.init=function(e){t.assertParameter("id",e.id),this.id=e.id,this.modelClass=e.modelClass;var i;if(e.codes)for(i=0;i<e.codes.length;i++)this._initCode(e.codes[i])},t.CodeType.prototype._initCode=function(e,i){var o,n;if(n=t.create(e),this.add(n,i),e.children)for(o=0;o<e.children.length;o++)this._initCode(e.children[o],n)},t.CodeType.prototype.add=function(t,e){this.codes.push(t),this.codeMap[t.id]=t,e&&(e.children.push(t),t.parent=e)},t.CodeType.prototype.get=function(t){var e=this.codeMap[t];if(!e)throw new Error("No code found for id="+t);return e},t.CodeType.prototype.getCodes=function(t){if(t){for(var e=[],i=0;i<this.codes.length;i++)this.codes[i].parent||e.push(this.codes[i]);return e}return this.codes},t.CodeType.ensure=function(e){return e?e instanceof t.CodeType?e:t.create("CodeType",e):e},t.codes={defaultLanguage:"en",registry:{},bootstrap:function(i){return i=t.nvl(i,"res/codes.json"),e.ajaxJson(i).done(this.init.bind(this))},init:function(t){t=t||{},Object.keys(t).forEach(function(e){this.add(t[e])},this)},add:function(e){e=t.arrays.ensure(e),e.forEach(function(e){e=t.CodeType.ensure(e),this.registry[e.id]=e},this)},get:function(e,i){var o;if(2===arguments.length)o=e;else{var n=e.split(" ");if(2!==n.length)throw new Error('Invalid string. Must have format "[CodeType.id] [Code.id]"');o=n[0],i=n[1]}return t.assertParameter("codeTypeId",o),t.assertParameter("codeId",i),this.codeType(o).get(i)},codeType:function(t,e){var i=this.registry[t];if(!e&&!i)throw new Error("No CodeType found for id="+t);return i},generateTextKey:function(t){return"__code."+t.id},registerTexts:function(e,i){var o=t.codes.generateTextKey(e);for(var n in i){var r=i[n];n&&n===this.defaultLanguage&&(n="default"),t.texts.get(n).add(o,r)}return o}},t.dates={shift:function(e,i,o,n){var r=new Date(e.getTime());return i&&(r.setFullYear(e.getFullYear()+i),t.dates.compareMonths(r,e)!==12*i&&r.setDate(0)),o&&(r.setMonth(e.getMonth()+o),t.dates.compareMonths(r,e)!==o+12*i&&r.setDate(0)),n&&r.setDate(e.getDate()+n),r},shiftTime:function(t,e,i,o,n){var r=new Date(t.getTime());return e&&r.setHours(t.getHours()+e),i&&r.setMinutes(t.getMinutes()+i),o&&r.setSeconds(t.getSeconds()+o),n&&r.setMilliseconds(t.getMilliseconds()+n),r},shiftToNextDayOfType:function(e,i){var o=i-e.getDay();return o<=0&&(o+=7),t.dates.shift(e,0,0,o)},shiftToPreviousDayOfType:function(e,i){var o=i-e.getDay();return o>=0&&(o-=7),t.dates.shift(e,0,0,o)},shiftToNextOrPrevDayOfType:function(e,i,o){return o>0?t.dates.shiftToNextDayOfType(e,i):t.dates.shiftToPreviousDayOfType(e,i)},shiftToNextOrPrevMonday:function(e,i){return t.dates.shiftToNextOrPrevDayOfType(e,1,i)},ensure:function(e){return e?e instanceof Date?e:t.dates.parseJsonDate(e):e},ensureMonday:function(e,i){return 1===e.getDay()?e:t.dates.shiftToNextOrPrevMonday(e,i)},isSameDay:function(t,e){return!(!t||!e)&&(t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate())},compareMonths:function(t,e){var i=t.getMonth(),o=e.getMonth(),n=t.getFullYear(),r=e.getFullYear(),s=i-o;return n===r?s:12*(n-r)+s},compareDays:function(e,i){return(t.dates.trunc(e)-t.dates.trunc(i)-6e4*(e.getTimezoneOffset()-i.getTimezoneOffset()))/864e5},timestamp:function(e,i){var o=e||new Date;return i?t.strings.padZeroLeft(o.getUTCFullYear(),4)+t.strings.padZeroLeft(o.getUTCMonth()+1,2)+t.strings.padZeroLeft(o.getUTCDate(),2)+t.strings.padZeroLeft(o.getUTCHours(),2)+t.strings.padZeroLeft(o.getUTCMinutes(),2)+t.strings.padZeroLeft(o.getUTCSeconds(),2)+t.strings.padZeroLeft(o.getUTCMilliseconds(),3):t.strings.padZeroLeft(o.getFullYear(),4)+t.strings.padZeroLeft(o.getMonth()+1,2)+t.strings.padZeroLeft(o.getDate(),2)+t.strings.padZeroLeft(o.getHours(),2)+t.strings.padZeroLeft(o.getMinutes(),2)+t.strings.padZeroLeft(o.getSeconds(),2)+t.strings.padZeroLeft(o.getMilliseconds(),3)},orderWeekdays:function(t,e){for(var i=[],o=0;o<7;o++)i[o]=t[(o+e)%7];return i},weekInYear:function(t,e){if(!t)return i;var o=1;"object"==typeof e?e.symbols!==i&&e.symbols.firstDayOfWeek!==i?o=e.symbols.firstDayOfWeek:e.decimalFormatSymbols!==i&&e.decimalFormatSymbols.firstDayOfWeek!==i&&(o=e.decimalFormatSymbols.firstDayOfWeek):"number"==typeof e&&(o=e);var n=this._thursdayOfWeek(t,o),r=new Date(n.getFullYear(),0,4),s=this._firstDayOfWeek(r,o);t.getTime()<s.getTime()&&(r=new Date(n.getFullYear()-1,0,4));var a=this._thursdayOfWeek(r,o),l=(n.getTime()-a.getTime())/864e5;return 1+Math.round(l/7)},_thursdayOfWeek:function(t,e){if(!t||"number"!=typeof e)return i;var o=new Date(t.valueOf());return 4!==o.getDay()&&(o.getDay()<e&&o.setDate(o.getDate()-7),o.setDate(o.getDate()-o.getDay()+4)),o},_firstDayOfWeek:function(t,e){if(!t||"number"!=typeof e)return i;var o=new Date(t.valueOf());return o.getDay()!==e&&o.setDate(o.getDate()-(o.getDay()+7-e)%7),o},parseJsonDate:function(t){if(!t)return null;var e="1970",i="01",o="01",n="00",r="00",s="00",a="000",l=!1,h=/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})\.(\d{3})(Z?)$/.exec(t);if(null!==h)e=h[1],i=h[2],o=h[3],n=h[4],r=h[5],s=h[6],a=h[7],l="Z"===h[8];else if(h=/^(\d{4})-(\d{2})-(\d{2})(Z?)$/.exec(t),null!==h)e=h[1],i=h[2],o=h[3],l="Z"===h[4];else{if(h=/^(\d{2}):(\d{2}):(\d{2})\.(\d{3})(Z?)$/.exec(t),null===h)throw new Error("Unparsable date: "+t);n=h[1],r=h[2],s=h[3],a=h[4],l="Z"===h[5]}var d;return l?(d=new Date(Date.UTC(e,i-1,o,n,r,s,a)),e<100&&d.setUTCFullYear(e)):(d=new Date(e,i-1,o,n,r,s,a),e<100&&d.setFullYear(e)),d},toJsonDate:function(e,o,n,r){if(!e)return null;n===i&&(n=!0),r===i&&(r=!0);var s,a,l;o?(s=t.strings.padZeroLeft(e.getUTCFullYear(),4)+"-"+t.strings.padZeroLeft(e.getUTCMonth()+1,2)+"-"+t.strings.padZeroLeft(e.getUTCDate(),2),a=t.strings.padZeroLeft(e.getUTCHours(),2)+":"+t.strings.padZeroLeft(e.getUTCMinutes(),2)+":"+t.strings.padZeroLeft(e.getUTCSeconds(),2)+"."+t.strings.padZeroLeft(e.getUTCMilliseconds(),3),l="Z"):(s=t.strings.padZeroLeft(e.getFullYear(),4)+"-"+t.strings.padZeroLeft(e.getMonth()+1,2)+"-"+t.strings.padZeroLeft(e.getDate(),2),a=t.strings.padZeroLeft(e.getHours(),2)+":"+t.strings.padZeroLeft(e.getMinutes(),2)+":"+t.strings.padZeroLeft(e.getSeconds(),2)+"."+t.strings.padZeroLeft(e.getMilliseconds(),3),l="");var h="";return n&&(h+=s,r&&(h+=" ")),r&&(h+=a),h+=l},toJsonDateRange:function(e){return{from:t.dates.toJsonDate(e.from),to:t.dates.toJsonDate(e.to)}},create:function(t){if(t){var e=/^(\d{4})(?:-(\d{2})(?:-(\d{2})(?: (\d{2})(?::(\d{2})(?::(\d{2})(?:\.(\d{3}))?(Z?))?)?)?)?)?/.exec(t);if(null===e)throw new Error("Unparsable date: "+t);var o;return o="Z"===e[8]?new Date(Date.UTC(e[1],(e[2]||1)-1,e[3]||1,e[4]||0,e[5]||0,e[6]||0,e[7]||0)):new Date(e[1],(e[2]||1)-1,e[3]||1,e[4]||0,e[5]||0,e[6]||0,e[7]||0)}return i},format:function(e,i,o){var n=new t.DateFormat(i,o);return n.format(e)},compare:function(t,e){if(!t&&!e)return 0;if(!t)return-1;if(!e)return 1;var i=t.getTime()-e.getTime();return i<-1?-1:i>1?1:i},equals:function(t,e){return 0===this.compare(t,e)},combineDateTime:function(e,i){var o=new Date(0);return e&&o.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),i&&(o.setHours(t.nvl(i.getHours(),0)),o.setMinutes(t.nvl(i.getMinutes(),0)),o.setSeconds(t.nvl(i.getSeconds(),0)),o.setMilliseconds(t.nvl(i.getMilliseconds(),0))),o},isLeapYear:function(t){if(t===i||null===t)return!1;var e=new Date(t,1,29);return 29===e.getDate()},trunc:function(e,i){return e&&(t.nvl(i,!0)&&(e=new Date(e.getTime())),e.setHours(0,0,0,0)),e}},t.defaultValues={_defaults:{},_objectTypeHierarchyFlat:{},bootstrap:function(t){t=t||{};var i={url:"defaultValues"};return t=e.extend({},i,t),e.ajaxJson(t.url).done(this.init.bind(this))},init:function(t){this._objectTypeHierarchyFlat={},this._defaults=t.defaults||{};var e=t.objectTypeHierarchy||{};this._generateObjectTypeHierarchyRec(e,i,this._objectTypeHierarchyFlat),Object.keys(this._defaults).forEach(function(t){this._objectTypeHierarchyFlat[t]||(this._objectTypeHierarchyFlat[t]=[t])},this)},_generateObjectTypeHierarchyRec:function(t,e,i){if(t){if(!i)throw new Error("Argument 'targetMap' must not be null");Object.keys(t).forEach(function(o){var n=[o];if(e&&(n=n.concat(e)),"object"==typeof t[o]&&this._generateObjectTypeHierarchyRec(t[o],n,i),i[o])throw new Error("Object type '"+o+"' has ambiguous parent object types.");i[o]=n},this)}},applyTo:function(t,e){if(Array.isArray(t))for(var i=0;i<t.length;i++)this.applyTo(t[i],e);else"object"==typeof t&&(e=e||t.objectType,e&&this._applyToInternal(t,e))},_applyToInternal:function(e,i){var o=this._objectTypeHierarchyFlat[i];if(o||(i=i.replace(new RegExp(t.strings.quote(t.ObjectFactory.MODEL_VARIANT_SEPARATOR)+".*"),""),o=this._objectTypeHierarchyFlat[i]),o)for(var n=0;n<o.length;n++){var r=o[n],s=this._defaults[r];this._extendWithDefaults(e,s)}},_extendWithDefaults:function(e,o){e!==i&&o!==i&&Object.keys(o).forEach(function(n){var r=n;if(t.strings.startsWith(n,"~")&&(r=n.substring(1)),e[r]===i)e[r]=t.objects.valueCopy(o[r]);else if(t.objects.isPlainObject(e[r])&&t.objects.isPlainObject(o[n]))this._extendWithDefaults(e[r],o[n]);else if(Array.isArray(e[r])&&t.objects.isPlainObject(o[n]))for(var s=e[r],a=0;a<s.length;a++)t.objects.isPlainObject(s[a])&&this._extendWithDefaults(s[a],o[n])},this)}},t.DetachHelper=function(t){this.session=t,this._defaultOptions={storeScrollPositions:!0,storeTooltips:!0,storeFocus:!0}},t.DetachHelper.prototype.beforeDetach=function(t,i){i=e.extend(this._defaultOptions,i||{}),i.storeScrollPositions&&this._storeScrollPositions(t),i.storeTooltips&&this._storeTooltips(t),this._storeFocusAndFocusContext(t,i)},t.DetachHelper.prototype.afterAttach=function(t){this._restoreScrollPositions(t),this._restoreTooltips(t),this._restoreFocusAndFocusContext(t)},t.DetachHelper.prototype._storeScrollPositions=function(e){t.scrollbars.storeScrollPositions(e,this.session)},t.DetachHelper.prototype._restoreScrollPositions=function(e){t.scrollbars.restoreScrollPositions(e,this.session)},t.DetachHelper.prototype._storeTooltips=function(e){var i,o,n=t.tooltips.find(e);i=function(e){t.arrays.remove(n,e.source),e.source.off("render",o)},o=function(t){t.source.off("destroy",i)},n.forEach(function(t){t.rendered&&(t.remove(),t.one("render",o),t.one("destroy",i))}),e.data("tooltips",n)},t.DetachHelper.prototype._restoreTooltips=function(t){var e=t.data("tooltips");e&&(e.forEach(function(t){t.render(t.$parent)}),t.data("tooltips",null))},t.DetachHelper.prototype._storeFocusAndFocusContext=function(e,i){var o=(e.is(":focus")?e:e.find(":focus"))[0];i.storeFocus&&(o?e.data("focus",o):e.removeData("focus")),this.session.focusManager.isFocusContextInstalled(e)?(this.session.focusManager.uninstallFocusContext(e),e.data("focusContext",!0)):(e.removeData("focusContext"),o&&this.session.focusManager.validateFocus(t.filters.outsideFilter(e)))},t.DetachHelper.prototype._restoreFocusAndFocusContext=function(e){var i=e.data("focus"),o=e.data("focusContext");o?this.session.focusManager.installFocusContext(e,i||t.focusRule.AUTO):i?this.session.focusManager.requestFocus(i):this.session.focusManager.validateFocus()},t.Device=function(e){this.userAgent=e,this.features={},this.system=t.Device.System.UNKNOWN,this.type=t.Device.Type.DESKTOP,this.browser=t.Device.Browser.UNKNOWN,this.browserVersion=0,this.scrollbarWidth,this.unselectableAttribute=t.Device.DEFAULT_UNSELECTABLE_ATTRIBUTE,this.tableAdditionalDivRequired=!1,e&&(this._parseSystem(e),this._parseSystemVersion(e),this._parseBrowser(e),
this._parseBrowserVersion(e))},t.Device.DEFAULT_UNSELECTABLE_ATTRIBUTE={key:null,value:null,string:""},t.Device.vendorPrefixes=["Webkit","Moz","O","ms","Khtml"],t.Device.Browser={UNKNOWN:"Unknown",FIREFOX:"Firefox",CHROME:"Chrome",INTERNET_EXPLORER:"InternetExplorer",EDGE:"Edge",SAFARI:"Safari"},t.Device.System={UNKNOWN:"Unknown",IOS:"IOS",ANDROID:"ANDROID"},t.Device.Type={DESKTOP:"DESKTOP",TABLET:"TABLET",MOBILE:"MOBILE"},t.Device.prototype.bootstrap=function(){var t=[];return this.unselectableAttribute=this.getUnselectableAttribute(),this.tableAdditionalDivRequired=this.isTableAdditionalDivRequired(),this.scrollbarWidth=this._detectScrollbarWidth(),this.type=this._detectType(this.userAgent),this._needsFastClick()?t.push(this._loadFastClickDeferred()):this.isIos()&&this._installActiveHandler(),this.hasOnScreenKeyboard()&&t.push(this._loadJQueryMobileDeferred()),t},t.Device.prototype._needsFastClick=function(){return!!this.isIos()&&!(this.systemVersion>=9.3&&!this.isStandalone())},t.Device.prototype._loadFastClickDeferred=function(){return this._loadScriptDeferred("res/fastclick-1.0.6.js",function(){FastClick.attach(document.body),e.log.info("FastClick script loaded and attached")})},t.Device.prototype._loadJQueryMobileDeferred=function(){return this._loadScriptDeferred("res/jquery.mobile.custom-1.4.5.js",function(){e.log.info("JQuery Mobile script loaded")})},t.Device.prototype._loadScriptDeferred=function(t,i){return e.injectScript(t).done(i)},t.Device.prototype._installActiveHandler=function(){document.addEventListener("touchstart",function(){},!1)},t.Device.prototype.hasOnScreenKeyboard=function(){return this.supportsFeature("_onScreenKeyboard",function(){return this.isIos()||this.isAndroid()||this.isWindowsTablet()}.bind(this))},t.Device.prototype.isCustomEllipsisTooltipPossible=function(){return this.browser!==t.Device.Browser.SAFARI},t.Device.prototype.isIos=function(){return t.Device.System.IOS===this.system},t.Device.prototype.isAndroid=function(){return t.Device.System.ANDROID===this.system},t.Device.prototype.isWindowsTablet=function(){return t.Device.Browser.EDGE===this.browser&&0===this.scrollbarWidth},t.Device.prototype.isStandalone=function(){return!!window.navigator.standalone},t.Device.prototype.isSupportedBrowser=function(e,i){e=t.nvl(e,this.browser),i=t.nvl(i,this.browserVersion);var o=t.Device.Browser;return!(e===o.INTERNET_EXPLORER&&i<9||e===o.CHROME&&i<23||e===o.FIREFOX&&i<21||e===o.SAFARI&&i<7)},t.Device.prototype._detectType=function(e){return t.Device.System.ANDROID===this.system?e.indexOf("Mobile")>-1?t.Device.Type.MOBILE:t.Device.Type.TABLET:t.Device.System.IOS===this.system?e.indexOf("iPad")>-1?t.Device.Type.TABLET:t.Device.Type.MOBILE:this.isWindowsTablet()?t.Device.Type.TABLET:t.Device.Type.DESKTOP},t.Device.prototype._parseSystem=function(e){e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1?this.system=t.Device.System.IOS:e.indexOf("Android")>-1&&(this.system=t.Device.System.ANDROID)},t.Device.prototype._parseSystemVersion=function(e){var i,o=t.Device.System;this.system===o.IOS&&(i=/ OS ([0-9]+\.?[0-9]*)/,e=e.replace(/_/g,".")),i&&(this.systemVersion=this._parseVersion(e,i))},t.Device.prototype._parseBrowser=function(e){e.indexOf("Firefox")>-1?this.browser=t.Device.Browser.FIREFOX:e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1?this.browser=t.Device.Browser.INTERNET_EXPLORER:e.indexOf("Edge")>-1?this.browser=t.Device.Browser.EDGE:e.indexOf("Chrome")>-1?this.browser=t.Device.Browser.CHROME:e.indexOf("Safari")>-1&&(this.browser=t.Device.Browser.SAFARI)},t.Device.prototype._parseBrowserVersion=function(e){var i,o=t.Device.Browser;this.browser===o.INTERNET_EXPLORER?i=e.indexOf("MSIE")>-1?/MSIE ([0-9]+\.?[0-9]*)/:/rv:([0-9]+\.?[0-9]*)/:this.browser===o.EDGE?i=/Edge\/([0-9]+\.?[0-9]*)/:this.browser===o.SAFARI?i=/Version\/([0-9]+\.?[0-9]*)/:this.browser===o.FIREFOX?i=/Firefox\/([0-9]+\.?[0-9]*)/:this.browser===o.CHROME&&(i=/Chrome\/([0-9]+\.?[0-9]*)/),i&&(this.browserVersion=this._parseVersion(e,i))},t.Device.prototype._parseVersion=function(t,e){var i=e.exec(t);if(Array.isArray(i)&&2===i.length)return parseFloat(i[1])},t.Device.prototype.supportsFeature=function(t,e){return this.features[t]===i&&(this.features[t]=e(t)),this.features[t]},t.Device.prototype.supportsTouch=function(){return this.supportsFeature("_touch",this.hasOnScreenKeyboard.bind(this))},t.Device.prototype.supportsFile=function(){return!!window.File},t.Device.prototype.supportsCssAnimation=function(){return this.supportsCssProperty("animation")},t.Device.prototype.supportsHistoryApi=function(){return!(!window.history||!window.history.pushState)},t.Device.prototype.supportsCssGradient=function(){var t="linear-gradient(to left, #000 0%, #000 50%, transparent 50%, transparent 100% )";return this.supportsFeature("gradient",this.checkCssValue.bind(this,"backgroundImage",t,function(t){return(t+"").indexOf("gradient")>0}))},t.Device.prototype.supportsCssUserSelect=function(){return this.supportsCssProperty("userSelect")},t.Device.prototype.supportsInternationalization=function(){return window.Intl&&"object"==typeof window.Intl},t.Device.prototype.supportsDownloadInSameWindow=function(){return t.Device.Browser.FIREFOX!==this.browser},t.Device.prototype.hasPrettyScrollbars=function(){return this.supportsFeature("_prettyScrollbars",function(t){return 0===this.scrollbarWidth}.bind(this))},t.Device.prototype.supportsCopyFromDisabledInputFields=function(){return t.Device.Browser.FIREFOX!==this.browser},t.Device.prototype.supportsFocusEmptyBeforeDiv=function(){return t.Device.Browser.FIREFOX!==this.browser||this.supportsTouch()},t.Device.prototype.supportsCssProperty=function(e){return this.supportsFeature(e,function(e){if(document.body.style[e]!==i)return!0;e=e.charAt(0).toUpperCase()+e.slice(1);for(var o=0;o<t.Device.vendorPrefixes.length;o++)if(document.body.style[t.Device.vendorPrefixes[o]+e]!==i)return!0;return!1})},t.Device.prototype.supportsGeolocation=function(){return!!navigator.geolocation},t.Device.prototype.checkCssValue=function(e,o,n){if(document.body.style[e]===i)return!1;var r=document.createElement("div");if(r.style[e]=o,n(r.style[e]))return!0;e=e.charAt(0).toUpperCase()+e.slice(1);for(var s=0;s<t.Device.vendorPrefixes.length;s++){var a=t.Device.vendorPrefixes[s]+e;if(document.body.style[a]!==i&&(r.style[a]=o,n(r.style[a])))return!0}return!1},t.Device.prototype.getUnselectableAttribute=function(){return this.supportsFeature("_unselectableAttribute",function(e){return this.supportsCssUserSelect()?t.Device.DEFAULT_UNSELECTABLE_ATTRIBUTE:{key:"unselectable",value:"on",string:' unselectable="on"'}}.bind(this))},t.Device.prototype.isTableAdditionalDivRequired=function(){return this.supportsFeature("_tableAdditionalDivRequired",function(t){var i=e("body").appendDiv().text("Scout").css("visibility","hidden").css("display","table-cell").css("max-width","1px").css("overflow","hidden"),o=i.width()>1;return i.remove(),o}.bind(this))},t.Device.prototype.requiresIframeSecurityAttribute=function(){return this.supportsFeature("_requiresIframeSecurityAttribute",function(t){var e=document.createElement("iframe"),i="sandbox"in e;return!i&&"security"in e}.bind(this))},t.Device.prototype._detectScrollbarWidth=function(t){var i=e("body").appendDiv().attr("id","MeasureScrollbar").css("width",50).css("height",50).css("overflow-y","scroll"),o=i[0],n=o.offsetWidth-o.clientWidth;return i.remove(),n},t.Device.prototype.toString=function(){return"scout.Device[system="+this.system+" browser="+this.browser+" browserVersion="+this.browserVersion+" type="+this.type+" scrollbarWidth="+this.scrollbarWidth+" features="+JSON.stringify(this.features)+"]"},t.device=new t.Device(navigator.userAgent),t.DoubleClickSupport=function(t){t=t||{},this._lastPosX,this._lastPosY,this._lastTimestamp,this._maxDoubleClickInterval=t.maxDoubleClickInterval||500,this._maxDoubleClickDistance=t.maxDoubleClickDistance||10,this._doubleClicked=!1},t.DoubleClickSupport.prototype.mousedown=function(e){if(e&&"mousedown"===e.type){var o=t.nvl(e.pageX,0),n=t.nvl(e.pageY,0),r=Date.now(),s=!1;if(this._lastTimestamp!==i){var a=r-this._lastTimestamp;if(a<=this._maxDoubleClickInterval){var l=Math.max(Math.abs(o-this._lastPosX),Math.abs(n-this._lastPosY));l<=this._maxDoubleClickDistance&&(s=!0)}}this._lastPosX=o,this._lastPosY=n,this._lastTimestamp=r,this._doubleClicked=s}},t.DoubleClickSupport.prototype.doubleClicked=function(){return this._doubleClicked},t.dragAndDrop={SCOUT_TYPES:{FILE_TRANSFER:1,JAVA_ELEMENT_TRANSFER:2,TEXT_TRANSFER:4,IMAGE_TRANSFER:8},scoutTypeToDragTypeMapping:function(e){e=t.arrays.ensure(e);var i=[];return e.indexOf(this.SCOUT_TYPES.FILE_TRANSFER)>=0&&i.push("Files"),i},verifyDataTransferTypesScoutTypes:function(e,o,n){o=t.arrays.ensure(o);var r=[];n!==i?o.forEach(function(e){n&e===e&&t.arrays.pushAll(r,this.scoutTypeToDragTypeMapping(o))}.bind(this)):r=this.scoutTypeToDragTypeMapping(o),Array.isArray(r)&&r.length>0&&this.verifyDataTransferTypes(e,r)},verifyDataTransferTypes:function(t,e){var i=t.originalEvent.dataTransfer;return!!this.dataTransferTypesContains(i,e)&&(t.stopPropagation(),t.preventDefault(),!0)},dataTransferTypesContainsScoutTypes:function(e,i){i=t.arrays.ensure(i);var o=t.dragAndDrop.scoutTypeToDragTypeMapping(i);return this.dataTransferTypesContains(e,o)},dataTransferTypesContains:function(e,i){if(i=t.arrays.ensure(i),e&&e.types){if(Array.isArray(e.types)&&t.arrays.containsAny(e.types,i))return!0;if(e.types.contains)return i.some(function(t){return e.types.contains(t)})}return!1},handler:function(e,i){return i=i||{},i.target=e,new t.DragAndDropHandler(i)}},t.DragAndDropHandler=function(i){i=i||{},e.extend(this,i),this.supportedScoutTypes=t.arrays.ensure(i.supportedScoutTypes),this._onDragEnterHandler=this._onDragEnter.bind(this),this._onDragOverHandler=this._onDragOver.bind(this),this._onDropHandler=this._onDrop.bind(this)},t.DragAndDropHandler.prototype.install=function(t,e){if(this.$element)throw new Error("Already installed.");this.selector=e,this.$element=t,this.$element.on("dragenter",this.selector,this._onDragEnterHandler).on("dragover",this.selector,this._onDragOverHandler).on("drop",this.selector,this._onDropHandler)},t.DragAndDropHandler.prototype.uninstall=function(){this.$element.off("dragenter",this.selector,this._onDragEnterHandler).off("dragover",this.selector,this._onDragOverHandler).off("drop",this.selector,this._onDropHandler),this.$element=null,this.selector=null},t.DragAndDropHandler.prototype._onDragEnter=function(t){this._onDragEnterOrOver(t)},t.DragAndDropHandler.prototype._onDragOver=function(t){this._onDragEnterOrOver(t)},t.DragAndDropHandler.prototype._onDragEnterOrOver=function(e){t.dragAndDrop.verifyDataTransferTypesScoutTypes(e,this.supportedScoutTypes,this.dropType())},t.DragAndDropHandler.prototype._onDrop=function(e){if(this.supportedScoutTypes.indexOf(t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)>=0&&this.dropType()&t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER===t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER&&t.dragAndDrop.dataTransferTypesContainsScoutTypes(e.originalEvent.dataTransfer,t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)){e.stopPropagation(),e.preventDefault();var o=e.originalEvent.dataTransfer.files;o.length>=1&&this.target.session.uploadFiles(this.target,o,this.additionalDropProperties?this.additionalDropProperties(e):i,this.dropMaximumSize?this.dropMaximumSize():i,this.allowedTypes?this.allowedTypes():i)}},t.EventSupport=function(){this._eventListeners=[]},t.EventSupport.prototype._assertFunc=function(t){if(!t)throw new Error("Missing callback function")},t.EventSupport.prototype.on=function(t,e,i){this._assertFunc(e);var o={type:t,func:e,origFunc:i};return this.addListener(o),o},t.EventSupport.prototype.one=function(t,e){this._assertFunc(e);var i=this,o=function(n){i.off(t,o),e(n)}.bind(this);return this.on(t,o,e)},t.EventSupport.prototype.off=function(t,e){if(t||e)for(var i=this._eventListeners.length-1;i>=0;i--){var o=this._eventListeners[i],n=e===o.func||e===o.origFunc,r=t===o.type,s=!1;s=e&&t?n&&r:e?n:r,s&&this._eventListeners.splice(i,1)}},t.EventSupport.prototype.addListener=function(t){this._eventListeners.push(t)},t.EventSupport.prototype.removeListener=function(e){t.arrays.remove(this._eventListeners,e)},t.EventSupport.prototype.count=function(t){var e=0;return this._eventListeners.forEach(function(i){t&&t!==i.type||e++}),e},t.EventSupport.prototype.trigger=function(t,e){function i(t,e){var i,o=e.split(" ");if(1===o.length)return t===e;for(i=0;i<o.length;i++)if(t===o[i])return!0;return!1}e=e||{},e.type=t;var o,n,r=this._eventListeners.slice();for(o=0;o<r.length;o++)n=r[o],n.type&&!i(e.type,n.type)||n.func(e)},t.fonts={_deferred:e.Deferred(),loadingComplete:!0,bootstrap:function(t){t&&0!==t.length&&(this.loadingComplete=!1,this.preload({fonts:t,onComplete:function(t){this.loadingComplete=!0,this._deferred.resolve()}.bind(this)}))},preloader:function(){return this._deferred.promise()},preload:function(i){function o(t,e){for(var i=a.length;i--;){var n=a[i];n.outerWidth()!==n.data("original-width")&&(a.splice(i,1),n.remove())}return 0===a.length?void e(!0):void(l=setTimeout(function(){t<1e3&&(t=1.2*t),o(t,e)},t))}function n(t){i.onComplete(t)}i=i||{};var r=i.fonts||[];if(Array.isArray(r)||(r=[r]),i.onComplete){var s="monospace",a=[];if(r.forEach(function(t){if("string"==typeof t){var i=t.match(/^(.*?)\s*\|\s*(.*)$/);t=i?{family:i[1],style:i[2]}:{family:t}}t.family=t.family||"",t.style=t.style||"";var o=e("body"),n=o.appendDiv("font-preloader").text("ABC abc 123 .,_").css("visibility","hidden").css("font-family",s),r=n.outerWidth();if(n.data("original-width",r),n.css("font-family","'"+t.family+"',"+s),t.style){var l=(n.attr("style")||"").trim(),h=(";"===l.substr(-1)?"":";")+(l?" ":"");n.attr("style",l+h+t.style)}n.outerWidth()!==r?n.remove():a.push(n)}.bind(this)),0===a.length)return void n(!0);var l,h,d=n,p=t.nvl(i.timeout,3e4);p&&p>=0&&(h=setTimeout(function(){clearTimeout(l),n(!1)}.bind(this),p),d=function(){clearTimeout(h),n(!0)}),o(50,d)}}},t.icons={ANGLE_DOWN:"font:",ANGLE_UP:"font:",OUTLINE:"font:",ELLIPSIS_V:"font:",COLLAPSE:"font:",HOME:"font:",SUM:"font:",AVG:"font:",MAX:"font:",MIN:"font:",ICON_ID_REGEX:/\$\{iconId\:([a-zA-Z0-9_\.]*)\}/,parseIconId:function(e){var i=new t.Icon;if(t.strings.startsWith(e,"font:"))if(i.iconType=t.Icon.IconType.FONT_ICON,e=e.substr(5),1===t.strings.countCodePoints(e))i.font=t.Icon.DEFAULT_FONT,i.iconCharacter=e;else{var o=e.split(" ");i.font=o[0],i.iconCharacter=o[1]}else i.iconType=t.Icon.IconType.BITMAP,i.iconUrl=e;return i},resolveIconId:function(i){var o,n,r=this.ICON_ID_REGEX.exec(i);return r&&2===r.length&&(o=r[1],n=o.split("."),1===n.length?i=t.icons[n]:2===n.length?i=window[n[0]].icons[n[1]]:e.log.warn("Invalid iconId: "+i)),i}},t.Icon=function(){this.iconType,this.font,this.iconCharacter,this.iconUrl},t.Icon.IconType={FONT_ICON:0,BITMAP:1},t.Icon.DEFAULT_FONT="scoutIcons",t.Icon.prototype.cssClass=function(){return this.isFontIcon()&&this.font!==t.Icon.DEFAULT_FONT?"font-"+this.font:""},t.Icon.prototype.appendCssClass=function(t){var e=this.cssClass();return e.length>0?t+" "+e:t},t.Icon.prototype.isFontIcon=function(){return this.iconType===t.Icon.IconType.FONT_ICON},t.Icon.prototype.isBitmap=function(){return this.iconType===t.Icon.IconType.BITMAP},t.inspector={applyInfo:function(t,e){t&&(e=e||t.$container,e&&(e.toggleAttr("data-id",!!t.id,t.id),e.toggleAttr("data-modelclass",!!t.modelClass,t.modelClass),e.toggleAttr("data-classid",!!t.classId,t.classId)))}},t.locales={localesMap:{},bootstrap:function(i){return i=t.nvl(i,"res/locales.json"),e.ajaxJson(i).done(this.init.bind(this))},init:function(t){t.forEach(function(t){this.localesMap[t.languageTag]=t},this)},get:function(t){return this.localesMap[t]}},t.logging={defaultLevel:"trace",bootstrap:function(){var i,o=new t.URL,n=o.getParameter("logging");if(e.log=new t.NullLogger,n){var r=function(){var i=t.logging.parseLevel(o.getParameter("logLevel"));i||(i=t.logging.parseLevel(t.logging.defaultLevel)),log4javascript.getDefaultLogger().setLevel(i),e.log=log4javascript.getDefaultLogger()};"undefined"==typeof log4javascript?i=e.injectScript("res/log4javascript.js").done(function(t,e){r()}):r()}return i},parseLevel:function(t){if(t)switch(t=t.toLowerCase()){case"trace":return log4javascript.Level.TRACE;case"debug":return log4javascript.Level.DEBUG;case"info":return log4javascript.Level.INFO;case"warn":return log4javascript.Level.WARN;case"error":return log4javascript.Level.ERROR;case"fatal":return log4javascript.Level.FATAL}}},t.NullLogger=function(){},t.NullLogger.prototype={trace:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},fatal:function(){},isEnabledFor:function(t){return!1},isTraceEnabled:function(){return!1},isDebugEnabled:function(){return!1},isInfoEnabled:function(){return!1},isWarnEnabled:function(){return!1},isErrorEnabled:function(){return!1},isFatalEnabled:function(){return!1}},t.LookupCall=function(){},t.LookupCall.prototype.init=function(t){this._init(t)},t.LookupCall.prototype._init=function(t){e.extend(this,t)},t.LookupCall.prototype.textById=function(t){},t.CodeLookupCall=function(){t.CodeLookupCall.parent.call(this),this.codeType},t.inherits(t.CodeLookupCall,t.LookupCall),t.CodeLookupCall.prototype._init=function(e){if(t.CodeLookupCall.parent.prototype._init.call(this,e),!this.session)throw new Error("missing property 'session'")},t.CodeLookupCall.prototype.textById=function(o){if(null===o||o===i)return e.Deferred().resolve(null);var n=t.codes.get(this.codeType,o);return e.Deferred().resolve(n.text(this.session.locale))},t.mimeTypes={TEXT_PLAIN:"text/plain",TEXT_HTML:"text/html",IMAGE_PNG:"image/png",IMAGE_JPG:"image/jpg",IMAGE_JPEG:"image/jpeg",IMAGE_GIF:"image/gif",JSON:"application/json"},t.models={modelMap:{},bootstrap:function(i){return t.assertParameter("modelsUrl",i),e.ajaxJson(i).done(this.init.bind(this))},init:function(t){this.modelMap=t},getModel:function(e,i){var o=t.models._get(e,"model");return i&&(o.parent=i),o},getExtension:function(e){return t.models._get(e,"extension")},_get:function(t,i){var o=this.modelMap[t];if(!o)throw new Error("No JSON file defined for id='"+t+"'. Check if file .json is listed in your *-module.json and if id matches the filename of the file .json file");if(!o.type||o.type!=i)throw new Error(t+" is not of type '"+i+"'");return e.extend(!0,{},o)},extend:function(i,o){return"string"==typeof i&&(i=t.models.getExtension(i)),t.assertParameter("extensions",i.extensions),i.extensions.forEach(function(n){t.assertParameter("operation",n.operation);var r=n.target;t.assertParameter("target",r);var s;if(s=r.root?o:t.objects.findChildObjectByKey(o,"id",r.id),!s)throw new Error("Extensions "+i.id+":Target not found: {id: "+r.id+"}");if("appendTo"===n.operation)e.extend(s,n.extension);else if("insert"===n.operation){s[r.property]=s[r.property]||[];var a=s[r.property],l=a.length;r.before&&(l=t.arrays.findIndex(a,function(t){return t.id===r.before}),l===-1&&(l=a.length)),e.isNumeric(r.index)&&(l=r.index),t.arrays.insertArray(a,n.extension,l)}}.bind(this)),o}},t.numbers={toBase62:function(t){if(t===i)return i;for(var e,o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split(""),n=62,r="";t>=1;)e=Math.floor(t/n),r=o[t-n*e]+r,t=e;return r},randomId:function(t){t=t||8;for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",i="",o=0;o<t;o++)i+=e[Math.floor(Math.random()*e.length)];return i},_correlationCounter:1,correlationId:function(t){t=t||11;for(var e="abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ",i="23456789",o="",n=0;n<t;n++)o+=(n+1)%3===0?i[Math.floor(Math.random()*i.length)]:e[Math.floor(Math.random()*e.length)];return o+"/"+this._correlationCounter++},round:function(e,o,n){if(null===e||e===i)return e;switch(n=n||0,e=this.shiftDecimalPoint(e,n),o){case t.numbers.RoundingMode.UP:e=e<0?-Math.ceil(Math.abs(e)):Math.ceil(e);break;case t.numbers.RoundingMode.DOWN:e=e<0?-Math.floor(Math.abs(e)):Math.floor(e);break;case t.numbers.RoundingMode.CEILING:e=Math.ceil(e);break;case t.numbers.RoundingMode.FLOOR:e=Math.floor(e);break;case t.numbers.RoundingMode.HALF_DOWN:e=e<0?Math.round(e):-Math.round(-e);break;default:e=e<0?-Math.round(Math.abs(e)):Math.round(e)}return this.shiftDecimalPoint(e,-n)},shiftDecimalPoint:function(e,o){if(null===e||e===i||!o)return e;var n=e?e<0?-1:1:0,r=Math.abs(o);e=Math.abs(e);var s,a=t.strings.asString(e);return o<0?(a=t.strings.repeat("0",r)+a,s=a.split(".",2),a=1===s.length?a.substr(0,a.length-r)+"."+a.substr(a.length-r):s[0].substr(0,s[0].length-r)+"."+s[0].substr(s[0].length-r)+s[1]):o>0&&(a+=t.strings.repeat("0",r),s=a.split(".",2),2===s.length&&(a=s[0]+s[1].substr(0,r)+"."+s[1].substr(r))),a=a.replace(/^0*(\d)/g,"$1"),Number(a)*n}},t.numbers.RoundingMode={UP:"UP",DOWN:"DOWN",CEILING:"CEILING",FLOOR:"FLOOR",HALF_UP:"HALF_UP",HALF_DOWN:"HALF_DOWN",HALF_EVEN:"HALF_EVEN",UNNECESSARY:"UNNECESSARY"},t.objects={copyProperties:function(t,e){var i;for(i in t)e[i]=t[i]},copyOwnProperties:function(t,e){var i;for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},countOwnProperties:function(t){var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;return e},extractProperties:function(t,e,i){return i.forEach(function(i){e[i]||(e[i]=t[i])}),e},someOwnProperties:function(e,i){var o=t.arrays.ensure(i);return o.some(function(t){return e.hasOwnProperty(t)})},someProperties:function(e,i){var o=t.arrays.ensure(i);return o.some(function(t){return t in e})},valueCopy:function(e){if(e===i||null===e||"object"!=typeof e)return e;var o;if(Array.isArray(e)){o=[];for(var n=0;n<e.length;n++)o[n]=t.objects.valueCopy(e[n]);return o}o={};for(var r in e)e.hasOwnProperty(r)&&(o[r]=t.objects.valueCopy(e[r]));return o},findChildObjectByKey:function(e,o,n){if(e===i||null===e||"object"!=typeof e)return null;if(e[o]===n)return e;var r;if(Array.isArray(e))for(var s=0;s<e.length;s++)if(r=t.objects.findChildObjectByKey(e[s],o,n))return r;for(var a in e)if(e.hasOwnProperty(a)&&(r=t.objects.findChildObjectByKey(e[a],o,n)))return r;return null},isPlainObject:function(t){return"object"==typeof t&&!Array.isArray(t)},optProperty:function(t,e){return t?t[e]:null},isNumber:function(t){return null!==t&&!isNaN(t)&&isFinite(t)},isString:function(t){return"string"==typeof t},isNullOrUndefined:function(t){return null===t||t===i},values:function(t,e){var i=[];if(t)for(var o in t)(e||t.hasOwnProperty(o))&&i.push(t[o]);return i},equals:function(t,e){return t===e||!!(t&&e&&t.equals&&e.equals)&&t.equals(e)},propertiesEquals:function(e,i,o){var n,r;for(n=0;n<o.length;n++)if(r=o[n],!t.objects.equals(e[r],i[r]))return!1;return!0},mandatoryFunction:function(t,e){var i=t[e];if(!i||"function"!=typeof i)throw new Error("Function '"+e+"' does not exist on object. Check if it has been renamed or moved.",t);return i},replacePrototypeFunction:function(t,e,i){var o=t.prototype;this.mandatoryFunction(o,e),o[e]=i},argumentsToArray:function(t){return Array.prototype.slice.call(t)},forEachArgument:function(t,e){return this.argumentsToArray(t).forEach(e)},checkFunctionOverrides:function(){function e(t){var e=/\/\*.*?\*\/|\/\/.*$/gm,i=/^function[^(]*\((.*?)\)/m;if("function"!=typeof t)throw new Error("Argument is not a function: "+t);var o=t.toString().replace(e,"").match(i),n=[];return null!==o&&o[1].split(",").forEach(function(t,e){t=t.trim(),t.length>0&&n.push(t)}),n}function i(e){for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];if("function"==typeof o)for(var n in o.prototype)if(o.prototype.hasOwnProperty(n)){var r=o.prototype[n];if("constructor"!==n&&o.prototype.hasOwnProperty(n)&&"function"==typeof r&&r===e)return i}}return""}var o=["ModelAdapter.init","ModelAdapter._init","Calendar.init"],n=["Legend:","[!] Function includes super call, and parent function uses arguments"," ~  Function includes super call, but parent function does not use arguments","    Function does not include super call","","Wrong number of arguments:"],r=["Different argument names:"];for(var s in t)if(t.hasOwnProperty(s)){var a=t[s];if("function"==typeof a&&a.parent)for(var l in a.prototype)if(a.prototype.hasOwnProperty(l)){var h=a.prototype[l];if("constructor"!==l&&a.prototype.hasOwnProperty(l)&&"function"==typeof h)for(var d=e(h),p=a.parent;p;){var u=p.prototype[l];if(p.prototype.hasOwnProperty(l)&&"function"==typeof u){for(var c=e(u),f=!1,y=0;y<c.length;y++)if(d.length<y||d[y]!==c[y]){f=!0;break}var g=s+"."+l;if(f&&o.indexOf(g)===-1){var m=g+"("+d.join(", ")+") does not correctly override "+i(u)+"."+l+"("+c.join(", ")+")",_=null!==h.toString().match(new RegExp("scout."+t.strings.quote(s)+".parent.prototype."+t.strings.quote(l)+".call\\(")),b=!1;if(_)for(var v=0;v<c.length;v++){var C=u.toString().match(new RegExp("[^.\\w]"+t.strings.quote(c[v])+"[^\\w]","g"));if(null!==C&&C.length>1){b=!0;break}}m=(_?b?"[!]":" ~ ":"   ")+" "+m,d.length!==c.length?n.push(m):r.push(m)}}p=p.parent}}}return n.push(""),n.concat(r)}},t.polyfills={install:function(i){i.FormData||(i.FormData=function(){this.polyfill=!0,this._boundary="ScoutFormData-"+t.numbers.randomId(50),this._data=[],this._crlf="\r\n"},i.FormData.prototype.append=function(t,e,i){var o=[t,e,i];this._data.push(o)},i.FormData.prototype.getContent=function(){var e="";return this._data.forEach(function(o){var n=o[0],r=o[1],s=o[2];if(e+="--"+this._boundary+this._crlf,t.device.supportsFile()&&r instanceof i.File){var a=r;s=s||a.name||n,e+='Content-Disposition: form-data; name="'+n+'"; filename="'+s+'"'+this._crlf,e+="Content-Type: "+a.type+this._crlf,e+=this._crlf,e+=(a.getAsBinary?a.getAsBinary():"UNKNOWN CONTENT")+this._crlf}else e+='Content-Disposition: form-data; name="'+n+'";'+this._crlf,e+=this._crlf,e+=r+this._crlf}.bind(this)),e+="--"+this._boundary+"--"},i.FormData.prototype.applyToAjaxOptions=function(t){t&&(t.xhr=function(){var t=e.ajaxSettings.xhr();return t.send=t.sendAsBinary||t.send,t},t.contentType="multipart/form-data; boundary="+this._boundary,t.data=this.getContent())})}},t.Range=function(t,e){this.from=t,this.to=e},t.Range.prototype.equals=function(t){return this.from===t.from&&this.to===t.to},t.Range.prototype.subtract=function(e){if(0===e.size())return[new t.Range(this.from,this.to)];if(this.from>=e.from&&this.to<=e.to)return[new t.Range(0,0)];if(e.from>=this.from&&e.to<=this.to){var i=new t.Range(this.from,e.from),o=new t.Range(e.to,this.to);return 0===i.size()?[o]:0===o.size()?[i]:[i,o]}return e.from>this.from&&e.from<this.to?[new t.Range(this.from,e.from)]:this.from>e.from&&this.from<e.to?[new t.Range(e.to,this.to)]:[new t.Range(this.from,this.to)]},t.Range.prototype.shrink=function(e){return 0===e.size()?new t.Range(this.from,this.to):this.from>=e.from&&this.to<=e.to?new t.Range(0,0):e.from>=this.from&&e.to<=this.to?new t.Range(this.from,e.to):e.from>=this.from&&e.from<this.to?new t.Range(this.from,e.from):this.from>e.from&&this.from<e.to?new t.Range(e.to,this.to):e.to<this.from?new t.Range(this.from-e.size()-1,this.to-e.size()-1):new t.Range(this.from,this.to)},t.Range.prototype.union=function(e){if(this.to<e.from||e.to<this.from){var i=new t.Range(this.from,this.to),o=new t.Range(e.from,e.to);return 0===i.size()?[o]:0===o.size()?[i]:[i,o]}return[new t.Range(Math.min(this.from,e.from),Math.max(this.to,e.to))]},t.Range.prototype.intersect=function(e){return this.to<=e.from||e.to<=this.from?new t.Range(0,0):new t.Range(Math.max(this.from,e.from),Math.min(this.to,e.to))},t.Range.prototype.size=function(t){return this.to-this.from},t.Range.prototype.contains=function(t){return this.from<=t&&t<this.to},t.Range.prototype.toString=function(){return"scout.Range[from="+(null===this.from?"null":this.from)+" to="+(null===this.to?"null":this.to)+"]"},t.Status=function(t){this.message,this.severity,e.extend(this,t)},t.Status.Severity={OK:1,INFO:256,WARNING:65536,ERROR:16777216},t.Status.cssClasses="has-error has-warning has-info",t.Status.prototype.cssClass=function(){return t.Status.cssClassForSeverity(this.severity)},t.Status.prototype.isValid=function(){return this.severity===t.Status.Severity.OK||this.severity===t.Status.Severity.INFO},t.Status.prototype.isError=function(){return this.severity===t.Status.Severity.ERROR},t.Status.prototype.clone=function(){var i=e.extend({},this);return new t.Status(i)},t.Status.prototype.equals=function(e){return e instanceof t.Status&&t.objects.propertiesEquals(this,e,["severity","message","invalidDate","invalidTime"])},t.Status.clone=function(t){return t?t.clone():null},t.Status.cssClassForSeverity=function(e){var i=e>t.Status.Severity.OK,o=e>t.Status.Severity.INFO,n=e>t.Status.Severity.WARNING;return n?"has-error":o?"has-warning":i?"has-info":""},t.Status.animateStatusMessage=function(e,i){if(t.strings.endsWith(i,"...")){for(var o=e.makeSpan("elipsis"),n=0;n<3;n++)o.append(e.makeSpan("animate-dot delay-"+n,"."));i=i.substring(0,i.length-3),e.empty().text(i).append(o)}else e.text(i)},t.Status.ensure=function(e){return e?e instanceof t.Status?e:new t.Status(e):e},t.Status.ok=function(){return new t.Status({severity:t.Status.Severity.OK})},t.Status.info=function(){return new t.Status({severity:t.Status.Severity.INFO})},t.strings={nl2br:function(e,i){return e?(e=this.asString(e),i=t.nvl(i,!0),i&&(e=t.strings.encode(e)),e.replace(/\n/g,"<br>").replace(/\r/g,"")):e},insertAt:function(t,e,i){return t?(t=this.asString(t),e=this.asString(e),e&&("number"==typeof i||i instanceof Number)&&i>=0?t.substr(0,i)+e+t.substr(i):t):t},hasText:function(t){return t!==i&&null!==t&&(t=this.asString(t),"string"==typeof t&&0!==t.length&&!/^\s*$/.test(t))},empty:function(e){return!t.strings.hasText(e)},repeat:function(t,e){if(t===i||null===t)return t;if("number"!=typeof e||e<1)return"";for(var o="",n=0;n<e;n++)o+=t;return o},padZeroLeft:function(e,o){if(e=this.asString(e),e===i||null===e||"number"!=typeof o||o<1||(e+"").length>=o)return e;var n=t.strings.repeat("0",o)+e;return n.slice(-o)},startsWith:function(t,e){return t!==i&&null!==t&&e!==i&&null!==e&&(0===e.length||0!==t.length&&(t=this.asString(t),e=this.asString(e),t.substr(0,e.length)===e))},endsWith:function(t,e){return t!==i&&null!==t&&e!==i&&null!==e&&(0===e.length||0!==t.length&&(t=this.asString(t),e=this.asString(e),t.substr(-e.length)===e))},count:function(t,e){return t&&e!==i&&null!==e?(t=this.asString(t),e=this.asString(e),t.split(e).length-1):0},_encodeElement:null,encode:function(e){if(!e)return e;var i=t.strings._encodeElement;return i||(i=window.document.createElement("div"),t.strings._encodeElement=i),i.textContent=e,i.innerHTML},plainText:function(e){if(!e)return e;e=this.asString(e),e=e.replace(/<br>|<br\/>|<\/p>|<p\/>|<\/div>|<\/li>|<\/tr>/gi,"\n"),e=e.replace(/<\/td>/gi," "),e=e.replace(/<[^>]+>/gi,""),e=e.replace(/^[ ]+/gm,""),e=e.replace(/[ ]+$/gm,"");var i=t.strings.plainTextElement;return i||(i=document.createElement("textarea"),t.strings.plainTextElement=i),i.innerHTML=e,i.value},join:function(t){t=this.asString(t);for(var e="",i=1;i<arguments.length;i++){var o=this.asString(arguments[i]);o&&(e&&t&&(e+=t),e+=o)}return e},box:function(t,e,i){t=this.asString(t),e=this.asString(e),i=this.asString(i);var o="";return this.hasText(e)&&(t&&(o+=t),o+=e,i&&(o+=i)),o},lowercaseFirstLetter:function(t){if(t===i||null===t)return t;t=this.asString(t);var e="";return this.hasText(t)&&(e=t.charAt(0).toLowerCase()+t.slice(1)),e},quote:function(t){return t===i||null===t?t:(t=this.asString(t),t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))},asString:function(t){return t===i||null===t?t:"string"==typeof t||t instanceof String?t:String(t)},nvl:function(e){return t.nvl(e,"")},toUpperCaseFirstLetter:function(t){return t.substring(0,1).toUpperCase()+t.substring(1)},countCodePoints:function(t){return t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length}},t.styles={styleMap:{},get:function(e,i){var o=t.styles.styleMap[e];i=t.arrays.ensure(i),i=i.map(function(t){return{name:t,nameCamelCase:t.replace(/\-(.)/g,function(t,e){return e.toUpperCase()})}}),o||(o={},t.styles.put(e,o));var n=i.filter(function(t){return!(t.nameCamelCase in o)});if(0===n.length)return o;
var r=t.styles.element;r||(r=window.document.createElement("div"),r.style.display="none",window.document.body.appendChild(r),t.styles.element=r),r.className=e;var s=window.getComputedStyle(r);return n.forEach(function(t){o[t.nameCamelCase]=s[t.name]}),r.className="",o},put:function(t,e){this.styleMap[t]=e},rgb:function(t){var e=t.replace(/\s/g,"").match(/^rgba?\(([0-9]+),([0-9]+),([0-9]+)/i);return{red:parseInt(e[1],10),green:parseInt(e[2],10),blue:parseInt(e[3],10)}},parseFontSpec:function(e){var i={};if(t.strings.hasText(e))for(var o=e.split(/[-_,\/.;]/),n=0;n<o.length;n++){var r=o[n].toUpperCase();"NULL"===r||"0"===r||"PLAIN"===r||("BOLD"===r?i.bold=!0:"ITALIC"===r?i.italic=!0:/^\d+$/.test(r)?i.size=r:"NULL"!==r&&(i.name=r))}return i},modelToCssColor:function(t){var e="";return/^[A-Fa-f0-9]{3}([A-Fa-f0-9]{3})?$/.test(t)?e="#"+t:/^[A-Za-z0-9().,%-]+$/.test(t)&&(e=t),e},legacyStyle:function(e,i,o){var n="",r="",s="",a="",l="",h="";if(o=o||"","object"==typeof e&&null!==e){n=t.styles.modelToCssColor(e[t.strings.lowercaseFirstLetter(o+"ForegroundColor")]),r=t.styles.modelToCssColor(e[t.strings.lowercaseFirstLetter(o+"BackgroundColor")]);var d=t.strings.lowercaseFirstLetter(o+"Font");if(d in e){var p=this.parseFontSpec(e[d]);p.bold&&(s="bold"),p.italic&&(a="italic"),p.size&&(l=p.size+"pt"),p.name&&(h=p.name)}}i&&i.css("color",n).css("background-color",r).css("font-weight",s).css("font-style",a).css("font-size",l).css("font-family",h);var u="";return n&&(u+="color: "+n+"; "),r&&(u+="background-color: "+r+"; "),s&&(u+="font-weight: "+s+"; "),a&&(u+="font-style: "+a+"; "),l&&(u+="font-size: "+l+"; "),h&&(u+="font-family: "+h+"; "),u}},t.URL=function(e){e===i&&(e=window.location.href);var o=/^([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/.exec(e||"");this.baseUrlRaw=o[1],this.queryPartRaw=o[2],this.hashPartRaw=o[3],this.parameterMap=t.URL._parse(this.queryPartRaw)},t.URL.prototype.getParameter=function(e){if("string"!=typeof e)throw new Error("Illegal argument type: "+e);var i=this.parameterMap[e];return Array.isArray(i)?i.sort(t.URL._sorter):i},t.URL.prototype.removeParameter=function(t){if("string"!=typeof t)throw new Error("Illegal argument type: "+t);return delete this.parameterMap[t],this},t.URL.prototype.setParameter=function(t,e){if("string"!=typeof t)throw new Error("Illegal argument type: "+t);if(""!==t)return this.parameterMap[t]=e,this},t.URL.prototype.addParameter=function(e,i){if("string"!=typeof e)throw new Error("Illegal argument type: "+e);if(""!==e)return t.URL._addToMap(this.parameterMap,e,i),this},t.URL.prototype.toString=function(){var e=this.baseUrlRaw;if(Object.keys(this.parameterMap).length){var i=Object.keys(this.parameterMap).sort(t.URL._sorter).map(function(e){var i=this.getParameter(e);return Array.isArray(i)?i.map(function(o,n){return t.URL._formatQueryParam(e,i[n])}).join("&"):t.URL._formatQueryParam(e,i)}.bind(this)).join("&");e+="?"+i}return this.hashPartRaw&&(e+="#"+this.hashPartRaw),e},t.URL._sorter=function(t,e){return null===t?-1:null===e?1:t.toString().localeCompare(e)},t.URL._formatQueryParam=function(t,e){var o=encodeURIComponent(t);return e!==i&&null!==e&&(o+="="+encodeURIComponent(e)),o},t.URL._addToMap=function(t,e,o){if(t===i)throw new Error("Argument 'map' must not be null");if(e===i)throw new Error("Argument 'key' must not be null");if(e in t){var n=t[e];Array.isArray(n)?n.push(o):t[e]=[n,o]}else t[e]=o},t.URL._parse=function(e){for(var i,o,n,r=(e||"").replace(/\+/g," "),s=/([^&=]+)(=?)([^&]*)/g,a={};i=s.exec(r);)o=decodeURIComponent(i[1]),n=decodeURIComponent(i[3]),""===n&&"="!==i[2]&&(n=null),t.URL._addToMap(a,o,n);return a},t.filters={ensure:function(t){return t?Array.isArray(t)?t:[t]:[]},returnTrue:function(){return!0},returnFalse:function(){return!1},outsideFilter:function(t){return t=t instanceof e?t[0]:t,function(){return this!==t&&!e.contains(t,this)}},notSameFilter:function(t){return t=t instanceof e?t[0]:t,function(){return this!==t}}},t.hAlign={LEFT:"left",RIGHT:"right",CENTER:"center"},t.aggregation={sumStart:function(){return null},sumStep:function(t,e){return"number"==typeof e&&(t=(t||0)+e),t},sumFinish:function(t){return t},sumSymbol:t.icons.SUM,avgStart:function(){return{sum:0,count:0}},avgStep:function(t,e){return"number"==typeof e&&(t.sum+=e,t.count+=1),t},avgFinish:function(t){if(t.count&&t.count>0)return 1*t.sum/t.count},avgSymbol:t.icons.AVG,minStart:function(){return null},minStep:function(t,e){return"number"==typeof e&&("number"==typeof t?e<t&&(t=e):t=e),t},minFinish:function(t){return t},minSymbol:t.icons.MIN,maxStart:function(){return null},maxStep:function(t,e){return"number"==typeof e&&("number"==typeof t?e>t&&(t=e):t=e),t},maxFinish:function(t){return t},maxSymbol:t.icons.MAX},t.BackgroundJobPollingStatus={STOPPED:"stopped",RUNNING:"running",FAILURE:"failure"},t.BackgroundJobPollingSupport=function(e){this.enabled=!!e,this.status=t.BackgroundJobPollingStatus.STOPPED},t.BackgroundJobPollingSupport.prototype.setFailed=function(){this.status=t.BackgroundJobPollingStatus.FAILURE},t.BackgroundJobPollingSupport.prototype.setRunning=function(){this.status=t.BackgroundJobPollingStatus.RUNNING},t.BackgroundJobPollingSupport.prototype.setStopped=function(){this.status=t.BackgroundJobPollingStatus.STOPPED},t.BackgroundJobPollingSupport.prototype.isFailed=function(){return this.status===t.BackgroundJobPollingStatus.FAILURE},t.BackgroundJobPollingSupport.prototype.isRunning=function(){return this.status===t.BackgroundJobPollingStatus.RUNNING},t.BackgroundJobPollingSupport.prototype.isStopped=function(){return this.status===t.BackgroundJobPollingStatus.STOPPED},t.BusyIndicator=function(){t.BusyIndicator.parent.call(this)},t.inherits(t.BusyIndicator,t.Widget),t.BusyIndicator.prototype._init=function(e){t.BusyIndicator.parent.prototype._init.call(this,e),this._cancellable=e.cancellable===i||!!e.cancellable},t.BusyIndicator.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.BusyIndicator.prototype._initKeyStrokeContext=function(){t.BusyIndicator.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke([new t.ClickActiveElementKeyStroke(this,[t.keys.SPACE,t.keys.ENTER]),new t.CloseKeyStroke(this,function(){return this.$cancelButton}.bind(this))])},t.BusyIndicator.prototype._render=function(e){this._glassPaneRenderer=new t.GlassPaneRenderer(this.session,this,(!0)),this._glassPaneRenderer.renderGlassPanes(),this._glassPaneRenderer.eachGlassPane(function(t){t.addClass("busy")}),this.$container=e.appendDiv("busyindicator invisible");var i=this.$container.appendDiv("drag-handle");if(this.$container.makeDraggable(i),this.$content=this.$container.appendDiv("busyindicator-content"),this.$label=this.$content.appendDiv("busyindicator-label"),this._cancellable){this.$buttons=this.$container.appendDiv("busyindicator-buttons");var o=new t.BoxButtons(this.$buttons);this.$cancelButton=o.addButton({text:this.session.text("Cancel"),onClick:this._onClickCancel.bind(this)}),this.$cancelButton.css("width","100%")}else this.$content.addClass("no-buttons");this.$label.text(this.session.text("ui.PleaseWait_")),this.$container.addClass("calc-helper"),this.$container.css("min-width",this.$container.width()),this.$container.removeClass("calc-helper"),this._position(),this._busyIndicatorTimeoutId=setTimeout(function(){this.$container.removeClass("invisible").addClassForAnimation("animate-open"),this.session.focusManager.validateFocus()}.bind(this),2500)},t.BusyIndicator.prototype._onClickCancel=function(t){this.trigger("cancel",t)},t.BusyIndicator.prototype._postRender=function(){t.BusyIndicator.parent.prototype._postRender.call(this),this.session.focusManager.installFocusContext(this.$container,t.focusRule.AUTO)},t.BusyIndicator.prototype._remove=function(){clearTimeout(this._busyIndicatorTimeoutId),this._glassPaneRenderer.eachGlassPane(function(t){t.removeClass("busy")}),this._glassPaneRenderer.removeGlassPanes(),this.session.focusManager.uninstallFocusContext(this.$container),t.BusyIndicator.parent.prototype._remove.call(this)},t.BusyIndicator.prototype._position=function(){this.$container.cssMarginLeft(-this.$container.outerWidth()/2)},t.BusyIndicator.prototype.close=function(){this.$cancelButton&&this.session.focusManager.requestFocus(this.$cancelButton)&&(this.$cancelButton.focus(),this.$cancelButton.click())};t.Event=function(i,o,n){t.assertParameter("target",i),t.assertParameter("type",o),e.extend(this,n),this.target=i,this.type=o};t.Locale=function(e){this.languageTag=e.languageTag,this.decimalFormatPatternDefault=e.decimalFormatPatternDefault,this.decimalFormatSymbols=e.decimalFormatSymbols,this.decimalFormatPatternDefault&&this.decimalFormatSymbols&&(this.decimalFormat=new t.DecimalFormat(e)),this.dateFormatPatternDefault=e.dateFormatPatternDefault,this.dateFormatSymbols=e.dateFormatSymbols,this.dateFormatPatternDefault&&this.dateFormatSymbols&&(this.dateFormat=new t.DateFormat(e))},t.PropertyChangeEventFilter=function(){this._filterProperties={}},t.PropertyChangeEventFilter.prototype.addFilterForProperties=function(e){t.objects.copyProperties(e,this._filterProperties)},t.PropertyChangeEventFilter.prototype.filter=function(e,i){if(!this._filterProperties.hasOwnProperty(e))return!1;var o=this._filterProperties[e];return t.objects.equals(o,i)},t.PropertyChangeEventFilter.prototype.reset=function(){this._filterProperties={}},t.Reconnector=function(t){this.session=t,this.interval=3e3},t.Reconnector.prototype.start=function(){this._schedulePing()},t.Reconnector.prototype._schedulePing=function(){this.pingScheduled||(this.pingScheduled=!0,setTimeout(function(){this.ping(),this.pingScheduled=!1}.bind(this),this.interval))},t.Reconnector.prototype.ping=function(){function t(t){this._onSuccess(t)}function i(t,e,i){this._onFailure(o,t,e,i)}this.pingTime=new Date,this.session.onReconnecting();var o={ping:!0},n=this.session.defaultAjaxOptions(o);e.ajax(n).done(t.bind(this)).fail(i.bind(this))},t.Reconnector.prototype._onSuccess=function(){this.session.onReconnectingSucceeded()},t.Reconnector.prototype._onFailure=function(){var t=1e3,e=(new Date).getTime()-this.pingTime.getTime();e>t?this._onFailureImpl():setTimeout(function(){this._onFailureImpl()}.bind(this),t-e)},t.Reconnector.prototype._onFailureImpl=function(){this.session.onReconnectingFailed(),this._schedulePing()},t.ResponseQueue=function(t){this.session=t,this.queue=[],this.lastProcessedSequenceNo=0,this.nextExpectedSequenceNo=1,this.force=!1,this.forceTimeoutId=null},t.ResponseQueue.FORCE_TIMEOUT=1e4,t.ResponseQueue.prototype.add=function(e){var i=e&&e["#"];if(!(i&&i<=this.lastProcessedSequenceNo))if(e.combined&&(this.nextExpectedSequenceNo=Math.max(i,this.nextExpectedSequenceNo)),i&&0!==this.queue.length){for(var o=null,n=0;n<this.queue.length;n++){var r=this.queue[n];if(r["#"]&&r["#"]>i){o=n;break}}null===o?this.queue.push(e):t.arrays.insert(this.queue,e,o)}else this.queue.push(e)},t.ResponseQueue.prototype.process=function(t){t&&this.add(t);for(var e=!0,i=!1,o=[],n=0;n<this.queue.length;n++){var r=this.queue[n],s=r["#"];if(s&&(!this.nextExpectedSequenceNo||this.force||i||(i=this.nextExpectedSequenceNo!==s),i))o.push(r);else{var a=this.session.processJsonResponseInternal(r);t&&r===t&&(e=a),s&&(this.lastProcessedSequenceNo=s,this.nextExpectedSequenceNo=s+1)}}return this.queue=o,this._checkTimeout(),e},t.ResponseQueue.prototype.size=function(){return this.queue.length},t.ResponseQueue.prototype._checkTimeout=function(){0===this.queue.length?(clearTimeout(this.forceTimeoutId),this.forceTimeoutId=null):this.forceTimeoutId||(this.forceTimeoutId=setTimeout(function(){try{for(var e="[",i=0;i<this.queue.length;i++)i>0&&(e+=", "),e+=t.strings.box("#",this.queue[i]["#"])||"<none>";e+="]",this.session.sendLogRequest("Expected response #"+this.nextExpectedSequenceNo+" still missing after "+t.ResponseQueue.FORCE_TIMEOUT+" ms. Forcing response queue to process "+this.size()+" elements: "+e)}catch(t){}this.force=!0;try{this.process()}finally{this.force=!1,this.forceTimeoutId=null}}.bind(this),t.ResponseQueue.FORCE_TIMEOUT))},t.ResponseQueue.prototype.prepareRequest=function(t){t["#ACK"]=this.lastProcessedSequenceNo},t.ResponseQueue.prototype.prepareHttpRequest=function(t){t.headers=t.headers||{},t.headers["X-Scout-#ACK"]=this.lastProcessedSequenceNo},t.Session=function(){this.$entryPoint,this.partId=0,this.url=new t.URL,this.userAgent=new t.UserAgent(t.device.type,t.device.supportsTouch()),this.locale,this.textMap=new t.TextMap,this.ready=!1,this.unloading=!1,this.unloaded=!1,this.loggedOut=!1,this.inspector=!1,this.desktop,this.layoutValidator=new t.LayoutValidator,this.detachHelper=new t.DetachHelper(this),this.focusManager,this.keyStrokeManager,this.uiSessionId,this.clientSessionId=sessionStorage.getItem("scout:clientSessionId"),this.forceNewClientSession=!1,this.remote=!1,this.remoteUrl="json",this.modelAdapterRegistry={},this.ajaxRequests=[],this.asyncEvents=[],this.responseQueue=new t.ResponseQueue(this),this.requestsPendingCounter=0,this.suppressErrors=!1,this.requestTimeoutCancel=5e3,this.requestTimeoutPoll=75e3,this.requestTimeoutPing=5e3,this.backgroundJobPollingSupport=new t.BackgroundJobPollingSupport((!0)),this.adapterExportEnabled=!1,this._adapterDataCache={},this._busyCounter=0,this._busyIndicator,this._busyIndicatorTimeoutId,this._deferred,this._fatalMessagesOnScreen={},this.rootAdapter=new t.ModelAdapter,this.rootAdapter.init({session:this,id:"1",objectType:"GlobalAdapter"}),this.rootAdapter.createWidget({session:this,id:"1",objectType:"NullWidget"},new t.NullWidget)},t.Session.prototype.init=function(e){var i=e||{};if(!i.$entryPoint)throw new Error("$entryPoint is not defined");this.$entryPoint=i.$entryPoint,this.partId=t.nvl(i.portletPartId,this.partId),this.forceNewClientSession=t.nvl(this.url.getParameter("forceNewClientSession"),i.forceNewClientSession),this.forceNewClientSession?this.clientSessionId=null:this.clientSessionId=t.nvl(i.clientSessionId,this.clientSessionId),this.userAgent=t.nvl(i.userAgent,this.userAgent),this.suppressErrors=t.nvl(i.suppressErrors,this.suppressErrors),i.locale&&(this.locale=i.locale,this.textMap=t.texts.get(this.locale.languageTag)),this.remote=t.nvl(i.remote,this.remote),i.backgroundJobPollingEnabled===!1&&(this.backgroundJobPollingSupport.enabled=!1),"true"!==this.url.getParameter("debug")&&"true"!==this.url.getParameter("inspector")||(this.inspector=!0),"true"===this.url.getParameter("adapterExportEnabled")&&(this.adapterExportEnabled=!0),this.focusManager=new t.FocusManager({session:this,active:i.focusManagerActive}),this.keyStrokeManager=new t.KeyStrokeManager(this)},t.Session.prototype._throwError=function(t){if(!this.suppressErrors)throw new Error(t)},t.Session.prototype.unregisterModelAdapter=function(t){delete this.modelAdapterRegistry[t.id]},t.Session.prototype.registerModelAdapter=function(t){if(t.id===i)throw new Error("modelAdapter.id must be defined");this.modelAdapterRegistry[t.id]=t},t.Session.prototype.getModelAdapter=function(t){return this.modelAdapterRegistry[t]},t.Session.prototype.getWidget=function(t){if(!t)return null;if("string"!=typeof t)throw new Error("typeof adapterId must be string");var e=this.getModelAdapter(t);if(!e)return null;var i=e.widget;return i},t.Session.prototype.getOrCreateWidget=function(t,e){if(!t)return null;if("string"!=typeof t)throw new Error("typeof adapterId must be string");var i=this.getWidget(t);if(i)return i;var o=this._getAdapterData(t);if(!o)throw new Error("no adapterData found for adapterId="+t);var n=this.createModelAdapter(o);return n.createWidget(o,e)},t.Session.prototype.createModelAdapter=function(i){var o=i.objectType,n={},r=o.split(t.ObjectFactory.MODEL_VARIANT_SEPARATOR);r.length>=2?(o=r[0]+"Adapter"+t.ObjectFactory.MODEL_VARIANT_SEPARATOR+r[1],n.variantLenient=!0):o+="Adapter";var s={id:i.id,session:this},a=t.create(o,s,n);return e.log.trace("created new adapter "+a),a},t.Session.prototype.sendEvent=function(e,i){i=i||0,this.asyncEvents=this._coalesceEvents(this.asyncEvents,e),this.asyncEvents.push(e),this._asyncDelay=Math.min(i,t.nvl(this._asyncDelay,i)),clearTimeout(this._sendTimeoutId),this._sendTimeoutId=setTimeout(function(){this._sendTimeoutId=null,this._asyncDelay=null,this.areRequestsPending()||this._sendNow()}.bind(this),this._asyncDelay)},t.Session.prototype._sendStartupRequest=function(){function t(t){this._processStartupResponse(t)}function i(t,e,i){this._setApplicationLoading(!1),this._processErrorResponse(t,e,i,o)}var o={startup:!0};this.partId&&(o.partId=this.partId),this.clientSessionId&&(o.clientSessionId=this.clientSessionId),o.userAgent=this.userAgent,o.sessionStartupParams=this._createSessionStartupParams();var n=this.defaultAjaxOptions(o);e.ajax(n).done(t.bind(this)).fail(i.bind(this))},t.Session.prototype._createSessionStartupParams=function(){var e={url:this.url.baseUrlRaw,geolocationServiceAvailable:t.device.supportsGeolocation()},i=this.url.parameterMap;for(var o in i)e[o]=i[o];return e},t.Session.prototype._processStartupResponse=function(i){if(i.error)return void this._processErrorJsonResponse(i.error);if(!i.startupData)throw new Error("Missing startupData");try{sessionStorage.setItem("scout:clientSessionId",i.startupData.clientSessionId)}catch(t){e.log.error('Error while storing "scout:clientSessionId" in sessionStorage: '+t)}if(this.uiSessionId=i.startupData.uiSessionId,e(window).on("beforeunload."+this.uiSessionId,this._onWindowBeforeUnload.bind(this)).on("unload."+this.uiSessionId,this._onWindowUnload.bind(this)),i.startupData.reloadPage)return void t.reloadPage();i.startupData.inspector&&(this.inspector=!0),this.modelAdapterRegistry[this.uiSessionId]=this,i.adapterData&&this._copyAdapterData(i.adapterData),this._putLocaleData(i.startupData.locale,i.startupData.textMap);var o=this._getAdapterData(i.startupData.clientSession);this.desktop=this.getOrCreateWidget(o.desktop,this.rootAdapter.widget);var n=function(){if(this._renderDesktop(),i.events){this.processingEvents=!0;try{this._processEvents(i.events)}finally{this.processingEvents=!1}}this.layoutValidator.validate(),this.focusManager.validateFocus(),this._resumeBackgroundJobPolling(),this.ready=!0,e.log.info("Session initialized. Detected "+t.device),e.log.isDebugEnabled()&&(e.log.debug("size of _adapterDataCache after session has been initialized: "+t.objects.countOwnProperties(this._adapterDataCache)),e.log.debug("size of modelAdapterRegistry after session has been initialized: "+t.objects.countOwnProperties(this.modelAdapterRegistry)))}.bind(this);this.render(n)},t.Session.prototype.render=function(e){t.fonts.loadingComplete?e():t.fonts.preloader().then(e)},t.Session.prototype._sendUnloadRequest=function(){var t={uiSessionId:this.uiSessionId,unload:!0,showBusyIndicator:!1};this._sendRequest(t)},t.Session.prototype._sendNow=function(){if(0!==this.asyncEvents.length){var e={uiSessionId:this.uiSessionId,events:this.asyncEvents};e.showBusyIndicator=e.events.some(function(e){return t.nvl(e.showBusyIndicator,!0)}),this.responseQueue.prepareRequest(e),this._sendRequest(e),this.asyncEvents=[]}},t.Session.prototype._coalesceEvents=function(t,i){if(!i.coalesce)return t;var o=e.negate(i.coalesce).bind(i);return t.filter(o)},t.Session.prototype._sendRequest=function(e){if(e){if(this.offline)return void this._handleSendWhenOffline(e);if(e.unload&&navigator.sendBeacon){var i=new Blob([this._requestToJson(e)],{type:"application/json; charset=UTF-8"});return void navigator.sendBeacon(this._decorateUrl(this.remoteUrl,e),i)}var o=this.defaultAjaxOptions(e),n=t.nvl(e.showBusyIndicator,!0);e.unload&&(o.async=!1),this._performUserAjaxRequest(o,n,e)}},t.Session.prototype._handleSendWhenOffline=function(t){t.events&&(this._queuedRequest?this._queuedRequest.events?(t.events.forEach(function(t){this._queuedRequest.events=this._coalesceEvents(this._queuedRequest.events,t)}.bind(this)),this._queuedRequest.events=this._queuedRequest.events.concat(t.events)):this._queuedRequest.events=t.events:this._queuedRequest=t,this.layoutValidator.validate())},t.Session.prototype.defaultAjaxOptions=function(t){t=t||{};var e=this._decorateUrl(this.remoteUrl,t),i={type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",cache:!1,url:e,data:this._requestToJson(t)};return t.cancel&&(i.timeout=this.requestTimeoutCancel),t.ping&&(i.timeout=this.requestTimeoutPing),t.pollForBackgroundJobs&&(i.timeout=this.requestTimeoutPoll),i},t.Session.prototype._decorateUrl=function(e,i){var o=null;return i.unload?o="unload":i.pollForBackgroundJobs?o="poll":i.ping?o="ping":i.cancel?o="cancel":i.log?o="log":i.syncResponseQueue&&(o="sync"),o&&(e=new t.URL(e).addParameter(o).toString()),e},t.Session.prototype._requestToJson=function(e){return JSON.stringify(e,function(o,n){var r=this===e&&"showBusyIndicator"===o||this instanceof t.Event&&t.isOneOf(o,"showBusyIndicator","coalesce");return r?i:n})},t.Session.prototype._performUserAjaxRequest=function(t,i,o){function n(t){try{i&&this.setBusy(!1),l=this.responseQueue.process(t)}catch(t){a=a||t}}function r(t,e,n){try{i&&this.setBusy(!1),this._processErrorResponse(t,e,n,o)}catch(t){a=a||t}}function s(t,e,i){if(this.unregisterAjaxRequest(h),this.requestsPendingCounter--,this.layoutValidator.validate(),l){this._resumeBackgroundJobPolling(),this._fireRequestFinished(t);var o=this._queuedRequest;o&&(this._queuedRequest=null,this.responseQueue.prepareRequest(o),this._sendRequest(o)),this._sendTimeoutId||this._sendNow()}if(a)throw a}i&&this.setBusy(!0),this.requestsPendingCounter++;var a=null,l=!1,h=e.ajax(t).done(n.bind(this)).fail(r.bind(this)).always(s.bind(this));this.registerAjaxRequest(h)},t.Session.prototype.registerAjaxRequest=function(t){t&&this.ajaxRequests.push(t)},t.Session.prototype.unregisterAjaxRequest=function(e){e&&t.arrays.remove(this.ajaxRequests,e)},t.Session.prototype._resumeBackgroundJobPolling=function(){this.backgroundJobPollingSupport.enabled&&this.backgroundJobPollingSupport.status!==t.BackgroundJobPollingStatus.RUNNING&&(e.log.info("Resume background jobs polling request, status was="+this.backgroundJobPollingSupport.status),this._pollForBackgroundJobs())},t.Session.prototype._pollForBackgroundJobs=function(){function t(t){t.error?(e.log.warn("Polling request failed. Interrupt polling until the next user-initiated request succeeds"),this.backgroundJobPollingSupport.setFailed(),this.areRequestsPending()?this.responseQueue.add(t):this.responseQueue.process(t)):t.sessionTerminated?(e.log.warn("Session terminated, stopped polling for background jobs"),!this.loggedOut&&t.redirectUrl&&this.logout(t.redirectUrl)):(this.areRequestsPending()?this.responseQueue.add(t):(this.responseQueue.process(t),this.layoutValidator.validate()),setTimeout(this._pollForBackgroundJobs.bind(this)))}function i(t,e,i){this.backgroundJobPollingSupport.setFailed(),this._processErrorResponse(t,e,i,n)}function o(t,e,i){this.unregisterAjaxRequest(s)}var n={uiSessionId:this.uiSessionId,pollForBackgroundJobs:!0};this.responseQueue.prepareRequest(n),this.backgroundJobPollingSupport.setRunning();var r=this.defaultAjaxOptions(n),s=e.ajax(r).done(t.bind(this)).fail(i.bind(this)).always(o.bind(this));this.registerAjaxRequest(s)},t.Session.prototype.processJsonResponseInternal=function(t){var e=!1;return t.error?this._processErrorJsonResponse(t.error):(this._processSuccessResponse(t),e=!0),e},t.Session.prototype._processSuccessResponse=function(i){if(i.adapterData&&this._copyAdapterData(i.adapterData),i.events){this.processingEvents=!0;try{this._processEvents(i.events)}finally{this.processingEvents=!1}}if(e.log.isDebugEnabled()){var o=t.objects.countOwnProperties(this._adapterDataCache);e.log.debug("size of _adapterDataCache after response has been processed: "+o),o=t.objects.countOwnProperties(this.modelAdapterRegistry),e.log.debug("size of modelAdapterRegistry after response has been processed: "+o)}},t.Session.prototype._copyAdapterData=function(t){var i,o=0;for(i in t)this._adapterDataCache[i]=t[i],o++;o>0&&e.log.debug("Stored "+o+" properties in adapterDataCache")},t.Session.prototype._processErrorResponse=function(i,o,n,r){e.log.error("errorResponse: status="+i.status+", textStatus="+o+", errorThrown="+n);var s=!i.status||i.status>=12e3||502===i.status||503===i.status||504===i.status;if(s){if(this.ready)return this.goOffline(),void(this._queuedRequest||!r||r.pollForBackgroundJobs||(this._queuedRequest=r));n=n||this.optText("ui.ConnectionInterrupted","Connection interrupted")}var a={header:this.optText("ui.NetworkError","Network error"),body:t.strings.join(" ",i.status||"",n),yesButtonText:this.optText("ui.Reload","Reload"),yesButtonAction:function(){t.reloadPage()},noButtonText:this.ready?this.optText("ui.Ignore","Ignore"):null};this.showFatalMessage(a,i.status+".net")},t.Session.prototype._processErrorJsonResponse=function(e){var i={header:this.optText("ui.ServerError","Server error")+" ("+this.optText("ui.ErrorCodeX","Code "+e.code,e.code)+")",body:e.message,yesButtonText:this.optText("ui.Reload","Reload"),yesButtonAction:function(){t.reloadPage()}};5===e.code?(i.header=e.message,i.body=null,i.yesButtonText="Retry"):10===e.code?(i.header=this.optText("ui.SessionTimeout",i.header),i.body=this.optText("ui.SessionExpiredMsg",i.body)):20===e.code?(i.header=this.optText("ui.UnexpectedProblem",i.header),i.body=t.strings.join("\n\n",this.optText("ui.InternalProcessingErrorMsg",i.body," ("+this.optText("ui.ErrorCodeX","Code 20","20")+")"),this.optText("ui.UiInconsistentMsg","")),i.noButtonText=this.optText("ui.Ignore","Ignore")):30===e.code&&(i.header=this.optText("ui.UnsafeUpload",i.header),i.body=this.optText("ui.UnsafeUploadMsg",i.body),i.yesButtonText=this.optText("ui.Ok","Ok"),i.yesButtonAction=function(){}),this.showFatalMessage(i,e.code)},t.Session.prototype._fireRequestFinished=function(t){if(this._deferred){if(t.events)for(var e=0;e<t.events.length;e++)this._deferredEventTypes.push(t.events[e].type);0===this.requestsPendingCounter&&(this._deferred.resolve(this._deferredEventTypes),this._deferred=null,this._deferredEventTypes=null)}},t.Session.prototype.showFatalMessage=function(e,i){if(i){if(this._fatalMessagesOnScreen[i])return;this._fatalMessagesOnScreen[i]=!0}this._setApplicationLoading(!1),e=e||{};var o={session:this,parent:this.desktop||new t.NullWidget,iconId:e.iconId,severity:t.nvl(e.severity,t.MessageBox.SEVERITY.ERROR),header:e.header,body:e.body,hiddenText:e.hiddenText,yesButtonText:e.yesButtonText,noButtonText:e.noButtonText,cancelButtonText:e.cancelButtonText},n=t.create("MessageBox",o),r=e.entryPoint||this.$entryPoint;n.on("action",function(t){delete this._fatalMessagesOnScreen[i],n.destroy();var o=t.option;"yes"===o&&e.yesButtonAction?e.yesButtonAction.apply(this):"no"===o&&e.noButtonAction?e.noButtonAction.apply(this):"cancel"===o&&e.cancelButtonAction&&e.cancelButtonAction.apply(this)}.bind(this)),n.render(r)},t.Session.prototype.uploadFiles=function(i,o,n,r,s){var a=new FormData,l=0;if(n&&e.each(n,function(t,e){a.append(t,e)}),e.each(o,function(e,i){s&&0!==s.length&&!t.isOneOf(i.type,s)||(l+=i.size,a.append("files",i,i.name||""))}.bind(this)),r||(r=5242880),l>r){var h={header:this.text("ui.FileSizeLimitTitle"),body:this.text("ui.FileSizeLimit",r/1024/1024),yesButtonText:this.optText("Ok","Ok")};return void this.showFatalMessage(h)}var d={async:!0,type:"POST",url:"upload/"+this.uiSessionId+"/"+i.id,cache:!1,processData:!1,contentType:!1,data:a};a.polyfill&&a.applyToAjaxOptions(d),this.responseQueue.prepareHttpRequest(d);var p=!this.areRequestsPending();this._performUserAjaxRequest(d,p)},t.Session.prototype.goOffline=function(){this.offline||(this.offline=!0,this.ajaxRequests.slice().forEach(function(t){t.abort()}),setTimeout(function(){this.unloading||this.unloaded||(this.rootAdapter.goOffline(),this.reconnector||(this.reconnector=new t.Reconnector(this)),this.reconnector.start())}.bind(this),100))},t.Session.prototype.goOnline=function(){this.offline=!1;var t={uiSessionId:this.uiSessionId,syncResponseQueue:!0};this._sendRequest(t),this.rootAdapter.goOnline()},t.Session.prototype.onReconnecting=function(){this.desktop&&this.desktop.onReconnecting()},t.Session.prototype.onReconnectingSucceeded=function(){this.desktop&&this.desktop.onReconnectingSucceeded(),this.goOnline()},t.Session.prototype.onReconnectingFailed=function(){this.desktop&&this.desktop.onReconnectingFailed()},t.Session.prototype.listen=function(){return this._deferred||(this._deferred=e.Deferred(),this._deferredEventTypes=[]),this._deferred},t.Session.prototype.areEventsQueued=function(){return this.asyncEvents.length>0},t.Session.prototype.areBusyIndicatedEventsQueued=function(){return this.asyncEvents.some(function(e){return t.nvl(e.showBusyIndicator,!0)})},t.Session.prototype.areResponsesQueued=function(){return this.responseQueue.size()>0},t.Session.prototype.areRequestsPending=function(){return this.requestsPendingCounter>0},t.Session.prototype.setBusy=function(t){t?(0===this._busyCounter&&this._renderBusy(),this._busyCounter++):(this._busyCounter--,0!==this._busyCounter||this.areBusyIndicatedEventsQueued()&&!this.offline||this._removeBusy())},t.Session.prototype._renderBusy=function(){null!==this._busyIndicatorTimeoutId&&this._busyIndicatorTimeoutId!==i||(this._busyIndicatorTimeoutId=setTimeout(function(){this._busyIndicator||this.desktop&&this.desktop.rendered&&(this._busyIndicator=t.create("BusyIndicator",{parent:this.desktop}),this._busyIndicator.on("cancel",this._onCancelProcessing.bind(this)),this._busyIndicator.render(this.$entryPoint))}.bind(this),500))},t.Session.prototype._removeBusy=function(){clearTimeout(this._busyIndicatorTimeoutId),this._busyIndicatorTimeoutId=null,this._busyIndicator&&(this._busyIndicator.destroy(),this._busyIndicator=null)},t.Session.prototype._onCancelProcessing=function(t){var e=this._busyIndicator;e&&(e.off("cancel"),setTimeout(function(){e.rendered&&(e.$label.addClass("cancelled"),e.$buttons.remove(),e.$content.addClass("no-buttons"))}.bind(this),100),this._sendCancelRequest())},t.Session.prototype._sendCancelRequest=function(){this._sendRequest({uiSessionId:this.uiSessionId,cancel:!0})},t.Session.prototype.sendLogRequest=function(t){function i(t,e,i){this.unregisterAjaxRequest(r)}var o={uiSessionId:this.uiSessionId,log:!0,message:t};this.currentEvent&&(o.event={target:this.currentEvent.target,type:this.currentEvent.type});var n=this.defaultAjaxOptions(o),r=e.ajax(n).always(i.bind(this));this.registerAjaxRequest(r)},t.Session.prototype._setApplicationLoading=function(t){t?this._applicationLoadingTimeoutId=setTimeout(function(){this.desktop&&this.desktop.rendered||this.$entryPoint.appendDiv("application-loading").hide().fadeIn()}.bind(this),500):(clearTimeout(this._applicationLoadingTimeoutId),this._applicationLoadingTimeoutId=null,this.$entryPoint.children(".application-loading").remove())},t.Session.prototype._processEvents=function(t){for(var i=0;i<t.length;){var o=t[i];this.currentEvent=o;var n=this.getModelAdapter(o.target);n?(t.splice(i,1),i=0,e.log.debug("Processing event '"+o.type+"' for adapter with ID "+o.target),n.onModelEvent(o),n.resetEventFilters()):(e.log.debug("Postponing '"+o.type+"' for adapter with ID "+o.target),i++)}if(this.currentEvent=null,t.length)throw new Error("Could not resolve event targets: ["+t.map(function(t){return'"'+t.target+'"'}).join(", ")+"]")},t.Session.prototype.start=function(){e.log.info("Session starting..."),this._setApplicationLoading(!0),this._sendStartupRequest()},t.Session.prototype.onModelEvent=function(t){"localeChanged"===t.type?this._onLocaleChanged(t):"logout"===t.type?this._onLogout(t):"disposeAdapter"===t.type?this._onDisposeAdapter(t):"reloadPage"===t.type?this._onReloadPage(t):e.log.warn('Model action "'+t.type+'" is not supported by UI session')},t.Session.prototype.resetEventFilters=function(){},t.Session.prototype._onLocaleChanged=function(t){this._putLocaleData(t.locale,t.textMap)},t.Session.prototype._putLocaleData=function(e,i){this.locale=new t.Locale(e),this.textMap=new t.TextMap(i)},t.Session.prototype._renderDesktop=function(){
this.desktop.render(this.$entryPoint),this.desktop.invalidateLayoutTree(!1),this._setApplicationLoading(!1)},t.Session.prototype._onLogout=function(t){this.logout(t.redirectUrl)},t.Session.prototype.logout=function(i){if(this.loggedOut=!0,this.forceNewClientSession)this.desktop.$container.window(!0).close();else{try{sessionStorage.setItem("scout:loginUrl",window.location.href)}catch(t){e.log.error('Error while storing "scout:loginUrl" in sessionStorage: '+t)}setTimeout(function(){t.reloadPage({redirectUrl:i})}.bind(this))}},t.Session.prototype._onDisposeAdapter=function(t){var e=this.getModelAdapter(t.adapter);e&&e.destroy()},t.Session.prototype._onReloadPage=function(e){t.reloadPage({clearBody:!1})},t.Session.prototype._onWindowBeforeUnload=function(){e.log.info("Session before unloading..."),this.unloading=!0,setTimeout(function(){this.unloading=!1}.bind(this),200)},t.Session.prototype._onWindowUnload=function(){e.log.info("Session unloading..."),this.unloaded=!0,this.desktop&&this.desktop.formController.closePopupWindows(),this.loggedOut||this._sendUnloadRequest()},t.Session.prototype._getAdapterData=function(t){var e=this._adapterDataCache[t],i=!this.adapterExportEnabled;return i&&delete this._adapterDataCache[t],e},t.Session.prototype.getAdapterData=function(t){return this._adapterDataCache[t]},t.Session.prototype.text=function(e){return t.TextMap.prototype.get.apply(this.textMap,arguments)},t.Session.prototype.optText=function(e,i){return t.TextMap.prototype.optGet.apply(this.textMap,arguments)},t.Session.prototype.textExists=function(t){return this.textMap.exists(t)},t.UserAgent=function(e,i){if(!e)throw new Error("deviceType needs to be defined");this.deviceType=e,this.touch=t.nvl(i,!1)},t.WidgetEventTypeFilter=function(){this.filters=[]},t.WidgetEventTypeFilter.prototype.addFilter=function(t){this.filters.push(t)},t.WidgetEventTypeFilter.prototype.addFilterForEventType=function(t){this.filters.push(function(e){return e.type===t})},t.WidgetEventTypeFilter.prototype.filter=function(t){return this.filters.some(function(e){return e(t)})},t.WidgetEventTypeFilter.prototype.reset=function(){this.filters=[]},t.graphics={prefSize:function(o,n){if(!o[0]||o.isDisplayNone())return new t.Dimension(0,0);n=n||{};var r={includeMargin:!1,useCssSize:!1,widthHint:i,heightHint:i,restoreScrollPositions:!0};n=e.extend({},r,n);var s=o.attr("style"),a=o.scrollLeft(),l=o.scrollTop();n.restoreScrollPositions&&t.scrollbars.storeScrollPositions(o);var h=n.useCssSize?"":t.nvl(n.widthHint,"auto"),d=n.useCssSize?"":t.nvl(n.heightHint,"auto");o.css({width:h,height:d});var p=o[0].getBoundingClientRect(),u=new t.Dimension(p.width,p.height);return n.includeMargin&&(u.width+=o.cssMarginX(),u.height+=o.cssMarginY()),o.attrOrRemove("style",s),o.scrollLeft(a),o.scrollTop(l),n.restoreScrollPositions&&t.scrollbars.restoreScrollPositions(o),u.width=Math.ceil(u.width),u.height=Math.ceil(u.height),u},getSize:function(e,i){if(!e[0]||e.isDisplayNone())return new t.Dimension(0,0);var o=e[0].getBoundingClientRect(),n=new t.Dimension(o.width,o.height);return t.nvl(i,!1)&&(n.width+=e.cssMarginX(),n.height+=e.cssMarginY()),n.width=Math.ceil(n.width),n.height=Math.ceil(n.height),n},setSize:function(e,i,o){var n=i instanceof t.Dimension?i:new t.Dimension(i,o);e.cssWidth(n.width).cssHeight(n.height)},getVisibleSize:function(e,i){return 1===e.length&&e.isVisible()?t.graphics.getSize(e,i):new t.Dimension(0,0)},getInsets:function(e,o){o=o||{};var n,r=["top","right","bottom","left"],s=[0,0,0,0],a=o.includeMargin!==i&&o.includeMargin,l=o.includePadding===i||o.includePadding,h=o.includeBorder===i||o.includeBorder;for(n=0;n<r.length;n++)a&&(s[n]+=e.cssPxValue("margin-"+r[n])),l&&(s[n]+=e.cssPxValue("padding-"+r[n])),h&&(s[n]+=e.cssPxValue("border-"+r[n]+"-width"));return new t.Insets(s[0],s[1],s[2],s[3])},getMargins:function(e){return t.graphics.getInsets(e,{includeMargin:!0,includePadding:!1,includeBorder:!1})},getBounds:function(e){var i=function(t){var i=e.css(t);return"auto"===i?0:parseInt(i,10)};return new t.Rectangle(i("left"),i("top"),e.outerWidth(!0),e.outerHeight(!0))},setBounds:function(e,i,o,n,r){var s=i instanceof t.Rectangle?i:new t.Rectangle(i,o,n,r);e.cssLeft(s.x).cssTop(s.y).cssWidth(s.width).cssHeight(s.height)},setLocation:function(e,i,o){var n=i instanceof t.Point?i:new t.Point(i,o);e.cssLeft(n.x).cssTop(n.y)},bounds:function(e,i,o){return t.graphics._bounds(e,e.position(),i,o)},offsetBounds:function(e,i,o){return t.graphics._bounds(e,e.offset(),i,o)},_bounds:function(e,i,o,n){n&&(i.left+=e.cssMarginLeft(),i.top+=e.cssMarginTop());var r=t.graphics.getSize(e,o);return new t.Rectangle(i.left,i.top,r.width,r.height)},debugOutput:function(i){if(!i)return"$comp is undefined";if(i instanceof e||(i=e(i)),0===i.length)return"$comp doesn\t match any elements";var o="";if(i.attr("id")&&(o+="id="+i.attr("id")),i.attr("class")&&(o+=" class="+i.attr("class")),i.attr("data-modelclass")&&(o+=" data-modelclass="+i.attr("data-modelclass")),0===o.length){var n=t.nvl(i.html(),"");n.length>30&&(n=n.substring(0,30)+"..."),o=n}return"Element["+o.trim()+"]"}},t.Point=function(t,e){this.x=t||0,this.y=e||0},t.Point.prototype.toString=function(){return"Point[x="+this.x+" y="+this.y+"]"},t.Point.prototype.equals=function(t){return!!t&&(this.x===t.x&&this.y===t.y)},t.Point.prototype.clone=function(e){return new t.Point(this.x,this.y)},t.Dimension=function(e,i){e instanceof t.Dimension?(this.width=e.width,this.height=e.height):(this.width=e||0,this.height=i||0)},t.Dimension.prototype.toString=function(){return"Dimension[width="+this.width+" height="+this.height+"]"},t.Dimension.prototype.equals=function(t){return!!t&&(this.width===t.width&&this.height===t.height)},t.Dimension.prototype.clone=function(){return new t.Dimension(this.width,this.height)},t.Dimension.prototype.subtract=function(e){return new t.Dimension(this.width-e.horizontal(),this.height-e.vertical())},t.Dimension.prototype.add=function(e){return new t.Dimension(this.width+e.horizontal(),this.height+e.vertical())},t.Rectangle=function(t,e,i,o){this.x=t||0,this.y=e||0,this.width=i||0,this.height=o||0},t.Rectangle.prototype.equals=function(t){return!!t&&(this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height)},t.Rectangle.prototype.toString=function(){return"Rectangle[x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t.Rectangle.prototype.clone=function(e){return new t.Rectangle(this.x,this.y,this.width,this.height)},t.Rectangle.prototype.center=function(){return new t.Point(this.x+this.width/2,this.y+this.height/2)},t.Rectangle.prototype.contains=function(t,e){return e>=this.y&&e<this.y+this.height&&t>=this.x&&t<this.x+this.width},t.Rectangle.prototype.subtract=function(e){return new t.Rectangle(this.x+e.left,this.y+e.top,this.width-e.right,this.height-e.bottom)},t.Rectangle.prototype.union=function(e){var i=this.width,o=this.height;if(i<0||o<0)return new t.Rectangle(e.x,e.y,e.width,e.height);var n=e.width,r=e.height;if(n<0||r<0)return new t.Rectangle(this.x,this.y,this.width,this.height);var s=this.x,a=this.y;i+=s,o+=a;var l=e.x,h=e.y;return n+=l,r+=h,s>l&&(s=l),a>h&&(a=h),i<n&&(i=n),o<r&&(o=r),i-=s,o-=a,i>Number.MAX_VALUE&&(i=Number.MAX_VALUE),o>Number.MAX_VALUE&&(o=Number.MAX_VALUE),new t.Rectangle(s,a,i,o)},t.Insets=function(t,e,i,o){this.top=t||0,this.right=e||0,this.bottom=i||0,this.left=o||0},t.Insets.prototype.equals=function(t){return this.top===t.top&&this.right===t.right&&this.bottom===t.bottom&&this.left===t.left},t.Insets.prototype.horizontal=function(){return this.right+this.left},t.Insets.prototype.vertical=function(){return this.top+this.bottom},t.Insets.prototype.toString=function(){return"Insets[top="+this.top+" right="+this.right+" bottom="+this.bottom+" left="+this.left+"]"},t.Insets.prototype.clone=function(){return new t.Insets(this.top,this.right,this.bottom,this.left)},t.TreeSet=function(){this.array=[],this.properties={}},t.TreeSet.prototype.add=function(t){this.contains(t)||(this.array.push(t),this.array.sort(),this.properties[t]=!0)},t.TreeSet.prototype.size=function(){return this.array.length},t.TreeSet.prototype.contains=function(t){return t in this.properties},t.TreeSet.prototype.last=function(){return this.array[this.array.length-1]},t.HtmlEnvironment={formRowHeight:30,formRowGap:10,formColumnWidth:420,formColumnGap:32,smallColumnGap:4,fieldLabelWidth:140,fieldMandatoryIndicatorWidth:8,fieldStatusWidth:20},t.AbstractLayout=function(){},t.AbstractLayout.prototype.invalidate=function(){},t.AbstractLayout.prototype.layout=function(t){},t.AbstractLayout.prototype.preferredLayoutSize=function(e,i){return t.graphics.prefSize(e,i)},t.HtmlComponent=function(e,i){if(!i)throw new Error("session must be defined for "+this.debug());this.$comp=e,this.layout=new t.NullLayout,this.layoutData,this.valid=!1,this.layouted=!1,this.suppressInvalidate=!1,this.pixelBasedSizing=!0,this.session=i},t.HtmlComponent.prototype.getParent=function(){var e=this.$comp.parent();return 0===e.length?null:t.HtmlComponent.optGet(e)},t.HtmlComponent.prototype.isDescendantOf=function(e){for(var i=this.$comp.parent();i.length>0;){if(t.HtmlComponent.optGet(i)===e)return!0;i=i.parent()}return!1},t.HtmlComponent.prototype.getAvailableSize=function(){var t,e=this.getSize();return this.scrollable&&(t=this.getPreferredSize(),t.height>e.height&&(e.height=t.height)),e},t.HtmlComponent.prototype.invalidateLayout=function(){this.valid=!1,this.layout&&this.layout.invalidate()},t.HtmlComponent.prototype.validateLayout=function(){if(!this.layout)throw new Error("Called layout() but component has no layout");this.valid||(this.layouting=!0,this.layout.layout(this.$comp),this.layouting=!1,this.layouted=!0,this.size=this.getSize(),this.valid=!0)},t.HtmlComponent.prototype.revalidateLayout=function(){this.invalidateLayout(),this.validateLayout()},t.HtmlComponent.prototype.invalidateLayoutTree=function(e){this.suppressInvalidate||(t.nvl(e,!0)?this.session.layoutValidator.invalidateTree(this):(this.valid=!1,this.session.layoutValidator.invalidate(this)))},t.HtmlComponent.prototype.validateLayoutTree=function(){this.session.layoutValidator.validate()},t.HtmlComponent.prototype.revalidateLayoutTree=function(){this.invalidateLayoutTree(),this.validateLayoutTree()},t.HtmlComponent.prototype.isValidateRoot=function(){return!!this.validateRoot||!(!this.layoutData||!this.layoutData.isValidateRoot)&&this.layoutData.isValidateRoot()},t.HtmlComponent.prototype.setLayout=function(t){this.layout=t,t.cssClass&&this.$comp.addClass(t.cssClass)},t.HtmlComponent.prototype.getPreferredSize=function(t){if(!this.layout)throw new Error("Called getPreferredSize() but component has no layout");t=t||{};var i=this.layout.preferredLayoutSize(this.$comp,t);return e.log.trace("(HtmlComponent#getPreferredSize) "+this.debug()+" widthHint="+t.widthHint+" heightHint="+t.heightHint+" preferredSize="+i),i},t.HtmlComponent.prototype.getInsets=function(e){return t.graphics.getInsets(this.$comp,e)},t.HtmlComponent.prototype.getMargins=function(){return t.graphics.getMargins(this.$comp)},t.HtmlComponent.prototype.getSize=function(e){return t.graphics.getSize(this.$comp,e)},t.HtmlComponent.prototype.setSize=function(e){if(this.isAttachedAndVisible()){var i=this.size;e.equals(i)||this.invalidateLayout(),this.pixelBasedSizing&&t.graphics.setSize(this.$comp,e),this.validateLayout()}},t.HtmlComponent.prototype.getBounds=function(){return t.graphics.getBounds(this.$comp)},t.HtmlComponent.prototype.offsetBounds=function(){return t.graphics.offsetBounds(this.$comp)},t.HtmlComponent.prototype.setLocation=function(e){t.graphics.setLocation(this.$comp,e)},t.HtmlComponent.prototype.setBounds=function(e){if(this.isAttachedAndVisible()){var i=this.getBounds();i.equals(e)||this.invalidateLayout(),t.graphics.setBounds(this.$comp,e),this.validateLayout()}},t.HtmlComponent.prototype.pack=function(){var t=this.getPreferredSize();this.setSize(t)},t.HtmlComponent.prototype.isAttached=function(){return this.$comp.isAttached()&&this.$comp.window(!0)},t.HtmlComponent.prototype.isVisible=function(){return this.$comp.isVisible()},t.HtmlComponent.prototype.isAttachedAndVisible=function(){return this.isAttached()&&this.isVisible()},t.HtmlComponent.prototype.debug=function(){return t.graphics.debugOutput(this.$comp)},t.HtmlComponent.install=function(e,i){if(!e)throw new Error('Missing argument "$comp"');if(!i)throw new Error('Missing argument "session"');var o=new t.HtmlComponent(e,i);return e.data("htmlComponent",o),o},t.HtmlComponent.get=function(t){var e=this.optGet(t);if(!e){var i="";throw t&&(i="\nClass: "+t.attr("class"),i+="\nId: "+t.attr("id"),i+="\nAttached: "+t.isAttached()),new Error('data "htmlComponent" is undefined.'+i)}return e},t.HtmlComponent.optGet=function(t){return t&&t.data("htmlComponent")},t.LayoutConstants={MIN:0,PREF:1,MAX:2,EPS:1e-6},t.LayoutValidator=function(){this._invalidComponents=[],this._validateTimeoutId=null,this._postValidateFunctions=[]},t.LayoutValidator.prototype.invalidateTree=function(t){for(var e,i=t;i;){if(t=i,t.invalidateLayout(),t.isValidateRoot()){e=t;break}i=t.getParent()}i||(e=t),this.invalidate(e)},t.LayoutValidator.prototype.invalidate=function(e){var i=0;this._invalidComponents.indexOf(e)>=0||(this._invalidComponents.forEach(function(t,o){t.isDescendantOf(e)||i++},this),t.arrays.insert(this._invalidComponents,e,i),null===this._validateTimeoutId&&(this._validateTimeoutId=setTimeout(function(){this.validate()}.bind(this))))},t.LayoutValidator.prototype.validate=function(){clearTimeout(this._validateTimeoutId),this._validateTimeoutId=null,this._invalidComponents.slice().forEach(function(e){e.isAttached()&&(e.validateLayout(),t.arrays.remove(this._invalidComponents,e))},this),this._postValidateFunctions.slice().forEach(function(e){e(),t.arrays.remove(this._postValidateFunctions,e)},this)},t.LayoutValidator.prototype.cleanupInvalidComponents=function(e){this._invalidComponents.slice().forEach(function(i){i.$comp.closest(e).length>0&&t.arrays.remove(this._invalidComponents,i)},this)},t.LayoutValidator.prototype.schedulePostValidateFunction=function(t){t&&this._postValidateFunctions.push(t)},t.LogicalGridData=function(e){this.gridx=0,this.gridy=0,this.gridw=1,this.gridh=1,this.weightx=0,this.weighty=0,this.useUiWidth=!1,this.useUiHeight=!1,this.widthHint=0,this.heightHint=0,this.horizontalAlignment=-1,this.verticalAlignment=-1,this.fillHorizontal=!0,this.fillVertical=!0,this.topInset=0,e instanceof t.LogicalGridData?t.objects.copyProperties(e,this):e instanceof t.Widget&&(this.widget=e)},t.LogicalGridData.prototype.validate=function(){if(this.widget){var e=this.widget.gridData;this.gridx=e.x,this.gridy=e.y,this.gridw=e.w,this.gridh=e.h,this.weightx=e.weightX,this.weighty=e.weightY,this.weightx<0&&(this.weightx=Math.max(1,this.gridw)),this.weighty<0&&(this.weighty=this._inheritWeightY()),this.useUiWidth=e.useUiWidth,this.useUiHeight=e.useUiHeight,this.horizontalAlignment=e.horizontalAlignment,this.verticalAlignment=e.verticalAlignment,this.fillHorizontal=e.fillHorizontal,this.fillVertical=e.fillVertical,this.widthHint=e.widthInPixel,this.heightHint=e.heightInPixel,this.widget.labelVisible&&this.widget.$label&&this.widget.labelPosition===t.FormField.LABEL_POSITION_TOP&&(this.logicalRowHeightAddition=t.HtmlEnvironment.formRowHeight)}},t.LogicalGridData.prototype._inheritWeightY=function(){var t=this._inheritWeightYRec(this.widget);if(null===t){var e=this.widget.gridData;t=e.weightY>=0?e.weightY:e.h>=2?e.h:0}return t},t.LogicalGridData.prototype._inheritWeightYRec=function(e){var i=!1,o=0;if(e instanceof t.CompositeField){var n,r,s,a=e.getFields();for(n=0;n<a.length;n++)if(s=a[n],s.visible){var l=s.gridData;l.weightY<0?(r=this._inheritWeightYRec(s),null!==r&&(i=!0,o+=r)):(i=!0,o+=l.weightY)}}else o=e.gridData.h>=2?e.gridData.h:0,i=!0;return i?o:null},t.LogicalGridData.prototype.isValidateRoot=function(){return!this.useUiHeight&&!this.useUiWidth&&this.fillVertical&&this.fillHorizontal},t.LogicalGridLayout=function(e,i){t.LogicalGridLayout.parent.call(this),this.cssClass="logical-grid-layout",this.validityBasedOnContainerSize=new t.Dimension,this.valid=!1,this.m_info,this.m_hgap=e||0,this.m_vgap=i||0},t.inherits(t.LogicalGridLayout,t.AbstractLayout),t.LogicalGridLayout.prototype._verifyLayout=function(e){var i=t.HtmlComponent.get(e),o=i.getSize();this.valid&&this.validityBasedOnContainerSize.equals(o)||(this.validityBasedOnContainerSize=o,this.validateLayout(e),this.valid=!0)},t.LogicalGridLayout.prototype.invalidate=function(){this.valid=!1},t.LogicalGridLayout.prototype.validateLayout=function(i){var o,n=[],r=[];i.children().each(function(i,s){var a=e(s),l=t.HtmlComponent.optGet(a);l&&a.isVisible()&&(n.push(a),o=l.layoutData,o.validate(),r.push(o))}),this.m_info=new t.LogicalGridLayoutInfo(n,r,this.m_hgap,this.m_vgap),e.log.trace("(LogicalGridLayout#validateLayout) $container="+t.HtmlComponent.get(i).debug())},t.LogicalGridLayout.prototype.layout=function(i){this._verifyLayout(i);var o=t.HtmlComponent.get(i),n=o.getAvailableSize(),r=o.getInsets();e.log.trace("(LogicalGridLayout#layout) container "+o.debug()+" size="+n+" insets="+r);var s,a,l,h,d,p,u,c,f,y,g=this.m_info.layoutCellBounds(n,r);for(p=0;p<this.m_info.$components.length;p++)d=this.m_info.$components[p],u=t.HtmlComponent.get(d),c=this.m_info.gridDatas[p],s=g[c.gridy][c.gridx],a=g[c.gridy+c.gridh-1][c.gridx+c.gridw-1],l=s.union(a),c.topInset>0&&(l.y+=c.topInset,l.height-=c.topInset),y=u.getMargins(),l.width-=y.horizontal(),l.height-=y.vertical(),c.fillHorizontal&&c.fillVertical||(h=this.m_info.compSize[p],!c.fillHorizontal&&h.width<l.width&&(f=l.width-h.width,l.width=h.width,0===c.horizontalAlignment?l.x+=Math.ceil(f/2):c.horizontalAlignment>0&&(l.x+=f)),!c.fillVertical&&h.height<l.height&&(f=l.height-h.height,0===c.heightHint?l.height=h.height:l.height=c.heightHint,0===c.verticalAlignment?l.y+=Math.ceil(f/2):c.verticalAlignment>0&&(l.y+=f))),e.log.trace("(LogicalGridLayout#layout) comp="+u.debug()+" bounds="+l),u.setBounds(l)},t.LogicalGridLayout.prototype.preferredLayoutSize=function(e){return this.getLayoutSize(e,t.LayoutConstants.PREF)},t.LogicalGridLayout.prototype.getLayoutSize=function(e,i){this._verifyLayout(e);var o,n,r,s=new t.Dimension,a=0;for(o=0;o<this.m_info.cols;o++)n=this.m_info.width[o][i],a>0&&(s.width+=this.m_hgap),s.width+=n,a++;for(a=0,o=0;o<this.m_info.rows;o++)r=this.m_info.height[o][i],a>0&&(s.height+=this.m_vgap),s.height+=r,a++;var l=t.HtmlComponent.get(e).getInsets();return s.width+=l.horizontal(),s.height+=l.vertical(),s},t.LogicalGridLayoutInfo=function(i,o,n,r){this.gridDatas=[],this.$components=i,this.cols,this.rows,this.width=[],this.height=[],this.weightX,this.weightY,this.m_hgap=n,this.m_vgap=r,this.m_cellBounds=[];var s,a,l,h;for(s=0;s<o.length;s++)this.gridDatas[s]=new t.LogicalGridData(o[s]);if(0===i.length)return this.cols=0,this.rows=0,this.width=[],this.height=[],this.weightX=[],void(this.weightY=[]);var d=new t.TreeSet,p=new t.TreeSet;for(s=0;s<this.gridDatas.length;s++){for(a=this.gridDatas[s],a.gridx<0&&(a.gridx=0),a.gridy<0&&(a.gridy=0),a.gridw<1&&(a.gridw=1),a.gridh<1&&(a.gridh=1),l=a.gridx;l<a.gridx+a.gridw;l++)d.add(l);for(h=a.gridy;h<a.gridy+a.gridh;h++)p.add(h)}var u=d.last();for(l=u;l>=0;l--)if(!d.contains(l))for(s=0;s<this.gridDatas.length;s++)a=this.gridDatas[s],a.gridx>l&&a.gridx--;var c=p.last();for(h=c;h>=0;h--)if(!p.contains(h))for(s=0;s<this.gridDatas.length;s++)a=this.gridDatas[s],a.gridy>h&&a.gridy--;this.cols=d.size(),this.rows=p.size(),this.width=[],this.height=[],this.weightX=[],this.weightY=[],e.log.trace("(LogicalGridLayoutInfo#CTOR) $components.length="+i.length+" usedCols="+this.cols+" usedRows="+this.rows),this._initializeInfo(n,r)},t.LogicalGridLayoutInfo.prototype._initializeInfo=function(i,o){for(var n,r,s,a,l=this.$components.length,h=[],d=0;d<l;d++)r=this.$components[d],s=this.gridDatas[d],s.useUiHeight||s.useUiWidth||!s.fillVertical||!s.fillHorizontal?(a=this.uiSizeInPixel(r),e.log.isTraceEnabled()&&(n=t.HtmlComponent.optGet(r),e.log.trace(n.debug()))):a=new t.Dimension(0,0),s.widthHint>0&&(a.width=s.widthHint),s.heightHint>0&&(a.height=s.heightHint),h[d]=a,s.gridx<0&&(s.gridx=0),s.gridy<0&&(s.gridy=0),s.gridw<1&&(s.gridw=1),s.gridh<1&&(s.gridh=1),s.gridx>=this.cols&&(s.gridx=this.cols-1),s.gridy>=this.rows&&(s.gridy=this.rows-1),s.gridx+s.gridw-1>=this.cols&&(s.gridw=this.cols-s.gridx),s.gridy+s.gridh>=this.rows&&(s.gridh=this.rows-s.gridy);this.compSize=h,this._initializeColumns(h,i),this._initializeRows(h,o)},t.LogicalGridLayoutInfo.prototype._initializeColumns=function(e,i){var o,n,r,s,a,l=e.length,h=t.arrays.init(this.cols,0),d=t.arrays.init(this.cols,!1);for(o=0;o<l;o++)if(a=this.gridDatas[o],1===a.gridw)for(s=a.widthHint>0?a.widthHint:a.useUiWidth?e[o].width:this.logicalWidthInPixel(a),s=Math.floor(s),n=a.gridx;n<a.gridx+a.gridw&&n<this.cols;n++)h[n]=Math.max(h[n],s),0===a.weightx&&(d[n]=!0);for(o=0;o<l;o++)if(a=this.gridDatas[o],a.gridw>1){var p,u=a.gridw,c=0;for(n=a.gridx;n<a.gridx+a.gridw&&n<this.cols;n++)d[n]||(c+=h[n]);if(p=a.widthHint>0?a.widthHint-c-(u-1)*i:a.useUiWidth?e[o].width-c-(u-1)*i:this.logicalWidthInPixel(a)-c-(u-1)*i,p>0){var f=Math.floor((p+c)/u),y=(p+c)%u,g=-1;for(n=a.gridx;n<a.gridx+a.gridw&&n<this.cols;n++)d[n]?h[g=n]=h[n]:h[g=n]=Math.max(f,h[n]),0===a.weightx&&(d[n]=!0);g>-1&&(h[g]+=y)}}var m=t.LayoutConstants;for(o=0;o<this.cols;o++)this.width[o]=[],d[o]?(this.width[o][m.MIN]=h[o],this.width[o][m.PREF]=h[o],this.width[o][m.MAX]=h[o]):(this.width[o][m.MIN]=0,this.width[o][m.PREF]=h[o],this.width[o][m.MAX]=10240);for(o=0;o<this.cols;o++)if(d[o])this.weightX[o]=0;else{var _=0,b=0;for(r=0;r<l;r++)a=this.gridDatas[r],a.weightx>0&&a.gridx<=o&&o<=a.gridx+a.gridw-1&&(_+=a.weightx/a.gridw,b++);this.weightX[o]=b>0?_/b:0}var v=0;for(o=0;o<this.cols;o++)v+=this.weightX[o];if(v>=1e-6){var C=1/v;for(o=0;o<this.cols;o++)this.weightX[o]=this.weightX[o]*C}},t.LogicalGridLayoutInfo.prototype._initializeRows=function(e,i){var o,n,r,s,a,l=e.length,h=t.arrays.init(this.rows,0),d=t.arrays.init(this.rows,!1);for(o=0;o<l;o++)if(a=this.gridDatas[o],1===a.gridh)for(s=a.heightHint>0?a.heightHint:a.useUiHeight?e[o].height:this.logicalHeightInPixel(a),s=Math.floor(s),n=a.gridy;n<a.gridy+a.gridh&&n<this.rows;n++)h[n]=Math.max(h[n],s),0===a.weighty&&(d[n]=!0);for(o=0;o<l;o++)if(a=this.gridDatas[o],a.gridh>1){var p,u=a.gridh,c=0;for(n=a.gridy;n<a.gridy+a.gridh&&n<this.rows;n++)d[n]||(c+=h[n]);if(p=a.heightHint>0?a.heightHint-c-(u-1)*i:a.useUiHeight?e[o].height-c-(u-1)*i:this.logicalHeightInPixel(a)-c-(u-1)*i,p>0){var f=Math.floor((p+c)/u),y=(p+c)%u,g=-1;for(n=a.gridy;n<a.gridy+a.gridh&&n<this.rows;n++)d[n]?h[g=n]=h[n]:h[g=n]=Math.max(f,h[n]),0===a.weighty&&(d[n]=!0);g>-1&&(h[g]+=y)}}var m=t.LayoutConstants;for(o=0;o<this.rows;o++)this.height[o]=[],d[o]?(this.height[o][m.MIN]=h[o],this.height[o][m.PREF]=h[o],this.height[o][m.MAX]=h[o]):(this.height[o][m.MIN]=0,this.height[o][m.PREF]=h[o],this.height[o][m.MAX]=10240);for(o=0;o<this.rows;o++)if(d[o])this.weightY[o]=0;else{var _=0,b=0;for(r=0;r<l;r++)a=this.gridDatas[r],a.weighty>0&&a.gridy<=o&&o<=a.gridy+a.gridh-1&&(_+=a.weighty/a.gridh,b++);this.weightY[o]=b>0?_/b:0}var v=0;for(o=0;o<this.rows;o++)v+=this.weightY[o];if(v>=1e-6){var C=1/v;for(o=0;o<this.rows;o++)this.weightY[o]=this.weightY[o]*C}},t.LogicalGridLayoutInfo.prototype.layoutCellBounds=function(e,i){var o=this.layoutSizes(e.width-i.horizontal()-Math.max(0,(this.cols-1)*this.m_hgap),this.width,this.weightX),n=this.layoutSizes(e.height-i.vertical()-Math.max(0,(this.rows-1)*this.m_vgap),this.height,this.weightY);this.m_cellBounds=t.arrays.init(this.rows,null);var r,s,a,l=i.top;for(r=0;r<this.rows;r++){for(s=i.left,this.m_cellBounds[r]=t.arrays.init(this.cols,null),a=0;a<this.cols;a++)this.m_cellBounds[r][a]=new t.Rectangle(s,l,o[a],n[r]),s+=o[a],s+=this.m_hgap;l+=n[r],l+=this.m_vgap}return this.m_cellBounds},t.LogicalGridLayoutInfo.prototype.layoutSizes=function(e,i,o){var n,r=t.arrays.init(i.length,0);if(e<=0){for(n=0;n<i.length;n++)r[n]=i[n][t.LayoutConstants.MIN];return r}var s=0,a=t.arrays.init(o.length,0),l=0;for(n=0;n<i.length;n++)r[n]=i[n][t.LayoutConstants.PREF],s+=r[n],a[n]=o[n],a[n]<t.LayoutConstants.EPS&&(i[n][t.LayoutConstants.MAX]>i[n][t.LayoutConstants.MIN]?a[n]=1:a[n]=0),l+=a[n];if(l>0)for(n=0;n<a.length;n++)a[n]=a[n]/l;var h=e-s;if(Math.abs(h)>0){var d,p=t.arrays.init(a.length,0);if(h>0)for(d=!0;h>0&&d;)for(d=!1,n=0;n<r.length&&h>0;n++)a[n]>0&&r[n]<i[n][t.LayoutConstants.MAX]&&(d=!0,p[n]+=a[n],p[n]>0&&(p[n]-=1,r[n]+=1,h-=1));else for(d=!0;h<0&&d;)for(d=!1,n=0;n<r.length&&h<0;n++)a[n]>0&&r[n]>i[n][t.LayoutConstants.MIN]&&(d=!0,p[n]+=a[n],p[n]>0&&(p[n]-=1,r[n]-=1,h+=1))}return r},t.LogicalGridLayoutInfo.prototype.logicalWidthInPixel=function(e){var i=e.gridw;return t.HtmlEnvironment.formColumnWidth*i+this.m_hgap*Math.max(0,i-1)},t.LogicalGridLayoutInfo.prototype.logicalHeightInPixel=function(e){var i=e.gridh,o=e.logicalRowHeightAddition||0;return t.HtmlEnvironment.formRowHeight*i+this.m_vgap*Math.max(0,i-1)+o},t.LogicalGridLayoutInfo.prototype.uiSizeInPixel=function(e){return t.HtmlComponent.get(e).getPreferredSize()},t.NullLayout=function(){t.NullLayout.parent.call(this)},t.inherits(t.NullLayout,t.AbstractLayout),t.NullLayout.prototype.layout=function(i){i.children().each(function(){var i=t.HtmlComponent.optGet(e(this));i&&i.revalidateLayout()})},t.RowLayout=function(){t.RowLayout.parent.call(this)},t.inherits(t.RowLayout,t.AbstractLayout),t.RowLayout.prototype.layout=function(i){i.children().each(function(){var i=t.HtmlComponent.optGet(e(this));i&&i.setSize(i.getPreferredSize())})},t.RowLayout.prototype.preferredLayoutSize=function(i){var o=new t.Dimension,n=t.HtmlComponent.get(i),r=0;return i.children().each(function(){var i,n=t.HtmlComponent.optGet(e(this));n&&(i=n.getPreferredSize().add(n.getMargins()),r=Math.max(i.width,r),o.height+=i.height,o.width=r)}),o=o.add(n.getInsets())},t.SingleLayout=function(e){t.SingleLayout.parent.call(this),this._htmlChild=e},t.inherits(t.SingleLayout,t.AbstractLayout),t.SingleLayout.prototype.layout=function(e){var i=t.HtmlComponent.get(e),o=i.getAvailableSize().subtract(i.getInsets()),n=this._htmlChild;n||(n=this._getHtmlSingleChild(e)),n&&n.setSize(o)},t.SingleLayout.prototype.preferredLayoutSize=function(e){var i=this._htmlChild;return i||(i=this._getHtmlSingleChild(e)),i?i.getPreferredSize():new t.Dimension(1,1)};t.SingleLayout.prototype._getHtmlSingleChild=function(e){var i=e.children().first();return i.length?t.HtmlComponent.get(i):null};t.keys={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,DASH:189,COMMA:188,POINT:190,FORWARD_SLASH:191,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222,ANGULAR_BRACKET:226},t.codesToKeys={8:"Backspace",9:"Tab",13:"Enter",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",27:"Esc",33:"Page up",34:"Page down",35:"End",36:"Home",37:"Left",38:"UP",39:"Right",40:"Down",32:"Space",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",93:"SELECT",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",96:"NUMPAD_0",97:"NUMPAD_1",98:"NUMPAD_2",99:"NUMPAD_3",100:"NUMPAD_4",101:"NUMPAD_5",102:"NUMPAD_6",103:"NUMPAD_7",104:"NUMPAD_8",105:"NUMPAD_9",106:"MULTIPLY",107:"+",109:"SUBTRACT",110:"DECIMAL_POINT",111:"/",144:"Num lock",145:"Scroll lock",186:"ü",189:"-",188:",",190:".",191:"§",219:"'",220:"ä",221:"^",222:"ö",226:"<"},t.keyStrokeBox={gap:4,drawSingleKeyBoxItem:function(t,i,o,n,r,s,a){if(o){var l=e(".key-box",o),h=a?"right":"left";if(l.length>0){var d=l.first();t=a?o.outerWidth()-d.position().left+this.gap:this.gap+d.position().left+d.outerWidth()}if(s&&(i="Shift "+i),r&&(i="Alt "+i),n&&(i="Ctrl "+i),"absolute"===o.css("position")||"relative"===o.css("position")||"static"===o.css("position")&&l.length>0)return o.prependDiv("key-box ",i).css(h,""+t+"px");var p=o.position();return p?o.prependDiv("key-box ",i).css(h,""+(p.left+t)+"px"):void e.log.warn("(keys#drawSingleKeyBoxItem) pos is undefined. $container="+o)}}},t.Key=function(t,e){this.keyStroke=t,this.which=e,this.ctrl=t.ctrl,this.alt=t.alt,this.shift=t.shift,this.keyStrokeMode=t.keyStrokeMode},t.Key.prototype.render=function(t,e){return this.$drawingArea=this.keyStroke.renderKeyBox(t,e),!!this.$drawingArea},t.Key.prototype.remove=function(){this.keyStroke.removeKeyBox(this.$drawingArea),this.$drawingArea=null},t.keyStrokeModifier={NONE:0,CTRL:1,CTRL_UNDEFINED:2,SHIFT:4,SHIFT_UNDEFINED:8,ALT:16,ALT_UNDEFINED:32,isCtrl:function(t){return this._eval(t,this.CTRL,this.CTRL_UNDEFINED)},isShift:function(t){return this._eval(t,this.SHIFT,this.SHIFT_UNDEFINED)},isAlt:function(t){return this._eval(t,this.ALT,this.ALT_UNDEFINED)},_eval:function(t,e,o){return(o&t)>0?i:(e&t)>0},toModifierBitMask:function(e){var i=0;return i|=e.ctrlKey?t.keyStrokeModifier.CTRL:0,i|=e.altKey?t.keyStrokeModifier.ALT:0,i|=e.shiftKey?t.keyStrokeModifier.SHIFT:0}},t.VirtualKeyStrokeEvent=function(t,e,i,o,n,r){this.which=t,this.ctrlKey=e,this.metaKey=!1,this.altKey=i,this.shiftKey=o,this.target=r,this.type=n,this._propagationStopped=!1,this._immediatePropagationStopped=!1,this._defaultPrevented=!1},t.VirtualKeyStrokeEvent.prototype.stopPropagation=function(){this._propagationStopped=!0},t.VirtualKeyStrokeEvent.prototype.stopImmediatePropagation=function(){this._immediatePropagationStopped=!0},t.VirtualKeyStrokeEvent.prototype.preventDefault=function(){this._defaultPrevented=!0},t.VirtualKeyStrokeEvent.prototype.isPropagationStopped=function(){return this._propagationStopped},t.VirtualKeyStrokeEvent.prototype.isImmediatePropagationStopped=function(){return this._immediatePropagationStopped},t.VirtualKeyStrokeEvent.prototype.isDefaultPrevented=function(){return this._defaultPrevented},t.VirtualKeyStrokeEvent.prototype.isAnyPropagationStopped=function(){return this._propagationStopped||this._immediatePropagationStopped},t.KeyStrokeManager=function(t){var e=t.$entryPoint;this.session=t,this._helpRendered=!1,this._renderedKeys=[],this.installTopLevelKeyStrokeHandlers(e)},t.KeyStrokeManager.prototype.installTopLevelKeyStrokeHandlers=function(e){var i=e.window(!0),o=function(t){return!this._isHelpKeyStroke(t)}.bind(this),n=function(e){return e.which!==t.keys.BACKSPACE}.bind(this);e.keydown(o).keyup(o),e.keydown(n).keyup(n),"onhelp"in i&&(i.onhelp=t.filters.returnFalse)},t.KeyStrokeManager.prototype.installKeyStrokeContext=function(t){if(t&&!t._handler){if(!t.$getBindTarget())throw new Error("missing bind-target for KeyStrokeContext: "+t);t._handler=function(e){this.session.focusManager.isElementCovertByGlassPane(t.$getScopeTarget())||(this._isHelpKeyStroke(e)?!e.originalEvent.renderingHelp&&this._helpRendered||(e.originalEvent.renderingHelp=!0,this._helpRendered=!0,this._installHelpDisposeListener(e),this._renderKeys(t,e)):this._handleKeyStrokeEvent(t,e))}.bind(this),t._handler.$target=t.$getBindTarget(),t._handler.$target.keydown(t._handler),t._handler.$target.keyup(t._handler)}},t.KeyStrokeManager.prototype.uninstallKeyStrokeContext=function(t){t&&t._handler&&(t._handler.$target.off("keydown",t._handler),t._handler.$target.off("keyup",t._handler),t._handler.$target=null,
t._handler=null)},t.KeyStrokeManager.prototype._renderKeys=function(e,i){var o=i.originalEvent.keyStrokeContexts||[];e.keyStrokes.filter(function(t){var e=t.renderingHints.render;return"function"==typeof e?e.call(t):e}).forEach(function(n){var r=(n.field?n.field.$container:null)||e.$getScopeTarget(),s=n.keys();s.forEach(function(s){var a=new t.VirtualKeyStrokeEvent(s.which,s.ctrl,s.alt,s.shift,s.keyStrokeMode,i.target);e.accept(a)&&n.accept(a)&&!this._isPreventedByDescendantContext(s,i.target,o)&&s.render(r,a)&&this._renderedKeys.push(s)},this)},this),o.push(e),i.originalEvent.keyStrokeContexts=o},t.KeyStrokeManager.prototype._isPreventedByDescendantContext=function(e,i,o){var n=new t.VirtualKeyStrokeEvent(e.which,e.ctrl,e.alt,e.shift,e.keyStrokeMode,i);return o.some(function(t){return t.accept(n),!!n.isAnyPropagationStopped()||t.keyStrokes.some(function(t){return t.accept(n),n.isAnyPropagationStopped()},this)},this)},t.KeyStrokeManager.prototype._handleKeyStrokeEvent=function(e,i){if(e.accept(i)){var o=e.keyStrokes.slice();o.some(function(o){return i.which=i.which>=96&&i.which<=105?i.which-48:i.which,!!o.accept(i)&&(o.preventInvokeAcceptInputOnActiveValueField||!o.invokeAcceptInputOnActiveValueField&&!e.invokeAcceptInputOnActiveValueField||t.ValueField.invokeValueFieldAcceptInput(i.target),o.invokeHandle(i),this.session.desktop&&this.session.desktop.trigger("keystrokeConsumed",{keyStrokeEvent:i,$target:e.$getBindTarget(),keyStroke:o}),i.isImmediatePropagationStopped())},this)}},t.KeyStrokeManager.prototype._isHelpKeyStroke=function(e){return e.which===t.keys.F1},t.KeyStrokeManager.prototype._installHelpDisposeListener=function(t){var i,o=e(t.currentTarget),n=o.window(),r=o.entryPoint();return i=function(){r.off("keyup",i),n.off("blur",i),this._helpRendered=!1,this._renderedKeys.forEach(function(t){t.remove()}),this._renderedKeys=[]}.bind(this),r.on("keyup",i),n.on("blur",i),!1},t.KeyStrokeContext=function(){this.$bindTarget,this.$scopeTarget,this.keyStrokes=[],this.stopPropagationInterceptors=[],this._stopPropagationKeys={},this.invokeAcceptInputOnActiveValueField=!1},t.KeyStrokeContext.prototype.registerStopPropagationKeys=function(e,i){this._stopPropagationKeys[e]=this._stopPropagationKeys[e]||[],t.arrays.pushAll(this._stopPropagationKeys[e],i)},t.KeyStrokeContext.prototype.registerStopPropagationInterceptor=function(t){this.stopPropagationInterceptors.push(t)},t.KeyStrokeContext.prototype.accept=function(t){return!!this._accept(t)&&(this._applyPropagationFlags(t),!0)},t.KeyStrokeContext.prototype._applyPropagationFlags=function(e){var i=t.keyStrokeModifier.toModifierBitMask(e),o=this._stopPropagationKeys[i];o&&t.isOneOf(e.which,o)&&e.stopPropagation(),this.stopPropagationInterceptors.forEach(function(t){t(e)},this)},t.KeyStrokeContext.prototype._accept=function(t){return!0},t.KeyStrokeContext.prototype.registerKeyStroke=function(e){t.arrays.ensure(e).map(this._resolveKeyStroke).filter(function(t){return this.keyStrokes.indexOf(t)===-1}.bind(this)).forEach(function(t){this.keyStrokes.push(t),t.field&&!t.destroyListener&&(t.destroyListener=function(e){this.unregisterKeyStroke(t),t.destroyListener=null}.bind(this),t.field.one("destroy",t.destroyListener))},this)},t.KeyStrokeContext.prototype.unregisterKeyStroke=function(e){e=this._resolveKeyStroke(e),t.arrays.remove(this.keyStrokes,e)&&e.field&&e.destroyListener&&(e.field.off("destroy",e.destroyListener),e.destroyListener=null)},t.KeyStrokeContext.prototype._resolveKeyStroke=function(e){if(e instanceof t.KeyStroke)return e;if(e instanceof t.Action)return e.actionKeyStroke;throw new Error("unsupported keystroke: "+e)},t.KeyStrokeContext.prototype.$getBindTarget=function(){return"function"==typeof this.$bindTarget?this.$bindTarget():this.$bindTarget},t.KeyStrokeContext.prototype.$getScopeTarget=function(){return"function"==typeof this.$scopeTarget?this.$scopeTarget():this.$scopeTarget},t.InputFieldKeyStrokeContext=function(){t.InputFieldKeyStrokeContext.parent.call(this),this.invokeAcceptInputOnActiveValueField=!0,this.registerStopPropagationKeys(t.keyStrokeModifier.CTRL,[t.keys.A,t.keys.C,t.keys.Y,t.keys.V,t.keys.Z,t.keys.RIGHT,t.keys.BACKSPACE,t.keys.LEFT,t.keys.HOME,t.keys.END,t.keys.NUMPAD_4,t.keys.NUMPAD_6]),this.registerStopPropagationKeys(t.keyStrokeModifier.CTRL|t.keyStrokeModifier.SHIFT,[t.keys.RIGHT,t.keys.BACKSPACE,t.keys.LEFT,t.keys.HOME,t.keys.END,t.keys.NUMPAD_4,t.keys.NUMPAD_6]),this.registerStopPropagationKeys(t.keyStrokeModifier.SHIFT,[t.keys.RIGHT,t.keys.BACKSPACE,t.keys.LEFT,t.keys.HOME,t.keys.END,t.keys.NUMPAD_4,t.keys.NUMPAD_6]),this.registerStopPropagationKeys(t.keyStrokeModifier.NONE,[t.keys.SEMICOLON,t.keys.DASH,t.keys.COMMA,t.keys.POINT,t.keys.FORWARD_SLASH,t.keys.OPEN_BRACKET,t.keys.BACK_SLASH,t.keys.CLOSE_BRACKET,t.keys.SINGLE_QUOTE,t.keys.MULTIPLY,t.keys.ADD,t.keys.SUBTRACT,t.keys.DECIMAL_POINT,t.keys.DIVIDE,t.keys.NUMPAD_0,t.keys.NUMPAD_1,t.keys.NUMPAD_2,t.keys.NUMPAD_3,t.keys.NUMPAD_4,t.keys.NUMPAD_5,t.keys.NUMPAD_6,t.keys.NUMPAD_7,t.keys.NUMPAD_8,t.keys.NUMPAD_9,t.keys.MULTIPLY,t.keys.END,t.keys.HOME,t.keys.RIGHT,t.keys.BACKSPACE,t.keys.LEFT,t.keys.DELETE,t.keys.SPACE])},t.inherits(t.InputFieldKeyStrokeContext,t.KeyStrokeContext),t.InputFieldKeyStrokeContext.prototype._applyPropagationFlags=function(i){if(t.InputFieldKeyStrokeContext.parent.prototype._applyPropagationFlags.call(this,i),!i.isPropagationStopped()){var o=e(i.target).is("input:text")||e(i.target).is("textarea");o&&(this._isLetterKeyStroke(i)||this._isNumberKeyStroke(i))&&i.stopPropagation()}},t.InputFieldKeyStrokeContext.prototype._isNumberKeyStroke=function(e){return!e.ctrlKey&&e.which>=t.keys[0]&&e.which<=t.keys[9]},t.InputFieldKeyStrokeContext.prototype._isLetterKeyStroke=function(e){return!e.ctrlKey&&e.which>=t.keys.A&&e.which<=t.keys.Z},t.KeyStroke=function(){this.field,this.which=[],this.ctrl=!1,this.alt=!1,this.shift=!1,this.preventDefault=!0,this.stopPropagation=!1,this.stopImmediatePropagation=!1,this.keyStrokeMode=t.KeyStrokeMode.DOWN,this.repeatable=!1,this._handleExecuted=!1,this.renderingHints={render:function(){return!this.field||this.field.rendered===i||this.field.rendered}.bind(this),offset:4,hAlign:t.hAlign.LEFT,text:null,$drawingArea:function(t,e){return t}},this.invokeAcceptInputOnActiveValueField=!1,this.preventInvokeAcceptInputOnActiveValueField=!1},t.KeyStroke.prototype.parseAndSetKeyStroke=function(e){this.alt=this.ctrl=this.shift=!1,this.which=[],e&&e.split("-").forEach(function(e){if("alternate"===e||"alt"===e)this.alt=!0;else if("control"===e||"ctrl"===e)this.ctrl=!0;else if("shift"===e)this.shift=!0;else{var i=t.keys[e.toUpperCase()];this.which=i&&[i]}},this)},t.KeyStroke.prototype.accept=function(t){return!!this._isEnabled()&&("keyup"===t.type&&(this._handleExecuted=!1),!!this._accept(t)&&(this._applyPropagationFlags(t),t.type===this.keyStrokeMode))},t.KeyStroke.prototype.handle=function(t){throw new Error("keystroke event not handled: "+t)},t.KeyStroke.prototype.invokeHandle=function(t){return this.repeatable?void this.handle(t):void(this._handleExecuted||(this.handle(t),this._handleExecuted=!0))},t.KeyStroke.prototype._isEnabled=function(){if(this.field){if(this.field.visible!==i&&!this.field.visible)return!1;if(this.field.enabled!==i&&!this.field.enabled)return!1}return!0},t.KeyStroke.prototype._accept=function(e){return this._acceptModifer(this.ctrl,e.ctrlKey||e.metaKey)&&this._acceptModifer(this.alt,e.altKey)&&this._acceptModifer(this.shift,e.shiftKey)&&t.isOneOf(e.which,this.which)},t.KeyStroke.prototype._acceptModifer=function(t,e){return t===i||t===e},t.KeyStroke.prototype._applyPropagationFlags=function(t){this.stopPropagation&&t.stopPropagation(),this.stopImmediatePropagation&&t.stopImmediatePropagation(),this.preventDefault&&t.preventDefault()},t.KeyStroke.prototype.keys=function(){return this.which.map(function(e){return new t.Key(this,e)},this)},t.KeyStroke.prototype.renderKeyBox=function(e,i){if(e=this.renderingHints.$drawingArea(e,i),!e||!e.length)return null;var o=t.keyStrokeBox.drawSingleKeyBoxItem(this.renderingHints.offset,this.renderingHints.text||t.codesToKeys[i.which],e,this.ctrl,this.alt,this.shift,this.renderingHints.hAlign===t.hAlign.RIGHT);return this._postRenderKeyBox(e,o),e},t.KeyStroke.prototype._postRenderKeyBox=function(t){},t.KeyStroke.prototype.removeKeyBox=function(t){t&&(e(".key-box",t).remove(),e(".key-box-additional",t).remove())},t.KeyStrokeMode={UP:"keyup",DOWN:"keydown"},t.RangeKeyStroke=function(){t.RangeKeyStroke.parent.call(this),this.ranges=[]},t.inherits(t.RangeKeyStroke,t.KeyStroke),t.RangeKeyStroke.prototype.registerRange=function(t,e){this.ranges.push({from:t,to:e})},t.RangeKeyStroke.prototype._accept=function(t){return(t.ctrlKey||t.metaKey)===this.ctrl&&t.altKey===this.alt&&t.shiftKey===this.shift&&this.ranges.some(function(e){return t.which>=this._getRangeFrom(e)&&t.which<=this._getRangeTo(e)},this)},t.RangeKeyStroke.prototype.keys=function(){var e=[];return this.ranges.forEach(function(i){for(var o=this._getRangeFrom(i),n=this._getRangeTo(i),r=o;r<=n;r++)e.push(new t.Key(this,r))},this),e},t.RangeKeyStroke.prototype._getRangeFrom=function(t){return"function"==typeof t.from?t.from():t.from},t.RangeKeyStroke.prototype._getRangeTo=function(t){return"function"==typeof t.to?t.to():t.to},t.ContextMenuKeyStroke=function(e,i,o){t.ContextMenuKeyStroke.parent.call(this),this._contextFunction=i,this._bindObject=o||this,this.field=e,this.renderingHints.render=!1,this.which=[t.keys.SELECT],this.ctrl=!1,this.shift=!1,this.stopPropagation=!0},t.inherits(t.ContextMenuKeyStroke,t.KeyStroke),t.ContextMenuKeyStroke.prototype.handle=function(t){this._contextFunction.call(this._bindObject,t)},t.ClickActiveElementKeyStroke=function(e,i){t.ClickActiveElementKeyStroke.parent.call(this),this.field=e,this.which=i,this.stopPropagation=!0,this.renderingHints.render=!0,this.renderingHints.$drawingArea=function(t,e){return e._$activeElement}},t.inherits(t.ClickActiveElementKeyStroke,t.KeyStroke),t.ClickActiveElementKeyStroke.prototype._accept=function(e){var i=t.ClickActiveElementKeyStroke.parent.prototype._accept.call(this,e);return!!i&&(e._$activeElement=this.field.$container.activeElement(),!0)},t.ClickActiveElementKeyStroke.prototype.handle=function(t){t._$activeElement.trigger({type:"click",which:1})},t.FocusAdjacentElementKeyStroke=function(e,i){t.FocusAdjacentElementKeyStroke.parent.call(this),this.session=e,this.field=i,this.which=[t.keys.LEFT,t.keys.RIGHT],this.renderingHints.render=!1,this.stopPropagation=!0,this.keyStrokeMode=t.KeyStrokeMode.DOWN},t.inherits(t.FocusAdjacentElementKeyStroke,t.KeyStroke),t.FocusAdjacentElementKeyStroke.prototype.handle=function(e){var i=this.field.$container.activeElement(!0),o=this.field.$container.find(":focusable");switch(e.which){case t.keys.RIGHT:i===o.last()[0]?this.session.focusManager.requestFocus(o.first()):this.session.focusManager.requestFocus(o[o.index(i)+1]);break;case t.keys.LEFT:i===o.first()[0]?this.session.focusManager.requestFocus(o.last()):this.session.focusManager.requestFocus(o[o.index(i)-1])}},t.CloseKeyStroke=function(e,i){t.CloseKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.ESC],this.renderingHints.render=!0,this.stopPropagation=!0,this.renderingHints={render:!!i,$drawingArea:i}},t.inherits(t.CloseKeyStroke,t.KeyStroke),t.CloseKeyStroke.prototype.handle=function(t){this.field.close()},t.TabItemKeyStroke=function(e,i){t.TabItemKeyStroke.parent.call(this),this.field=i,this.parseAndSetKeyStroke(e),this.renderingHints.offset=16,this.renderingHints.hAlign=t.hAlign.RIGHT,this.renderingHints.$drawingArea=function(t,e){return this.field.$tabContainer}.bind(this)},t.inherits(t.TabItemKeyStroke,t.KeyStroke),t.TabItemKeyStroke.prototype.handle=function(t){this.field.parent._syncSelectedTab(this.field)},t.BoxButtons=function(t,e){if(!t)throw new Error("Missing $parent");t.addClass("box-buttons"),this._$parent=t,this._onClickHandler=e,this._$buttons=[]},t.BoxButtons.prototype.addButton=function(i){i=i||{};var o=this._$parent.appendDiv().text(i.text).addClass("box-button").unfocusable().setEnabled(t.nvl(i.enabled,!0));if(t.device.supportsTouch()||o.attr("tabindex",i.tabIndex||"0"),i.onClick){var n=i.onClick;o.on("click",function(t){e.suppressEventIfDisabled(t)||n(t)})}else this._onClickHandler&&o.on("click",this._onClick.bind(this));return o.data("buttonOption",i.option),this._$buttons.push(o),o},t.BoxButtons.prototype._onClick=function(t){var i=e(t.target);e.suppressEventIfDisabled(t,i)||this._onClickHandler(t,i.data("buttonOption"))},t.BoxButtons.prototype.updateButtonWidths=function(t){var e=[];this._$buttons.forEach(function(t){t.isVisible()&&e.push(t)});var i=e.length>0;this._$parent.toggleClass("empty",!i),t=t||this._$parent.width();var o=Math.floor(t/e.length);e.forEach(function(i,n){n===e.length-1?o=t:t-=o,i.outerWidth(o)})},t.BoxButtons.prototype.buttonCount=function(){return this._$buttons.length},t.Carousel=function(){t.Carousel.parent.call(this),this._addAdapterProperties(["widgets"]),this.currentItem=0,this.moveThreshold=.25,this.widgets=[],this.$carouselFilmstrip,this.$carouselItems=[],this.positionX=0},t.inherits(t.Carousel,t.Widget),t.Carousel.prototype._init=function(e){t.Carousel.parent.prototype._init.call(this,e),this._syncGridData(this.gridData)},t.Carousel.prototype._syncGridData=function(e){this._setProperty("gridData",new t.GridData(e))},t.Carousel.prototype._render=function(e){this.$container=e.appendDiv("carousel"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.CarouselLayout(this)),this.$carouselFilmstrip=this.$container.appendDiv("carousel-filmstrip"),this._registerCarouselFilmstripEventListeners(),this.htmlCompFilmstrip=t.HtmlComponent.install(this.$carouselFilmstrip,this.session)},t.Carousel.prototype._renderProperties=function(){t.Carousel.parent.prototype._renderProperties.call(this),this._renderWidgets(),this._renderCurrentItem()},t.Carousel.prototype.recalcTransformation=function(){this.positionX=this.currentItem*this.$container.width()*-1,this.$carouselFilmstrip.css({transform:" translateX("+this.positionX+"px)"})},t.Carousel.prototype._renderCurrentItem=function(){this._renderItemsInternal(i,!1)},t.Carousel.prototype._renderItemsInternal=function(t,e){t=t||this.currentItem,e||this.widgets.forEach(function(e,i){e.rendered&&(i<t-1||i>t+1)&&e.remove()},this);for(var i=Math.max(t-1,0);i<Math.min(t+2,this.widgets.length);i++)this.widgets[i].rendered||(this.widgets[i].render(this.$carouselItems[i]),this.widgets[i].htmlComp.revalidateLayout())},t.Carousel.prototype._registerCarouselFilmstripEventListeners=function(){var t=this.$carouselFilmstrip.window();this.$carouselFilmstrip.on("mousedown touchstart",function(e){var i=e.pageX;!i&&e.originalEvent&&e.originalEvent.touches&&1==e.originalEvent.touches.length&&(i=e.originalEvent.touches[0].pageX);var o=this.positionX,n=this.$container.width()-this.$carouselFilmstrip.width(),r=this.$container.width();t.on("mousemove.carouselDrag touchmove.carouselDrag",function(t){var e=t.pageX;!e&&t.originalEvent&&t.originalEvent.touches&&1==t.originalEvent.touches.length&&(e=t.originalEvent.touches[0].pageX);var s=e-i,a=o+s;if(a!==this.positionX&&a<=0&&a>=n){this.$carouselFilmstrip.css({transform:" translateX("+a+"px)"}),this.positionX=a;var l=a/r*-1;this._renderItemsInternal(a<o?Math.floor(l):Math.ceil(l),!0)}}.bind(this)),t.on("mouseup.carouselDrag touchend.carouselDrag touchcancel.carouselDrag",function(e){t.off(".carouselDrag");var i=this.positionX%r,n=this.currentItem;this.positionX<o&&i/r<0-this.moveThreshold?n=Math.ceil(this.positionX/r*-1):this.positionX>o&&i/r>=this.moveThreshold-1&&(n=Math.floor(this.positionX/r*-1)),this.setCurrentItem(n),0!==i&&(this.positionX=n*r*-1,this.recalcTransformation())}.bind(this))}.bind(this))},t.Carousel.prototype._renderWidgets=function(){this.$carouselFilmstrip.empty(),this.$carouselItems=[],this.widgets=t.arrays.ensure(this.widgets),this.widgets.forEach(function(e,i){this.$carouselItems.push(this.$carouselFilmstrip.appendDiv("carousel-item")),t.HtmlComponent.install(this.$carouselItems[i],this.session)},this),this.setCurrentItem(0)},t.Carousel.prototype.setCurrentItem=function(t){this.setProperty("currentItem",t)},t.Carousel.prototype.setWidgets=function(t){this.setProperty("widgets",t)},t.CarouselLayout=function(e){t.CarouselLayout.parent.call(this),this.carousel=e},t.inherits(t.CarouselLayout,t.AbstractLayout),t.CarouselLayout.prototype.layout=function(e){this.carousel.recalcTransformation();var i=this.carousel.htmlComp.getAvailableSize().subtract(this.carousel.htmlComp.getInsets()).subtract(this.carousel.htmlCompFilmstrip.getMargins()),o=this.carousel.htmlComp.getAvailableSize().subtract(this.carousel.htmlComp.getInsets()).subtract(this.carousel.htmlCompFilmstrip.getMargins()),n=this.carousel.$carouselItems;i.width=n.length*i.width,this.carousel.htmlCompFilmstrip.setSize(i),n.forEach(function(e){var i=t.HtmlComponent.get(e);i.setSize(o)})},t.CarouselLayout.prototype.preferredLayoutSize=function(e){return this.carousel.currentIndex<this.carousel.$carouselItems.length&&this.carousel.currentIndex>=0?t.HtmlComponent.get(this.carousel.$carouselItems[this.carousel.currentIndex]).getPreferredSize():new t.Dimension(1,1)},t.Cell=function(){this.$cell,this.checked=!1,this.cssClass,this.editable=!1,this.errorStatus,this.horizontalAlignment=-1,this.htmlEnabled=!1,this.iconId,this._cachedEncodedText,this.text,this.value},t.Cell.prototype.init=function(t){this._init(t)},t.Cell.prototype._init=function(i){e.extend(this,i),t.defaultValues.applyTo(this)},t.Cell.prototype.update=function(t){this.setText(t.text),e.extend(this,t)},t.Cell.prototype.setText=function(t){var e=this.text;this.text=t,e!==this.text&&(this._cachedEncodedText=null)},t.Cell.prototype.encodedText=function(){return this._cachedEncodedText||(this._cachedEncodedText=t.strings.encode(this.text)),this._cachedEncodedText},t.CollapseHandle=function(){t.CollapseHandle.parent.call(this),this.leftVisible=!1,this.rightVisible=!1},t.inherits(t.CollapseHandle,t.Widget),t.CollapseHandle.prototype._init=function(i){t.CollapseHandle.parent.prototype._init.call(this,i);var o={leftVisible:!0,rightVisible:!0};e.extend(this,o,i)},t.CollapseHandle.prototype._render=function(t){this.$container=t.appendDiv("collapse-handle"),this.$container.on("mousedown",this._onMouseDown.bind(this)),this.$left=this.$container.appendDiv("collapse-handle-body left"),this.$right=this.$container.appendDiv("collapse-handle-body right")},t.CollapseHandle.prototype._renderProperties=function(){t.CollapseHandle.parent.prototype._renderProperties.call(this),this._renderLeftVisible(),this._renderRightVisible()},t.CollapseHandle.prototype._renderLeftVisible=function(){this.$left.setVisible(this.leftVisible),this._updateVisibilityClasses()},t.CollapseHandle.prototype._renderRightVisible=function(){this.$right.setVisible(this.rightVisible),this._updateVisibilityClasses()},t.CollapseHandle.prototype._updateVisibilityClasses=function(){var t=this.leftVisible&&this.rightVisible;this.$container.toggleClass("both-visible",t),this.$left.toggleClass("both-visible",t),this.$right.toggleClass("both-visible",t),this.$container.toggleClass("one-visible",(this.leftVisible||this.rightVisible)&&!t)},t.CollapseHandle.prototype.setLeftVisible=function(t){this.setProperty("leftVisible",t)},t.CollapseHandle.prototype.setRightVisible=function(t){this.setProperty("rightVisible",t)},t.CollapseHandle.prototype._onLeftMouseDown=function(t){this.trigger("action",{left:!0})},t.CollapseHandle.prototype._onRightMouseDown=function(t){this.trigger("action",{right:!0})},t.CollapseHandle.prototype._onMouseDown=function(t){var e=t.target;return this.$left.isOrHas(e)?void this.trigger("action",{left:!0}):this.$right.isOrHas(e)?void this.trigger("action",{right:!0}):void(this.$container.hasClass("one-visible")&&this.trigger("action",{left:this.leftVisible,right:this.rightVisible}))},t.FocusManager=function(i){var o={active:!t.device.supportsTouch(),restrictedFocusGain:!t.device.supportsTouch()};if(e.extend(this,o,i),!this.session)throw new Error("Session expected");this._focusContexts=[],this._glassPaneTargets=[];var n=this.session.$entryPoint,r=n.data("partid")||"0";n.attr("tabindex",r),this.restrictedFocusGain&&this.installTopLevelMouseHandlers(n),this.installFocusContext(n,t.focusRule.AUTO)},t.FocusManager.prototype.installTopLevelMouseHandlers=function(t){t.on("mousedown",function(t){return this._acceptFocusChangeOnMouseDown(e(t.target))?this._handleIEEvent(t):t.preventDefault(),!0}.bind(this))},t.FocusManager.prototype._handleIEEvent=function(i){if(t.device.browser===t.Device.Browser.INTERNET_EXPLORER){var o,n=e(i.target);if(n.is(".table-cell")||n.closest(".table-cell").length>0)return this.requestFocus(n.closest(".table")),void i.preventDefault();if(n.is(".tree-node")||n.closest(".tree-node").length>0)return this.requestFocus(n.closest(".tree")),void i.preventDefault();var r=n.css("user-select"),s="div:not(.desktop),[tabindex]:not([tabindex=-1]),radio,a[href],area[href],input:not([disabled]),select:not([disabled]),textarea:not([disabled]),button:not([disabled]),iframe";0!==n.not(s).length&&0===n.closest('[contenteditable="true"]').length&&(r&&"none"===r||!r&&0===n.closest("div").not('[unselectable="on"]').length)&&(o=n.closest(s),o&&o.not('[unselectable="on"]').length>0&&this.requestFocus(o.get(0)),i.preventDefault())}},t.FocusManager.prototype.activate=function(t){this.active!==t&&(this.active=t,e.log.isDebugEnabled()&&e.log.debug("Focus manager active: "+this.active),this.active&&this.validateFocus())},t.FocusManager.prototype.installFocusContext=function(e,i){var o;o=i&&i!==t.focusRule.AUTO?i===t.focusRule.NONE?null:i:this.findFirstFocusableElement(e);var n=new t.FocusContext(e,this);this._pushIfAbsendElseMoveTop(n),o&&n._validateAndSetFocus(o)},t.FocusManager.prototype.uninstallFocusContext=function(e){var i=this._findFocusContext(e);if(i){var o=t.filters.outsideFilter(i.$container);t.arrays.remove(this._focusContexts,i),i._dispose();var n=this._findActiveContext();n&&n._validateAndSetFocus(n._lastValidFocusedElement,o)}},t.FocusManager.prototype.isFocusContextInstalled=function(t){return!!this._findFocusContext(t)},t.FocusManager.prototype.isElementCovertByGlassPane=function(t){return!!this._glassPaneTargets.length&&this._glassPaneTargets.some(function(i){return 0!==e(t).closest(i).length})},t.FocusManager.prototype.registerGlassPaneTarget=function(t){this._glassPaneTargets.push(t),this.validateFocus()},t.FocusManager.prototype.unregisterGlassPaneTarget=function(e){t.arrays.remove(this._glassPaneTargets,e),this.validateFocus()},t.FocusManager.prototype.validateFocus=function(t){var e=this._findActiveContext();e&&e._validateAndSetFocus(e._lastValidFocusedElement,t)},t.FocusManager.prototype.requestFocus=function(i,o){i=i instanceof e?i[0]:i;var n=this._findActiveContext();return n&&n._validateAndSetFocus(i,o),t.focusUtils.isActiveElement(i)},t.FocusManager.prototype.findFirstFocusableElement=function(i,o){var n,r,s,a,l,h,d,p,u,c=i.entryPoint(),f=i.find(":focusable").addBack(":focusable").not(c).filter(o||t.filters.returnTrue);for(a=0;a<f.length;a++)if(l=f[a],h=e(l),!this.isElementCovertByGlassPane(l)&&!(h.is(".prevent-initial-focus")||h.closest(".prevent-initial-focus").length>0))if(n||h.hasClass("button")||h.hasClass("menu-item")||(n=l),!r&&h.is(".default-menu")&&(r=l),d=h.parents(".menubar"),p=h.parents(".tab-area"),u=h.parents(".box-buttons"),(d.length>0||p.length>0||u.length>0)&&!s&&(h.hasClass("button")||h.hasClass("menu-item")))s=l;else if(!d.length&&!p.length&&!u.length&&"function"==typeof l.focus)return l;if(r)return r;if(s){if(s!==n&&n){var y=e(s).parents(".tab-area"),g=e(n),m=e(n).parents(".tab-area");if(m.length>0&&y.length>0&&g.is(".tab-item"))return n}return s}return n},t.FocusManager.prototype._findActiveContext=function(){return t.arrays.last(this._focusContexts)},t.FocusManager.prototype._findFocusContext=function(e){return t.arrays.find(this._focusContexts,function(t){return t.$container===e})},t.FocusManager.prototype._acceptFocusChangeOnMouseDown=function(e){return!e.hasClass("glasspane")&&(!this.isElementCovertByGlassPane(e)&&(!!t.focusUtils.isFocusableByMouse(e)&&(!!e.is(":focusable")||(!!t.focusUtils.isSelectableText(e)||!!t.focusUtils.containsParentFocusableByMouse(e,e.entryPoint())))))},t.FocusManager.prototype._pushIfAbsendElseMoveTop=function(e){t.arrays.remove(this._focusContexts,e),this._focusContexts.push(e)},t.FocusContext=function(t,e){this.$container=t,this.focusManager=e,this._lastValidFocusedElement=null,this._focusedField=null,this._keyDownListener=this._onKeyDown.bind(this),this._focusInListener=this._onFocusIn.bind(this),this._focusOutListener=this._onFocusOut.bind(this),this._hideListener=this._onHide.bind(this),this._removeListener=this._onRemove.bind(this),this.$container.on("keydown",this._keyDownListener).on("focusin",this._focusInListener).on("focusout",this._focusOutListener).on("hide",this._hideListener)},t.FocusContext.prototype._dispose=function(){this.$container.off("keydown",this._keyDownListener).off("focusin",this._focusInListener).off("focusout",this._focusOutListener).off("hide",this._hideListener),e(this._focusedField).off("remove",this._removeListener)},t.FocusContext.prototype._onKeyDown=function(i){if(i.which===t.keys.TAB){var o,n=this.$container.activeElement(!0),r=this.$container.find(":tabbable:visible"),s=r.first()[0],a=r.last()[0];if(i.shiftKey)if(!a||n!==this.$container[0]&&n!==s){if(!(r.length>0))return void e.suppressEvent(i);o=r.get(r.index(n)-1)}else e.suppressEvent(i),this._validateAndSetFocus(a),o=s;else if(!s||n!==a&&n!==this.$container[0]){if(!(r.length>0))return void e.suppressEvent(i);o=r.get(r.index(n)+1)}else e.suppressEvent(i),this._validateAndSetFocus(s),o=s;var l=e(o),h=t.graphics.offsetBounds(l),d=l.scrollParent();t.scrollbars.isLocationInView(new t.Point(h.x,h.y),d)||t.scrollbars.scrollTo(d,l)}},t.FocusContext.prototype._onFocusIn=function(t){var i=e(t.target);i.on("remove",this._removeListener),this._focusedField=t.target,t.target!==this.$container.entryPoint(!0)&&(this.focusManager._pushIfAbsendElseMoveTop(this),this._validateAndSetFocus(t.target),t.stopPropagation())},t.FocusContext.prototype._onFocusOut=function(t){e(t.target).off("remove",this._removeListener),this._focusedField=null,t.stopPropagation()},t.FocusContext.prototype._onRemove=function(e){this._validateAndSetFocus(null,t.filters.notSameFilter(e.target)),e.stopPropagation()},t.FocusContext.prototype._onHide=function(i){e(i.target).isOrHas(this._lastValidFocusedElement)&&(this._validateAndSetFocus(null,t.filters.notSameFilter(i.target)),i.stopPropagation())},t.FocusContext.prototype._validateAndSetFocus=function(t,i){t&&!e.contains(this.$container[0],t)&&(t=null);var o=null;o=t&&(!i||i.call(t))?t:this.focusManager.findFirstFocusableElement(this.$container,i),this._lastValidFocusedElement=o,this._focus(o)},t.FocusContext.prototype._focus=function(i){if(this.focusManager.active&&(this.focusManager.isElementCovertByGlassPane(i)&&(i=null),i=i||this.$container.entryPoint(!0),!t.focusUtils.isActiveElement(i))){var o,n=e(i);for(o=n;o.length>0;o=o.parent())o.data("oldScrollPosition",{left:o.scrollLeft(),top:o.scrollTop()});for(n.focus(),e.log.isDebugEnabled()&&e.log.debug("Focus set to "+t.graphics.debugOutput(i)),o=n;o.length>0;o=o.parent()){var r=o.data("oldScrollPosition");o.removeData("oldScrollPosition"),o.scrollLeft(r.left),o.scrollTop(r.top)}}},t.focusUtils={isFocusableByMouse:function(t){var i=e(t);return!i.hasClass("unfocusable")&&!i.closest(".unfocusable").length},containsParentFocusableByMouse:function(i,o){var n=e(i).parents(":focusable").not(o).filter(function(){return t.focusUtils.isFocusableByMouse(this)});return n.length>0},isSelectableText:function(t){for(var i=e(t),o=i;"auto"===o.css("user-select");)if(o=o.parent(),o.is("body"))return!1;if("none"===o.css("user-select"))return!1;if(i.is("input[disabled][type=text], textarea[disabled]"))return!0;var n=i.clone().children().remove().end().text().trim();return n.length>0},isActiveElement:function(t){if(!t)return!1;var i;return t instanceof e?(i=t.activeElement(!0),t=t[0]):i=t.ownerDocument.activeElement,i===t}},t.focusRule={AUTO:"auto",NONE:"none"},t.DeferredGlassPaneTarget=function(){this.$glassPaneTargets,this.glassPaneRenderer},t.DeferredGlassPaneTarget.prototype.ready=function(t){this.$glassPaneTargets=t,this.renderWhenReady()},t.DeferredGlassPaneTarget.prototype.rendererReady=function(t){this.glassPaneRenderer=t,this.renderWhenReady()},t.DeferredGlassPaneTarget.prototype.removeGlassPaneRenderer=function(t){this.glassPaneRenderer===t&&(this.glassPaneRenderer=null)},t.DeferredGlassPaneTarget.prototype.renderWhenReady=function(){this.glassPaneRenderer&&this.$glassPaneTargets&&this.$glassPaneTargets.length>0&&this.$glassPaneTargets.forEach(function(t){this.glassPaneRenderer.renderGlassPane(t[0])}.bind(this))},t.DeferredGlassPaneTarget.createFor=function(e,i){if(e.rendered)throw new Error("Don't call this function if widget is already rendered.");var o=new t.DeferredGlassPaneTarget,n=function(t){var e=i();o.ready(e)};return e.one("render",n),e.one("destroy",function(){e.off("render",n)}.bind(e)),[o]},t.GlassPaneRenderer=function(t,e,i){this._element=e,this._enabled=i,this.session=t,this._$glassPanes=[],this._$glassPaneTargets=[],this._deferredGlassPanes=[]},t.GlassPaneRenderer.prototype.renderGlassPanes=function(){this.findGlassPaneTargets().forEach(function(e){e instanceof t.DeferredGlassPaneTarget?(e.rendererReady(this),this._deferredGlassPanes.push(e)):this.renderGlassPane(e)},this)},t.GlassPaneRenderer.prototype.renderGlassPane=function(t){var i;i=e(t).appendDiv("glasspane").on("mousedown",this._onMousedown.bind(this)),i.window(!0).popupWindow&&i.addClass("dark"),this._$glassPanes.push(i),this._$glassPaneTargets.push(t),this.session.focusManager.registerGlassPaneTarget(t)},t.GlassPaneRenderer.prototype.removeGlassPanes=function(){this._$glassPanes.forEach(function(t){t.remove()}),this._deferredGlassPanes.forEach(function(t){t.removeGlassPaneRenderer(this)},this),this._deferredGlassPanes=[],this._$glassPaneTargets.forEach(function(t){this.session.focusManager.unregisterGlassPaneTarget(t)},this),this._$glassPanes=[],this._$glassPaneTargets=[]},t.GlassPaneRenderer.prototype.eachGlassPane=function(t){this._$glassPanes.forEach(function(e){t(e)})},t.GlassPaneRenderer.prototype.findGlassPaneTargets=function(){if(!this._enabled)return[];var t=this._element.displayParent||this.session.desktop;return t&&t.rendered&&t.glassPaneTargets?t.glassPaneTargets():[]},t.GlassPaneRenderer.prototype._onMousedown=function(e){var i=null;this._element instanceof t.Form&&this._element.isView()?(i=this.session.desktop.bench.getViewTab(this._element).$container,i.isVisible()||(i=i.siblings(".overflow-tab-item"))):this._element.$container&&(i=this._element.$container),i&&i.addClassForAnimation("animate-modality-highlight",{classesToRemove:"animate-modality-highlight animate-open"})},t.Scrollbar=function(){t.Scrollbar.parent.call(this),this._beginDefault=0,this._thumbRange,this._scrollSize,this._offsetSize,this._onScrollWheelHandler=this._onScrollWheel.bind(this),this._onScrollHandler=this._onScroll.bind(this),this._onScrollbarMousedownHandler=this._onScrollbarMousedown.bind(this),this._onThumbMousedownHandler=this._onThumbMousedown.bind(this),this._onDocumentMousemoveHandler=this._onDocumentMousemove.bind(this),this._onDocumentMouseupHandler=this._onDocumentMouseup.bind(this),this._fixScrollbarHandler=this._fixScrollbar.bind(this),this._unfixScrollbarHandler=this._unfixScrollbar.bind(this)},t.inherits(t.Scrollbar,t.Widget),t.Scrollbar.prototype._init=function(i){t.Scrollbar.parent.prototype._init.call(this,i);var o={axis:"y",borderless:!1,mouseWheelNeedsShift:!1};e.extend(this,o,i)},t.Scrollbar.prototype._render=function(t){this._begin=0,this.$container=t.appendDiv("scrollbar").addClass(this.axis+"-axis"),this._$thumb=this.$container.appendDiv("scrollbar-thumb").addClass(this.axis+"-axis"),
this.borderless&&this.$container.addClass("borderless"),this._dim="x"===this.axis?"Width":"Height",this._dir="x"===this.axis?"left":"top",this._dirReverse="x"===this.axis?"right":"bottom",this._scrollDir="x"===this.axis?"scrollLeft":"scrollTop",t.on("DOMMouseScroll mousewheel",this._onScrollWheelHandler).on("scroll",this._onScrollHandler).data("scrollbars").forEach(function(t){t.on("scrollstart",this._fixScrollbarHandler),t.on("scrollend",this._unfixScrollbarHandler)}.bind(this)),this.$container.on("mousedown",this._onScrollbarMousedownHandler),this._$thumb.on("mousedown",this._onThumbMousedownHandler)},t.Scrollbar.prototype._onScrollWheel=function(t){var e,i;return!this.$container.isVisible()||(!!t.ctrlKey||(this.mouseWheelNeedsShift!==t.shiftKey||(t=t.originalEvent||this.$container.window(!0).event.originalEvent,e=t.wheelDelta?-t.wheelDelta/2:20*t.detail,i=this._scrollSize/this._offsetSize,this.trigger("scrollstart"),this.scroll(e/i),this.trigger("scrollend"),!1)))},t.Scrollbar.prototype._onScroll=function(t){this.update()},t.Scrollbar.prototype._onScrollbarMousedown=function(t){this.trigger("scrollstart"),this._scrollTo(t),this.trigger("scrollend")},t.Scrollbar.prototype._onThumbMousedown=function(t){return this.trigger("scrollstart"),this._begin=("x"===this.axis?t.pageX:t.pageY)-this._$thumb.offset()[this._dir],this._$thumb.addClass("scrollbar-thumb-move"),this._$thumb.document().on("mousemove",this._onDocumentMousemoveHandler).one("mouseup",this._onDocumentMouseupHandler),!1},t.Scrollbar.prototype._onDocumentMousemove=function(t){this.rendered&&this._scrollTo(t)},t.Scrollbar.prototype._onDocumentMouseup=function(t){var i=e(t.currentTarget);return i.off("mousemove",this._onDocumentMousemoveHandler),this.rendered&&this._$thumb.removeClass("scrollbar-thumb-move"),this.trigger("scrollend"),!1},t.Scrollbar.prototype._scrollTo=function(t){var e=0===this._begin?this._beginDefault:this._begin,i=("x"===this.axis?t.pageX:t.pageY)-this._$thumb.offset()[this._dir];this.scroll(i-e)},t.Scrollbar.prototype._remove=function(){this.$parent.off("DOMMouseScroll mousewheel",this._onScrollWheelHandler).off("scroll",this._onScrollHandler).data("scrollbars").forEach(function(t){t.off("scrollstart",this._fixScrollbarHandler),t.off("scrollend",this._unfixScrollbarHandler)}.bind(this)),this.$container.off("mousedown",this._onScrollbarMousedownHandler),this._$thumb.off("mousedown","",this._onThumbMousedownHandler),t.Scrollbar.parent.prototype._remove.call(this)},t.Scrollbar.prototype.update=function(){var t=this.$container["cssMargin"+this.axis.toUpperCase()](),e=this.$parent[this._scrollDir](),i=this.$parent.scrollLeft(),o=this.$parent.scrollTop();this.reset(),this._offsetSize=this.$parent[0]["offset"+this._dim],this._scrollSize=this.$parent[0]["scroll"+this._dim];var n=Math.max(this._offsetSize*this._offsetSize/this._scrollSize-t,30);this._thumbRange=this._offsetSize-n-t,this._$thumb.css(this._dim.toLowerCase(),n),this._beginDefault=n/2;var r=e/(this._scrollSize-this._offsetSize)*this._thumbRange;this._$thumb.css(this._dir,r),this._offsetSize>=this._scrollSize?this.$container.css("display","none"):this.$container.css("display",""),this.$container.cssRight(-1*i),this.$container.cssBottom(-1*o)},t.Scrollbar.prototype.reset=function(){this._$thumb.css(this._dim.toLowerCase(),0),this.$container.cssRight(0),this.$container.cssBottom(0)},t.Scrollbar.prototype.scroll=function(t){var e=this.$container.offset(),i=this._$thumb.offset(),o=i[this._dir]-e[this._dir],n=Math.min(this._thumbRange,Math.max(0,o+t)),r=(this._scrollSize-this._offsetSize)/this._thumbRange*n;this.$parent[this._scrollDir](r),this._$thumb.css(this._dir,n),this.$container.css(this._dirReverse,-1*r)},t.Scrollbar.prototype._fixScrollbar=function(){t.scrollbars.fix(this.$container)},t.Scrollbar.prototype._unfixScrollbar=function(){this._unfixTimeoutId=t.scrollbars.unfix(this.$container,this._unfixTimeoutId)},t.Scrollbar.prototype.notifyBeforeScroll=function(){this.trigger("scrollstart")},t.Scrollbar.prototype.notifyAfterScroll=function(){this.trigger("scrollend")},t.scrollbars={_$scrollables:{},getScrollables:function(e){if(e)return this._$scrollables[e]||[];var i=[];return t.objects.values(this._$scrollables).forEach(function(e){t.arrays.pushAll(i,e)}),i},pushScrollable:function(t,i){if(this._$scrollables[t]){if(this._$scrollables[t].indexOf(i)>-1)return;this._$scrollables[t].push(i)}else this._$scrollables[t]=[i];e.log.debug("Scrollable added: "+i.attr("class")+". New length: "+this._$scrollables.length)},removeScrollable:function(i,o){var n=0;if(!this._$scrollables[i])throw new Error("scrollable could not be removed. Potential memory leak. "+o.attr("class"));if(n=this._$scrollables[i].length,t.arrays.$remove(this._$scrollables[i],o),e.log.debug("Scrollable removed: "+o.attr("class")+". New length: "+this._$scrollables.length),n===this._$scrollables[i].length)throw new Error("scrollable could not be removed. Potential memory leak. "+o.attr("class"))},install:function(o,n){function r(){e.log.debug("use native scrollbars for container "+t.graphics.debugOutput(o)),"x"===n.axis?o.css("overflow-x","auto").css("overflow-y","hidden"):"y"===n.axis?o.css("overflow-x","hidden").css("overflow-y","auto"):o.css("overflow","auto"),o.css("-webkit-overflow-scrolling","touch")}function s(){if(e.log.debug("installing JS-scrollbars for container "+t.graphics.debugOutput(o)),a=t.arrays.ensure(o.data("scrollbars")),a.forEach(function(t){t.destroy()}),a=[],"both"===n.axis){var i=e.extend({},n);i.axis="y",l=t.create("Scrollbar",i),a.push(l),i.axis="x",i.mouseWheelNeedsShift=!0,l=t.create("Scrollbar",i),a.push(l)}else l=t.create("Scrollbar",n),a.push(l);o.css("overflow","hidden"),o.data("scrollbars",a),a.forEach(function(t){t.render(o),t.update()})}var a,l,h,d=t.HtmlComponent.optGet(o),p=n.session||n.parent.session;return n=n||{},n.axis=n.axis||"both",h=n.nativeScrollbars!==i?n.nativeScrollbars:t.device.hasPrettyScrollbars(),h?t.device.isIos()?setTimeout(r):r():s(),d&&(d.scrollable=!0),o.data("scrollable",!0),this.pushScrollable(p,o),o},uninstall:function(e,i){if(e.data("scrollable")){var o=e.data("scrollbars");o&&o.forEach(function(t){t.destroy()}),this.removeScrollable(i,e),e.removeData("scrollable"),e.css("overflow",""),e.removeData("scrollbars");var n=t.HtmlComponent.optGet(e);n&&(n.scrollable=!1)}},update:function(t,e){function i(){o.forEach(function(t){t.rendered&&t.reset()}),o.forEach(function(t){t.rendered&&t.update()})}if(t){var o=t.data("scrollbars");if(o)return e?void i():void(t.data("scrollbarUpdatePending")||(setTimeout(function(){i(),t.removeData("scrollbarUpdatePending")}.bind(this),0),t.data("scrollbarUpdatePending",!0)))}},reset:function(t){var e=t.data("scrollbars");e&&e.forEach(function(t){t.reset()})},scrollTo:function(e,i){var o,n=4,r=8,s=e.height(),a=t.graphics.offsetBounds(i,!1,!1),l=t.graphics.offsetBounds(e,!1,!1),h=a.y-l.y-n,d=a.height+r;d===r&&i.data("valuefield")&&i.data("valuefield").$container&&(i=i.data("valuefield").$container,a=t.graphics.offsetBounds(i,!1,!1),h=a.y-l.y-n,d=a.height+r),h<0?t.scrollbars.scrollTop(e,e.scrollTop()+h):h+d>s&&(o=Math.ceil(e.scrollTop()+h+d-s),t.scrollbars.scrollTop(e,o))},scrollHorizontalTo:function(e,i){var o,n=e.width(),r=t.graphics.bounds(i,!0,!0),s=r.x,a=r.width;s<0?t.scrollbars.scrollLeft(e,e.scrollLeft()+s):s+a>n&&(o=Math.ceil(e.scrollLeft()+s+a-n),t.scrollbars.scrollLeft(e,o))},scrollTop:function(e,i){var o=t.scrollbars.scrollbar(e,"y");o?(o.notifyBeforeScroll(),e.scrollTop(i),o.notifyAfterScroll()):e.scrollTop(i)},scrollLeft:function(e,i){var o=t.scrollbars.scrollbar(e,"x");o?(o.notifyBeforeScroll(),e.scrollLeft(i),o.notifyAfterScroll()):e.scrollLeft(i)},scrollbar:function(e,i){var o=e.data("scrollbars")||[];return t.arrays.find(o,function(t){return t.axis===i})},scrollToBottom:function(e){t.scrollbars.scrollTop(e,e[0].scrollHeight-e[0].offsetHeight)},isLocationInView:function(e,i){if(!i||0===i.length)return!0;var o=t.graphics.offsetBounds(i);return o.contains(e.x,e.y)},onScroll:function(t,i){i.$scrollParents=[],t.scrollParents().each(function(){var t=e(this);t.on("scroll",i),i.$scrollParents.push(t)})},offScroll:function(t){var e=t.$scrollParents;if(!e)throw new Error("$scrollParents are not defined");for(var i=0;i<e.length;i++){var o=e[i];o.off("scroll",t)}},fix:function(e){var i=t.graphics.offsetBounds(e);e.css("position","fixed").cssLeft(i.x-e.cssMarginLeft()).cssTop(i.y-e.cssMarginTop()).cssWidth(i.width).cssHeight(i.height)},unfix:function(t,e){return clearTimeout(e),setTimeout(function(){t.css({position:"absolute",left:"",top:"",width:"",height:""})}.bind(this),50)},storeScrollPositions:function(t,i){var o=this.getScrollables(i);if(o){var n,r;o.forEach(function(i){t.isOrHas(i[0])&&(n=i.scrollTop(),i.data("scrollTop",n),r=i.scrollLeft(),i.data("scrollLeft",i.scrollLeft()),e.log.debug("Stored scroll position for "+i.attr("class")+". Top: "+n+". Left: "+r))})}},restoreScrollPositions:function(i,o){var n=this.getScrollables(this.session);if(n){var r,s;n.forEach(function(o){i.isOrHas(o[0])&&(r=o.data("scrollTop"),r&&(o.scrollTop(r),o.removeData("scrollTop")),s=o.data("scrollLeft"),s&&(o.scrollLeft(s),o.removeData("scrollLeft")),t.scrollbars.update(o),e.log.debug("Restored scroll position for "+o.attr("class")+". Top: "+r+". Left: "+s))})}}},t.Splitter=function(){t.Splitter.parent.call(this),this.splitHorizontal,this.$anchor,this._$root,this.ratio,this.position,this._cursorOffset=0},t.inherits(t.Splitter,t.Widget),t.Splitter.prototype._init=function(e){t.Splitter.parent.prototype._init.call(this,e),this.splitHorizontal=t.nvl(e.splitHorizontal,!0),this.$anchor=e.$anchor,this._$root=e.$root},t.Splitter.prototype._render=function(t){this.$container=t.appendDiv("splitter").addClass(this.splitHorizontal?"x-axis":"y-axis").on("mousedown",this._onMouseDown.bind(this)),this._$window=t.window(),this._$body=t.body()},t.Splitter.prototype.getPosition=function(){return this.position},t.Splitter.prototype.getRatio=function(){return this.ratio},t.Splitter.prototype.setPosition=function(i,o,n){if(!e.isNumeric(i)){var r=t.graphics.offsetBounds(this.$anchor);i=this.splitHorizontal?r.x+r.width:r.y+r.height}if(i!==this.position)return this._setPosition(i,o,n),i},t.Splitter.prototype._setPosition=function(i,o,n){if(n=t.nvl(n,!0),e.isNumeric(i)&&i!==this.position){o&&(this.splitHorizontal?this.ratio=i/this._$root.outerWidth(!0):this.ratio=i/this._$root.outerHeight(!0)),this.position=i;var r={position:i};if(n&&this.trigger("positionChanged",r),this.rendered){var s=t.graphics.getVisibleSize(this.$container,!0);this.splitHorizontal?this.$container.cssLeft(i-s.width/2):this.$container.cssTop(i-s.height/2)}}},t.Splitter.prototype._onMouseDown=function(e){var i=t.graphics.offsetBounds(this.$container,!0).center();this._$window.on("mousemove.splitter",this._onMouseMove.bind(this)).one("mouseup",this._onMouseUp.bind(this)),this._$body.addClass(this.splitHorizontal?"col-resize":"row-resize"),this._cursorOffset={left:i.x-e.pageX,top:i.y-e.pageY},this.trigger("moveStart",{position:this._getSplitterPosition(e)}),e.preventDefault()},t.Splitter.prototype._getSplitterPosition=function(e){var i=t.graphics.offsetBounds(this._$root);return this.splitHorizontal?e.pageX+this._cursorOffset.left-i.x:e.pageY+this._cursorOffset.top-i.y},t.Splitter.prototype._onMouseMove=function(t){var e=this._getSplitterPosition(t),i={position:e,defaultPrevented:!1,preventDefault:function(){this.defaultPrevented=!0},setPosition:function(t){this.position=t}};this.trigger("move",i),i.defaultPrevented||this._setPosition(i.position,!0)},t.Splitter.prototype._onMouseUp=function(t){this._$window.off("mousemove.splitter"),this._$body.removeClass(this.splitHorizontal?"col-resize":"row-resize"),this.trigger("moveEnd",{position:this.position})},t.DateFormatPatternType={YEAR:"year",MONTH:"month",WEEK_IN_YEAR:"week_in_year",DAY_IN_MONTH:"day_in_month",WEEKDAY:"weekday",HOUR_24:"hour_24",HOUR_12:"hour_12",AM_PM:"am_pm",MINUTE:"minute",SECOND:"second",MILLISECOND:"millisecond"},t.DateFormat=function(e,o){if(this.locale=e,this.locale===i||null===this.locale)throw new Error("Missing locale");if(this.pattern=o||e.dateFormatPatternDefault,this.pattern===i||null===this.pattern)throw new Error("Missing pattern");this.symbols=e.dateFormatSymbols,this.symbols.firstDayOfWeek=1,this.symbols.weekdaysOrdered=t.dates.orderWeekdays(this.symbols.weekdays,this.symbols.firstDayOfWeek),this.symbols.weekdaysShortOrdered=t.dates.orderWeekdays(this.symbols.weekdaysShort,this.symbols.firstDayOfWeek),this.symbols.monthsToNumber,this.symbols.monthsShortToNumber,this._terms=[],this._formatFunctions=[],this._parseFunctions=[],this._analyzeFunctions=[];var n=this,r=function(t){t=t||{},this.type=t.type,Array.isArray(t.terms)?this.terms=t.terms:this.terms=[t.terms],this.acceptedTerm=null,this.dateFormat=n,this.formatFunction=t.formatFunction&&t.formatFunction.bind(this),this.parseRegExp=t.parseRegExp,this.applyMatchFunction=t.applyMatchFunction&&t.applyMatchFunction.bind(this),this.parseFunction=t.parseFunction&&t.parseFunction.bind(this)};r.prototype.createFormatFunction=function(){return function(t){if(this.formatFunction){var e=this.formatFunction(t);e!==i&&(t.formattedString+=e)}}.bind(this)},r.prototype.createParseFunction=function(){return function(t){var e,i,o,n=!1;return this.parseRegExp&&(e=this.parseRegExp.exec(t.inputString),e&&(this.applyMatchFunction&&this.applyMatchFunction(t,e[1]),o=e[1],t.inputString=e[2],n=!0)),!n&&this.parseFunction&&(o=this.parseFunction(t),null!==o&&(n=!0)),n&&(i=this.terms[0],this.terms.length>1&&this.terms.some(function(t){return t.length===o.length&&(i=t,!0)}),t.parsedPattern+=i),n}.bind(this)},r.prototype.accept=function(t){if(t)for(var e=0;e<this.terms.length;e++)if(t===this.terms[e])return this.acceptedTerm=this.terms[e],!0;return this.acceptedTerm=null,!1},this._patternDefinitions=[new r({type:t.DateFormatPatternType.YEAR,terms:"yyyy",formatFunction:function(e){return t.strings.padZeroLeft(e.inputDate.getFullYear(),4).slice(-4)},parseRegExp:/^(\d{4})(.*)$/,applyMatchFunction:function(t,e){t.matchInfo.year=e,t.dateInfo.year=Number(e)}}),new r({type:t.DateFormatPatternType.YEAR,terms:["yyy","yy","y"],formatFunction:function(e){var i=String(e.inputDate.getFullYear()),o=e.exactLength?this.acceptedTerm.length:2;return 1===this.acceptedTerm.length?i.slice(-o):t.strings.padZeroLeft(i,o).slice(-o)},parseRegExp:/^(\d{1,3})(.*)$/,applyMatchFunction:function(e,i){if(3===i.length)return e.dateInfo.year=Number(i),void(e.matchInfo.year=i);var o=Number(i),n=e.startDate||new Date,r=Number(String(n.getFullYear()).slice(-2)),s=r-50<0?r+50:r-50,a=String(t.strings.padZeroLeft(n.getFullYear(),4)).substr(0,2);o>s&&(a=Number(a)-1);var l=Number(String(a)+t.strings.padZeroLeft(o,2));e.dateInfo.year=l,e.matchInfo.year=i}}),new r({type:t.DateFormatPatternType.MONTH,terms:"MMMM",formatFunction:function(t){return this.dateFormat.symbols.months[t.inputDate.getMonth()]},parseFunction:function(e){var i,o,n,r;for(i=0;i<this.dateFormat.symbols.months.length;i++)if(o=this.dateFormat.symbols.months[i],o&&(n=new RegExp("^("+t.strings.quote(o)+")(.*)$","i"),r=n.exec(e.inputString)))return e.dateInfo.month=i,e.matchInfo.month=r[1],e.inputString=r[2],r[1];if(e.analyze)for(i=0;i<this.dateFormat.symbols.months.length;i++)if(o=this.dateFormat.symbols.months[i],n=new RegExp("^("+t.strings.quote(e.inputString)+")(.*)$","i"),r=n.exec(o))return e.dateInfo.month=i,e.matchInfo.month=o,e.inputString="",r[1];return null}}),new r({type:t.DateFormatPatternType.MONTH,terms:"MMM",formatFunction:function(t){return this.dateFormat.symbols.monthsShort[t.inputDate.getMonth()]},parseFunction:function(e){var i,o,n,r;for(i=0;i<this.dateFormat.symbols.monthsShort.length;i++)if(o=this.dateFormat.symbols.monthsShort[i],o&&(n=new RegExp("^("+t.strings.quote(o)+")(.*)$","i"),r=n.exec(e.inputString)))return e.dateInfo.month=i,e.matchInfo.month=r[1],e.inputString=r[2],r[1];if(e.analyze)for(i=0;i<this.dateFormat.symbols.monthsShort.length;i++)if(o=this.dateFormat.symbols.monthsShort[i],n=new RegExp("^("+t.strings.quote(e.inputString)+")(.*)$","i"),r=n.exec(o))return e.dateInfo.month=i,e.matchInfo.month=o,e.inputString="",r[1];return null}}),new r({type:t.DateFormatPatternType.MONTH,terms:"MM",formatFunction:function(e){return t.strings.padZeroLeft(e.inputDate.getMonth()+1,2)},parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:function(t,e){var i=Number(e);t.dateInfo.month=i-1,t.matchInfo.month=e},parseFunction:function(e){if(e.analyze&&"0"===e.inputString){var o=this.dateFormat._dateInfoToDate(e.dateInfo);if(!o)return null;var n=o.getMonth();return n>=9&&(n=0,e.dateInfo.year===i?e.dateInfo.year=Number(o.getFullYear())+1:e.dateInfo.year=e.dateInfo.year+1),e.dateInfo.month=n,e.matchInfo.month=t.strings.padZeroLeft(String(n+1),2),e.inputString="","0"}return null}}),new r({type:t.DateFormatPatternType.MONTH,terms:"M",formatFunction:function(t){return String(t.inputDate.getMonth()+1)},parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:function(t,e){var i=Number(e);t.dateInfo.month=i-1,t.matchInfo.month=e}}),new r({type:t.DateFormatPatternType.WEEK_IN_YEAR,terms:"ww",formatFunction:function(e){return t.strings.padZeroLeft(t.dates.weekInYear(e.inputDate),2)},parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:function(t,e){t.matchInfo.week=e,t.hints.weekInYear=Number(e)}}),new r({type:t.DateFormatPatternType.WEEK_IN_YEAR,terms:"w",formatFunction:function(e){return String(t.dates.weekInYear(e.inputDate))},parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:function(t,e){t.matchInfo.week=e,t.hints.weekInYear=Number(e)}}),new r({type:t.DateFormatPatternType.DAY_IN_MONTH,terms:"dd",formatFunction:function(e){return t.strings.padZeroLeft(e.inputDate.getDate(),2)},parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.day=Number(e),t.matchInfo.day=e},parseFunction:function(t){return t.analyze&&"0"===t.inputString?(t.dateInfo.day=1,t.matchInfo.day="01",t.inputString="","0"):null}}),new r({type:t.DateFormatPatternType.DAY_IN_MONTH,terms:"d",formatFunction:function(t){return String(t.inputDate.getDate())},parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.day=Number(e),t.matchInfo.day=e}}),new r({type:t.DateFormatPatternType.WEEKDAY,terms:"EEEE",formatFunction:function(t){return this.dateFormat.symbols.weekdays[t.inputDate.getDay()]},parseFunction:function(e){var i,o,n,r;for(i=0;i<this.dateFormat.symbols.weekdays.length;i++)if(o=this.dateFormat.symbols.weekdays[i],o&&(n=new RegExp("^("+t.strings.quote(o)+")(.*)$","i"),r=n.exec(e.inputString)))return e.matchInfo.weekday=r[1],e.hints.weekday=i,e.inputString=r[2],r[1];if(e.analyze)for(i=0;i<this.dateFormat.symbols.weekdays.length;i++)if(o=this.dateFormat.symbols.weekdays[i],n=new RegExp("^("+t.strings.quote(e.inputString)+")(.*)$","i"),r=n.exec(o))return e.matchInfo.weekday=o,e.hints.weekday=i,e.inputString="",r[1];return null}}),new r({type:t.DateFormatPatternType.WEEKDAY,terms:["EEE","EE","E"],formatFunction:function(t){return this.dateFormat.symbols.weekdaysShort[t.inputDate.getDay()]},parseFunction:function(e){var i,o,n,r;for(i=0;i<this.dateFormat.symbols.weekdaysShort.length;i++)if(o=this.dateFormat.symbols.weekdaysShort[i],o&&(n=new RegExp("^("+t.strings.quote(o)+")(.*)$","i"),r=n.exec(e.inputString)))return e.matchInfo.weekday=r[1],e.hints.weekday=i,e.inputString=r[2],r[1];if(e.analyze)for(i=0;i<this.dateFormat.symbols.weekdaysShort.length;i++)if(o=this.dateFormat.symbols.weekdaysShort[i],n=new RegExp("^("+t.strings.quote(e.inputString)+")(.*)$","i"),r=n.exec(o))return e.matchInfo.weekday=o,e.hints.weekday=i,e.inputString="",r[1];return null}}),new r({type:t.DateFormatPatternType.HOUR_24,terms:"HH",formatFunction:function(e){return t.strings.padZeroLeft(e.inputDate.getHours(),2)},parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.hours=Number(e),t.matchInfo.hours=e}}),new r({type:t.DateFormatPatternType.HOUR_24,terms:["H","h"],formatFunction:function(t){return String(t.inputDate.getHours())},parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.hours=Number(e),t.matchInfo.hours=e}}),new r({type:t.DateFormatPatternType.HOUR_12,terms:"KK",formatFunction:function(e){return t.strings.padZeroLeft((e.inputDate.getHours()+11)%12+1,2)},parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.hours=Number(e),t.matchInfo.hours=e}}),new r({type:t.DateFormatPatternType.HOUR_12,terms:"K",formatFunction:function(t){return String(t.inputDate%12+1)},parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.hours=Number(e),t.matchInfo.hours=e}}),new r({type:t.DateFormatPatternType.AM_PM,terms:"a",formatFunction:function(t){return t.inputDate.getHours()<12?this.dateFormat.symbols.am:this.dateFormat.symbols.pm},parseFunction:function(e){var i,o,n=!1,r=!1;return i=new RegExp("^("+t.strings.quote(this.dateFormat.symbols.am)+")(.*)$","i"),o=i.exec(e.inputString),o?(n=!0,e.matchInfo.ampm=o[1],e.inputString=o[2]):(i=new RegExp("^("+t.strings.quote(this.dateFormat.symbols.pm)+")(.*)$","i"),o=i.exec(e.inputString),o&&(r=!0,e.matchInfo.ampm=o[1],e.inputString=o[2])),n||r?(e.hints.am=n,e.hints.pm=r,o[1]):null}}),new r({type:t.DateFormatPatternType.MINUTE,terms:"mm",formatFunction:function(e){return t.strings.padZeroLeft(e.inputDate.getMinutes(),2)},parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.minutes=Number(e),t.matchInfo.minutes=e},parseFunction:function(e){if(e.analyze&&t.isOneOf(e.inputString,"0","1","2","3","4","5")){var i=e.inputString+"0";return e.dateInfo.minutes=Number(i),e.matchInfo.minutes=i,e.inputString="",e.inputString}return null}}),new r({type:t.DateFormatPatternType.MINUTE,terms:"m",formatFunction:function(t){return String(t.inputDate.getMinutes())},parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.minutes=Number(e),t.matchInfo.minutes=e}}),new r({type:t.DateFormatPatternType.SECOND,terms:"ss",formatFunction:function(e){return t.strings.padZeroLeft(e.inputDate.getSeconds(),2)},parseRegExp:/^(\d{2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.seconds=Number(e),t.matchInfo.seconds=e}}),new r({type:t.DateFormatPatternType.SECOND,terms:"s",formatFunction:function(t){return String(t.inputDate.getSeconds())},parseRegExp:/^(\d{1,2})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.seconds=Number(e),t.matchInfo.seconds=e}}),new r({type:t.DateFormatPatternType.MILLISECOND,terms:"SSS",formatFunction:function(e){return t.strings.padZeroLeft(e.inputDate.getMilliseconds(),3)},parseRegExp:/^(\d{3})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.milliseconds=Number(e),t.matchInfo.milliseconds=e}}),new r({type:t.DateFormatPatternType.MILLISECOND,terms:"S",formatFunction:function(t){return String(t.inputDate.getMilliseconds())},parseRegExp:/^(\d{1,3})(.*)$/,applyMatchFunction:function(t,e){t.dateInfo.milliseconds=Number(e),t.matchInfo.milliseconds=e}})],this._patternLibrary={};for(var s=0;s<this._patternDefinitions.length;s++){var a=this._patternDefinitions[s],l=a.type;l&&(this._patternLibrary[l]||(this._patternLibrary[l]=[]),this._patternLibrary[l].push(a))}this._compile()},t.DateFormat.prototype._compile=function(){var t,e,i,o,n,r,s,a,l;for(n=/(.)\1*/g;r=n.exec(this.pattern);){for(s=r[0],this._terms.push(s),a=!1,t=0;t<this._patternDefinitions.length;t++)if(o=this._patternDefinitions[t],o.accept(s)){for(this._formatFunctions.push(o.createFormatFunction()),this._parseFunctions.push(o.createParseFunction()),i=this._patternLibrary[o.type],l=[],e=0;e<i.length;e++)l.push(i[e].createParseFunction());this._analyzeFunctions.push(l),a=!0;break}if(!a){this._formatFunctions.push(this._createConstantStringFormatFunction(s));var h=this._createConstantStringParseFunction(s);this._parseFunctions.push(h),this._analyzeFunctions.push([h])}}},t.DateFormat.prototype._createConstantStringFormatFunction=function(t){return function(e){e.formattedString+=t}},t.DateFormat.prototype._createConstantStringParseFunction=function(e){return function(i){return t.strings.startsWith(i.inputString,e)?(i.inputString=i.inputString.substr(e.length),i.parsedPattern+=e,!0):!!i.analyze}},t.DateFormat.prototype.format=function(e,i){if(!e)return"";var o=this._createFormatContext(e);o.exactLength=t.nvl(i,!1);for(var n=0;n<this._formatFunctions.length;n++){var r=this._formatFunctions[n];r(o)}return o.formattedString},t.DateFormat.prototype.analyze=function(e,o){var n=this._createAnalyzeInfo(e);if(!e)return n;var r=this._createParseContext(e);r.analyze=!0,r.startDate=o;for(var s=0;s<this._terms.length;s++)if(r.inputString.length>0){for(var a=this._analyzeFunctions[s],l=!1,h=0;h<a.length;h++){var d=a[h];if(d(r)){l=!0;break}}if(!l)return n.error=!0,n}else r.parsedPattern+=this._terms[s];if(r.inputString.length>0)return n.error=!0,n;o=this._prepareStartDate(o),r.hints.weekday!==i&&(o=t.dates.shiftToNextDayOfType(o,r.hints.weekday));var p=this._dateInfoToDate(r.dateInfo,o);return n.dateInfo=r.dateInfo,n.matchInfo=r.matchInfo,n.hints=r.hints,n.parsedPattern=r.parsedPattern,n.predictedDate=p,n.error=!p,n},t.DateFormat.prototype.parse=function(t,e){if(!t)return null;var o=this._createParseContext(t);o.startDate=e;for(var n=0;n<this._parseFunctions.length;n++){var r=this._parseFunctions[n];if(!r(o))return null;if(0===o.inputString.length)break}if(o.inputString.length>0)return null;var s=this._dateInfoToDate(o.dateInfo,e);if(!s)return null;if(o.hints.am||o.hints.pm){var a=s.getHours();12===a&&(a=0),o.hints.pm&&(a+=12),s.setHours(a)}return o.hints.weekday!==i&&s.getDay()!==o.hints.weekday?null:s},t.DateFormat.prototype._dateInfoToDate=function(e,o){function n(t,e){return e===i||e===t}if(!e)return null;o=this._prepareStartDate(o);var r=new Date(1970,0,1),s=t.nvl(e.month,o.getMonth()),a=t.nvl(e.year,o.getFullYear());if(e.day&&!e.month)if(31===e.day){var l=[0,2,4,6,7,9,11];t.isOneOf(s,l)||(s+=1)}else e.day>=29&&1===s&&(e.day>29||!t.dates.isLeapYear(a))&&(s+=1);return r.setFullYear(a,s,t.nvl(e.day,o.getDate())),r.setHours(t.nvl(e.hours,o.getHours()),t.nvl(e.minutes,o.getMinutes()),t.nvl(e.seconds,o.getSeconds()),t.nvl(e.milliseconds,o.getMilliseconds())),n(r.getFullYear(),e.year)&&n(r.getMonth(),e.month)&&n(r.getDate(),e.day)&&n(r.getHours(),e.hours)&&n(r.getMinutes(),e.minutes)&&n(r.getSeconds(),e.seconds)&&n(r.getMilliseconds(),e.milliseconds)?r:null};t.DateFormat.prototype._prepareStartDate=function(e){return e?new Date(e.getTime()):t.dates.trunc(new Date)};t.DateFormat.prototype._createFormatContext=function(t){return{inputDate:t,formattedString:"",exactLength:!1}},t.DateFormat.prototype._createParseContext=function(t){return{inputString:t,dateInfo:{},matchInfo:{},hints:{},parsedPattern:"",analyze:!1,startDate:null}},t.DateFormat.prototype._createAnalyzeInfo=function(t){return{inputString:t,dateInfo:{},matchInfo:{},hints:{},parsedPattern:"",predictedDate:null,error:!1}},t.DecimalFormat=function(e,i){function o(t){var e={prefix:"",suffix:""},i=n.digit+n.zeroDigit+n.decimalSeparator+n.groupingSeparator,o=new RegExp("^(.*?)["+i+"].*$"),r=o.exec(t);return null!==r&&(e.prefix=r[1].replace(new RegExp("'([^']+)'","g"),"$1")),o=new RegExp("^.*["+i+"](.*?)$"),r=o.exec(t),null!==r&&(e.suffix=r[1].replace(new RegExp("'([^']+)'","g"),"$1")),e}this.positivePrefix="",this.positiveSuffix="",this.negativePrefix=e.decimalFormatSymbols.minusSign,this.negativeSuffix="",this.groupingChar=e.decimalFormatSymbols.groupingSeparator,this.groupLength=0,this.decimalSeparatorChar=e.decimalFormatSymbols.decimalSeparator,this.zeroBefore=1,this.zeroAfter=0,this.allAfter=0,i=i||{},this.pattern=i.pattern||e.decimalFormatPatternDefault,this.multiplier=i.multiplier||1,this.roundingMode=i.roundingMode||t.numbers.RoundingMode.HALF_UP;var n=t.DecimalFormat.PATTERN_SYMBOLS,r=this.pattern.split(n.patternSeparator),s=o(r[0]);if(this.positivePrefix=s.prefix,this.positiveSuffix=s.suffix,r.length>1){var a=o(r[1]);this.negativePrefix=a.prefix,this.negativeSuffix=a.suffix,this.pattern=r[0]}else this.positivePrefix.indexOf(n.minusSign)!==-1||this.positiveSuffix.indexOf(n.minusSign)!==-1?(this.negativePrefix=this.positivePrefix.replace(n.minusSign,e.decimalFormatSymbols.minusSign),this.negativeSuffix=this.positiveSuffix.replace(n.minusSign,e.decimalFormatSymbols.minusSign),this.positivePrefix=this.positivePrefix.replace(n.minusSign,""),this.positiveSuffix=this.positiveSuffix.replace(n.minusSign,"")):(this.negativePrefix=this.positivePrefix+this.negativePrefix,this.negativeSuffix=this.negativeSuffix+this.positiveSuffix);var l=this.pattern.indexOf(n.decimalSeparator);l===-1&&(l=this.pattern.length);var h=this.pattern.lastIndexOf(n.groupingSeparator,l);h>0&&(this.groupLength=l-h-1),this.pattern=this.pattern.replace(new RegExp("["+n.groupingSeparator+"]","g"),""),r=this.pattern.split(n.decimalSeparator),this.zeroBefore=t.strings.count(r[0],n.zeroDigit),r.length>1&&(this.zeroAfter=t.strings.count(r[1],n.zeroDigit),this.allAfter=this.zeroAfter+t.strings.count(r[1],n.digit))},t.DecimalFormat.prototype.parse=function(e){if(t.strings.empty(e))return null;var i=e.replace(new RegExp("["+this.groupingChar+"]","g"),"").replace(new RegExp("["+this.decimalSeparatorChar+"]","g"),".").replace(/\s/g,""),o=Number(i);if(isNaN(o))throw new Error(e+" is not a number (NaN)");return o},t.DecimalFormat.prototype.format=function(e,o){if(o=t.nvl(o,!0),null===e||e===i)return null;var n=this.positivePrefix,r=this.positiveSuffix;o&&1!==this.multiplier&&(e*=this.multiplier),e=this.round(e);var s="";if(this.allAfter){s=e.toFixed(this.allAfter).split(".")[1];for(var a=s.length-1;a>this.zeroAfter-1&&"0"===s[a];a--)s=s.slice(0,-1);s&&(s=this.decimalSeparatorChar+s)}e<0&&(n=this.negativePrefix,r=this.negativeSuffix,e=-e);var l=Math.floor(e);if(l=0===l?"":String(l),l=t.strings.padZeroLeft(l,this.zeroBefore),this.groupLength)for(var h=l.length-this.groupLength;h>0;h-=this.groupLength)l=l.substr(0,h)+this.groupingChar+l.substr(h);return n+l+s+r},t.DecimalFormat.prototype.round=function(e){return t.numbers.round(e,this.roundingMode,this.allAfter)},t.DecimalFormat.PATTERN_SYMBOLS={digit:"#",zeroDigit:"0",decimalSeparator:".",groupingSeparator:",",minusSign:"-",patternSeparator:";"},t.DecimalFormat.ensure=function(e,i){return i?i instanceof t.DecimalFormat?i:new t.DecimalFormat(e,i):i},t.TextMap=function(t){this.map=t||{}},t.TextMap.TEXT_KEY_REGEX=/\$\{textKey\:([a-zA-Z0-9\.]*)\}/,t.TextMap.prototype.get=function(e){if(!this._exists(e))return this.parent?t.TextMap.prototype.get.apply(this.parent,arguments):"[undefined text: "+e+"]";var i=arguments.length,o=this.map[e];if(1===i)return o;for(var n=1;n<i;n++)o=o.replace(new RegExp("\\{"+(n-1)+"\\}","g"),arguments[n]);return o},t.TextMap.prototype.optGet=function(e,i){if(!this._exists(e))return this.parent?t.TextMap.prototype.optGet.apply(this.parent,arguments):i;if(arguments.length>2){var o=Array.prototype.slice.call(arguments,2);return o.unshift(e),t.TextMap.prototype.get.apply(this,o)}return this.get(e)},t.TextMap.prototype.exists=function(t){return!!this._exists(t)||!!this.parent&&this.parent.exists(t)},t.TextMap.prototype._exists=function(t){return this.map.hasOwnProperty(t)},t.TextMap.prototype.add=function(t,e){this.map[t]=e},t.TextMap.prototype.addAll=function(e){e&&(e instanceof t.TextMap&&(e=e.map),t.objects.copyOwnProperties(e,this.map))},t.TextMap.prototype.setParent=function(t){this.parent=t},t.texts={TEXT_KEY_REGEX:/\$\{textKey\:([^\}]*)\}/,textsByLocale:{},bootstrap:function(i){return i=t.nvl(i,"res/texts.json"),e.ajaxJson(i).done(this.init.bind(this))},init:function(t){var e=Object.keys(t);e.forEach(function(e){this.get(e).addAll(t[e])},this)},link:function(e){var i,o=this.splitLanguageTag(e);o.forEach(function(e){var o=this._get(e);o||(o=new t.TextMap,this.put(e,o)),i&&i.setParent(o),i=o},this)},splitLanguageTag:function(t){var e=[],i=t.lastIndexOf("-");for(e.push(t);i>=0;)t=t.substring(0,i),e.push(t),i=t.lastIndexOf("-");return"default"!==t&&e.push("default"),e},get:function(t){var e=this._get(t);if(e)return e;if(this.link(t),e=this._get(t),
!e)throw new Error("Texts missing for the language tag "+t);return e},_get:function(t){return this.textsByLocale[t]},put:function(t,e){this.textsByLocale[t]=e},readFromDOM:function(){var t={};return e("scout-text").each(function(){var i=e(this).data("key"),o=e(this).data("value");t[i]=o}),t},buildKey:function(t){return"${textKey:"+t+"}"},resolveKey:function(t){var e=this.TEXT_KEY_REGEX.exec(t);return e&&2===e.length?e[1]:t},resolveText:function(e,i){var o=t.texts.resolveKey(e);return o!==e?t.texts.get(i).get(o):e},resolveTextProperty:function(t,e,i){e=e||"text",i=t.session||i;var o=t[e],n=this.resolveText(o,i.locale.languageTag);n!==o&&(t[e]=n)}},t.Tooltip=function(){t.Tooltip.parent.call(this),this.text="",this.arrowPosition=25,this.arrowPositionUnit="%",this.windowPaddingX=10,this.windowPaddingY=5,this.origin,this.originRelativeToParent=!1,this.$anchor,this.autoRemove=!0,this.cssClass,this.tooltipPosition="top",this.scrollType="position",this.htmlEnabled=!1,this.$content},t.inherits(t.Tooltip,t.Widget),t.Tooltip.prototype._render=function(e){this.$parent=this.$parent||this.$anchor&&this.session.$entryPoint,this.$container=this.$parent.appendDiv("tooltip").hide().data("tooltip",this),this.cssClass&&this.$container.addClass(this.cssClass),this.$arrow=this.$container.appendDiv("tooltip-arrow"),this.$content=this.$container.appendDiv("tooltip-content"),this._renderText(),this._renderSeverity(),this.$container.show(),this.autoRemove&&(this._mousedownHandler=this._onDocumentMousedown.bind(this),this._keydownHandler=this._onDocumentKeydown.bind(this),this.$container.document().on("mousedown",this._mousedownHandler).on("keydown",this._keydownHandler)),this.$anchor&&this.scrollType&&(this._scrollHandler=this._onAnchorScroll.bind(this),t.scrollbars.onScroll(this.$anchor,this._scrollHandler)),this.dialog=null;for(var i=this.parent;i;){if(i instanceof t.Form&&i.isDialog()){this.dialog=i;break}i=i.parent}this.dialog&&(this._moveHandler=this.position.bind(this),this.dialog.on("move",this._moveHandler))},t.Tooltip.prototype._postRender=function(){t.Tooltip.parent.prototype._postRender.call(this),this.position()},t.Tooltip.prototype._remove=function(){this._mousedownHandler&&(this.$container.document().off("mousedown",this._mousedownHandler),this._mousedownHandler=null),this._keydownHandler&&(this.$container.document().off("keydown",this._keydownHandler),this._keydownHandler=null),this._scrollHandler&&(t.scrollbars.offScroll(this._scrollHandler),this._scrollHandler=null),this._moveHandler&&(this.dialog&&this.dialog.off("move",this._moveHandler),this._moveHandler=null),this.dialog=null,t.Tooltip.parent.prototype._remove.call(this)},t.Tooltip.prototype.setText=function(t){this.text!==t&&(this._setProperty("text",t),this.rendered&&(this._renderText(),this.position()))},t.Tooltip.prototype.setSeverity=function(t){this.setProperty("severity",t)},t.Tooltip.prototype._renderText=function(){var e=this.text;this.htmlEnabled?this.$content.html(e):this.$content.html(t.strings.nl2br(e))},t.Tooltip.prototype._renderSeverity=function(){this.$container.removeClass("tooltip-error tooltip-warning tooltip-info"),this.$container.addClass(this._cssClassForSeverity())},t.Tooltip.prototype._cssClassForSeverity=function(){var e=this.severity>t.Status.Severity.OK,i=this.severity>t.Status.Severity.INFO,o=this.severity>t.Status.Severity.WARNING;return o?"tooltip-error":i?"tooltip-warning":e?"tooltip-info":""},t.Tooltip.prototype.position=function(){var e,i,o,n,r,s,a,l,h,d,p,u,c;if(this.origin?(l=this.origin,s=l.x):(l=t.graphics.offsetBounds(this.$anchor),s=l.x+l.width/2),a=l.y,this.$anchor&&(c=t.scrollbars.isLocationInView(l,this.$anchor.scrollParent()),this.$container.setVisible(c)),!this.originRelativeToParent){var f=this.$parent.offset();s-=f.left,a-=f.top}p=this.$arrow.outerWidth(),o=t.Tooltip.computeHypotenuse(p)/2,d=this.$container.outerHeight(),h=this.$container.outerWidth(),u=this.arrowPosition,"%"===this.arrowPositionUnit&&(u=h*this.arrowPosition/100),e=a-d-o,i=s-u,n=i+h+this.windowPaddingX-this.$parent.width(),r=e-this.windowPaddingY,n>0&&(i-=n,u=s-i),this.$arrow.removeClass("arrow-top arrow-bottom"),"bottom"===this.tooltipPosition||r<0?(this.$arrow.addClass("arrow-top"),e=a+l.height+o):this.$arrow.addClass("arrow-bottom"),u=Math.min(u,this.$container.outerWidth()-o),u=Math.max(u,o),this.$arrow.cssLeft(u),this.$container.cssLeft(i).cssTop(e)},t.Tooltip.prototype._onAnchorScroll=function(t){this.rendered&&("position"===this.scrollType?this.position():"remove"===this.scrollType&&this.destroy())},t.Tooltip.prototype._onDocumentMousedown=function(t){return!!this.rendered&&void(this._isMousedownOutside(t)&&this._onMousedownOutside(t))},t.Tooltip.prototype._isMousedownOutside=function(i){var o=e(i.target),n=t.Widget.getWidgetFor(o);return!this.isOrHas(n)&&this.$anchor&&!this.$anchor.isOrHas(o[0])&&!this.session.focusManager.isElementCovertByGlassPane(this.$container[0])},t.Tooltip.prototype._onMousedownOutside=function(){this.destroy()},t.Tooltip.prototype._onDocumentKeydown=function(t){this.destroy()},t.Tooltip.computeHypotenuse=function(t){return Math.sqrt(Math.pow(t,2)+Math.pow(t,2))},t.tooltips={install:function(e,i){var o=new t.TooltipSupport(i);o.install(e)},uninstall:function(t){var e=t.data("tooltipSupport");e&&e.uninstall(t)},installForEllipsis:function(i,o){var n={text:function(t){if(t.isContentTruncated())return t.text()},nativeTooltip:!t.device.isCustomEllipsisTooltipPossible()};o=e.extend({},n,o),this.install(i,o)},find:function(t){var i,o,n,r=[];for(i=e(".tooltip",t.document(!0)),o=0;o<i.length;o++)n=i.eq(o).data("tooltip"),t.has(n.$anchor).length>0&&r.push(n);return r}},t.TooltipSupport=function(t){var o={selector:null,delay:600,text:i,nativeTooltip:!1};t=e.extend({},o,t),this._options=t,this._mouseEnterHandler=this._onMouseEnter.bind(this),this._mouseLeaveHandler=this._onMouseLeave.bind(this),this._tooltip,this._tooltipTimeoutId},t.TooltipSupport.prototype.install=function(t){t.data("tooltipSupport")||t.on("mouseenter",this._options.selector,this._mouseEnterHandler).on("mouseleave",this._options.selector,this._mouseLeaveHandler).data("tooltipSupport",this)},t.TooltipSupport.prototype.uninstall=function(t){t.removeData("tooltipSupport").off("mouseleave",this._options.selector,this._mouseLeaveHandler).off("mouseenter",this._options.selector,this._onMouseEnterHandler),this._destroyTooltip(),clearTimeout(this._tooltipTimeoutId)},t.TooltipSupport.prototype._onMouseEnter=function(t){var i=e(t.currentTarget);if(this._options.nativeTooltip){var o=this._text(i);i.attr("title",o)}else clearTimeout(this._tooltipTimeoutId),this._tooltipTimeoutId=setTimeout(this._showTooltip.bind(this,i),this._options.delay)},t.TooltipSupport.prototype._onMouseLeave=function(t){this._destroyTooltip()},t.TooltipSupport.prototype._destroyTooltip=function(){clearTimeout(this._tooltipTimeoutId),this._tooltip&&(this._tooltip.destroy(),this._tooltip=null)},t.TooltipSupport.prototype._text=function(t){var i=this._options.text||t.data("tooltipText");return e.isFunction(i)&&(i=i(t)),i},t.TooltipSupport.prototype._showTooltip=function(i){if(i&&i.isAttached()){var o=this._text(i);if(o)if(this._tooltip&&this._tooltip.rendered)this._tooltip.setText(o);else{var n=e.extend({},this._options,{$anchor:i,text:o});this._tooltip=t.create("Tooltip",n),this._tooltip.render()}}},t.Action=function(){t.Action.parent.call(this),this.enabled=!0,this.visible=!0,this.selected=!1,this.horizontalAlignment=-1,this.iconId="",this.tooltipText="",this.text="",this.cssClass="",this.toggleAction=!1,this.keyStroke=null,this.tabbable=!1,this.actionStyle=t.Action.ActionStyle.DEFAULT,this.textVisible=!0,this.compact=!1,this._addCloneProperties(["actionStyle","cssClass","horizontalAlignment","iconId","selected","tabbable","text","tooltipText","toggleAction"])},t.inherits(t.Action,t.Widget),t.Action.ActionStyle={DEFAULT:0,BUTTON:1},t.Action.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.Action.prototype._init=function(e){t.Action.parent.prototype._init.call(this,e),this.actionKeyStroke=this._createActionKeyStroke(),this.resolveTextKeys(["text","tooltipText"]),this.resolveIconIds(["iconId"]),this._syncKeyStroke(this.keyStroke)},t.Action.prototype._renderProperties=function(){t.Action.parent.prototype._renderProperties.call(this),this._renderText(),this._renderIconId(),this._renderTooltipText(),this._renderKeyStroke(),this._renderSelected(),this._renderTabbable(),this._renderCompact()},t.Action.prototype._remove=function(){this._removeText(),t.Action.parent.prototype._remove.call(this)},t.Action.prototype._renderText=function(){var t=this.text||"";t&&this.textVisible?(this.$text||(this.$text=this.$container.appendSpan("text")),this.$text.text(t)):this._removeText()},t.Action.prototype._removeText=function(){this.$text&&(this.$text.remove(),this.$text=null)},t.Action.prototype._renderIconId=function(){var t=this.iconId||"";this.$container.icon(t)},t.Action.prototype._renderEnabled=function(){this.$container.setEnabled(this.enabled),this._updateTooltip()},t.Action.prototype._renderSelected=function(){this.$container.select(this.selected),this._updateTooltip()},t.Action.prototype._renderKeyStroke=function(){var t=this.keyStroke;t===i?this.$container.removeAttr("data-shortcut"):this.$container.attr("data-shortcut",t)},t.Action.prototype._renderTooltipText=function(){this._updateTooltip()},t.Action.prototype._updateTooltip=function(){this._shouldInstallTooltip()?t.tooltips.install(this.$container,this._configureTooltip()):t.tooltips.uninstall(this.$container)},t.Action.prototype._shouldInstallTooltip=function(){return this.tooltipText&&!this.selected&&this.enabled},t.Action.prototype._renderTabbable=function(){this.$container.setTabbable(this.tabbable&&!t.device.supportsTouch())},t.Action.prototype._renderHorizontalAlignment=function(){},t.Action.prototype._renderCompact=function(){this.$container.toggleClass("compact",this.compact),this.invalidateLayoutTree()},t.Action.prototype._configureTooltip=function(){return{parent:this,text:this.tooltipText,$anchor:this.$container,arrowPosition:50,arrowPositionUnit:"%",tooltipPosition:this.tooltipPosition}},t.Action.prototype.doAction=function(){return!!this.prepareDoAction()&&(this.isToggleAction()?this.setSelected(!this.selected):this._doAction(),!0)},t.Action.prototype.toggle=function(){this.isToggleAction()&&this.setSelected(!this.selected)},t.Action.prototype.isToggleAction=function(){return this.toggleAction},t.Action.prototype.prepareDoAction=function(){return!(!this.enabled||!this.visible)},t.Action.prototype._doAction=function(){this.trigger("doAction")},t.Action.prototype.setText=function(t){this.setProperty("text",t)},t.Action.prototype.setSelected=function(t){this.setProperty("selected",t)},t.Action.prototype._syncKeyStroke=function(t){this._setProperty("keyStroke",t),this.actionKeyStroke.parseAndSetKeyStroke(t)},t.Action.prototype.setTabbable=function(t){this.setProperty("tabbable",t)},t.Action.prototype.setTextVisible=function(t){this.textVisible!==t&&(this._setProperty("textVisible",t),this.rendered&&this._renderText())},t.Action.prototype.setCompact=function(t){this.compact!==t&&(this.compact=t,this.rendered&&this._renderCompact())},t.Action.prototype._createActionKeyStroke=function(){return new t.ActionKeyStroke(this)},t.ActionAdapter=function(){t.ActionAdapter.parent.call(this),this._addRemoteProperties(["selected"])},t.inherits(t.ActionAdapter,t.ModelAdapter),t.ActionAdapter.prototype._goOffline=function(){this._enabledBeforeOffline=this.widget.enabled,this.widget.setEnabled(!1)},t.ActionAdapter.prototype._goOnline=function(){this.widget.setEnabled(this._enabledBeforeOffline)},t.ActionAdapter.prototype._onWidgetDoAction=function(t){this._send("doAction")},t.ActionAdapter.prototype._onWidgetEvent=function(e){"doAction"===e.type?this._onWidgetDoAction(e):t.ActionAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.ActionKeyStroke=function(e){t.ActionKeyStroke.parent.call(this),this.field=e,this.parseAndSetKeyStroke(e.keyStroke),this.stopPropagation=!0,this.stopImmediatePropagation=!1},t.inherits(t.ActionKeyStroke,t.KeyStroke),t.ActionKeyStroke.prototype._isEnabled=function(){return!!this.which.length&&t.ActionKeyStroke.parent.prototype._isEnabled.call(this)},t.ActionKeyStroke.prototype.handle=function(t){this.field.doAction()},t.Box=function(){},t.Box.prototype.render=function(t){this._render(t),this.rendered=!0},t.Box.prototype.remove=function(){this.$container.remove(),this.$container=null,this.rendered=!1},t.Box.prototype._render=function(t){this.$container=e("<div>").addClass("box").appendTo(t),this.$wrapper=e("<div>").addClass("wrapper").appendTo(this.$container),this.$content=e("<div>").addClass("box-content").appendTo(this.$wrapper),this.logoUrl&&(this.$header=this.$content.appendDiv("header"),this.$logo=e("<img>").addClass("logo").attr("src",this.logoUrl).appendTo(this.$header))},t.Popup=function(){t.Popup.parent.call(this),this._mouseDownHandler,this._scrollHandler,this._popupOpenHandler,this.anchorBounds,this.$anchor,this.windowPaddingX,this.windowPaddingY,this.withFocusContext,this.initialFocus,this.focusableContainer,this.openingDirectionX,this.openingDirectionY,this.trimWidth,this.trimHeight,this.boundToAnchor,this.closeOnAnchorMousedown},t.inherits(t.Popup,t.Widget),t.Popup.prototype._init=function(e){t.Popup.parent.prototype._init.call(this,e),this.anchorBounds=e.anchorBounds,e.location&&(this.anchorBounds=new t.Rectangle(e.location.x,e.location.y,0,0)),this.$anchor=e.$anchor,this.windowPaddingX=t.nvl(e.windowPaddingX,10),this.windowPaddingY=t.nvl(e.windowPaddingY,5),this.openingDirectionX=e.openingDirectionX||"right",this.openingDirectionY=e.openingDirectionY||"down",this.trimWidth=t.nvl(e.trimWidth,!1),this.trimHeight=t.nvl(e.trimHeight,!0),this.withFocusContext=t.nvl(e.installFocusContext,!0),this.initialFocus=t.nvl(e.initialFocus,function(){return t.focusRule.AUTO}),this.focusableContainer=t.nvl(e.focusableContainer,!1),this.scrollType=e.scrollType||"remove",this.boundToAnchor=t.nvl(e.boundToAnchor,!0),this.closeOnAnchorMousedown=t.nvl(e.closeOnAnchorMousedown,!0)},t.Popup.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.Popup.prototype._initKeyStrokeContext=function(){t.Popup.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke(this._createCloseKeyStroke())},t.Popup.prototype._createCloseKeyStroke=function(){return new t.CloseKeyStroke(this)},t.Popup.prototype._createLayout=function(){return new t.PopupLayout(this)},t.Popup.prototype.open=function(t){this._triggerPopupOpenEvent(),this._open(t),this.withFocusContext&&this.session.focusManager.installFocusContext(this.$container,this.initialFocus())},t.Popup.prototype._open=function(t){this.render(t),this.revalidateLayout(),this.position()},t.Popup.prototype.render=function(e){var i=e||this.entryPoint(this.parent.$container);t.Popup.parent.prototype.render.call(this,i)},t.Popup.prototype._render=function(e){this.$container=e.appendDiv("popup"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.validateRoot=!0,this.htmlComp.setLayout(this._createLayout()),this.withFocusContext&&this.focusableContainer&&this.$container.attr("tabindex",-1)},t.Popup.prototype._postRender=function(){t.Popup.parent.prototype._postRender.call(this),this.size(),this._attachCloseHandler(),t.scrollbars.update(this.$body)},t.Popup.prototype._remove=function(){this.withFocusContext&&this.session.focusManager.uninstallFocusContext(this.$container),this._detachCloseHandler(),t.Popup.parent.prototype._remove.call(this)},t.Popup.prototype.close=function(){this.trigger("close"),this.destroy()},t.Popup.prototype._attachCloseHandler=function(){this._mouseDownHandler=this._onMouseDown.bind(this),this.$container.document(!0).addEventListener("mousedown",this._mouseDownHandler,!0),this._popupOpenHandler=this._onPopupOpen.bind(this),this.session.desktop.on("popupopen",this._popupOpenHandler),this.$anchor&&this.boundToAnchor&&this.scrollType&&(this._scrollHandler=this._onAnchorScroll.bind(this),t.scrollbars.onScroll(this.$anchor,this._scrollHandler))},t.Popup.prototype._detachCloseHandler=function(){this._scrollHandler&&(t.scrollbars.offScroll(this._scrollHandler),this._scrollHandler=null),this._popupOpenHandler&&(this.session.desktop.off("popupopen",this._popupOpenHandler),this._popupOpenHandler=null),this._mouseDownHandler&&(this.$container.document(!0).removeEventListener("mousedown",this._mouseDownHandler,!0),this._mouseDownHandler=null)},t.Popup.prototype._onMouseDown=function(t){this.rendered&&this._isMouseDownOutside(t)&&this._onMouseDownOutside(t)},t.Popup.prototype._isMouseDownOutside=function(i){var o,n=e(i.target);return!(!this.closeOnAnchorMousedown&&this.$anchor&&this.$anchor.isOrHas(i.target))&&(o=t.Widget.getWidgetFor(n),!this.isOrHas(o)&&!this.session.focusManager.isElementCovertByGlassPane(this.$container[0]))},t.Popup.prototype._onMouseDownOutside=function(t){this.close()},t.Popup.prototype._onAnchorScroll=function(t){this.rendered&&("position"===this.scrollType?this.position():"layoutAndPosition"===this.scrollType?(this.revalidateLayout(),this.position()):"remove"===this.scrollType&&this.close())},t.Popup.prototype._onPopupOpen=function(t){this.isOrHas(t.popup)||t.popup.isOrHas(this)||this.session.focusManager.isElementCovertByGlassPane(this.$container[0])||this.close()},t.Popup.prototype.prefLocation=function(t,e){var i,o,n,r,s;if(this.boundToAnchor&&(this.anchorBounds||this.$anchor)){s="right",e=e||this.openingDirectionY,t.removeClass("up down left right"),t.addClass(e+" "+s),r=t.outerHeight(!0),n=this.getAnchorBounds(),i=n.x,o=n.y,"up"===e?o-=r:"down"===e&&(o+=n.height);var a=this.$parent.offset();return i-=a.left,o-=a.top,{x:i,y:o}}},t.Popup.prototype.getAnchorBounds=function(){var e=this.anchorBounds;return e||(e=t.graphics.offsetBounds(this.$anchor)),e},t.Popup.prototype.overlap=function(t,e){if(t&&e){var i,o,n=t.outerHeight(),r=t.outerWidth(),s=e.x,a=e.y;return i=s+r+this.windowPaddingX-this.session.$entryPoint.outerWidth(!0),o=a+n+this.windowPaddingY-this.session.$entryPoint.outerHeight(!0),{x:i,y:o}}},t.Popup.prototype.adjustLocation=function(e,i,o){var n,r,s,a=this.overlap(e,i);return o=t.nvl(o,!0),a.y>0&&o&&(n="up",i=this.prefLocation(e,n)),r=i.x,s=i.y,a.x>0&&(r-=a.x),{x:r,y:s}},t.Popup.prototype.size=function(){var e=this.prefSize(this.$container);e&&t.graphics.setSize(this.$container,e)},t.Popup.prototype.prefSize=function(t){return null},t.Popup.prototype.position=function(t){this._validateVisibility(),this._position(this.$container,t)},t.Popup.prototype._position=function(t,e){var i=this.prefLocation(t);i&&(i=this.adjustLocation(t,i,e),this.setLocation(i))},t.Popup.prototype.setLocation=function(t){this.$container.css("left",t.x).css("top",t.y),this._triggerLocationChanged()},t.Popup.prototype._validateVisibility=function(){if(this.boundToAnchor&&this.$anchor){var t=this._isInView(),e=this.$container.isVisible()!==t&&t;this.$container.setVisible(t),e&&this.revalidateLayout()}},t.Popup.prototype._isInView=function(){if(this.boundToAnchor&&this.$anchor){var e=this.getAnchorBounds();return t.scrollbars.isLocationInView(e.center(),this.$anchor.scrollParent())}},t.Popup.prototype._triggerLocationChanged=function(){this.trigger("locationChanged")},t.Popup.prototype._triggerPopupOpenEvent=function(){this.session.desktop.trigger("popupopen",{popup:this})},t.Popup.prototype.belongsTo=function(t){return this.$anchor[0]===t[0]},t.Popup.prototype.isOpen=function(){return this.rendered},t.Popup.prototype.ensureOpen=function(){this.isOpen()||this.open()},t.PopupLayout=function(e){t.PopupLayout.parent.call(this),this.popup=e},t.inherits(t.PopupLayout,t.AbstractLayout),t.PopupLayout.prototype.layout=function(e){var i,o=this.popup.htmlComp,n=this.preferredLayoutSize(e);i=this.popup.boundToAnchor?this._adjustSizeWithAnchor(n):this._adjustSize(n),t.graphics.setSize(o.$comp,i)},t.PopupLayout.prototype._adjustSize=function(e){var i=new t.Dimension,o=this._calcMaxSize();return i.width=Math.min(o.width,e.width),i.height=Math.min(o.height,e.height),i},t.PopupLayout.prototype._calcMaxSize=function(){this.popup.position(!1);var e,i,o=this.popup.htmlComp,n=this.popup.windowPaddingX,r=this.popup.windowPaddingY,s=o.getMargins(),a=o.getBounds(),l=this.popup.$container.window(),h=new t.Dimension(l.width(),l.height());return e=h.width-s.horizontal()-a.x-n,i=h.height-s.vertical()-a.y-r,new t.Dimension(e,i)},t.PopupLayout.prototype._adjustSizeWithAnchor=function(e){var i=new t.Dimension,o=this._calcMaxSizeAroundAnchor();return i.width=e.width,this.popup.trimWidth&&("right"===this.popup.openingDirectionX&&e.width>o.right&&e.width>o.left?i.width=Math.max(o.right,o.left):"left"===this.popup.openingDirectionX&&e.width>o.left&&e.width>o.right&&(i.width=Math.max(o.right,o.left))),i.height=e.height,this.popup.trimHeight&&("down"===this.popup.openingDirectionY&&e.height>o.bottom&&e.height>o.top?i.height=Math.max(o.bottom,o.top):"up"===this.popup.openingDirectionY&&e.height>o.top&&e.height>o.bottom&&(i.height=Math.max(o.bottom,o.top))),i},t.PopupLayout.prototype._calcMaxSizeAroundAnchor=function(){var e,i,o,n,r=this.popup.htmlComp,s=this.popup.windowPaddingX,a=this.popup.windowPaddingY,l=r.getMargins(),h=this.popup.getAnchorBounds(),d=this.popup.$container.window(),p=new t.Dimension(d.width(),d.height());return i=p.width-(h.x+h.width)-l.horizontal()-s,e=h.x-l.horizontal()-s,o=p.height-(h.y+h.height)-l.vertical()-a,n=h.y-l.vertical()-a,new t.Insets(n,i,o,e)},t.PopupWithHead=function(){t.PopupWithHead.parent.call(this),this.$head,this.$body,this.$deco,this.$parent,this._headVisible=!0,this.resizeHandler=this.onResize.bind(this)},t.inherits(t.PopupWithHead,t.Popup),t.PopupWithHead.prototype._createLayout=function(){return new t.PopupWithHeadLayout(this)},t.PopupWithHead.prototype._init=function(e){t.PopupWithHead.parent.prototype._init.call(this,e),this.trimWidth=t.nvl(e.trimWidth,!0)},t.PopupWithHead.prototype._render=function(e){t.PopupWithHead.parent.prototype._render.call(this,e),this.$parent.window().on("resize",this.resizeHandler),this.$body=this._$createNewBody(),this._headVisible&&this._renderHead()},t.PopupWithHead.prototype.onResize=function(){this.rendered&&(this.$parent.window().off("resize",this.resizeHandler),this.close())},t.PopupWithHead.prototype._remove=function(){this.$parent.window().off("resize",this.resizeHandler),t.PopupWithHead.parent.prototype._remove.call(this)},t.PopupWithHead.prototype._$createNewBody=function(){return this.$body=this.$container.appendDiv("popup-body"),this._modifyBody(),this.$body},t.PopupWithHead.prototype.rerenderHead=function(){this._removeHead(),this._renderHead()},t.PopupWithHead.prototype._renderHead=function(){this.$deco=this.$container.makeDiv("popup-deco"),this.$head=this.$container.makeDiv("popup-head menu-item").on("mousedown","",this._onHeadMouseDown.bind(this)),this.$container.prepend(this.$head).append(this.$deco),this.$headBlueprint&&(this.$head.html(this.$headBlueprint.html()),this._modifyHeadChildren())},t.PopupWithHead.prototype._modifyHeadChildren=function(){},t.PopupWithHead.prototype._modifyBody=function(){},t.PopupWithHead.prototype._removeHead=function(){this.$head&&this.$head.remove(),this.$deco&&this.$deco.remove()},t.PopupWithHead.prototype._copyCssClassToHead=function(t){this.$headBlueprint&&this.$headBlueprint.hasClass(t)&&this.$head.addClass(t)},t.PopupWithHead.prototype._onHeadMouseDown=function(t){this.$head&&this.$head.isOrHas(t.target)&&this.close()},t.PopupWithHead.prototype._isMouseDownOutside=function(e){return(!this.$headBlueprint||!this.$headBlueprint.isOrHas(e.target))&&t.PopupWithHead.parent.prototype._isMouseDownOutside.call(this,e)},t.PopupWithHead.prototype.appendToBody=function(t){this.$body.append(t)},t.PopupWithHead.prototype.addClassToBody=function(t){this.$body.addClass(t)},t.PopupWithHead.prototype._position=function(e,i){if(this.$container){var o,n,r,s;if(!this._headVisible)return t.PopupWithHead.parent.prototype._position.call(this,e),this.$body.removeClass("up down left right"),n="up",e.hasClass("down")&&(n="down"),o="right",e.hasClass("left")&&(o="left"),void this.$body.addClass(n+" "+o);if(this._positionImpl(),i=t.nvl(i,!0)){s=e.offset(),r=this.overlap(e,{x:s.left,y:s.top});var a=this.$parent.offset();r.x-=a.left,r.y-=a.top,r.y>0&&(n="up"),r.x>0&&(o="left"),(o||n)&&this._positionImpl(o,n)}}},t.PopupWithHead.prototype._positionImpl=function(i,o){var n,r,s,a,l,h,d,p,u,c,f=0,y=0,g=0;i=i||this.openingDirectionX,o=o||this.openingDirectionY,this.$container.removeClass("up down left right"),this.$body.removeClass("up down left right"),this.$container.addClass(o+" "+i),this.$body.addClass(o+" "+i),this.$head.copyCssIfGreater(this.$headBlueprint,"padding"),this.$head.height(this.$headBlueprint.height()),h=this.$headBlueprint.children(),this.$head.children().each(function(t){var i=e(this),o=h.eq(t);i.copyCss(o,"margin padding line-height border vertical-align font-size display")}),r=t.graphics.getSize(this.$head,!0),s=t.graphics.getSize(this.$body,!0),s.width=Math.max(s.width,r.width),a=s.width,n=this.$headBlueprint.offset();var m=this.$parent.offset();n.left-=m.left,n.top-=m.top,d=n.left,u=t.graphics.getInsets(this.$head),c=t.graphics.getInsets(this.$headBlueprint),p=n.top-u.top+c.top,"up"===o?(p-=s.height,y=f+s.height,g=y-1,this.$container.cssMarginBottom(r.height),this.$container.css("margin-top","")):"down"===o&&(y-=r.height,this.$container.cssMarginTop(r.height),this.$container.css("margin-bottom","")),e.log.debug("bodyWidth="+a+" pos=[left="+n.left+" top="+n.top+"] headSize="+r+" headInsets="+u+" left="+d+" top="+p),this.$head.cssTop(y),this.$body.cssTop(f),this.$deco.cssTop(g),"left"===i?(l=a-r.width,d-=l+u.left-c.left,this.$head.cssLeft(l),this.$body.cssLeft(0),this.$deco.cssLeft(l+this.$head.cssBorderLeftWidth()).width(r.width-this.$head.cssBorderWidthX())):(d=d-u.left+c.left,this.$head.cssLeft(0),this.$deco.cssLeft(1).width(r.width-2)),this.openingDirectionX=i,this.openingDirectionY=o,this.setLocation(new t.Point(d,p)),t.graphics.setSize(this.$head,r),t.graphics.setSize(this.$body,s)},t.PopupWithHeadLayout=function(e){t.PopupWithHeadLayout.parent.call(this,e)},t.inherits(t.PopupWithHeadLayout,t.PopupLayout),t.PopupWithHeadLayout.prototype.layout=function(e){t.PopupWithHeadLayout.parent.prototype.layout.call(this,e);var i=this.popup.htmlComp,o=i.getSize();if(!this.popup.bodyAnimating){if(o=o.subtract(i.getInsets()),this._headVisible){var n=t.graphics.getSize(this.popup.$head,!0);o.width<n.width&&(o.width=n.width,t.graphics.setSize(i.$comp,o))}t.graphics.setSize(this.popup.$body,o)}},t.PopupWithHeadLayout.prototype._calcMaxSizeAroundAnchor=function(){this.popup.position(!1);var e,i,o,n,r=this.popup.htmlComp,s=this.popup.windowPaddingX,a=this.popup.windowPaddingY,l=t.graphics.offsetBounds(r.$comp),h=r.getMargins(),d=new t.Dimension(0,0),p=this.popup.$container.window(),u=new t.Dimension(p.width(),p.height());return this.popup.$head&&(d=t.graphics.getSize(this.popup.$head)),i=u.width-l.x-s,e=l.x+d.width-h.horizontal()-s,o=u.height-l.y-a,n=l.y-h.vertical()-a,new t.Insets(n,i,o,e)},t.PopupWithHeadLayout.prototype.preferredLayoutSize=function(e){var i,o=this.popup.htmlComp;if(this.popup.bodyAnimating)i=t.graphics.getSize(this.popup.$body,!0);else{var n=this.popup.$container.attr("style");this.popup.$container.css({width:"auto",height:"auto"}),i=t.graphics.prefSize(this.popup.$body,{includeMargin:!0}).add(o.getInsets()),this.popup.$container.attr("style",n)}if(this.popup._headVisible){var r=t.graphics.getSize(this.popup.$head,!0);i.width=i.width<r.width?r.width:i.width}return i},t.MobilePopup=function(){t.MobilePopup.parent.call(this),this.widget,this._addAdapterProperties("widget")},t.inherits(t.MobilePopup,t.Popup),t.MobilePopup.prototype._init=function(i){t.MobilePopup.parent.prototype._init.call(this,i);var o={boundToAnchor:!1,windowPaddingX:0,windowPaddingY:0,closable:!0,animateRemoval:!0};e.extend(this,o,i)},t.MobilePopup.prototype._createLayout=function(){return new t.MobilePopupLayout(this)},t.MobilePopup.prototype.prefLocation=function(e,i){var o=this.htmlComp.getPreferredSize(),n=e.window().height(),r=Math.max(n-o.height,0);return new t.Point(0,r)},t.MobilePopup.prototype._render=function(e){this.$container=e.appendDiv("popup mobile-popup"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.validateRoot=!0,this.htmlComp.setLayout(this._createLayout()),this.$header=this.$container.appendDiv("mobile-popup-header"),this.$title=this.$header.appendDiv("title"),this.widget.render(this.$container),this.widget.htmlComp.pixelBasedSizing=!0,this._renderTitle(),this._renderClosable()},t.MobilePopup.prototype._renderClosable=function(){if(this.$container.toggleClass("closable"),this.closable){if(this.$close)return;this.$close=this.$title.afterDiv("closer").on("click",this.close.bind(this))}else{if(!this.$close)return;this.$close.remove(),this.$close=null}},t.MobilePopup.prototype._renderTitle=function(){this.$title.textOrNbsp(this.title)},t.MobilePopupLayout=function(e){t.MobilePopupLayout.parent.call(this,e)},t.inherits(t.MobilePopupLayout,t.PopupLayout),t.MobilePopupLayout.prototype.layout=function(e){t.MobilePopupLayout.parent.prototype.layout.call(this,e);var i=this.popup.htmlComp,o=i.getSize(),n=this.popup.widget.htmlComp,r=0,s=this.popup.$header,a=0;o=o.subtract(i.getInsets()),a=t.graphics.prefSize(s,{includeMargin:!0}),t.graphics.setLocation(s,new t.Point(0,0)),r=o.clone(),r.height-=a.height,n.setLocation(new t.Point(0,a.height)),n.setSize(r.subtract(n.getMargins())),i.layouted||i.$comp.addClassForAnimation("animate-open")},t.MobilePopupLayout.prototype.preferredLayoutSize=function(e){var i=this.popup.$container.window(),o=new t.Dimension(i.width(),i.height());return o},t.TouchPopup=function(){t.TouchPopup.parent.call(this),this._touchField,this._field,this._widget,this._$widgetContainer,this._widgetContainerHtmlComp},t.inherits(t.TouchPopup,t.Popup),t.TouchPopup.TOP_MARGIN=45,t.TouchPopup.prototype._init=function(e){t.TouchPopup.parent.prototype._init.call(this,e),this._touchField=e.field,this._field=this._touchField.clone(this._fieldOverrides()),this._initWidget(e)},t.TouchPopup.prototype._fieldOverrides=function(){return{parent:this,popup:this,labelPosition:t.FormField.LABEL_POSITION_ON_FIELD,statusVisible:!1,embedded:!0,touch:!1}},t.TouchPopup.prototype._initWidget=function(t){},t.TouchPopup.prototype._createLayout=function(){return new t.TouchPopupLayout(this)},t.TouchPopup.prototype.prefLocation=function(e,i){var o=this.htmlComp.getPreferredSize(),n=e.window().width(),r=Math.max(this.windowPaddingX,(n-o.width)/2);return new t.Point(r,t.TouchPopup.TOP_MARGIN)},t.TouchPopup.prototype._render=function(e){this.$container=e.appendDiv("touch-popup"),this._$widgetContainer=this.$container.appendDiv("touch-popup-widget-container"),this._widgetContainerHtmlComp=t.HtmlComponent.install(this._$widgetContainer,this.session),this._widgetContainerHtmlComp.setLayout(new t.SingleLayout),this._field.render(this.$container),this._field.$container.insertBefore(this._$widgetContainer),this._field.$container.addClass("touch-popup-field"),this._widget&&this._widget.render(this._$widgetContainer),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.validateRoot=!0,this.htmlComp.setLayout(this._createLayout())},t.TouchPopupLayout=function(e){t.TouchPopupLayout.parent.call(this,e)},t.inherits(t.TouchPopupLayout,t.PopupLayout),t.TouchPopupLayout.prototype.layout=function(e){t.TouchPopupLayout.parent.prototype.layout.call(this,e);var i=this.popup.htmlComp.getSize(),o=this.popup._field,n=new t.Insets(4,6,5,4),r=o.htmlComp.getPreferredSize().height,s=i.width-n.horizontal(),a=r+n.vertical();o.htmlComp.setBounds(new t.Rectangle(n.left,n.top,s,r)),this.popup._widgetContainerHtmlComp.setBounds(new t.Rectangle(0,a,i.width,i.height-a))},t.TouchPopupLayout.prototype.preferredLayoutSize=function(e){
var i=t.HtmlEnvironment.formColumnWidth,o=15*t.HtmlEnvironment.formRowHeight;return new t.Dimension(i,o)},t.DatePicker=function(){t.DatePicker.parent.call(this),this.preselectedDate,this.selectedDate,this.dateFormat,this.viewDate,this.allowedDates,this.$container,this.$currentBox,this.$scrollable,this._scrollableLeft},t.inherits(t.DatePicker,t.Widget),t.DatePicker.prototype._init=function(e){t.DatePicker.parent.prototype._init.call(this,e),e=e||{},this.dateFormat=e.dateFormat,this.allowedDates=e.allowedDates},t.DatePicker.prototype._render=function(e){this.$container=e.appendDiv("date-picker").on("swipe",this._onSwipe.bind(this)),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.DatePickerLayout(this)),this._$header=this._append$Header(),this._$header.find(".date-picker-left-y, .date-picker-left-m, .date-picker-right-m, .date-picker-right-y").mousedown(this._onNavigationMouseDown.bind(this)),this.$container.appendDiv("date-picker-separator"),this.$scrollable=this.$container.appendDiv("date-picker-scrollable"),this._scrollableTop=this.$scrollable.position().top,this._scrollableLeft=this.$scrollable.position().left,this.$scrollable.css({position:"absolute",left:this._scrollableLeft,top:this._scrollableTop})},t.DatePicker.prototype.preselectDate=function(t,e){this.preselectedDate=t,this.show(t,null,e)},t.DatePicker.prototype.selectDate=function(t,e){this.show(null,t,e)},t.DatePicker.prototype.show=function(e,i,o){var n=0;this.selectedDate=i,this.selectedDate&&(this.preselectedDate=null),e=e||this.selectedDate||new Date,this.viewDate&&(n=t.dates.compareMonths(e,this.viewDate)),this.viewDate=e,this._updateHeader(e);var r=this._build$DateBox();r[0].addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),o&&this.$currentBox&&n?this._appendAnimated(n,r):(this.$currentBox&&this.$currentBox.remove(),r.appendTo(this.$scrollable),this.htmlComp.revalidateLayout()),this.$currentBox=r},t.DatePicker.prototype._appendAnimated=function(t,e){var i=this.$currentBox,o=0,n=this,r=this.$scrollable.find(".date-picker-month").length+1;this.htmlComp.layout._layoutMonth(e),this._boxWidth=e.width();var s=r*this._boxWidth;i.width(this._boxWidth).height(this._boxHeight),e.width(this._boxWidth).height(this._boxHeight),this.$scrollable.width(s),t>0?(e.appendTo(this.$scrollable),o=this._scrollableLeft-(s-this._boxWidth)):(this.$scrollable.cssLeft(this._scrollableLeft-this._boxWidth),e.prependTo(this.$scrollable),o=this._scrollableLeft),this.$scrollable.stop(!0).animate({left:o},300,function(){n.$currentBox.siblings(".date-picker-month").remove(),n.$scrollable.cssLeft(n._scrollableLeft).width(n._boxWidth)})},t.DatePicker.prototype._onNavigationMouseDown=function(t){var i=e(t.currentTarget),o=i.data("shift");this.shiftViewDate(0,o,0)},t.DatePicker.prototype._onDayClick=function(t){var i=e(t.currentTarget),o=i.data("date");this.trigger("dateSelect",{date:o})},t.DatePicker.prototype._onSwipe=function(t){var e=t.swipestop.coords[0]-t.swipestart.coords[0]>=0?-1:1;this.shiftViewDate(0,e,0)},t.DatePicker.prototype._onMouseWheel=function(t){t=t||this.$container.window(!0).event;var e=t.wheelDelta?t.wheelDelta/10:3*-t.detail,i=e>=0?-1:1;this.shiftViewDate(0,i,0),t.preventDefault()},t.DatePicker.prototype.shiftViewDate=function(e,i,o){var n=this.viewDate;n=t.dates.shift(n,e,i,o),this.show(n,null,!0)},t.DatePicker.prototype.shiftSelectedDate=function(e,i,o){var n=this.preselectedDate;this.selectedDate&&(n=this.allowedDates?this._findNextAllowedDate(e,i,o):t.dates.shift(this.selectedDate,e,i,o)),n&&(this.trigger("dateSelect",{date:n,shifting:!0}),this.selectDate(n,!0))},t.DatePicker.prototype._findNextAllowedDate=function(e,i,o){var n,r,s=e+i+o,a=s>0?1:-1,l=this.selectedDate||t.dates.trunc(new Date);if(0!==e?l=t.dates.shift(l,e,0,0):0!==i&&(l=t.dates.shift(l,0,i,0)),1===a){for(n=0;n<this.allowedDates.length;n++)if(r=this.allowedDates[n],t.dates.compare(l,r)<0)return r}else if(a===-1)for(n=this.allowedDates.length-1;n>=0;n--)if(r=this.allowedDates[n],t.dates.compare(l,r)>0)return r;return null};t.DatePicker.prototype._build$DateBox=function(){var e,i,o,n,r,s,a=new Date,l=new Date(this.viewDate),h=this.dateFormat.symbols.weekdaysShortOrdered,d=this.$container.makeDiv("date-picker-month").data("viewDate",this.viewDate);h.forEach(function(t){d.appendDiv("date-picker-weekday",t)});for(var p=0;p<42;p++){l.setDate(l.getDate()-1);var u=new Date(l.getYear(),this.viewDate.getMonth(),0).getDate()-l.getDate();if(0===l.getDay()&&l.getMonth()!==this.viewDate.getMonth()&&u>1)break}for(i=0;i<42;i++)l.setDate(l.getDate()+1),r=l.getDate(),e=6===l.getDay()||0===l.getDay()?l.getMonth()!==this.viewDate.getMonth()?" date-picker-out-weekend":" date-picker-weekend":l.getMonth()!==this.viewDate.getMonth()?" date-picker-out":"",t.dates.isSameDay(l,a)&&(e+=" date-picker-now"),t.dates.isSameDay(l,this.preselectedDate)?e+=" date-picker-preselected":t.dates.isSameDay(l,this.selectedDate)&&(e+=" date-picker-selected"),n=this._isDateAllowed(l),n||(e+=" date-picker-disabled"),o=r<=9?"0"+r:r,s=d.appendDiv("date-picker-day"+e,o).data("dayInMonth",r).data("date",new Date(l)),n&&s.on("click",this._onDayClick.bind(this));return d};t.DatePicker.prototype._isDateAllowed=function(t){if(!this.allowedDates||0===this.allowedDates.length)return!0;var e,i=t.getTime();return this.allowedDates.some(function(t){return e=t.getTime(),e===i})},t.DatePicker.prototype._append$Header=function(){var e='<div class="date-picker-header">  <div class="date-picker-left-y" data-shift="-12"></div>  <div class="date-picker-left-m" data-shift="-1"></div>  <div class="date-picker-right-y" data-shift="12"></div>  <div class="date-picker-right-m" data-shift="1"></div>  <div class="date-picker-header-month"></div></div>';return this.$container.appendElement(e).toggleClass("touch",t.device.supportsTouch())},t.DatePicker.prototype._updateHeader=function(t){this._$header.find(".date-picker-header-month").text(this._createHeaderText(t))},t.DatePicker.prototype._createHeaderText=function(t){var e=this.dateFormat.symbols.months;return e[t.getMonth()]+" "+t.getFullYear()},t.DatePickerLayout=function(e){t.DatePickerLayout.parent.call(this),this._datePicker=e,this._cache={monthWidth:0,cssDaySize:0,dayMarginHoriz:0,dayMarginVert:0,dayPaddingTop:0}},t.inherits(t.DatePickerLayout,t.AbstractLayout),t.DatePickerLayout.COLUMNS=7,t.DatePickerLayout.ROWS=6,t.DatePickerLayout.DAY_SIZE=26,t.DatePickerLayout.prototype.layout=function(e){var i=e.find(".date-picker-header"),o=e.find(".date-picker-scrollable"),n=e.find(".date-picker-month"),r=t.HtmlComponent.get(e),s=r.getSize().subtract(r.getInsets()),a=t.graphics.getSize(i,!0).height+1,l=t.graphics.getInsets(o),h=s.subtract(l),d=s.height-a,p=Math.floor(h.width/t.DatePickerLayout.COLUMNS),u=Math.floor((d-a)/t.DatePickerLayout.ROWS),c=Math.max(0,Math.floor(p-t.DatePickerLayout.DAY_SIZE)/2),f=Math.max(0,Math.floor(u-t.DatePickerLayout.DAY_SIZE)/2),y=p*t.DatePickerLayout.COLUMNS,g=Math.max(0,Math.floor((h.width-y)/2)),m=this._measureDaySize(n),_=new t.Dimension(p-2*c,u-2*f),b=Math.max(0,(_.height-m.height)/2);i.css("padding-left",g+l.left+c).css("padding-right",g+l.right+c),o.cssWidth(y+l.horizontal()).cssHeight(d+l.vertical()).css("margin-left",g),this._cache.monthWidth=y,this._cache.cssDaySize=_,this._cache.dayMarginHoriz=c,this._cache.dayMarginVert=f,this._cache.dayPaddingTop=b,this._layoutMonth(n)},t.DatePickerLayout.prototype._measureDaySize=function(e){var i=e.appendDiv("date-picker-day").text("30"),o=t.graphics.getSize(i);return i.remove(),o},t.DatePickerLayout.prototype._layoutMonth=function(t){var i=this._cache;t.width(i.monthWidth),t.find(".date-picker-weekday, .date-picker-day").each(function(){var t=e(this),o=t.data("dayInMonth");t.hasClass("date-picker-day")?(t.css("margin",i.dayMarginVert+"px "+i.dayMarginHoriz+"px").css("padding-top",i.dayPaddingTop).cssWidth(i.cssDaySize.width).cssHeight(i.cssDaySize.height),o>9&&o<20&&t.css("padding-right",2)):t.css("margin","0 "+i.dayMarginHoriz+"px").cssWidth(i.cssDaySize.width)})},t.DatePickerPopup=function(){t.DatePickerPopup.parent.call(this)},t.inherits(t.DatePickerPopup,t.Popup),t.DatePickerPopup.prototype._init=function(e){e.scrollType=e.scrollType||"layoutAndPosition",e.installFocusContext=!1,t.DatePickerPopup.parent.prototype._init.call(this,e),this.picker=t.create("DatePicker",{parent:this,dateFormat:e.dateFormat,allowedDates:e.allowedDates})},t.DatePickerPopup.prototype._render=function(t){this.picker.render(t),this.$container=this.picker.$container,this.$container.addClass("date-picker-popup"),this.htmlComp=this.picker.htmlComp,this.htmlComp.validateRoot=!0},t.DatePickerPopup.prototype.getDatePicker=function(){return this.picker},t.DatePickerTouchPopup=function(){t.DatePickerTouchPopup.parent.call(this)},t.inherits(t.DatePickerTouchPopup,t.TouchPopup),t.DatePickerTouchPopup.prototype._init=function(e){t.DatePickerTouchPopup.parent.prototype._init.call(this,e),this._field.on("displayTextChanged",this._onFieldDisplayTextChanged.bind(this)),this._field.on("timestampChanged",this._onFieldTimestampChanged.bind(this))},t.DatePickerTouchPopup.prototype._initWidget=function(e){this._widget=t.create("DatePicker",{parent:this,dateFormat:e.dateFormat})},t.DatePickerTouchPopup.prototype.getDatePicker=function(){return this._widget},t.DatePickerTouchPopup.prototype._onFieldDisplayTextChanged=function(t){this._touchField.dateDisplayText=this._field.dateDisplayText,this._touchField.timeDisplayText=this._field.timeDisplayText,this._touchField.setDisplayText(t.displayText)},t.DatePickerTouchPopup.prototype._onFieldTimestampChanged=function(t){this._touchField.timestamp=this._field.timestamp,this._touchField.timestampAsDate=this._field.timestampAsDate},t.menus={CLOSING_EVENTS:"mousedown.contextMenu keydown.contextMenu",filterAccordingToSelection:function(e,i,o,n,r,s,a){var l=[];n===t.MenuDestinations.MENU_BAR?l=[e+".EmptySpace",e+".SingleSelection",e+".MultiSelection"]:n===t.MenuDestinations.CONTEXT_MENU?l=[e+".SingleSelection",e+".MultiSelection"]:n===t.MenuDestinations.HEADER&&(l=[e+".Header"]),l.indexOf(e+".SingleSelection")>-1&&1!==i&&t.arrays.remove(l,e+".SingleSelection"),l.indexOf(e+".MultiSelection")>-1&&i<=1&&t.arrays.remove(l,e+".MultiSelection"),a=t.arrays.ensure(a);var h=[];return e+=".",a.forEach(function(t){t.slice(0,e.length)!==e&&(t=e+t),h.push(t)},this),t.menus.filter(o,l,r,s,h)},filter:function(e,i,o,n,r){if(e){i=t.arrays.ensure(i),r=t.arrays.ensure(r);var s=[],a=0;return e.forEach(function(e){var l=e.childActions;if(l.length>0){if(l=t.menus.filter(l,i,o,n,r),0===l.length)return void t.menus._enableDisableMenuKeyStroke(e,n,!0)}else if(!t.menus._checkType(e,i)||0!==r.length&&t.menus._checkType(e,r))return void t.menus._enableDisableMenuKeyStroke(e,n,!0);return o&&!e.visible?void t.menus._enableDisableMenuKeyStroke(e,n,!0):(e.separator&&a++,t.menus._enableDisableMenuKeyStroke(e,n,!1),void s.push(e))}),a===s.length?[]:s}},checkType:function(e,i){if(i=t.arrays.ensure(i),e.childActions.length>0){var o=t.menus.filter(e.childActions,i);return o.length>0}return t.menus._checkType(e,i)},_enableDisableMenuKeyStroke:function(t,e,i){e&&(t.excludedByFilter=i)},_checkType:function(t,e){if(!e||0===e.length)return!1;if(!t.menuTypes)return!1;for(var i=0;i<e.length;i++)if(t.menuTypes.indexOf(e[i])>-1)return!0},showContextMenuWithWait:function(t,e){function i(){e.apply(this,o)}var o=Array.prototype.slice.call(arguments);o.shift(),o.shift(),t.areRequestsPending()||t.areEventsQueued()?t.listen().done(i):e.apply(this,o)},createEllipsisMenu:function(i){var o={iconId:t.icons.ELLIPSIS_V,tabbable:!1};return i=e.extend({},o,i),t.create("Menu",i)},moveMenuIntoEllipsis:function(t,e){t.remove(),t.overflow=!0,t.overflowMenu=e,e.childActions.unshift(t)},removeMenuFromEllipsis:function(t,e){t.overflow=!1,t.overflowMenu=null,t.rendered||t.render(e)}},t.MenuDestinations={MENU_BAR:1,CONTEXT_MENU:2,HEADER:3},t.Menu=function(){t.Menu.parent.call(this),this._addAdapterProperties("childActions"),this.defaultMenu=!1,this.separator=!1,this.childActions=[],this.menuTypes=[],this.popup,this.excludedByFilter=!1,this.subMenuIconVisible=!0,this.parentMenu,this.overflow=!1,this._addCloneProperties(["defaultMenu","menuTypes","overflow","separator"])},t.inherits(t.Menu,t.Action),t.Menu.prototype._initKeyStrokeContext=function(){t.Menu.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke(new t.MenuExecKeyStroke(this))},t.Menu.prototype._render=function(e){this.separator?this._renderSeparator(e):this._renderItem(e),this.$container.unfocusable(),this.htmlComp=t.HtmlComponent.install(this.$container,this.session)},t.Menu.prototype._remove=function(){t.Menu.parent.prototype._remove.call(this),this.$submenuIcon=null,this.$subMenuBody=null},t.Menu.prototype._renderSeparator=function(t){this.$container=t.appendDiv("menu-separator")},t.Menu.prototype._renderItem=function(t){this.$container=t.appendDiv("menu-item"),this.uiCssClass&&this.$container.addClass(this.uiCssClass);var e=this._onMouseEvent.bind(this);this.$container.on("mousedown",e).on("contextmenu",e).on("click",e),this.childActions.length>0&&this.text&&this.subMenuIconVisible&&(this.$submenuIcon=this.$container.appendSpan("submenu-icon")),this.isButton()&&!this.overflow&&this.$container.addClass("menu-button")},t.Menu.prototype._renderSelected=function(){this._doActionTogglesSubMenu()||t.Menu.parent.prototype._renderSelected.call(this),this.selected?this._doActionTogglesSubMenu()?this._renderSubMenuItems(this,this.childActions):this._doActionTogglesPopup()&&this._openPopup():this._doActionTogglesSubMenu()&&this.rendered?this._removeSubMenuItems(this):(this._closePopup(),this._closeSubMenues())},t.Menu.prototype._closeSubMenues=function(){this.childActions.forEach(function(t){t._doActionTogglesPopup()&&(t._closeSubMenues(),t.setSelected(!1))})},t.Menu.prototype._removeSubMenuItems=function(e){this.parent instanceof t.ContextMenuPopup?this.parent.removeSubMenuItems(e,!0):this.parent instanceof t.Menu&&this.parent._removeSubMenuItems(e)},t.Menu.prototype._renderSubMenuItems=function(e,i){this.parent instanceof t.ContextMenuPopup?this.parent.renderSubMenuItems(e,i,!0):this.parent instanceof t.Menu&&this.parent._renderSubMenuItems(e,i)},t.Menu.prototype._doActionTogglesSubMenu=function(){return this.childActions.length>0&&(this.parent instanceof t.ContextMenuPopup||this.parent instanceof t.Menu)},t.Menu.prototype._getSubMenuLevel=function(){return this.parent instanceof t.ContextMenuPopup?0:t.Menu.parent.prototype._getSubMenuLevel.call(this)+1},t.Menu.prototype._onMouseEvent=function(t){1===t.which&&("mousedown"===t.type&&this._doActionTogglesPopup()?this.doAction():"click"!==t.type&&"contextmenu"!==t.type||this._doActionTogglesPopup()||this.doAction())},t.Menu.prototype._doActionTogglesPopup=function(){return this.childActions.length>0},t.Menu.prototype._renderChildActions=function(){if(t.objects.optProperty(this.popup,"rendered")){var e=this.popup.$container;this.childActions.forEach(function(t){t.render(e)})}},t.Menu.prototype._renderText=function(e){t.Menu.parent.prototype._renderText.call(this,e),this.$submenuIcon&&this.$submenuIcon.appendTo(this.$container),this._updateIconAndTextStyle(),this.invalidateLayoutTree()},t.Menu.prototype._renderIconId=function(){t.Menu.parent.prototype._renderIconId.call(this),this._updateIconAndTextStyle(),this.invalidateLayoutTree()},t.Menu.prototype._renderVisible=function(){t.Menu.parent.prototype._renderVisible.call(this),this.invalidateLayoutTree()},t.Menu.prototype.isTabTarget=function(){return this.enabled&&this.visible&&(this.isButton()||!this.separator)},t.Menu.prototype._updateIconAndTextStyle=function(){var e=t.strings.hasText(this.text)&&this.textVisible,i=!(!e||!this.iconId);this.$container.toggleClass("menu-textandicon",i),this.$container.toggleClass("menu-icononly",!e)},t.Menu.prototype._closePopup=function(){this.popup&&this.popup.close()},t.Menu.prototype._openPopup=function(){this.popup||(this.popup=this._createPopup(),this.popup.open(),this.popup.on("remove",function(t){this.popup=null}.bind(this)),this.popup.on("close",function(t){this.setSelected(!1)}.bind(this)),this.uiCssClass&&this.popup.$container.addClass(this.uiCssClass))},t.Menu.prototype._createPopup=function(e){var i={parent:this,menu:this,ignoreEvent:e,openingDirectionX:this.popupOpeningDirectionX,openingDirectionY:this.popupOpeningDirectionY};return this.parent._filterMenusHandler&&(i.menuFilter=function(e,i,o,n){return this.parent._filterMenusHandler(e,t.MenuDestinations.MENU_BAR,o,n)}.bind(this)),t.create("MenuBarPopup",i)},t.Menu.prototype._createActionKeyStroke=function(){return new t.MenuKeyStroke(this)},t.Menu.prototype.isToggleAction=function(){return this.childActions.length>0||this.toggleAction},t.Menu.prototype.isButton=function(){return t.Action.ActionStyle.BUTTON===this.actionStyle},t.Menu.prototype.setSelected=function(e){e!==this.selected&&(t.Menu.parent.prototype.setSelected.call(this,e),(this._doActionTogglesSubMenu()||this._doActionTogglesPopup())&&this.overflowMenu&&!this.overflowMenu.selected&&this._handleSelectedInEllipsis())},t.Menu.prototype._handleSelectedInEllipsis=function(){this.selected&&this.overflowMenu.setSelected(!0)},t.Menu.prototype.clone=function(e){var i=t.Menu.parent.prototype.clone.call(this,e),o=[];return this.childActions.forEach(function(t){var e=t.clone({parent:i});o.push(e)}),i.childActions=o,i},t.MenuAdapter=function(){t.MenuAdapter.parent.call(this),this._addAdapterProperties("childActions")},t.inherits(t.MenuAdapter,t.ActionAdapter),t.MenuKeyStroke=function(e){t.MenuKeyStroke.parent.call(this,e)},t.inherits(t.MenuKeyStroke,t.ActionKeyStroke),t.MenuKeyStroke.prototype._isEnabled=function(){return!this.field.excludedByFilter&&t.MenuKeyStroke.parent.prototype._isEnabled.call(this)},t.MenuExecKeyStroke=function(e){t.MenuExecKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.SPACE,t.keys.ENTER],this.stopPropagation=!0,this.renderingHints.offset=16,this.renderingHints.$drawingArea=function(t,e){return this.field.$container}.bind(this)},t.inherits(t.MenuExecKeyStroke,t.KeyStroke),t.MenuExecKeyStroke.prototype.handle=function(t){this.field.doAction()},t.MenuItemsOrder=function(t,e){this.session=t,this.objectType=e,this.emptySpaceTypes=["EmptySpace"],this.selectionTypes=["SingleSelection","MultiSelection"]},t.MenuItemsOrder.prototype.order=function(e){var i=[],o=[],n=[],r=[],s=!1,a=!1;return e.forEach(function(e){e.createdBy!==this&&(e.isButton()?i.push(e):1===e.horizontalAlignment?r.push(e):t.menus.checkType(e,this._menuTypes(this.emptySpaceTypes))?(e.visible&&(s=!0),o.push(e)):t.menus.checkType(e,this._menuTypes(this.selectionTypes))&&(e.visible&&(a=!0),n.push(e)))},this),s&&a&&o.push(this._createSeparator()),{left:i.concat(o,n),right:r}},t.MenuItemsOrder.prototype._menuTypes=function(t){var e,i=[];for(t=t||[],e=0;e<t.length;e++)i.push(this.objectType+"."+t[e]);return i},t.MenuItemsOrder.prototype._createSeparator=function(){return t.create("Menu",{parent:this.menuBar,createdBy:this,separator:!0})},t.ContextMenuPopup=function(){t.ContextMenuPopup.parent.call(this),this._headVisible=!1,this.menuItems=[],this.cloneMenuItems=!0},t.inherits(t.ContextMenuPopup,t.PopupWithHead),t.ContextMenuPopup.prototype._init=function(e){e.focusableContainer=!0,e.cloneMenuItems===!1&&this._addAdapterProperties("menuItems"),t.ContextMenuPopup.parent.prototype._init.call(this,e)},t.ContextMenuPopup.prototype._initKeyStrokeContext=function(){t.ContextMenuPopup.parent.prototype._initKeyStrokeContext.call(this),t.menuNavigationKeyStrokes.registerKeyStrokes(this.keyStrokeContext,this,"menu-item")},t.ContextMenuPopup.prototype._createLayout=function(){return new t.ContextMenuPopupLayout(this)},t.ContextMenuPopup.prototype._render=function(e){t.ContextMenuPopup.parent.prototype._render.call(this,e),this._installScrollbars(),this._renderMenuItems()},t.ContextMenuPopup.prototype._installScrollbars=function(){t.scrollbars.install(this.$body,{parent:this,axis:"y"})},t.ContextMenuPopup.prototype._remove=function(){t.scrollbars.uninstall(this.$body,this.session),t.ContextMenuPopup.parent.prototype._remove.call(this)},t.ContextMenuPopup.prototype.removeSubMenuItems=function(e,i){var o=300;this.$body=e.parentMenu.$subMenuBody,this.$body.insertBefore(e.$subMenuBody),e.parentMenu._doActionTogglesSubMenu&&e.parentMenu._doActionTogglesSubMenu();var n=e.$subMenuBody.css("display");e.$subMenuBody.css({width:"auto",height:"auto",display:"none"});var r=this.htmlComp.getBounds(),s=this.htmlComp.getSize();this.revalidateLayout(),this.position(),e.$subMenuBody.css("display",n);var a;if(a=e.$placeHolder.position(),i&&this.rendered){this.bodyAnimating=!0,e.$subMenuBody.css({width:"auto",height:"auto"});var l=this.htmlComp.getSize();e.$subMenuBody.css("box-shadow","none"),this.htmlComp.setBounds(r),"up"!==this.openingDirectionY&&e.$subMenuBody.cssTop(),e.$subMenuBody.cssHeightAnimated(s.height,e.$container.cssHeight(),{duration:o,queue:!1});var h=a.top-this.$body.cssHeight(),d=0-s.height;e.$subMenuBody.cssTopAnimated(d,h,{duration:o,queue:!1,complete:function(){e.$container&&(t.scrollbars.uninstall(e.$subMenuBody,this.session),e.$placeHolder.replaceWith(e.$container),e.$container.toggleClass("expanded",!1),this._updateFirstLastClass(),this.updateNextToSelected("menu-item",e.$container),e.$subMenuBody.detach(),this._installScrollbars(),this.$body.css("box-shadow",""),this.bodyAnimating=!1)}.bind(this)}),this.$body.cssWidthAnimated(s.width,l.width,{duration:o,progress:this.revalidateLayout.bind(this),queue:!1}),l.height!==s.height&&this.$body.cssHeightAnimated(s.height,l.height,{duration:o,queue:!1})}},t.ContextMenuPopup.prototype.renderSubMenuItems=function(e,i,o,n){if(!this.session.desktop.rendered&&!n)return void(this.initialSubMenusToRender={parentMenu:e,menus:i});var r=this.htmlComp.getBounds(),s=this.htmlComp.getSize();e.parentMenu.$subMenuBody=this.$body;var a=this.$body.find(".menu-item");if(a.toggleClass("next-to-selected",!1),e.$subMenuBody)this.$body=e.$subMenuBody;else{var l=e.$container.find(".text").css("padding-left"),h=0;e.iconId&&e.$container.data("$icon").cssWidth()>h&&(h=e.$container.data("$icon").cssWidth()),l&&(l=l.replace("px",""),l=Number(l)),this.$body=this._$createNewBody(),e.$subMenuBody=this.$body,this._renderMenuItems(i,n,Math.max(l,h))}var d=e.$container.prev(),p=e.$container.position();if(e.$placeHolder=e.$container.clone(),d.length?e.$placeHolder.insertAfter(d):e.parentMenu.$subMenuBody.prepend(e.$placeHolder),this.$body.insertAfter(e.parentMenu.$subMenuBody),this.$body.prepend(e.$container),e.$container.toggleClass("expanded"),this.revalidateLayout(),this.position(),this.updateNextToSelected(),o&&this.rendered){var u=300;this.bodyAnimating=!0,e.parentMenu.$subMenuBody.css({width:"auto",height:"auto"});var c=this.htmlComp.getBounds(),f=this.htmlComp.getSize();this.$body.css("box-shadow","none"),this.$body.cssWidthAnimated(s.width,f.width,{duration:u,progress:this.revalidateLayout.bind(this),complete:function(){this.bodyAnimating=!1}.bind(this),queue:!1}),this.$body.cssHeightAnimated(e.$container.cssHeight(),f.height,{duration:u,queue:!1});var y=0-f.height,g=p.top-e.parentMenu.$subMenuBody.cssHeight(),m=0;this.$body.cssTopAnimated(g,y,{duration:u,queue:!1,complete:function(){e.parentMenu.$subMenuBody&&(t.scrollbars.uninstall(e.parentMenu.$subMenuBody,this.session),e.parentMenu.$subMenuBody.detach(),this.$body.cssTop(m),this._installScrollbars(),this._updateFirstLastClass(),this.$body.css("box-shadow",""))}.bind(this)}),s.height!==f.height&&(e.parentMenu.$subMenuBody.cssHeightAnimated(s.height,f.height,{duration:u,queue:!1}),this.$container.cssHeight(s.height,f.height,{duration:u,queue:!1})),"up"===this.openingDirectionY&&(this.$container.cssTopAnimated(r.y,c.y,{duration:u,queue:!1}).css("overflow","visible"),this.$head.cssTopAnimated(s.height,f.height,{duration:u,queue:!1}),this.$deco.cssTopAnimated(s.height-1,f.height-1,{duration:u,queue:!1}))}else n||t.scrollbars.uninstall(e.parentMenu.$subMenuBody,this.session),e.parentMenu.$subMenuBody.detach(),this._installScrollbars(),this._updateFirstLastClass()},t.ContextMenuPopup.prototype._renderMenuItems=function(e,i,o){e=e?e:this._getMenuItems(),this.menuFilter&&(e=this.menuFilter(e,t.MenuDestinations.CONTEXT_MENU)),e&&0!==e.length&&(o=o?o:0,e.forEach(function(t){if(!t.separator){var e=t.parent;this.cloneMenuItems&&!t.cloneOf&&(t=t.cloneAndMirror({parent:this}),this._attachCloneMenuListeners(t)),t.parentMenu||(t.parentMenu=e),t.render(this.$body),this._attachMenuListeners(t),o=this._updateIconAndText(t,o)}},this),this._handleInitialSubMenus(i),this._updateFirstLastClass())},t.ContextMenuPopup.prototype._handleInitialSubMenus=function(t){for(var e;this.initialSubMenusToRender&&!t;)e=this.initialSubMenusToRender,this.initialSubMenusToRender=i,this.renderSubMenuItems(e.parentMenu,e.menus,!1,!0)},t.ContextMenuPopup.prototype._updateIconAndText=function(t,i){return t.iconId&&t.$container.data("$icon").cssWidth()>i?(i=t.$container.data("$icon").cssWidth(),this.$body.children().each(function(o,n){var r=e(n),s=r.data("$icon");s&&s.cssWidth()<i?r.find(".text").css("padding-left",i-s.cssWidth()):n!==t.$container[0]&&r.find(".text").css("padding-left",i)})):i&&!t.iconId?t.$container.find(".text").css("padding-left",i):t.$container.data("$icon")&&t.$container.data("$icon").cssWidth()<i&&t.$container.find(".text").css("padding-left",i-t.$container.data("$icon").cssWidth()),i},t.ContextMenuPopup.prototype._attachMenuListeners=function(t){var e=this._onMenuItemDoAction.bind(this),i=this._onMenuItemPropertyChange.bind(this);t.on("doAction",e),t.on("propertyChange",i),this.one("remove",function(){t.off("doAction",e),t.off("propertyChange",i)})},t.ContextMenuPopup.prototype._attachCloneMenuListeners=function(t){t.on("doAction",this._onCloneMenuDoAction.bind(this)),t.on("propertyChange",this._onCloneMenuPropertyChange.bind(this)),t.childActions.forEach(this._attachCloneMenuListeners.bind(this))},t.ContextMenuPopup.prototype._onCloneMenuDoAction=function(t){var e=t.source;e.cloneOf.doAction()},t.ContextMenuPopup.prototype._onCloneMenuPropertyChange=function(t){if(t.changedProperties.indexOf("selected")!==-1){var e=t.source;e.cloneOf.triggerPropertyChange("selected",t.oldProperties.selected,t.newProperties.selected)}},t.ContextMenuPopup.prototype._modifyBody=function(){this.$body.addClass("context-menu")},t.ContextMenuPopup.prototype.updateMenuItems=function(e){e=t.arrays.ensure(e),t.arrays.equals(this.menuItems,e)||this.close()},t.ContextMenuPopup.prototype._getMenuItems=function(){return this.menuItems},t.ContextMenuPopup.prototype.$menuItems=function(){return this.$body.children(".menu-item")},t.ContextMenuPopup.prototype._updateFirstLastClass=function(t){var i,o;this.$body.children(".menu-item").each(function(){var t=e(this);t.removeClass("context-menu-item-first context-menu-item-last"),t.isVisible()&&(i||(i=t),o=t)}),i&&i.addClass("context-menu-item-first"),o&&o.addClass("context-menu-item-last")},t.ContextMenuPopup.prototype.updateNextToSelected=function(t,e){t=t?t:"menu-item";var i=this.$body.find("."+t);e=e?e:this.$body.find("."+t+".selected"),i.toggleClass("next-to-selected",!1),e.hasClass("selected")&&e.nextAll(":visible").first().toggleClass("next-to-selected",!0)},t.ContextMenuPopup.prototype._onMenuItemDoAction=function(t){this.close()},t.ContextMenuPopup.prototype._onMenuItemPropertyChange=function(t){this.rendered&&(t.changedProperties.indexOf("visible")!==-1&&this._updateFirstLastClass(),this.position())},t.ContextMenuPopupLayout=function(e){t.ContextMenuPopupLayout.parent.call(this,e)},t.inherits(t.ContextMenuPopupLayout,t.PopupWithHeadLayout),t.ContextMenuPopupLayout.prototype.layout=function(e){var i=this.popup.$menuItems();this._resetMaxWidthFor(i),t.ContextMenuPopupLayout.parent.prototype.layout.call(this,e),this._setMaxWidthFor(i)},t.ContextMenuPopupLayout.prototype._resetMaxWidthFor=function(t){t.each(function(t,i){var o=e(i),n=o.data("widget");n&&n.$text&&n.$text.css("max-width","")}.bind(this))},t.ContextMenuPopupLayout.prototype._setMaxWidthFor=function(t){t.each(function(t,i){var o=e(i),n=o.data("widget");if(n&&n.$text){var r=this._calcTextMaxWidth(n);n.$text.cssPxValue("max-width",r)}}.bind(this))},t.ContextMenuPopupLayout.prototype._calcTextMaxWidth=function(t){var e=t.$container.width(),i=t.$container.data("$icon"),o=t.$text,n=t.$submenuIcon,r=e+1;return o&&o.isVisible()&&(r-=o.cssMarginX()),i&&i.isVisible()&&(r-=i.outerWidth(!0)),n&&n.isVisible()&&(r-=n.outerWidth(!0)),r},t.menuNavigationKeyStrokes={registerKeyStrokes:function(e,i,o){e.registerKeyStroke([new t.MenuNavigationUpKeyStroke(i,o),new t.MenuNavigationDownKeyStroke(i,o),new t.MenuNavigationExecKeyStroke(i,o),new t.MenuExecByNumberKeyStroke(i,o),new t.SubCloseKeyStroke(i,o)])},_findMenuItems:function(t,e){return{$all:t.$body.find("."+e),$allVisible:t.$body.find("."+e+":visible"),$selected:t.$body.find("."+e+".selected")}},_changeSelection:function(t,e){0!==e.length&&(e.select(!0).focus(),this.field.updateNextToSelected&&this.field.updateNextToSelected(this._menuItemClass,e),t.length>0&&t.select(!1))}},t.MenuNavigationUpKeyStroke=function(e,i){t.MenuNavigationUpKeyStroke.parent.call(this),this._menuItemClass=i,this.field=e,this.which=[t.keys.UP],this.renderingHints.render=!1},t.inherits(t.MenuNavigationUpKeyStroke,t.KeyStroke),t.MenuNavigationUpKeyStroke.prototype.handle=function(e){var i=t.menuNavigationKeyStrokes._findMenuItems(this.field,this._menuItemClass);i.$selected.length>0?t.menuNavigationKeyStrokes._changeSelection.call(this,i.$selected,i.$selected.prevAll(":visible").first()):t.menuNavigationKeyStrokes._changeSelection.call(this,i.$selected,i.$allVisible.last())},t.MenuNavigationDownKeyStroke=function(e,i){t.MenuNavigationDownKeyStroke.parent.call(this),this._menuItemClass=i,this.field=e,this.which=[t.keys.DOWN],this.renderingHints.render=!1},t.inherits(t.MenuNavigationDownKeyStroke,t.KeyStroke),t.MenuNavigationDownKeyStroke.prototype.handle=function(e){var i=t.menuNavigationKeyStrokes._findMenuItems(this.field,this._menuItemClass);i.$selected.length>0?t.menuNavigationKeyStrokes._changeSelection.call(this,i.$selected,i.$selected.nextAll(":visible").first()):t.menuNavigationKeyStrokes._changeSelection.call(this,i.$selected,i.$allVisible.first())},t.MenuNavigationExecKeyStroke=function(e,i){t.MenuNavigationExecKeyStroke.parent.call(this),this._menuItemClass=i,this.field=e,this.stopImmediatePropagation=!0,this.which=[t.keys.ENTER,t.keys.SPACE],this.renderingHints.render=!1},t.inherits(t.MenuNavigationExecKeyStroke,t.KeyStroke),t.MenuNavigationExecKeyStroke.prototype.handle=function(e){this._simulateLeftClickOnItems(t.menuNavigationKeyStrokes._findMenuItems(this.field,this._menuItemClass).$selected)},t.MenuNavigationExecKeyStroke.prototype._accept=function(e){var i=t.MenuNavigationExecKeyStroke.parent.prototype._accept.call(this,e);return!(!i||this.field.bodyAnimating)&&i},t.MenuNavigationExecKeyStroke.prototype._simulateLeftClickOnItems=function(t){["mousedown","mouseup","click"].forEach(function(e){t.trigger({type:e,which:1})})},t.SubCloseKeyStroke=function(e,i){t.SubCloseKeyStroke.parent.call(this,e,i),this._menuItemClass=i,this.field=e,this.which=[t.keys.BACKSPACE],this.renderingHints.render=!0,this.renderingHints.$drawingArea=function(t,e){return e._$element}.bind(this)},t.inherits(t.SubCloseKeyStroke,t.MenuNavigationExecKeyStroke),t.SubCloseKeyStroke.prototype._accept=function(e){var i=t.MenuExecByNumberKeyStroke.parent.prototype._accept.call(this,e);if(!i)return!1;var o=t.menuNavigationKeyStrokes._findMenuItems(this.field,this._menuItemClass+".expanded");return o.$all.length>0&&(e._$element=o.$all,!0)},t.SubCloseKeyStroke.prototype.handle=function(t){t._$element&&this._simulateLeftClickOnItems(t._$element)},t.MenuExecByNumberKeyStroke=function(e,i){t.MenuExecByNumberKeyStroke.parent.call(this,e,i),this._menuItemClass=i,this.field=e,this.which=[t.keys[1],t.keys[2],t.keys[3],t.keys[4],t.keys[5],t.keys[6],t.keys[7],t.keys[8],t.keys[9]],
this.renderingHints.render=!0,this.renderingHints.hAlign=t.hAlign.RIGHT,this.renderingHints.$drawingArea=function(t,e){return e._$element}.bind(this)},t.inherits(t.MenuExecByNumberKeyStroke,t.MenuNavigationExecKeyStroke),t.MenuExecByNumberKeyStroke.prototype._accept=function(e){var i=t.MenuExecByNumberKeyStroke.parent.prototype._accept.call(this,e);if(!i)return!1;var o=t.menuNavigationKeyStrokes._findMenuItems(this.field,this._menuItemClass),n=t.codesToKeys[e.which];return e._$element=o.$allVisible.eq(n-1),!!e._$element},t.MenuExecByNumberKeyStroke.prototype.handle=function(t){t._$element&&this._simulateLeftClickOnItems(t._$element)},t.ButtonAdapterMenu=function(){t.ButtonAdapterMenu.parent.call(this),this._removeAdapterProperties("childActions"),this._buttonPropertyChangeHandler=this._onButtonPropertyChange.bind(this),this._buttonDestroyHandler=this._onButtonDestroy.bind(this),this._addCloneProperties(["button"])},t.inherits(t.ButtonAdapterMenu,t.Menu),t.ButtonAdapterMenu.prototype._init=function(e){if(t.ButtonAdapterMenu.parent.prototype._init.call(this,e),!this.button)throw new Error("Cannot adapt to undefined button");this.button.adaptedBy=this,this._installListeners()},t.ButtonAdapterMenu.prototype.destroy=function(){t.ButtonAdapterMenu.parent.prototype.destroy.call(this),delete this.button.adaptedBy},t.ButtonAdapterMenu.prototype._installListeners=function(){this.button.on("propertyChange",this._buttonPropertyChangeHandler),this.button.on("destroy",this._buttonDestroyHandler)},t.ButtonAdapterMenu.prototype._uninstallListeners=function(){this.button.off("propertyChange",this._buttonPropertyChangeHandler),this.button.off("destroy",this._buttonDestroyHandler)},t.ButtonAdapterMenu.prototype._render=function(e){t.ButtonAdapterMenu.parent.prototype._render.call(this,e),this.$container.attr("data-buttonadapter",this.button.id)},t.ButtonAdapterMenu.prototype._onButtonPropertyChange=function(e){var i={};e.changedProperties.forEach(function(t){i[t]=e.newProperties[t]}),i=t.ButtonAdapterMenu.adaptButtonProperties(i);for(var o in i)this.setProperty(o,i[o])},t.ButtonAdapterMenu.prototype._onButtonDestroy=function(t){this.destroy(),this._uninstallListeners()},t.ButtonAdapterMenu.prototype.doAction=function(e){if(this.childActions.length>0)return t.ButtonAdapterMenu.parent.prototype.doAction.call(this,e);var i=this.button.doAction();return i&&this.isToggleAction()&&this.rendered&&this.setSelected(!this.selected),i},t.ButtonAdapterMenu.prototype.getFocusableElement=function(){return this.rendered?this.$container[0]:null},t.ButtonAdapterMenu.adaptButtonProperties=function(e,o){function n(e){return e===i?i:e===t.Button.DisplayStyle.LINK?t.Action.ActionStyle.DEFAULT:t.Action.ActionStyle.BUTTON}o=o||{},["enabled","visible","selected","tooltipText","keyStroke","keyStrokes","modelClass","classId"].forEach(function(t){o[t]=e[t]}),o.text=e.label,o.horizontalAlignment=e.gridData?e.gridData.horizontalAlignment:i,o.actionStyle=n(e.displayStyle),o.toggleAction=e.displayStyle===t.Button.DisplayStyle.TOGGLE,o.childActions=e.menus;for(var r in o)o[r]===i&&delete o[r];return o},t.MenuBox=function(e){t.MenuBox.parent.call(this),this.horizontalAlignment=1,this.compact=!1,this.menus=[],this._addAdapterProperties("menus")},t.inherits(t.MenuBox,t.Widget),t.MenuBox.prototype._init=function(e){t.MenuBox.parent.prototype._init.call(this,e),this.menus=e.menus||[],this.uiMenuCssClass=e.uiMenuCssClass||"",this.uiMenuCssClass+=" menu-box-item",this._initMenus(this.menus)},t.MenuBox.prototype._initMenus=function(t){t.forEach(this._initMenu.bind(this))},t.MenuBox.prototype._initMenu=function(t){t.uiCssClass=this.uiMenuCssClass},t.MenuBox.prototype._render=function(e){this.$container=e.appendDiv("menu-box"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.MenuBoxLayout(this))},t.MenuBox.prototype._renderProperties=function(){t.MenuBox.parent.prototype._renderProperties.call(this),this._renderMenus(),this._renderCompact()},t.MenuBox.prototype._renderMenus=function(){this.menus.forEach(function(t){t.render(this.$container)},this),this.invalidateLayoutTree()},t.MenuBox.prototype._removeMenus=function(){this.menus.forEach(function(t){t.remove()}),this.invalidateLayoutTree()},t.MenuBox.prototype._renderCompact=function(){this.$container.toggleClass("compact",this.compact),this.invalidateLayoutTree()},t.MenuBox.prototype.setCompact=function(t){this.setProperty("compact",t)},t.MenuBox.prototype.setMenus=function(t){this.setProperty("menus",t)},t.MenuBox.prototype.setHorizontalAlignment=function(t){this.setProperty("horizontalAlignment",t)},t.MenuBox.prototype._renderHorizontalAlignment=function(){this.invalidateLayoutTree()},t.MenuBoxLayout=function(e){t.MenuBoxLayout.parent.call(this),this.menuBox=e,this.firstMenu=null,this.lastMenu=null},t.inherits(t.MenuBoxLayout,t.AbstractLayout),t.MenuBoxLayout.prototype.layout=function(t){var e=this.menuBox.htmlComp,i=e.getSize(),o=this.visibleMenus(),n=0;this.menuBox.session.layoutValidator.schedulePostValidateFunction(function(){o.forEach(function(t){t.popup&&t.popup.position()})}),this.updateFirstAndLastMenuMarker(o),this.undoCollapse(o),this.undoCompact(o),this.undoShrink(o),n=this.actualPrefSize(o).width,n<=i.width||(this.compact(o),n=this.actualPrefSize(o).width,n<=i.width||(this.shrink(o),n=this.actualPrefSize(o).width,n<=i.width||this.collapse(o,i,n)))},t.MenuBoxLayout.prototype.preferredLayoutSize=function(t){var e=this.visibleMenus();return this.updateFirstAndLastMenuMarker(e),this.undoCollapse(e),this.undoCompact(e),this.undoShrink(e),this.actualPrefSize()},t.MenuBoxLayout.prototype.compact=function(t){this.menuBox.compactOrig===i&&(this.menuBox.compactOrig=this.compact,this.menuBox.htmlComp.suppressInvalidate=!0,this.menuBox.setCompact(!0),this.menuBox.htmlComp.suppressInvalidate=!1),this.compactMenus(t)},t.MenuBoxLayout.prototype.undoCompact=function(t){this.menuBox.compactOrig!==i&&(this.menuBox.htmlComp.suppressInvalidate=!0,this.menuBox.setCompact(this.compactOrig),this.menuBox.htmlComp.suppressInvalidate=!1,this.menuBox.compactOrig=i),this.undoCompactMenus(t)},t.MenuBoxLayout.prototype.compactMenus=function(t){t=t||this.visibleMenus(),t.forEach(function(t){t.compactOrig===i&&(t.compactOrig=t.compact,t.htmlComp.suppressInvalidate=!0,t.setCompact(!0),t.htmlComp.suppressInvalidate=!1)},this),this._ellipsis&&this._ellipsis.setCompact(!0)},t.MenuBoxLayout.prototype.undoCompactMenus=function(t){t=t||this.visibleMenus(),t.forEach(function(t){t.compactOrig!==i&&(t.htmlComp.suppressInvalidate=!0,t.setCompact(t.compactOrig),t.htmlComp.suppressInvalidate=!1,t.compactOrig=i)},this),this._ellipsis&&this._ellipsis.setCompact(!1)},t.MenuBoxLayout.prototype.shrink=function(t){this.shrinkMenus(t)},t.MenuBoxLayout.prototype.shrinkMenus=function(t){t=t||this.visibleMenus(),t.forEach(function(t){t.textVisibleOrig===i&&t.iconId&&(t.textVisibleOrig=t.textVisible,t.htmlComp.suppressInvalidate=!0,t.setTextVisible(!1),t.htmlComp.suppressInvalidate=!1)},this)},t.MenuBoxLayout.prototype.undoShrink=function(t){this.undoShrinkMenus(t)},t.MenuBoxLayout.prototype.undoShrinkMenus=function(t){t=t||this.visibleMenus(),t.forEach(function(t){t.textVisibleOrig!==i&&(t.htmlComp.suppressInvalidate=!0,t.setTextVisible(t.textVisibleOrig),t.htmlComp.suppressInvalidate=!1,t.textVisibleOrig=i)},this)},t.MenuBoxLayout.prototype.collapse=function(t,e,i){this._createAndRenderEllipsis(this.menuBox.$container);var o=this._moveOverflowMenusIntoEllipsis(e,i);this.updateFirstAndLastMenuMarker(o)},t.MenuBoxLayout.prototype.undoCollapse=function(t){t=t||this.visibleMenus(),this._destroyEllipsis(),this._removeMenusFromEllipsis(t,this.menuBox.$container)},t.MenuBoxLayout.prototype._createAndRenderEllipsis=function(e){var i=t.menus.createEllipsisMenu({parent:this.menuBox,horizontalAlignment:1,compact:this.menuBox.compact});i.uiCssClass=this.menuBox.uiMenuCssClass,i.render(e),this._ellipsis=i},t.MenuBoxLayout.prototype._destroyEllipsis=function(){this._ellipsis&&(this._ellipsis.destroy(),this._ellipsis=null)},t.MenuBoxLayout.prototype._moveOverflowMenusIntoEllipsis=function(e,i){var o=[this._ellipsis],n=t.graphics.getSize(this._ellipsis.$container,!0);return i+=n.width,this.visibleMenus().slice().reverse().forEach(function(n){var r;i>e.width?(r=t.graphics.getSize(n.$container,!0),i-=r.width,t.menus.moveMenuIntoEllipsis(n,this._ellipsis)):o.unshift(n)},this),o},t.MenuBoxLayout.prototype._removeMenusFromEllipsis=function(e){e=e||this.visibleMenus(),e.forEach(function(e){t.menus.removeMenuFromEllipsis(e,this.menuBox.$container)},this)},t.MenuBoxLayout.prototype.actualPrefSize=function(e){var i,o;return e=e||this.visibleMenus(),i=this._menusWidth(e),o=t.graphics.prefSize(this.menuBox.$container,{includeMargin:!0,useCssSize:!0}),o.width=i+this.menuBox.htmlComp.getInsets().horizontal(),o},t.MenuBoxLayout.prototype._menusWidth=function(t){var e=0;return t=t||this.visibleMenus(),t.forEach(function(t){t.rendered&&(e+=t.$container.outerWidth(!0))},this),this._ellipsis&&(e+=this._ellipsis.$container.outerWidth(!0)),e},t.MenuBoxLayout.prototype.compactPrefSize=function(t){return t=t||this.visibleMenus(),this.updateFirstAndLastMenuMarker(t),this.undoCollapse(t),this.undoShrink(t),this.compact(t),this.actualPrefSize()},t.MenuBoxLayout.prototype.shrinkPrefSize=function(t){return t=t||this.visibleMenus(),this.updateFirstAndLastMenuMarker(t),this.undoCollapse(t),this.compact(t),this.shrink(t),this.actualPrefSize()},t.MenuBoxLayout.prototype.visibleMenus=function(){return this.menuBox.menus.filter(function(t){return t.visible},this)},t.MenuBoxLayout.prototype.updateFirstAndLastMenuMarker=function(t){var e=null,i=null;(t||[]).forEach(function(t){t.rendered&&(e||(e=t),i=t)}),e===this.firstMenu&&i===this.lastMenu||(this.firstMenu&&this.firstMenu.rendered&&this.firstMenu.$container.removeClass("first"),this.lastMenu&&this.lastMenu.rendered&&this.lastMenu.$container.removeClass("last"),this.firstMenu=e,this.lastMenu=i,this.firstMenu&&this.firstMenu.$container.addClass("first"),this.lastMenu&&this.lastMenu.$container.addClass("last"))},t.MenuBar=function(){t.MenuBar.parent.call(this),this.menuSorter,this.position="top",this.size="small",this.tabbable=!0,this._internalMenuItems=[],this.menuItems=[],this._orderedMenuItems={left:[],right:[]},this.defaultMenu=null,this.visible=!1,this.ellipsis,this.visibleMenuItems=[],this._menuItemPropertyChangeListener=function(t){t.changedProperties.length>0&&(1===t.changedProperties.length&&"enabled"===t.changedProperties[0]?this.updateDefaultMenu():t.changedProperties.indexOf("visible")>-1&&(this.updateVisibility(),this.invalidateLayoutTree()))}.bind(this)},t.inherits(t.MenuBar,t.Widget),t.MenuBar.prototype._init=function(e){t.MenuBar.parent.prototype._init.call(this,e),this.menuSorter=e.menuOrder,this.menuSorter.menuBar=this,this.menuFilter=e.menuFilter,this.updateVisibility()},t.MenuBar.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.MenuBar.prototype._initKeyStrokeContext=function(){t.MenuBar.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke([new t.MenuBarLeftKeyStroke(this),new t.MenuBarRightKeyStroke(this)])},t.MenuBar.prototype._render=function(e){this.$container=e.makeDiv("menubar").toggleClass("main-menubar","large"===this.size),this.$left=this.$container.appendDiv("menubox left"),t.HtmlComponent.install(this.$left,this.session),this.$right=this.$container.appendDiv("menubox right"),t.HtmlComponent.install(this.$right,this.session),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.MenuBarLayout(this)),"top"===this.position?e.prepend(this.$container):(this.$container.addClass("bottom"),e.append(this.$container)),this.rebuildItemsInternal()},t.MenuBar.prototype._remove=function(){t.MenuBar.parent.prototype._remove.call(this),this._removeMenuItems(),this.visibleMenuItems=[],this.visible=!1},t.MenuBar.prototype._renderVisible=function(){this.$container.setVisible(this.visible),this.invalidateLayoutTree()},t.MenuBar.prototype.bottom=function(){this.position="bottom"},t.MenuBar.prototype.top=function(){this.position="top"},t.MenuBar.prototype.large=function(){this.size="large"},t.MenuBar.prototype._destroyMenuSorterSeparators=function(){this.menuItems.forEach(function(t){t.createdBy===this.menuSorter&&t.destroy()},this)},t.MenuBar.prototype.rebuildItems=function(t){this.htmlComp.revalidateLayout()},t.MenuBar.prototype.rebuildItemsInternal=function(){this._updateItems()},t.MenuBar.prototype.setMenuItems=function(e){e=t.arrays.ensure(e);var i=t.arrays.equals(this._internalMenuItems,e);if(i||(this.rendered&&this._removeMenuItems(),this._destroyMenuSorterSeparators(),this._internalMenuItems=e,this._orderedMenuItems=this.menuSorter.order(e,this),this.menuItems=this._orderedMenuItems.left.concat(this._orderedMenuItems.right),this.link(e)),this.rendered){var o=this.menuItems.some(function(t){return!t.rendered});!i||o?this.rebuildItems():(this.updateVisibility(),this.updateDefaultMenu(),this.updateLastItemMarker(),this.updateLeftOfButtonMarker())}},t.MenuBar.prototype._updateItems=function(){this._removeMenuItems(),this.visibleMenuItems=this.menuItems,this.updateVisibility(),this._renderMenuItems(this._orderedMenuItems.left,!1),this._renderMenuItems(this._orderedMenuItems.right,!0),this.updateDefaultMenu(),this.updateLastItemMarker(),this.updateLeftOfButtonMarker(),this.defaultMenu&&this.defaultMenu.enabled||!this.tabbable||this.menuItems.some(function(t){return!!t.isTabTarget()&&(this.setTabbableMenu(t),!0)}.bind(this))},t.MenuBar.prototype.setTabbableMenu=function(t){this.tabbable&&t!==this.tabbableMenu&&(this.tabbableMenu&&this.tabbableMenu.setTabbable(!1),t.setTabbable(!0),this.tabbableMenu=t)},t.MenuBar.prototype.updateLastItemMarker=function(){this._lastVisibleItem&&this._lastVisibleItem.rendered&&this._lastVisibleItem.$container.removeClass("last"),this._lastVisibleItem=null;var t=function(t){t.visible&&(this._lastVisibleItem=t)}.bind(this);this._orderedMenuItems.left.forEach(t),this._orderedMenuItems.right.forEach(t),this._lastVisibleItem&&this._lastVisibleItem.rendered&&this._lastVisibleItem.$container.addClass("last")},t.MenuBar.prototype.updateVisibility=function(){this.setVisible(!this.hiddenByUi&&this.menuItems.some(function(t){return t.visible}))},t.MenuBar.prototype.updateDefaultMenu=function(){if(this.setDefaultMenu(null),this._orderedMenuItems){var t=this._updateDefaultMenuInItems(this._orderedMenuItems.right);t||this._updateDefaultMenuInItems(this._orderedMenuItems.left)}},t.MenuBar.prototype._updateDefaultMenuInItems=function(t){var e=!1;return t.some(function(t){if(t.visible&&t.enabled&&this._isDefaultKeyStroke(t.actionKeyStroke))return this.setDefaultMenu(t),this.setTabbableMenu(t),e=!0,!0}.bind(this)),e},t.MenuBar.prototype.setDefaultMenu=function(t){this.defaultMenu!==t&&(this.defaultMenu&&this.defaultMenu.rendered&&this.defaultMenu.$container.removeClass("default-menu"),this._setProperty("defaultMenu",t),this.defaultMenu&&this.defaultMenu.rendered&&this.defaultMenu.$container.addClass("default-menu"))},t.MenuBar.prototype.updateLeftOfButtonMarker=function(){this._updateLeftOfButtonMarker(this._orderedMenuItems.left),this._updateLeftOfButtonMarker(this._orderedMenuItems.right)},t.MenuBar.prototype._updateLeftOfButtonMarker=function(t){var e,i;t=t.filter(function(t){return t.visible&&t.rendered});for(var o=0;o<t.length;o++)e=t[o],e.$container.removeClass("left-of-button"),o>0&&e.isButton()&&(i=t[o-1],i.$container.addClass("left-of-button"))},t.MenuBar.prototype._isDefaultKeyStroke=function(e){return t.isOneOf(t.keys.ENTER,e.which)&&!e.ctrl&&!e.alt&&!e.shift},t.MenuBar.prototype._renderMenuItems=function(t,e){var o="top"===this.position?"bottom":"top";t.forEach(function(t){t.setTabbable(!1),this.tabbableMenu===t&&(this.tabbableMenu=i),t.tooltipPosition=o,t.render(e?this.$right:this.$left),t.$container.addClass("menubar-item"),e&&(t.rightAligned=!0),t.on("propertyChange",this._menuItemPropertyChangeListener)}.bind(this))},t.MenuBar.prototype._removeMenuItems=function(){this.menuItems.forEach(function(t){t.off("propertyChange",this._menuItemPropertyChangeListener),t.overflow=!1,t.remove()},this)},t.MenuBarLayout=function(e){t.MenuBarLayout.parent.call(this),this._menuBar=e},t.inherits(t.MenuBarLayout,t.AbstractLayout),t.MenuBarLayout.prototype.layout=function(e){this._destroyEllipsis(),this._menuBar.rebuildItemsInternal();var i=e.attr("style");e.css("overflow","hidden"),e.css("display","inline-block");var o=e.width();e.attrOrRemove("style",i);var n=this._menuBar.$left.width(),r=this._menuBar.$right.width();if(n+r<=o+1)this._menuBar.visibleMenuItems=this._menuBar.menuItems;else{this._createAndRenderEllipsis(this._menuBar.$left,0===r);var s=t.graphics.getSize(this._menuBar.ellipsis.$container,!0),a=Math.min(o-r,n),l=[],h=!1,d=null;this._menuBar.menuItems.forEach(function(e){if(e.visible)if(e.rightAligned)l.push(e);else{var i=t.graphics.getSize(e.$container,!0);a-=i.width,h||a<0?(h||(h=!0,d&&a+i.width-s.width<0&&this._removeMenuItem(d)),this._removeMenuItem(e)):l.push(e),d=e}},this),this._addEllipsisToMenuItems(l),this._menuBar.visibleMenuItems=l}this._menuBar.visibleMenuItems.forEach(function(t){t.popup&&t.popup.position()})},t.MenuBarLayout.prototype._removeMenuItem=function(t){t.remove(),t.overflow=!0,this._menuBar.ellipsis.childActions.push(t)};t.MenuBarLayout.prototype._addEllipsisToMenuItems=function(e){var i=0;e.some(function(t,e){return!!t.rightAligned||(i=e+1,!1)}),t.arrays.insert(e,this._menuBar.ellipsis,i)};t.MenuBarLayout.prototype._createAndRenderEllipsis=function(e,i){var o=t.create("Menu",{parent:this._menuBar,horizontalAlignment:1,iconId:t.icons.ELLIPSIS_V,tabbable:!1});o.render(e),i&&o.$container.addClass("last"),this._menuBar.ellipsis=o},t.MenuBarLayout.prototype._destroyEllipsis=function(){this._menuBar.ellipsis&&(this._menuBar.ellipsis.destroy(),this._menuBar.ellipsis=null)},t.MenuBarLayout.prototype.preferredLayoutSize=function(e){return t.graphics.prefSize(e,{useCssSize:!0})},t.MenuBarLayout.size=function(t,e){var i=t.getPreferredSize();return i.width=e.width,i=i.subtract(t.getMargins())},t.MenuBarLeftKeyStroke=function(e){t.MenuBarLeftKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.LEFT],this.renderingHints.render=!1,this.stopPropagation=!0,this.keyStrokeMode=t.KeyStrokeMode.DOWN},t.inherits(t.MenuBarLeftKeyStroke,t.KeyStroke),t.MenuBarLeftKeyStroke.prototype.handle=function(t){var e,i,o,n=this.field.visibleMenuItems,r=this.field.$container.find(":focus");for(e=0;e<n.length;e++){if(i=n[e],r[0]===i.$container[0]){o&&(this.field.setTabbableMenu(o),this.field.session.focusManager.requestFocus(o.$container));break}i.isTabTarget()&&(o=i)}},t.MenuBarRightKeyStroke=function(e){t.MenuBarRightKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.RIGHT],this.renderingHints.render=!1,this.stopPropagation=!0,this.keyStrokeMode=t.KeyStrokeMode.DOWN},t.inherits(t.MenuBarRightKeyStroke,t.KeyStroke),t.MenuBarRightKeyStroke.prototype.handle=function(t){var e,i,o=this.field.visibleMenuItems,n=this.field.$container.find(":focus"),r=!1;for(e=0;e<o.length;e++){if(i=o[e],r&&i.isTabTarget()){this.field.setTabbableMenu(i),this.field.session.focusManager.requestFocus(i.$container);break}n[0]===i.$container[0]&&(r=!0)}},t.MenuBarPopup=function(){t.MenuBarPopup.parent.call(this),this.menu,this.$headBlueprint,this.ignoreEvent,this._headVisible=!0},t.inherits(t.MenuBarPopup,t.ContextMenuPopup),t.MenuBarPopup.prototype._init=function(e){e.$anchor=e.menu.$container,t.MenuBarPopup.parent.prototype._init.call(this,e),this.menu=e.menu,this.$headBlueprint=this.menu.$container,this.ignoreEvent=e.ignoreEvent},t.MenuBarPopup.prototype._getMenuItems=function(){return this.menu.childActions||this.menu.menus},t.MenuBarPopup.prototype.close=function(e){e&&this.ignoreEvent&&e.originalEvent===this.ignoreEvent.originalEvent||t.MenuBarPopup.parent.prototype.close.call(this,e)},t.MenuBarPopup.prototype._renderHead=function(){t.MenuBarPopup.parent.prototype._renderHead.call(this),this.menu.$container.parent().hasClass("main-menubar")&&this.$head.addClass("in-main-menubar"),this.menu.uiCssClass&&this._copyCssClassToHead(this.menu.uiCssClass),this._copyCssClassToHead("unfocusable"),this._copyCssClassToHead("button")},t.Calendar=function(){t.Calendar.parent.call(this),this.$container,this.$header,this.$range,this.$modes,this.$grid,this.$list,this.$progress,this._showYearPanel=!1,this._showListPanel=!1,this._exactRange,this._listComponents=[],this._addAdapterProperties(["components","menus","selectedComponent"])},t.inherits(t.Calendar,t.Widget),t.Calendar.prototype.init=function(e,i,o){t.Calendar.parent.prototype.init.call(this,e,i,o),this._tooltipSupport=new t.TooltipSupport({parent:this,htmlEnabled:!0})},t.Calendar.DisplayMode={DAY:1,WEEK:2,MONTH:3,WORK_WEEK:4},t.Calendar.Direction={BACKWARD:-1,FORWARD:1},t.Calendar.prototype._isDay=function(){return this.displayMode===t.Calendar.DisplayMode.DAY},t.Calendar.prototype._isWeek=function(){return this.displayMode===t.Calendar.DisplayMode.WEEK},t.Calendar.prototype._isMonth=function(){return this.displayMode===t.Calendar.DisplayMode.MONTH},t.Calendar.prototype._isWorkWeek=function(){return this.displayMode===t.Calendar.DisplayMode.WORK_WEEK},t.Calendar.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.Calendar.prototype._init=function(e){t.Calendar.parent.prototype._init.call(this,e),this._yearPanel=t.create("YearPanel",{parent:this}),this._yearPanel.on("dateSelect",this._onYearPanelDateSelect.bind(this)),this._syncSelectedDate(e.selectedDate),this._syncDisplayMode(e.displayMode),this._exactRange=this._calcExactRange(),this._yearPanel.setViewRange(this._exactRange),this.viewRange=this._calcViewRange()},t.Calendar.prototype._syncSelectedDate=function(e){e=t.dates.ensure(e),this._setProperty("selectedDate",e),this._yearPanel.selectDate(this.selectedDate)},t.Calendar.prototype._syncDisplayMode=function(t){this._setProperty("displayMode",t),this._yearPanel.setDisplayMode(this.displayMode)},t.Calendar.prototype._syncViewRange=function(e){e=t.DateRange.ensure(e),this._setProperty("viewRange",e)},t.Calendar.prototype._syncMenus=function(t){this._setProperty("menus",t),e.log.debug("(Calendar#_syncMenus) impl.")},t.Calendar.prototype._render=function(i){this.$container=i.appendDiv("calendar");var o=new t.CalendarLayout(this);this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(o),this.htmlComp.pixelBasedSizing=!1,this.$header=this.$container.appendDiv("calendar-header"),this._yearPanel.render(this.$container),this.$grid=this.$container.appendDiv("calendar-grid"),this.$list=this.$container.appendDiv("calendar-list-container").appendDiv("calendar-list"),this.$listTitle=this.$list.appendDiv("calendar-list-title"),this.$range=this.$header.appendDiv("calendar-range"),this.$range.appendDiv("calendar-previous").click(this._onClickPrevious.bind(this)),this.$range.appendDiv("calendar-today",this.session.text("ui.CalendarToday")).click(this._onClickToday.bind(this)),this.$range.appendDiv("calendar-next").click(this._onClickNext.bind(this)),this.$range.appendDiv("calendar-select"),this.$progress=this.$header.appendDiv("busyindicator-label"),this.$commands=this.$header.appendDiv("calendar-commands"),this.$commands.appendDiv("calendar-mode first",this.session.text("ui.CalendarDay")).attr("data-mode",t.Calendar.DisplayMode.DAY).click(this._onClickDisplayMode.bind(this)),this.$commands.appendDiv("calendar-mode",this.session.text("ui.CalendarWorkWeek")).attr("data-mode",t.Calendar.DisplayMode.WORK_WEEK).click(this._onClickDisplayMode.bind(this)),this.$commands.appendDiv("calendar-mode",this.session.text("ui.CalendarWeek")).attr("data-mode",t.Calendar.DisplayMode.WEEK).click(this._onClickDisplayMode.bind(this)),this.$commands.appendDiv("calendar-mode last",this.session.text("ui.CalendarMonth")).attr("data-mode",t.Calendar.DisplayMode.MONTH).click(this._onClickDisplayMode.bind(this)),this.$commands.appendDiv("calendar-toggle-year").click(this._onClickYear.bind(this)),this.$commands.appendDiv("calendar-toggle-list").click(this._onClickList.bind(this));for(var n=0;n<7;n++){var r=this.$grid.appendDiv();0===n?r.addClass("calendar-week-header"):r.addClass("calendar-week");for(var s=0;s<8;s++){var a=r.appendDiv();0===n&&0===s?a.addClass("calendar-week-name"):0===n&&s>0?a.addClass("calendar-day-name"):n>0&&0===s?a.addClass("calendar-week-name"):n>0&&s>0&&a.addClass("calendar-day").data("day",s).data("week",n).on("contextmenu",this._onDayContextMenu.bind(this))}}e(".calendar-day",this.$grid).mousedown(this._onMousedownDay.bind(this)),this._updateScreen(!1)},t.Calendar.prototype._renderProperties=function(){t.Calendar.parent.prototype._renderProperties.call(this),this._renderComponents(),this._renderSelectedComponent(),this._renderLoadInProgress(),this._renderDisplayMode(),this._renderSelectedDate(),this._renderViewRange()},t.Calendar.prototype._renderComponents=function(){this.components.sort(this._sortFromTo),this.components.forEach(function(t){t.remove(),t.render(this.$container)}),this._arrangeComponents(),this._updateListPanel()},t.Calendar.prototype._renderSelectedComponent=function(){e.log.debug("(Calendar#_renderSelectedComponent)"),this.selectedComponent&&this.selectedComponent.setSelected(!0)},t.Calendar.prototype._renderLoadInProgress=function(){this.$progress.setVisible(this.loadInProgress)},t.Calendar.prototype._renderViewRange=function(){e.log.debug("(Calendar#_renderViewRange) impl.")},t.Calendar.prototype._renderDisplayMode=function(){e.log.debug("(Calendar#_renderDisplayMode) impl.")},t.Calendar.prototype._renderSelectedDate=function(){e.log.debug("(Calendar#_renderSelectedDate) impl.")},t.Calendar.prototype._removeMenus=function(){},t.Calendar.prototype._onClickPrevious=function(e){this._navigateDate(t.Calendar.Direction.BACKWARD)},t.Calendar.prototype._onClickNext=function(e){this._navigateDate(t.Calendar.Direction.FORWARD)},t.Calendar.prototype._dateParts=function(t,e){var i={year:t.getFullYear(),month:t.getMonth(),date:t.getDate(),day:t.getDay()};return e&&(i.day=(t.getDay()+6)%7),i},t.Calendar.prototype._navigateDate=function(t){this.selectedDate=this._calcSelectedDate(t),this._updateModel(!1)},t.Calendar.prototype._calcSelectedDate=function(e){var i=this._dateParts(this.selectedDate),o=e,n=7*e,r=e;return this._isDay()?new Date(i.year,i.month,i.date+o):this._isWeek()||this._isWorkWeek()?new Date(i.year,i.month,i.date+n):this._isMonth()?t.dates.shift(this.selectedDate,0,r,0):void 0},t.Calendar.prototype._updateModel=function(t){this._exactRange=this._calcExactRange(),this._yearPanel.setViewRange(this._exactRange),this.viewRange=this._calcViewRange(),this.trigger("modelChanged"),this._updateScreen(t)},t.Calendar.prototype._calcExactRange=function(){var e,i,o=this._dateParts(this.selectedDate,!0);if(this._isDay())e=new Date(o.year,o.month,o.date),i=new Date(o.year,o.month,o.date+1);else if(this._isWeek())e=new Date(o.year,o.month,o.date-o.day),i=new Date(o.year,o.month,o.date-o.day+6);else if(this._isMonth())e=new Date(o.year,o.month,1),i=new Date(o.year,o.month+1,0);else{if(!this._isWorkWeek())throw new Error("invalid value for displayMode");e=new Date(o.year,o.month,o.date-o.day),i=new Date(o.year,o.month,o.date-o.day+4)}return new t.DateRange(e,i)},t.Calendar.prototype._calcViewRange=function(){function e(t){var e,i=new Date(t.valueOf());for(e=0;e<42;e++)if(i.setDate(i.getDate()-1),1===i.getDay()&&i.getMonth()!==t.getMonth())return i;throw new Error("failed to calc viewFrom date")}function i(t){var e,i=new Date(t.valueOf());for(e=0;e<42;e++)i.setDate(i.getDate()+1);return i}var o=e(this._exactRange.from),n=i(o);return new t.DateRange(o,n)},t.Calendar.prototype._onClickToday=function(t){this.selectedDate=new Date,this._updateModel(!1)},t.Calendar.prototype._onClickDisplayMode=function(i){var o,n,r=this.displayMode;n=e(i.target).data("mode"),r!==n&&(this.displayMode=n,this._yearPanel.setDisplayMode(n),this._isWorkWeek()&&(o=this._dateParts(this.selectedDate,!0),o.day>4&&(this.selectedDate=new Date(o.year,o.month,o.date-o.day+4))),this._updateModel(!0),r!==t.Calendar.DisplayMode.MONTH&&this.displayMode!==t.Calendar.DisplayMode.MONTH||this._renderComponents())},t.Calendar.prototype._onClickYear=function(t){this._showYearPanel=!this._showYearPanel,this._updateScreen(!0)},t.Calendar.prototype._onClickList=function(t){this._showListPanel=!this._showListPanel,this._updateScreen(!0)},t.Calendar.prototype._onMousedownDay=function(t){if(t.eventPhase===Event.AT_TARGET){var i=e(t.delegateTarget).data("date");this._setSelection(i,null)}},t.Calendar.prototype._setSelection=function(i,o){var n=!1;0!==t.dates.compare(this.selectedDate,i)&&(n=!0,e(".calendar-day",this.$container).each(function(o,n){var r=e(n),s=r.data("date");0===t.dates.compare(s,this.selectedDate)?r.select(!1):0===t.dates.compare(s,i)&&r.select(!0)}.bind(this)),this.selectedDate=i),this.selectedComponent!==o&&(n=!0,this.selectedComponent&&this.selectedComponent.setSelected(!1),o&&o.setSelected(!0),this.selectedComponent=o),n&&(this.trigger("selectionChanged"),this._updateListPanel()),this._showYearPanel&&this._yearPanel.selectDate(this.selectedDate)},t.Calendar.prototype._updateScreen=function(t){e.log.info("(Calendar#_updateScreen)"),e(".calendar-mode",this.$commands).select(!1),e('[data-mode="'+this.displayMode+'"]',this.$modes).select(!0),e(".selected",this.$grid).select(!1),this.layoutLabel(),this.layoutSize(t),this.layoutAxis(),this._showYearPanel&&this._yearPanel.selectDate(this.selectedDate),this._updateListPanel()},t.Calendar.prototype.layoutSize=function(t){e("div",this.$container).removeData(["new-width","new-height"]);var o=e(".selected",this.$grid),n=this.$header.height(),r=this.$grid.height(),s=this.$container.width();e(".calendar-toggle-year",this.$modes).select(this._showYearPanel),this._showYearPanel?(this._yearPanel.$container.data("new-width",215),s-=215):this._yearPanel.$container.data("new-width",0),e(".calendar-toggle-list",this.$modes).select(this._showListPanel),this._showListPanel?(this.$list.parent().data("new-width",270),s-=270):this.$list.parent().data("new-width",0),this.$grid.data("new-width",s),this._isDay()||this._isWeek()||this._isWorkWeek()?(e(".calendar-week",this.$grid).data("new-height",0),o.parent().data("new-height",r-n)):e(".calendar-week",this.$grid).data("new-height",parseInt((r-n)/6,10)),this._isDay()?(e(".calendar-day-name, .calendar-day",this.$grid).data("new-width",0),e(".calendar-day-name:nth-child("+(o.index()+1)+"), .calendar-day:nth-child("+(o.index()+1)+")",this.$grid).data("new-width",s-n)):this._isWorkWeek()?(e(".calendar-day-name, .calendar-day",this.$grid).data("new-width",0),e(".calendar-day-name:nth-child(-n+6), .calendar-day:nth-child(-n+6)",this.$grid).data("new-width",parseInt((s-n)/5,10))):(this._isMonth()||this._isWeek())&&e(".calendar-day-name, .calendar-day",this.$grid).data("new-width",parseInt((s-n)/7,10));var a,l=this.$container.width();this._isDay()?l/=1:this._isWorkWeek()?l/=5:this._isWeek()?l/=7:this._isMonth()&&(l/=7),a=l>100?this.session.locale.dateFormat.symbols.weekdaysOrdered:this.session.locale.dateFormat.symbols.weekdaysShortOrdered,e(".calendar-day-name",this.$grid).each(function(t){e(this).attr("data-day-name",a[t])}),e("div",this.$container).each(function(){var o=e(this),n=o.data("new-width"),r=o.data("new-height");n!==i&&n!==o.outerWidth()&&(t?o.animateAVCSD("width",n):o.css("width",n)),r!==i&&r!==o.outerHeight()&&(t?o.animateAVCSD("height",r):o.css("height",r))})},t.Calendar.prototype.layoutYearPanel=function(){this._showYearPanel&&(t.scrollbars.update(this._yearPanel.$yearList),this._yearPanel._scrollYear())},t.Calendar.prototype.layoutLabel=function(){var i,o,n=this._exactRange.from,r=this._exactRange.to;if(this._isDay())i=this._format(n,"d. MMMM yyyy");else if(this._isWorkWeek()||this._isWeek()){var s=this.session.text("ui.to");
i=n.getMonth()===r.getMonth()?t.strings.join(" ",this._format(n,"d."),s,this._format(r,"d. MMMM yyyy")):n.getFullYear()===r.getFullYear()?t.strings.join(" ",this._format(n,"d. MMMM"),s,this._format(r,"d. MMMM yyyy")):t.strings.join(" ",this._format(n,"d. MMMM yyyy"),s,this._format(r,"d. MMMM yyyy"))}else this._isMonth()&&(i=this._format(n,"MMMM yyyy"));e(".calendar-select",this.$range).text(i),o=e(".calendar-day",this.$grid);var a,l,h,d=this._exactRange.from.getMonth(),p=new Date(this.viewRange.from.valueOf());for(a=0;a<6;a++)for(l=0;l<7;l++)h="",h=6===p.getDay()||0===p.getDay()?p.getMonth()!==d?" weekend-out":" weekend":p.getMonth()!==d?" out":"",t.dates.isSameDay(p,new Date)&&(h+=" now"),t.dates.isSameDay(p,this.selectedDate)&&(h+=" selected"),p.getDate()>9&&p.getDate()<20&&(h+=" center-nice"),i=this._format(p,"dd"),o.eq(7*a+l).removeClass("weekend-out weekend out selected now").addClass(h).attr("data-day-name",i).data("date",new Date(p.valueOf())),p.setDate(p.getDate()+1)},t.Calendar.prototype.layoutAxis=function(){var i,o=e(".selected",this.$grid);e(".calendar-week-axis, .calendar-week-task",this.$grid).remove();var n=this.session;if(e(".calendar-week-name",this.$container).each(function(o){o>0&&(i=e(this),i.text(n.text("ui.CW",t.dates.weekInYear(i.next().data("date")))))}),!this._isMonth()){var r=o.parent();r.appendDiv("calendar-week-axis").attr("data-axis-name","08:00").css("top",this._dayPosition(8)+"%"),r.appendDiv("calendar-week-axis").attr("data-axis-name","12:00").css("top",this._dayPosition(12)+"%"),r.appendDiv("calendar-week-axis").attr("data-axis-name","13:00").css("top",this._dayPosition(13)+"%"),r.appendDiv("calendar-week-axis").attr("data-axis-name","17:00").css("top",this._dayPosition(17)+"%"),r.appendDiv("calendar-week-task").attr("data-axis-name",n.text("ui.CalendarDay")).css("top",this._dayPosition(-1)+"%")}},t.Calendar.prototype._onYearPanelDateSelect=function(t){this.selectedDate=t.date,this._updateModel(!1)},t.Calendar.prototype._updateListPanel=function(){this._showListPanel&&(this._listComponents.forEach(function(t){t.remove()}),this._listComponents=[],this._renderListPanel())},t.Calendar.prototype._renderListPanel=function(){function e(e){var i,o;for(i=0;i<e.coveredDays.length;i++)if(o=t.dates.parseJsonDate(e.coveredDays[i]),t.dates.isSameDay(this.selectedDate,o))return!0;return!1}var i,o=[];this.$listTitle.text(this._format(this.selectedDate,"d. MMMM yyyy")),this.components.forEach(function(t){e.call(this,t)&&o.push(t)}.bind(this)),o.forEach(function(e){i=new t.CalendarListComponent(this.selectedDate,e),i.render(this.$list),this._listComponents.push(i)}.bind(this))},t.Calendar.prototype._selectedComponentChanged=function(t,e){this._setSelection(e,t)},t.Calendar.prototype._onDayContextMenu=function(t){this._showContextMenu(t,"Calendar.EmptySpace")},t.Calendar.prototype._showContextMenu=function(i,o){i.preventDefault(),i.stopPropagation();var n=function(i,o){var n=t.menus.filter(this.menus,[o],!0),r=e(i.currentTarget);if(0!==n.length){var s=t.create("ContextMenuPopup",{parent:this,menuItems:n,location:{x:i.pageX,y:i.pageY},$anchor:r});s.open()}}.bind(this);t.menus.showContextMenuWithWait(this.session,n,i,o)},t.Calendar.prototype._arrangeComponents=function(){var t,i,o,n,r,s=e(".calendar-day",this.$grid);for(t=0;t<s.length;t++)i=s.eq(t),o=i.children(".calendar-component:not(.component-task)"),r=i.data("date"),this._isMonth()&&o.length>2?i.addClass("many-items"):!this._isMonth()&&o.length>1&&(n=this._getComponents(o),this._arrange(n,r),this._arrangeComponentSetPlacement(o,r))},t.Calendar.prototype._getComponents=function(t){var e,i,o=[];for(e=0;e<t.length;e++)i=t.eq(e),o.push(i.data("component"));return o},t.Calendar.prototype._sort=function(t){t.sort(this._sortFromTo)},t.Calendar.prototype._arrange=function(t,e){var i,o,n,r,s,a=[];for(this._sort(t),i=0;i<t.length;i++)n=t[i],n.stack||(n.stack={}),n.stack[e]={};for(i=0;i<t.length;i++)for(n=t[i],r=n.getPartDayPosition(e),a.length>0&&this._allEndBefore(a,r.from,e)&&(a=[]),s=this._findReplacableRow(a,r.from,e),s>=0?(a[s]=n,n.stack[e].x=s):(a.push(n),n.stack[e].x=a.length-1),o=0;o<a.length;o++)a[o].stack[e].w=a.length},t.Calendar.prototype._allEndBefore=function(t,e,i){var o;for(o=0;o<t.length;o++)if(!this._endsBefore(t[o],e,i))return!1;return!0},t.Calendar.prototype._findReplacableRow=function(t,e,i){var o;for(o=0;o<t.length;o++)if(this._endsBefore(t[o],e,i))return o;return-1},t.Calendar.prototype._endsBefore=function(t,e,i){return t.getPartDayPosition(i).to<=e},t.Calendar.prototype._arrangeComponentSetPlacement=function(t,e){var i,o,n;for(i=0;i<t.length;i++)o=t.eq(i),n=o.data("component").stack[e],o.css("width",100/n.w+"%").css("left",100*n.x/n.w+"%")},t.Calendar.prototype._dayPosition=function(t){var e;return t<0?e=85:t<8?e=t/8*10+5:t<12?e=(t-8)/4*25+15:t<13?e=(t-12)/1*5+40:t<17?e=(t-13)/4*25+45:t<=24&&(e=(t-17)/7*10+70),Math.round(100*e)/100},t.Calendar.prototype._hourToNumber=function(t){var e=t.split(":");return parseFloat(e[0])+parseFloat(e[1])/60},t.Calendar.prototype._format=function(e,i){return t.dates.format(e,this.session.locale,i)},t.Calendar.prototype._sortFromTo=function(e,i){var o=t.dates.parseJsonDate(e.fromDate),n=t.dates.parseJsonDate(i.fromDate),r=t.dates.compare(o,n);if(0!==r)return r;var s=t.dates.parseJsonDate(e.toDate),a=t.dates.parseJsonDate(i.toDate);return t.dates.compare(s,a)},t.CalendarAdapter=function(){t.CalendarAdapter.parent.call(this)},t.inherits(t.CalendarAdapter,t.ModelAdapter),t.CalendarAdapter.prototype._postCreateWidget=function(){this._sendViewRangeChanged()},t.CalendarAdapter.prototype._onWidgetEvent=function(e){"viewRangeChanged"===e.type?this._sendViewRangeChanged():"modelChanged"===e.type?this._sendModelChanged():"selectionChanged"===e.type?this._sendSelectionChanged():t.CalendarAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.CalendarAdapter.prototype._jsonViewRange=function(){return t.dates.toJsonDateRange(this.widget.viewRange)},t.CalendarAdapter.prototype._jsonSelectedDate=function(){return t.dates.toJsonDate(this.widget.selectedDate)},t.CalendarAdapter.prototype._sendViewRangeChanged=function(){this._send("viewRangeChanged",{viewRange:this._jsonViewRange()})},t.CalendarAdapter.prototype._sendModelChanged=function(){var t={viewRange:this._jsonViewRange(),selectedDate:this._jsonSelectedDate(),displayMode:this.widget.displayMode};this._send("modelChanged",t)},t.CalendarAdapter.prototype._sendSelectionChanged=function(){var t=this.widget.selectedComponent?this.widget.selectedComponent.id:null;this._send("selectionChanged",{date:this._jsonSelectedDate(),componentId:t})},t.CalendarComponent=function(){t.CalendarComponent.parent.call(this),this.selected=!1,this._$parts=[]},t.inherits(t.CalendarComponent,t.Widget),t.CalendarComponent.prototype._remove=function(){var e=this.parent._tooltipSupport;this._$parts.forEach(function(t){e.uninstall(t),t.remove()}),t.CalendarComponent.parent.prototype._remove.call(this)},t.CalendarComponent.prototype._render=function(o){e.log.debug("(CalendarComponent#_render)");var n,r,s,a;for(n=0;n<this.coveredDays.length;n++)if(r=t.dates.parseJsonDate(this.coveredDays[n]),s=this._findDayInGrid(r),s!==i&&(a=s.appendDiv("calendar-component",this.item.subject).addClass(this.item.cssClass).data("component",this).data("partDay",r).data("tooltipText",this._description.bind(this)).mousedown(this._onMousedown.bind(this)).on("contextmenu",this._onContextMenu.bind(this)),this.parent._tooltipSupport.install(a),this._$parts.push(a),!this.parent._isMonth()))if(this.fullDay){var l=e(".component-task",s).length;this._arrangeTask(1+26*l),a.addClass("component-task")}else{var h=t.dates.parseJsonDate(this.fromDate),d=t.dates.parseJsonDate(this.toDate),p=this._getHours(this.fromDate),u=this._getHours(this.toDate);a.addClass("component-day"),1===this.coveredDays.length?this._partPosition(a,p,u):t.dates.isSameDay(r,h)?this._partPosition(a,p,24).addClass("component-open-bottom"):t.dates.isSameDay(r,d)?this._partPosition(a,0,u).addClass("component-open-top"):this._partPosition(a,1,24).addClass("component-open-top").addClass("component-open-bottom")}},t.CalendarComponent.prototype._getHours=function(e){var i=t.dates.parseJsonDate(e);return i.getHours()+i.getMinutes()/60},t.CalendarComponent.prototype._findDayInGrid=function(i){var o;return e(".calendar-day",this.parent.$grid).each(function(){if(t.dates.isSameDay(e(this).data("date"),i))return void(o=e(this))}),o},t.CalendarComponent.prototype._isTask=function(){return!this.parent._isMonth()&&this.fullDay},t.CalendarComponent.prototype._arrangeTask=function(t){this._$parts.forEach(function(e){e.css("top","calc(85% + "+t+"px)")})},t.CalendarComponent.prototype._isDayPart=function(){return!this.parent._isMonth()&&!this.fullDay},t.CalendarComponent.prototype._getHourRange=function(e){var i=new t.Range(this._getHours(this.fromDate),this._getHours(this.toDate)),o=new t.Range(t.dates.parseJsonDate(this.fromDate),t.dates.parseJsonDate(this.toDate));return t.dates.isSameDay(e,o.from)&&t.dates.isSameDay(e,o.to)?new t.Range(i.from,i.to):t.dates.isSameDay(e,o.from)?new t.Range(i.from,24):t.dates.isSameDay(e,o.to)?new t.Range(0,i.to):new t.Range(0,24)},t.CalendarComponent.prototype.getPartDayPosition=function(t){return this._getDisplayDayPosition(this._getHourRange(t))},t.CalendarComponent.prototype._getDisplayDayPosition=function(e){var i=new t.Range(this.parent._dayPosition(e.from),this.parent._dayPosition(e.to)),o=2.5;return i.size()<o?new t.Range(i.from,i.from+o):i},t.CalendarComponent.prototype._partPosition=function(e,i,o){var n=new t.Range(i,o),r=this._getDisplayDayPosition(n);return e.css("top",r.from+"%").css("height",r.to-r.from+"%")},t.CalendarComponent.prototype._renderProperties=function(){t.CalendarComponent.parent.prototype._renderProperties.call(this),this._renderSelected()},t.CalendarComponent.prototype._renderSelected=function(){this._$parts.forEach(function(t){t.toggleClass("comp-selected",this.selected)},this)},t.CalendarComponent.prototype.setSelected=function(t){this.setProperty("selected",t)},t.CalendarComponent.prototype._onMousedown=function(t){var i=e(t.delegateTarget);this.parent._selectedComponentChanged(this,i.data("partDay"))},t.CalendarComponent.prototype._onContextMenu=function(t){this.parent._showContextMenu(t,"Calendar.CalendarComponent")},t.CalendarComponent.prototype._format=function(e,i){return t.dates.format(e,this.session.locale,i)},t.CalendarComponent.prototype._description=function(){var e=[],i=null,o="",n=t.dates.parseJsonDate(this.fromDate),r=t.dates.parseJsonDate(this.toDate);return t.strings.hasText(this.item.subject)&&e.push({text:t.strings.encode(this.item.subject),cssClass:"calendar-component-title"}),this.fullDay||(i=t.dates.isSameDay(n,r)?this.session.text("ui.FromXToY",this._format(n,"HH:mm"),this._format(r,"HH:mm")):this.session.text("ui.FromXToY",this._format(n,"EEEE HH:mm "),this._format(r,"EEEE HH:mm"))),t.strings.hasText(i)&&e.push({text:i,cssClass:"calendar-component-intro"}),t.strings.hasText(this.item.description)&&e.push({text:t.strings.nl2br(this.item.description)}),e.forEach(function(t){o+=(t.cssClass?'<span class="'+t.cssClass+'">'+t.text+"</span>":t.text)+"<br/>"}),o},t.CalendarComponentAdapter=function(){t.CalendarComponentAdapter.parent.call(this)},t.inherits(t.CalendarComponentAdapter,t.ModelAdapter),t.CalendarListComponent=function(t,e){this.partDay=t,this.source=e,this.$container,this._selectedListener=e.on("selected",function(t){this.$container.toggleClass("comp-selected",t.selected)}.bind(this)),this._removeListener=e.on("remove",this.remove.bind(this))},t.CalendarListComponent.prototype.render=function(t){var e=this.source;this.$container=t.appendDiv("calendar-component").data("partDay",this.partDay).addClass(e.item.cssClass).toggleClass("comp-selected",e._selected).mousedown(e._onMousedown.bind(e)).on("contextmenu",e._onContextMenu.bind(e)).html(e._description())},t.CalendarListComponent.prototype.remove=function(){this.source.removeListener(this._selectedListener),this.source.removeListener(this._removeListener),this.$container.remove()},t.CalendarLayout=function(e){t.CalendarLayout.parent.call(this),this.calendar=e},t.inherits(t.CalendarLayout,t.AbstractLayout),t.CalendarLayout.prototype.layout=function(t){var e=0,i=0,o=this.calendar._yearPanel.$container,n=this.calendar.$grid,r=this.calendar.$header;e+=t.cssMarginTop()+t.cssMarginBottom(),t.css("height","calc(100% - "+e+"px)"),i=r.outerHeight(!0),o.css("height","calc(100% - "+(i+o.cssMarginY())+"px)"),n.css("height","calc(100% - "+(i+n.cssMarginY())+"px)"),this.calendar.layoutSize(),this.calendar.layoutYearPanel()},t.DateRange=function(t,e){this.from=t,this.to=e},t.DateRange.prototype.equals=function(e){return!!e&&(t.dates.equals(this.from,e.from)&&t.dates.equals(this.to,e.to))},t.DateRange.prototype.toString=function(){return"scout.DateRange[from="+(null===this.from?"null":this.from.toUTCString())+" to="+(null===this.to?"null":this.to.toUTCString())+"]"},t.DateRange.ensure=function(e){return e?e instanceof t.DateRange?e:new t.DateRange(t.dates.ensure(e.from),t.dates.ensure(e.to)):e},t.YearPanel=function(){t.YearPanel.parent.call(this),this.$container,this.$yearTitle,this.$yearList,this.selectedDate,this.displayMode,this.alwaysSelectFirstDay},t.inherits(t.YearPanel,t.Widget),t.YearPanel.prototype._init=function(e){t.YearPanel.parent.prototype._init.call(this,e),this.alwaysSelectFirstDay=e.alwaysSelectFirstDay},t.YearPanel.prototype._render=function(t){this.$container=t.appendDiv("year-panel-container"),this.$yearTitle=this.$container.appendDiv("year-panel-title"),this.$yearList=this.$container.appendDiv("year-panel-list")},t.YearPanel.prototype.renderContent=function(){this.removeContent(),this._drawYear(),t.scrollbars.install(this.$yearList,{parent:this,axis:"y"}),this.yearRendered=!0,this._colorYear()},t.YearPanel.prototype.removeContent=function(){t.scrollbars.uninstall(this.$yearList,this.session),this.$yearList.empty(),this.yearRendered=!1},t.YearPanel.prototype._remove=function(){this.removeContent(),t.YearPanel.parent.prototype._remove.call(this)},t.YearPanel.prototype._drawYear=function(){var i,o,n,r,s,a,l=this.selectedDate.getFullYear();for(this.$yearTitle.data("year",l).empty(),this.$yearTitle.appendDiv("year-title-item",l-1).data("year-diff",-1).click(this._onYearClick.bind(this)),this.$yearTitle.appendDiv("year-title-item selected",l),this.$yearTitle.appendDiv("year-title-item",l+1).data("year-diff",1).click(this._onYearClick.bind(this)),o=0;o<12;o++)for(i=new Date(l,o,1),n=this.$yearList.appendDiv("year-month").attr("data-title",this._format(i,"MMMM")),r=1;r<=31&&(s=new Date(l,o,r),s.getMonth()===o);r++)a=n.appendDiv("year-day",r).data("date",s),0!==s.getDay()&&6!==s.getDay()||a.addClass("weekend"),1===r&&a.css("margin-left",(s.getDay()+6)%7*a.outerWidth());e(".year-day",this.$yearList).click(this._onYearDayClick.bind(this)).hover(this._onYearHoverIn.bind(this),this._onYearHoverOut.bind(this)),t.scrollbars.update(this.$yearList)},t.YearPanel.prototype._colorYear=function(){if(this.yearRendered){e(".year-day.year-range, .year-day.year-range-day",this.$yearList).removeClass("year-range year-range-day");var i,o,n=this;e(".year-day",this.$yearList).each(function(){i=e(this),o=i.data("date"),n.displayMode!==t.Calendar.DisplayMode.DAY&&o>=n.viewRange.from&&o<n.viewRange.to&&i.addClass("year-range"),t.dates.isSameDay(o,n.selectedDate)&&i.addClass("year-range-day")}),this._scrollYear()}},t.YearPanel.prototype._scrollYear=function(){var t,i,o,n=e(".year-range-day",this.$yearList),r=n.parent(),s=n.parent().parent();r[0]&&(t=r[0].offsetTop,i=r.outerHeight()/2,o=s.outerHeight()/2,this.$yearList.animateAVCSD("scrollTop",t+i-o))},t.YearPanel.prototype._format=function(e,i){return t.dates.format(e,this.session.locale,i)},t.YearPanel.prototype.selectDate=function(t){this.selectedDate=t,this.rendered&&(t&&t.getFullYear()===this.$yearTitle.data("year")||this.renderContent(),this._colorYear())},t.YearPanel.prototype.setDisplayMode=function(t){t!==this.displayMode&&(this._setProperty("displayMode",t),this.rendered&&this._colorYear())},t.YearPanel.prototype.setViewRange=function(t){t!==this.viewRange&&(this._setProperty("viewRange",t),this.rendered&&this._colorYear())},t.YearPanel.prototype._onYearClick=function(i){var o,n,r,s=t.Planner.DisplayMode,a=e(i.target).data("year-diff"),l=this.selectedDate.getFullYear(),h=this.selectedDate.getMonth(),d=this.selectedDate.getDate(),p=new Date(l+a,h,d);this.alwaysSelectFirstDay&&(t.isOneOf(this.displayMode,s.WEEK,s.WORK_WEEK,s.CALENDAR_WEEK)?(o=t.dates.weekInYear(this.selectedDate),n=t.dates.weekInYear(p),r=o-n,p=t.dates.shift(p,0,0,7*r),p=t.dates.shiftToNextOrPrevMonday(p,0)):t.isOneOf(this.displayMode,s.MONTH,s.YEAR)&&(p=new Date(l+a,h,1))),this.selectedDate=p,this.trigger("dateSelect",{date:this.selectedDate})},t.YearPanel.prototype._onYearDayClick=function(t){this.selectedDate=e(".year-hover-day",this.$yearList).data("date"),this.selectedDate&&this.trigger("dateSelect",{date:this.selectedDate})},t.YearPanel.prototype._onYearHoverIn=function(i){var o,n,r,s,a=e(i.target),l=a.data("date"),h=l.getFullYear(),d=l.getMonth(),p=l.getDate(),u=(l.getDay()+6)%7;this.displayMode===t.Calendar.DisplayMode.DAY?(o=new Date(h,d,p),n=new Date(h,d,p)):this.displayMode===t.Calendar.DisplayMode.WEEK?(o=new Date(h,d,p-u),n=new Date(h,d,p-u+6)):this.displayMode===t.Calendar.DisplayMode.WORK_WEEK?(o=new Date(h,d,p-u),n=new Date(h,d,p-u+4),l>n&&(l=n)):this.displayMode===t.Calendar.DisplayMode.MONTH?(o=new Date(h,d,1),n=new Date(h,d+1,0)):this.displayMode===t.Planner.DisplayMode.YEAR?(o=new Date(h,d,1),n=o):(o=new Date(h,d,p-u),n=o),this.alwaysSelectFirstDay&&(l=o),e(".year-day",this.$yearList).each(function(){r=e(this),s=r.data("date"),s>=o&&s<=n?r.addClass("year-hover"):r.removeClass("year-hover"),t.dates.isSameDay(l,s)&&r.addClass("year-hover-day")})},t.YearPanel.prototype._onYearHoverOut=function(t){e(".year-day.year-hover, .year-day.year-hover-day",this.$yearList).removeClass("year-hover year-hover-day")},t.Planner=function(){t.Planner.parent.call(this),this.resourceMap=[],this.activityMap=[],this.availableDisplayModes=[],this.resources=[],this.viewRange={},this.selectionRange=new t.DateRange,this.selectedResources=[],this._resourceTitleWidth=20,this.$container,this.$range,this.$modes,this.$grid,this.transformLeft=function(t){return t},this.transformWidth=function(t,e){return e-t},this.yearPanelVisible=!1,this._addAdapterProperties(["menus"])},t.inherits(t.Planner,t.Widget),t.Planner.Direction={BACKWARD:-1,FORWARD:1},t.Planner.DisplayMode=e.extend({CALENDAR_WEEK:5,YEAR:6},t.Calendar.DisplayMode),t.Planner.SelectionMode={NONE:0,SINGLE_RANGE:1,MULTI_RANGE:2},t.Planner.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.Planner.prototype._init=function(e){t.Planner.parent.prototype._init.call(this,e),this._yearPanel=t.create("YearPanel",{parent:this,alwaysSelectFirstDay:!0}),this._yearPanel.on("dateSelect",this._onYearPanelDateSelect.bind(this)),this._header=t.create("PlannerHeader",{parent:this}),this._header.on("todayClick",this._onTodayClick.bind(this)),this._header.on("yearClick",this._onYearClick.bind(this)),this._header.on("previousClick",this._onPreviousClick.bind(this)),this._header.on("nextClick",this._onNextClick.bind(this)),this._header.on("displayModeClick",this._onDisplayModeClick.bind(this)),this.menuBar=t.create("MenuBar",{parent:this,menuOrder:new t.PlannerMenuItemsOrder(this.session,"Planner")}),this.menuBar.bottom();for(var i=0;i<this.resources.length;i++)this._initResource(this.resources[i]);this._syncDisplayMode(this.displayMode),this._syncAvailableDisplayModes(this.availableDisplayModes),this._syncViewRange(this.viewRange),this._syncSelectedResources(this.selectedResources),this._syncSelectedActivity(this.selectedActivity),this._syncSelectionRange(this.selectionRange),this._syncMenus(this.menus),this._tooltipSupport=new t.TooltipSupport({parent:this,arrowPosition:50})},t.Planner.prototype._initResource=function(e){t.defaultValues.applyTo(e,"Resource"),e.activities.forEach(function(t){this._initActivity(t)},this),this.resourceMap[e.id]=e},t.Planner.prototype._initActivity=function(e){e.beginTime=t.dates.parseJsonDate(e.beginTime),e.endTime=t.dates.parseJsonDate(e.endTime),t.defaultValues.applyTo(e,"Activity"),this.activityMap[e.id]=e},t.Planner.prototype._render=function(e){this.$container=e.appendDiv("planner");var o=new t.PlannerLayout(this);this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(o),this.htmlComp.pixelBasedSizing=!1,this._header.render(this.$container),this._yearPanel.render(this.$container),this.$grid=this.$container.appendDiv("planner-grid").on("mousedown",".resource-cells",this._onCellMousedown.bind(this)).on("mousedown",".resource-title",this._onResourceTitleMousedown.bind(this)).on("contextmenu",".resource-title",this._onResourceTitleContextMenu.bind(this)).on("contextmenu",".planner-activity",this._onActivityContextMenu.bind(this)),this.$scale=this.$container.appendDiv("planner-scale"),this.menuBar.render(this.$container),t.tooltips.install(this.$grid,{parent:this,selector:".planner-activity",text:function(t){return this._activityById(t.attr("data-id"))?this._activityById(t.attr("data-id")).tooltipText:i}.bind(this)}),t.scrollbars.install(this.$grid,{parent:this}),this._gridScrollHandler=this._onGridScroll.bind(this),this.$grid.on("scroll",this._gridScrollHandler)},t.Planner.prototype._renderProperties=function(){t.Planner.parent.prototype._renderProperties.call(this),this._renderViewRange(),this._renderHeaderVisible(),this._renderYearPanelVisible(!1),this._renderResources(),this._renderSelectedActivity(),this._renderSelectedResources(),setTimeout(this._renderSelectionRange.bind(this))},t.Planner.prototype._remove=function(){t.scrollbars.uninstall(this.$grid,this.session),t.Planner.parent.prototype._remove.call(this)},t.Planner.prototype._onPreviousClick=function(e){this._navigateDate(t.Planner.Direction.BACKWARD)},t.Planner.prototype._onNextClick=function(e){this._navigateDate(t.Planner.Direction.FORWARD)},t.Planner.prototype._navigateDate=function(e){var i=new t.DateRange(this.viewRange.from,this.viewRange.to),o=t.Planner.DisplayMode;this.displayMode===o.DAY?(i.from=t.dates.shift(this.viewRange.from,0,0,e),i.to=t.dates.shift(this.viewRange.to,0,0,e)):t.isOneOf(this.displayMode,o.WEEK,o.WORK_WEEK)?(i.from=t.dates.shift(this.viewRange.from,0,0,7*e),i.from=t.dates.ensureMonday(i.from,-1*e),i.to=t.dates.shift(this.viewRange.to,0,0,7*e)):this.displayMode===o.MONTH?(i.from=t.dates.shift(this.viewRange.from,0,e,0),i.from=t.dates.ensureMonday(i.from,-1*e),i.to=t.dates.shift(this.viewRange.to,0,e,0)):this.displayMode===o.CALENDAR_WEEK?(i.from=t.dates.shift(this.viewRange.from,0,e,0),i.from=t.dates.ensureMonday(i.from,-1*e),i.to=t.dates.shift(this.viewRange.to,0,e,0)):this.displayMode===o.YEAR&&(i.from=t.dates.shift(this.viewRange.from,0,3*e,0),i.to=t.dates.shift(this.viewRange.to,0,3*e,0)),this.setViewRange(i)},t.Planner.prototype._onTodayClick=function(e){var i=new Date,o=i.getFullYear(),n=i.getMonth(),r=i.getDate(),s=(i.getDay()+6)%7,a=t.Planner.DisplayMode;i=this.displayMode===a.DAY?new Date(o,n,r):this.displayMode===a.YEAR?new Date(o,n,1):new Date(o,n,r-s),this.setViewRangeFrom(i)},t.Planner.prototype._onDisplayModeClick=function(t){var e=t.displayMode;this.setDisplayMode(e)},t.Planner.prototype._onYearClick=function(t){this.setYearPanelVisible(!this.yearPanelVisible)},t.Planner.prototype._onYearPanelDateSelect=function(t){this.setViewRangeFrom(t.date)},t.Planner.prototype._onResourceTitleMousedown=function(t){var i=e(t.target).parent();i.isSelected()&&(3===t.which||1===t.which&&t.ctrlKey)||(this.startRow=i.data("resource"),this.lastRow=this.startRow,this._select())},t.Planner.prototype._onResourceTitleContextMenu=function(t){this._showContextMenu(t,"Planner.Resource")},t.Planner.prototype._onRangeSelectorContextMenu=function(t){this._showContextMenu(t,"Planner.Range")},t.Planner.prototype._onActivityContextMenu=function(t){this._showContextMenu(t,"Planner.Activity")},t.Planner.prototype._showContextMenu=function(i,o){i.preventDefault(),i.stopPropagation();var n=function(i,o){var n=this._filterMenus([o]),r=e(i.currentTarget);if(0!==n.length){var s=t.create("ContextMenuPopup",{parent:this,menuItems:n,location:{x:i.pageX,y:i.pageY},$anchor:r});s.open()}}.bind(this);t.menus.showContextMenuWithWait(this.session,n,i,o)},t.Planner.prototype._onGridScroll=function(){this._reconcileScrollPos()},t.Planner.prototype._reconcileScrollPos=function(){var t=this.$grid.scrollLeft();this.$scale.scrollLeft(t)},t.Planner.prototype._renderRange=function(){if(this.viewRange.from&&this.viewRange.to){var i,o=new Date(this.viewRange.to.valueOf()-1),n=this.session.text("ui.to"),r=t.Planner.DisplayMode;i=t.dates.isSameDay(this.viewRange.from,o)?this._dateFormat(this.viewRange.from,"d. MMMM yyyy"):this.viewRange.from.getMonth()===o.getMonth()&&this.viewRange.from.getFullYear()===o.getFullYear()?t.strings.join(" ",this._dateFormat(this.viewRange.from,"d."),n,this._dateFormat(o,"d. MMMM yyyy")):this.viewRange.from.getFullYear()===o.getFullYear()?this.displayMode===r.YEAR?t.strings.join(" ",this._dateFormat(this.viewRange.from,"MMMM"),n,this._dateFormat(o,"MMMM yyyy")):t.strings.join(" ",this._dateFormat(this.viewRange.from,"d.  MMMM"),n,this._dateFormat(o,"d. MMMM yyyy")):this.displayMode===r.YEAR?t.strings.join(" ",this._dateFormat(this.viewRange.from,"MMMM yyyy"),n,this._dateFormat(o,"MMMM yyyy")):t.strings.join(" ",this._dateFormat(this.viewRange.from,"d.  MMMM yyyy"),n,this._dateFormat(o,"d. MMMM yyyy")),e(".planner-select",this._header.$range).text(i)}},t.Planner.prototype._renderScale=function(){if(this.viewRange.from&&this.viewRange.to){var i,o=this,n=t.Planner.DisplayMode;this.$scale.empty(),this.$grid.children(".planner-small-scale-item-line").remove(),this.$grid.children(".planner-large-scale-item-line").remove(),this.$scaleTitle=this.$scale.appendDiv("planner-scale-title"),this._renderLabel(),this.$timeline=this.$scale.appendDiv("timeline"),this.$timelineLarge=this.$timeline.appendDiv("timeline-large"),this.$timelineSmall=this.$timeline.appendDiv("timeline-small"),this.displayMode===n.DAY?this._renderDayScale():t.isOneOf(this.displayMode,n.WORK_WEEK,n.WEEK)?this._renderWeekScale():this.displayMode===n.MONTH?this._renderMonthScale():this.displayMode===n.CALENDAR_WEEK?this._renderCalendarWeekScale():this.displayMode===n.YEAR&&this._renderYearScale();var r=this.$timelineSmall.children(".scale-item"),s=this.$timelineLarge.children(".scale-item");if(i=100/r.length,s.each(function(){var t=e(this);t.css("width",t.data("count")*i+"%").data("scale-item-line",o.$grid.appendDiv("planner-large-scale-item-line")),t.appendDiv("planner-large-scale-item-line").css("left",0)}),r.each(function(t){var n=e(this);if(n.css("width",i+"%"),!n.data("first")){var r=o.$grid.appendDiv("planner-small-scale-item-line");n.data("scale-item-line",r);var s=n.appendDiv("planner-small-scale-item-line").css("left",0);n.hasClass("label-invisible")&&(r.addClass("first-in-range"),s.addClass("first-in-range"))}}),this.beginScale=this.$timelineSmall.children().first().data("date-from").valueOf(),this.endScale=this.$timelineSmall.children().last().data("date-to").valueOf(),t.isOneOf(this.displayMode,n.WORK_WEEK,n.WEEK)){var a=this.displayModeOptions[this.displayMode],l=a.interval,h=a.firstHourOfDay,d=a.lastHourOfDay;this.transformLeft=function(e,i,o,n,r){return function(r){r=new Date(r),e=new Date(e),i=new Date(i);var s=i-e,a=t.dates.compareDays(r,e),l=t.dates.compareDays(i,e),h=36e5*a*24,d=24/(n-o+1),p=a/l;return 100*((r.valueOf()-(e.valueOf()+36e5*o)-h)*d/s+p)}}(this.viewRange.from,this.viewRange.to,h,d,l),this.transformWidth=function(e,i,o,n,r){return function(r,s){r=new Date(r),s=new Date(s);var a=i-e,l=s-r,h=t.dates.compareDays(s,r),d=h*(24-(n+1)+o)*36e5,p=24/(n-o+1);return(l-d)*p/a*100}}(this.viewRange.from,this.viewRange.to,h,d,l)}else this.transformLeft=function(t,e){return function(i){return(i-t)/(e-t)*100}}(this.beginScale,this.endScale),this.transformWidth=function(t,e){return function(i,o){return(o-i)/(e-t)*100}}(this.beginScale,this.endScale)}},t.Planner.prototype._renderDayScale=function(){var e,i,o,n=!0,r=new Date(this.viewRange.from.valueOf()),s=this.displayModeOptions[this.displayMode],a=s.interval,l=s.labelPeriod,h=s.firstHourOfDay,d=s.lastHourOfDay;for(a=Math.min(a,60*(d-h+1));r<this.viewRange.to;)r.getHours()>=h&&r.getHours()<=d?(e=!1,(0===r.getMinutes()||n)&&(i=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"HH")).data("count",0),e=!0),o=this.$timelineSmall.appendDiv("scale-item",this._dateFormat(r,":mm")).data("date-from",new Date(r.valueOf())),r.getMinutes()%(a*l)!==0&&o.addClass("label-invisible"),r=t.dates.shiftTime(r,0,a,0),this._incrementTimelineScaleItems(i,o,r,e),n=!1):r=t.dates.shiftTime(r,0,a,0)},t.Planner.prototype._renderWeekScale=function(){var e,i,o,n=!0,r=new Date(this.viewRange.from.valueOf()),s=this.displayModeOptions[this.displayMode],a=s.interval,l=s.labelPeriod,h=s.firstHourOfDay,d=s.lastHourOfDay;for(a=Math.min(a,60*(d-h+1));r<this.viewRange.to;)e=!1,r.getHours()<h&&r.setHours(h),(r.getHours()===h&&0===r.getMinutes()||n)&&(i=0===r.getMonth()||n?this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"d. MMMM yyyy")).data("count",0):1===r.getDate()?this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"d. MMMM")).data("count",0):this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"d.")).data("count",0),e=!0),o=this.$timelineSmall.appendDiv("scale-item",this._dateFormat(r,"HH:mm")).data("date-from",new Date(r.valueOf())),(60*(r.getHours()-h)+r.getMinutes())%(a*l)!==0&&o.addClass("label-invisible"),r=t.dates.shiftTime(r,0,a,0,0),this._incrementTimelineScaleItems(i,o,r,e),n=!1,r.getHours()>d&&(r.setHours(0),r.setMinutes(0),r.setDate(r.getDate()+1))},t.Planner.prototype._renderMonthScale=function(){for(var e,i,o,n=!0,r=new Date(this.viewRange.from.valueOf()),s=this.displayModeOptions[this.displayMode],a=s.labelPeriod;r<this.viewRange.to;)e=!1,(1===r.getDate()||n)&&(i=0===r.getMonth()||n?this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"MMMM yyyy")).data("count",0):this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"MMMM")).data("count",0),e=!0),o=this.$timelineSmall.appendDiv("scale-item",this._dateFormat(r,"dd")).data("date-from",new Date(r.valueOf())),r.getDate()%a!==0&&o.addClass("label-invisible"),r=t.dates.shift(r,0,0,1),this._incrementTimelineScaleItems(i,o,r,e),n=!1},t.Planner.prototype._renderCalendarWeekScale=function(){for(var e,i,o,n=!0,r=new Date(this.viewRange.from.valueOf()),s=this.displayModeOptions[this.displayMode],a=s.labelPeriod;r<this.viewRange.to;)e=!1,(r.getDate()<8||n===!0)&&(0===r.getMonth()||n===!0?r.getDate()>11?(i=this.$timelineLarge.appendDiv("scale-item").html("&nbsp;").data("count",0),n=2):(i=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"MMMM yyyy")).data("count",0),n=!1):2===n?(i=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"MMMM yyyy")).data("count",0),n=!1):i=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"MMMM")).data("count",0),e=!0),o=this.$timelineSmall.appendDiv("scale-item",t.dates.weekInYear(r)).data("date-from",new Date(r.valueOf())).data("tooltipText",this._scaleTooltipText.bind(this)),this._tooltipSupport.install(o),t.dates.weekInYear(r)%a!==0&&o.addClass("label-invisible"),r.setDate(r.getDate()+7),this._incrementTimelineScaleItems(i,o,r,e)},t.Planner.prototype._renderYearScale=function(){for(var e,i,o,n=!0,r=new Date(this.viewRange.from.valueOf()),s=this.displayModeOptions[this.displayMode],a=s.labelPeriod;r<this.viewRange.to;)e=!1,(0===r.getMonth()||n)&&(i=this.$timelineLarge.appendDiv("scale-item",this._dateFormat(r,"yyyy")).data("count",0),e=!0),o=this.$timelineSmall.appendDiv("scale-item",this._dateFormat(r,"MMMM")).data("date-from",new Date(r.valueOf())),
r.getMonth()%a!==0&&o.addClass("label-invisible"),r=t.dates.shift(r,0,1,0),this._incrementTimelineScaleItems(i,o,r,e),n=!1},t.Planner.prototype._incrementTimelineScaleItems=function(t,e,i,o){t.data("count",t.data("count")+1),e.data("date-to",new Date(i.valueOf())).data("first",o)},t.Planner.prototype._scaleTooltipText=function(t){var e=" "+this.session.text("ui.to")+" ",i=new Date(t.data("date-from").valueOf()),o=new Date(t.data("date-to").valueOf()-1);return i.getMonth()===o.getMonth()?this._dateFormat(i,"d.")+e+this._dateFormat(o,"d. MMMM yyyy"):i.getFullYear()===o.getFullYear()?this._dateFormat(i,"d. MMMM")+e+this._dateFormat(o,"d. MMMM yyyy"):this._dateFormat(i,"d. MMMM yyyy")+e+this._dateFormat(o,"d. MMMM yyyy")},t.Planner.prototype._removeAllResources=function(){this.resources.forEach(function(t){t.$resource.remove()})},t.Planner.prototype._renderResources=function(t){var i,o,n="";for(t=t||this.resources,i=0;i<t.length;i++)o=t[i],n+=this._buildResourceHtml(o,this.$grid);e(n).appendTo(this.$grid),this.$grid.children(".planner-resource").each(function(t,i){var n=e(i);o=this._resourceById(n.attr("data-id")),this._linkResource(n,o),this._linkActivitiesForResource(o)}.bind(this))},t.Planner.prototype._linkResource=function(t,e){t.data("resource",e),e.$resource=t,e.$cells=t.children(".resource-cells")},t.Planner.prototype._linkActivity=function(t,e){t.data("activity",e),e.$activity=t},t.Planner.prototype._rerenderActivities=function(t){t=t||this.resources,t.forEach(function(t){this._removeActivititesForResource(t),this._renderActivititesForResource(t)},this)},t.Planner.prototype._buildResourceHtml=function(e){var i='<div class="planner-resource" data-id="'+e.id+'">';return i+='<div class="resource-title">'+t.strings.encode(e.resourceCell.text||"")+"</div>",i+='<div class="resource-cells">'+this._buildActivitiesHtml(e)+"</div>",i+="</div>"},t.Planner.prototype._renderActivititesForResource=function(t){t.$cells.html(this._buildActivitiesHtml(t)),this._linkActivitiesForResource(t)},t.Planner.prototype._linkActivitiesForResource=function(t){t.$cells.children(".planner-activity").each(function(t,i){var o=e(i),n=this._activityById(o.attr("data-id"));this._linkActivity(o,n)}.bind(this))},t.Planner.prototype._buildActivitiesHtml=function(t){var e="";return t.activities.forEach(function(t){t.beginTime.valueOf()>=this.endScale||t.endTime.valueOf()<=this.beginScale||(e+=this._buildActivityHtml(t))},this),e},t.Planner.prototype._removeActivititesForResource=function(t){t.activities.forEach(function(t){t.$activity&&(t.$activity.remove(),t.$activity=null)},this)},t.Planner.prototype._buildActivityHtml=function(e){var i=100-Math.min(100*e.level,100),o=t.styles.modelToCssColor(e.backgroundColor),n=t.styles.modelToCssColor(e.foregroundColor),r=t.styles.modelToCssColor(e.levelColor),s=e.beginTime.valueOf(),a=e.endTime.valueOf();s=Math.max(s,this.beginScale),a=Math.min(a,this.endScale);var l="planner-activity"+(e.cssClass?" "+e.cssClass:""),h="left: calc("+this.transformLeft(s)+"% + 2px);";h+=" width: calc("+this.transformWidth(s,a)+"% - 4px);",r&&(h+=" background-color: "+r+";",h+=" border-color: "+r+";"),!r&&o&&(h+=" background-color: "+o+";",h+=" border-color: "+o+";"),n&&(h+=" foreground-color: "+n+";"),h+=" background-image: linear-gradient(to bottom, #fff 0%, #fff "+i+"%, transparent "+i+"%, transparent 100% );";var d="<div";return d+=' class="'+l+'"',d+=' style="'+h+'"',d+=' data-id="'+e.id+'"',d+=">"+t.strings.encode(e.text||"")+"</div>"},t.Planner.prototype._onCellMousedown=function(i){var o,n,r=e(i.target),s=t.Planner.SelectionMode;return this.activitySelectable&&(o=this._$elementFromPoint(i.pageX,i.pageY),o.hasClass("planner-activity"))?(n=o.parent().parent(),this.selectResources([n.data("resource")]),this.selectActivity(o.data("activity")),void this.selectRange(new t.DateRange)):void(this.selectionMode!==s.NONE&&(r.hasClass("selector")&&(3===i.which||1===i.which&&i.ctrlKey)||(this.startRow=this._findRow(i.pageY),this.lastRow=this.startRow,this.startRange=this._findScale(i.pageX),this.lastRange=this.startRange,this._select(!0),this._cellMousemoveHandler=this._onCellMousemove.bind(this),r.document().on("mousemove",this._cellMousemoveHandler).one("mouseup",this._onDocumentMouseup.bind(this)))))},t.Planner.prototype._onResizeMousedown=function(t){var i,o=e(t.target);return(o.hasClass("selector-resize-right")&&this.startRange.to>this.lastRange.to||o.hasClass("selector-resize-left")&&this.startRange.to<this.lastRange.to)&&(i=this.startRange,this.startRange=this.lastRange,this.lastRange=i),o.body().addClass("col-resize"),this._resizeMousemoveHandler=this._onResizeMousemove.bind(this),o.document().on("mousemove",this._resizeMousemoveHandler).one("mouseup",this._onDocumentMouseup.bind(this)),!1},t.Planner.prototype._onCellMousemove=function(t){var e=this._findRow(t.pageY);e&&(this.lastRow=e);var i=this._findScale(t.pageX);i&&(this.lastRange=i),this._select(!0)},t.Planner.prototype._onResizeMousemove=function(t){if(this.rendered){var e=this._findScale(t.pageX);e&&(this.lastRange=e),this._select(!0)}},t.Planner.prototype._onDocumentMouseup=function(t){var i=e(t.target);i.body().removeClass("col-resize"),this._cellMousemoveHandler&&(i.document().off("mousemove",this._documentMousemoveHandler),this._cellMousemoveHandler=null),this._resizeMousemoveHandler&&(i.document().off("mousemove",this._resizeMousemoveHandler),this._resizeMousemoveHandler=null),this.rendered&&this._select()},t.Planner.prototype._select=function(i){if(this.startRow&&this.lastRow){this.startRange||this.lastRange||(this.selectionRange.from&&(this.startRange={},this.startRange.from=this.selectionRange.from.getTime(),this.startRange.to=this.startRange.from),this.selectionRange.to&&(this.lastRange={},this.lastRange.from=this.selectionRange.to.getTime(),this.lastRange.to=this.lastRange.from));var o=!(!this.startRange||!this.lastRange),n=this.startRow.$resource,r=this.lastRow.$resource;this.selectionMode===t.Planner.SelectionMode.SINGLE_RANGE&&(this.lastRow=this.startRow,r=this.startRow.$resource);for(var s=n[0].offsetTop<=r[0].offsetTop?n:r,a=n[0].offsetTop>r[0].offsetTop?n:r,l=e(".planner-resource",this.$grid).toArray(),h=s[0].offsetTop,d=a[0].offsetTop,p=l.length-1;p>=0;p--){var u=l[p];(u.offsetTop<h&&u.offsetTop<d||u.offsetTop>h&&u.offsetTop>d)&&l.splice(p,1)}if(this.selectResources(l.map(function(t){return e(t).data("resource")}),!i),this.selectActivity(null),o){var c=Math.min(this.lastRange.from,this.startRange.from),f=Math.max(this.lastRange.to,this.startRange.to),y=new t.DateRange(new Date(c),new Date(f));this.selectRange(y,!i)}}},t.Planner.prototype._findRow=function(t){var e=this.$grid.offset().left+10,i=this._$elementFromPoint(e,t).parent();return i.hasClass("planner-resource")?i.data("resource"):null},t.Planner.prototype._findScale=function(e){var o=this.$scale.offset().top+.75*this.$scale.height(),n=this._$elementFromPoint(e,o);return n.data("date-from")!==i?new t.DateRange(n.data("date-from").valueOf(),n.data("date-to").valueOf()):null},t.Planner.prototype._$elementFromPoint=function(t,i){return e(this.$container.document(!0).elementFromPoint(t,i))},t.Planner.prototype._dateFormat=function(e,i){var o=new Date(e.valueOf()),n=new t.DateFormat(this.session.locale,i);return n.format(o)},t.Planner.prototype._renderViewRange=function(){this._renderRange(),this._renderScale(),this.invalidateLayoutTree()},t.Planner.prototype._renderHeaderVisible=function(){this._header.setVisible(this.headerVisible),this.invalidateLayoutTree()},t.Planner.prototype._renderYearPanelVisible=function(t){var i;this.yearPanelVisible&&this._yearPanel.renderContent(),e(".calendar-toggle-year",this.$modes).select(this.yearPanelVisible),i=this.yearPanelVisible?210:0,this._yearPanel.$container.animate({width:i},{duration:t?500:0,progress:this._onYearPanelWidthChange.bind(this),complete:this._afterYearPanelWidthChange.bind(this)})},t.Planner.prototype._onYearPanelWidthChange=function(){if(this._yearPanel.$container){var t=this._yearPanel.$container.outerWidth();this.$grid.css("width","calc(100% - "+t+"px)"),this.$scale.css("width","calc(100% - "+t+"px)"),this.revalidateLayout()}},t.Planner.prototype._afterYearPanelWidthChange=function(){this.yearPanelVisible||this._yearPanel.removeContent()},t.Planner.prototype._syncMenus=function(t){this.updateKeyStrokes(t,this.menus),this._setProperty("menus",t),this._updateMenuBar()},t.Planner.prototype._updateMenuBar=function(){var t=this._filterMenus(["Planner.EmptySpace","Planner.Resource","Planner.Activity","Planner.Range"],!0);this.menuBar.setMenuItems(t)},t.Planner.prototype._removeMenus=function(){};t.Planner.prototype._filterMenus=function(e,i){return e=e||[],e.indexOf("Planner.Resource")>-1&&0===this.selectedResources.length&&t.arrays.remove(e,"Planner.Resource"),e.indexOf("Planner.Activity")>-1&&!this.selectedActivity&&t.arrays.remove(e,"Planner.Activity"),e.indexOf("Planner.Range")>-1&&!this.selectionRange.from&&!this.selectionRange.to&&t.arrays.remove(e,"Planner.Range"),t.menus.filter(this.menus,e,!0,i)};t.Planner.prototype._renderWorkDayCount=function(){},t.Planner.prototype._renderWorkDaysOnly=function(){},t.Planner.prototype._renderDisplayModeOptions=function(){this._renderRange(),this._renderScale(),this.invalidateLayoutTree()},t.Planner.prototype._renderAvailableDisplayModes=function(){},t.Planner.prototype._renderDisplayMode=function(){},t.Planner.prototype._syncViewRange=function(e){e=t.DateRange.ensure(e),this._setProperty("viewRange",e),this._yearPanel.setViewRange(this.viewRange),this._yearPanel.selectDate(this.viewRange.from)},t.Planner.prototype._syncDisplayMode=function(t){this._setProperty("displayMode",t),this._yearPanel.setDisplayMode(this.displayMode),this._header.setDisplayMode(this.displayMode)},t.Planner.prototype._syncAvailableDisplayModes=function(t){this._setProperty("availableDisplayModes",t),this._header.setAvailableDisplayModes(this.availableDisplayModes)},t.Planner.prototype._syncSelectionRange=function(e){e=t.DateRange.ensure(e),this._setProperty("selectionRange",e),this._updateMenuBar()},t.Planner.prototype._syncSelectedResources=function(t){"string"==typeof t[0]&&(t=this._resourcesByIds(t)),this.rendered&&this._removeSelectedResources(),this._setProperty("selectedResources",t),this._updateMenuBar()},t.Planner.prototype._removeSelectedResources=function(){this.selectedResources.forEach(function(t){t.$resource.select(!1)})},t.Planner.prototype._renderSelectedResources=function(){this.selectedResources.forEach(function(t){t.$resource.select(!0)})},t.Planner.prototype._renderActivitySelectable=function(){this.selectedActivity&&this.selectedActivity.$activity&&this.selectedActivity.$activity.toggleClass("selected",this.activitySelectable)},t.Planner.prototype._renderSelectionMode=function(){this.selectionMode===t.Planner.SelectionMode.NONE?this.$selector&&(this.$selector.remove(),this.$highlight.remove()):this._renderSelectionRange()},t.Planner.prototype._renderSelectionRange=function(){var t,e,i=this.selectionRange.from,o=this.selectionRange.to,n=this.selectedResources[0],r=this.selectedResources[this.selectedResources.length-1];if(this.$selector&&(this.$selector.remove(),this.$highlight.remove()),n&&r&&this.selectionRange.from&&this.selectionRange.to){t=n.$resource,e=r.$resource;var s=t[0].offsetTop<=e[0].offsetTop?t:e;this.$selector=s.children(".resource-cells").appendDiv("selector"),this.$selector.cssHeight(t.outerHeight()+Math.abs(e[0].offsetTop-t[0].offsetTop));var a=this.$selector.appendDiv("selector-resize-left").mousedown(this._onResizeMousedown.bind(this)),l=this.$selector.appendDiv("selector-resize-right").mousedown(this._onResizeMousedown.bind(this));this.$selector.css("left","calc("+this.transformLeft(i)+"% - "+a.cssWidth()+"px)").css("width","calc("+this.transformWidth(i,o)+"% + "+(a.cssWidth()+l.cssWidth())+"px)").on("contextmenu",this._onRangeSelectorContextMenu.bind(this)),this.$highlight=this.$timelineSmall.prependDiv("highlight");var h=this.$selector.cssLeft()+a.cssWidth()+this.$scaleTitle.cssWidth(),d=this.$selector.cssWidth()-(a.cssWidth()+l.cssWidth());this.$highlight.cssLeft(h).cssWidth(d)}},t.Planner.prototype._syncSelectedActivity=function(t){"string"==typeof t&&(t=this._activityById(t)),this.rendered&&this._removeSelectedActivity(),this._setProperty("selectedActivity",t),this._updateMenuBar()},t.Planner.prototype._removeSelectedActivity=function(){this.selectedActivity&&this.selectedActivity.$activity&&this.selectedActivity.$activity.removeClass("selected")},t.Planner.prototype._renderSelectedActivity=function(){this.selectedActivity&&this.selectedActivity.$activity&&this.selectedActivity.$activity.addClass("selected")},t.Planner.prototype._renderLabel=function(){var t=this.label||"";this.$scaleTitle&&this.$scaleTitle.text(t)},t.Planner.prototype._resourcesByIds=function(t){return t.map(this._resourceById.bind(this))},t.Planner.prototype._activityById=function(t){return this.activityMap[t]},t.Planner.prototype._resourceById=function(t){return this.resourceMap[t]},t.Planner.prototype.setDisplayMode=function(t){this.setProperty("displayMode",t),this.startRange=null,this.lastRange=null},t.Planner.prototype.layoutYearPanel=function(){this.yearPanelVisible&&(t.scrollbars.update(this._yearPanel.$yearList),this._yearPanel._scrollYear())},t.Planner.prototype.setYearPanelVisible=function(t){this.yearPanelVisible!==t&&(this._setProperty("yearPanelVisible",t),this.rendered&&this._renderYearPanelVisible(!0))},t.Planner.prototype.setViewRangeFrom=function(e){var i=this.viewRange.to.getTime()-this.viewRange.from.getTime(),o=new t.DateRange(this.viewRange.from,this.viewRange.to);o.from=e,o.to=new Date(e.getTime()+i),this.setViewRange(o)},t.Planner.prototype.setViewRange=function(t){this.viewRange!==t&&(this._syncViewRange(t),this.rendered&&(this._renderViewRange(),this._rerenderActivities(),this._renderSelectedActivity(),this.validateLayoutTree()))},t.Planner.prototype.selectRange=function(t){t&&t.equals(this.selectionRange)||(this.setProperty("selectionRange",t),this._updateMenuBar())},t.Planner.prototype.selectActivity=function(t){this.setProperty("selectedActivity",t),this._updateMenuBar()},t.Planner.prototype.selectResources=function(e){t.arrays.equals(e,this.selectedResources)||(e=t.arrays.ensure(e),e=e.slice(),this.setProperty("selectedResources",e),this.trigger("resourcesSelected",{resources:e}),this._updateMenuBar(),this.rendered&&this._renderSelectionRange())},t.Planner.prototype.deselectResources=function(e){var i=!1;e=t.arrays.ensure(e);var o=this.selectedResources.slice();return t.arrays.removeAll(o,e)&&(this.selectResources(o),i=!0),i},t.Planner.prototype.insertResources=function(t){t.forEach(function(t){this._initResource(t),this.resources.push(t)}.bind(this)),this.rendered&&(this._renderResources(t),this.invalidateLayoutTree())},t.Planner.prototype.deleteResources=function(e){this.deselectResources(e)&&this.selectRange(new t.DateRange),e.forEach(function(e){t.arrays.remove(this.resources,e),delete this.resourceMap[e.id],e.activities.forEach(function(t){delete this.activityMap[t.id]}.bind(this)),this.rendered&&(e.$resource.remove(),delete e.$resource)}.bind(this)),this.invalidateLayoutTree()},t.Planner.prototype.deleteAllResources=function(){this.rendered&&(this._removeAllResources(),this.invalidateLayoutTree()),this.resources=[],this.resourceMap={},this.activityMap={},this.selectResources([]),this.selectRange(new t.DateRange)},t.Planner.prototype._updateResources=function(i){i.forEach(function(i){var o=this.resourceMap[i.id];if(!o)throw new Error("Update event received for non existing resource. ResourceId: "+i.id);if(this._initResource(i),t.arrays.replace(this.resources,o,i),t.arrays.replace(this.selectedResources,o,i),this.rendered&&o.$resource){var n=e(this._buildResourceHtml(i));o.$resource.replaceWith(n),n.css("min-width",o.$resource.css("min-width")),this._linkResource(n,i)}}.bind(this))},t.PlannerAdapter=function(){t.PlannerAdapter.parent.call(this),this._addRemoteProperties(["displayMode","viewRange","selectionRange","selectedActivity"])},t.inherits(t.PlannerAdapter,t.ModelAdapter),t.PlannerAdapter.prototype._sendViewRange=function(e){this._send("property",{viewRange:t.dates.toJsonDateRange(e)})},t.PlannerAdapter.prototype._sendSelectedActivity=function(){var t=null;this.widget.selectedActivity&&(t=this.widget.selectedActivity.id),this._send("property",{selectedActivity:t})},t.PlannerAdapter.prototype._sendSelectionRange=function(){var e=t.dates.toJsonDateRange(this.widget.selectionRange);this._send("property",{selectionRange:e})},t.PlannerAdapter.prototype._onWidgetResourcesSelected=function(t){this._sendResourcesSelected()},t.PlannerAdapter.prototype._sendResourcesSelected=function(){var t=this.widget.selectedResources.map(function(t){return t.id});this._send("resourcesSelected",{resourceIds:t})},t.PlannerAdapter.prototype._onWidgetEvent=function(e){"resourcesSelected"===e.type?this._onWidgetResourcesSelected(e):t.PlannerAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.PlannerAdapter.prototype._onResourcesInserted=function(t){this.widget.insertResources(t)},t.PlannerAdapter.prototype._onResourcesDeleted=function(e){var i=this.widget._resourcesByIds(e);this.addFilterForWidgetEventType("resourcesSelected"),this.addFilterForProperties({selectionRange:new t.DateRange}),this.widget.deleteResources(i)},t.PlannerAdapter.prototype._onAllResourcesDeleted=function(){this.addFilterForWidgetEventType("resourcesSelected"),this.addFilterForProperties({selectionRange:new t.DateRange}),this.widget.deleteAllResources()},t.PlannerAdapter.prototype._onResourcesSelected=function(t){var e=this.widget._resourcesByIds(t);this.addFilterForWidgetEventType("resourcesSelected"),this.widget.selectResources(e,!1)},t.PlannerAdapter.prototype._onResourcesUpdated=function(t){this.widget._updateResources(t)},t.PlannerAdapter.prototype.onModelAction=function(e){"resourcesInserted"===e.type?this._onResourcesInserted(e.resources):"resourcesDeleted"===e.type?this._onResourcesDeleted(e.resourceIds):"allResourcesDeleted"===e.type?this._onAllResourcesDeleted():"resourcesSelected"===e.type?this._onResourcesSelected(e.resourceIds):"resourcesUpdated"===e.type?this._onResourcesUpdated(e.resources):t.PlannerAdapter.parent.prototype.onModelAction.call(this,e)},t.PlannerHeader=function(){t.PlannerHeader.parent.call(this),this.availableDisplayModes=[]},t.inherits(t.PlannerHeader,t.Widget),t.PlannerHeader.prototype._render=function(t){this.$container=t.appendDiv("planner-header"),this.$range=this.$container.appendDiv("planner-range"),this.$range.appendDiv("planner-previous").on("click",this._onPreviousClick.bind(this)),this.$range.appendDiv("planner-today",this.session.text("ui.CalendarToday")).on("click",this._onTodayClick.bind(this)),this.$range.appendDiv("planner-next").on("click",this._onNextClick.bind(this)),this.$range.appendDiv("planner-select"),this.$commands=this.$container.appendDiv("planner-commands"),this._renderAvailableDisplayModes(),this._renderDisplayMode()},t.PlannerHeader.prototype.setAvailableDisplayModes=function(t){this.setProperty("availableDisplayModes",t)},t.PlannerHeader.prototype._renderAvailableDisplayModes=function(){var e=t.Planner.DisplayMode;this.$commands.empty(),this.availableDisplayModes.length>1&&(this.availableDisplayModes.indexOf(e.DAY)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarDay")).attr("data-mode",e.DAY).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.WORK_WEEK)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarWorkWeek")).attr("data-mode",e.WORK_WEEK).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.WEEK)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarWeek")).attr("data-mode",e.WEEK).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.MONTH)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarMonth")).attr("data-mode",e.MONTH).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.CALENDAR_WEEK)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarCalendarWeek")).attr("data-mode",e.CALENDAR_WEEK).on("click",this._onDisplayModeClick.bind(this)),this.availableDisplayModes.indexOf(e.YEAR)>-1&&this.$commands.appendDiv("planner-mode",this.session.text("ui.CalendarYear")).attr("data-mode",e.YEAR).on("click",this._onDisplayModeClick.bind(this)));var i=this.$commands.children(".planner-mode");i.first().addClass("first"),i.last().addClass("last"),this.$commands.appendDiv("planner-toggle-year").on("click",this._onYearClick.bind(this))},t.PlannerHeader.prototype.setDisplayMode=function(t){this.setProperty("displayMode",t)},t.PlannerHeader.prototype._renderDisplayMode=function(){e(".planner-mode",this.$commands).select(!1),e('[data-mode="'+this.displayMode+'"]',this.$commands).select(!0)},t.PlannerHeader.prototype._onTodayClick=function(t){this.trigger("todayClick")},t.PlannerHeader.prototype._onNextClick=function(t){this.trigger("nextClick")},t.PlannerHeader.prototype._onPreviousClick=function(t){this.trigger("previousClick")},t.PlannerHeader.prototype._onYearClick=function(t){this.trigger("yearClick")},t.PlannerHeader.prototype._onDisplayModeClick=function(t){var i=e(t.target).data("mode");this.setDisplayMode(i),this.trigger("displayModeClick",{displayMode:this.displayMode})},t.PlannerLayout=function(e){t.PlannerLayout.parent.call(this),this.planner=e},t.inherits(t.PlannerLayout,t.AbstractLayout),t.PlannerLayout.prototype.layout=function(e){var i,o=this.planner._header.$container,n=this.planner.$scale,r=this.planner.$grid,s=this.planner.menuBar,a=this.planner._yearPanel.$container,l=0,h=0,d=0,p=0,u=0,c=t.HtmlComponent.get(s.$container),f=this.planner.htmlComp,y=f.getAvailableSize().subtract(f.getInsets());s.$container.isVisible()&&(i=t.MenuBarLayout.size(c,y),c.setSize(i),l=i.height,"top"===s.position&&(u+=l)),o.isVisible()&&(u+=t.graphics.getSize(o).height),n.css("top",u),p+=u+t.graphics.getSize(n).height,r.css("top",p),d=u+a.cssMarginY(),h=p+r.cssMarginY(),s.$container.isVisible()&&"bottom"===s.position&&(d+=l,h+=l),a.css("height","calc(100% - "+d+"px)"),r.css("height","calc(100% - "+h+"px)"),this._updateMinWidth(),this._layoutScaleLines(),t.scrollbars.update(this.planner.$grid,!0),this.planner.layoutYearPanel()},t.PlannerLayout.prototype._updateMinWidth=function(){var t=this._minWidth(),e=this.planner.$scaleTitle,i=this.planner.$timeline;i&&(i.css("min-width",t),t+=e.outerWidth(!0),this.planner.resources.forEach(function(e){e.$resource.css("min-width",t)}))},t.PlannerLayout.prototype._layoutScaleLines=function(){var i,o,n,r,s=this.planner.$timelineSmall,a=this.planner.$timelineLarge;s&&(o=s.children(".scale-item"),n=a.children(".scale-item"),n.each(function(){var t=e(this).data("scale-item-line");t.cssHeight(0)}),o.each(function(){var t=e(this).data("scale-item-line");t&&t.cssHeight(0)}),t.scrollbars.reset(this.planner.$grid),i=this.planner.$grid[0].scrollHeight,r=this.planner.$scale[0].scrollLeft,n.each(function(){var t=e(this),o=t.data("scale-item-line");o.cssLeft(r+t.position().left).cssHeight(i)}),o.each(function(){var t=e(this),o=t.data("scale-item-line");o&&o.cssLeft(r+t.position().left).cssHeight(i)}))},t.PlannerLayout.prototype._minWidth=function(){var e=this.planner.$timelineLarge.children(".scale-item"),i=this.planner.$timelineSmall.children(".scale-item"),o=e.length,n=i.length,r=t.Planner.DisplayMode,s=t.graphics.getInsets(i,{includeBorder:!1}),a=n*s.horizontal();return this.planner.displayMode===r.DAY?Math.max(a,52*o):t.isOneOf(this.planner.displayMode,r.WORK_WEEK,r.WEEK)?Math.max(a,160*o):this.planner.displayMode===r.MONTH?Math.max(a,23*n):this.planner.displayMode===r.CALENDAR_WEEK?Math.max(a,23*n):this.planner.displayMode===r.YEAR?Math.max(a,90*n):void 0},t.PlannerMenuItemsOrder=function(e,i){t.PlannerMenuItemsOrder.parent.call(this,e,i),this.selectionTypes=["Resource","Activity","Range"]},t.inherits(t.PlannerMenuItemsOrder,t.MenuItemsOrder),t.FileChooser=function(){t.FileChooser.parent.call(this),this._files=[],this._glassPaneRenderer},t.inherits(t.FileChooser,t.Widget),t.FileChooser.prototype._init=function(e){t.FileChooser.parent.prototype._init.call(this,e),this._glassPaneRenderer=new t.GlassPaneRenderer(this.session,this,(!0))},t.FileChooser.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.FileChooser.prototype._initKeyStrokeContext=function(){t.FileChooser.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke([new t.FocusAdjacentElementKeyStroke(this.session,this),new t.ClickActiveElementKeyStroke(this,[t.keys.SPACE,t.keys.ENTER]),new t.CloseKeyStroke(this,function(){return this.$cancelButton}.bind(this))])},t.FileChooser.prototype._render=function(i){this._glassPaneRenderer.renderGlassPanes(),this.$container=i.appendDiv("file-chooser");var o=this.$container.appendDiv("drag-handle");this.$container.makeDraggable(o),this.$container.appendDiv("closable").on("click",function(){this._doCancel()}.bind(this)),this.$content=this.$container.appendDiv("file-chooser-content"),this.$title=this.$content.appendDiv("file-chooser-title").text(this.session.text(this.multiSelect?"ui.ChooseFiles":"ui.ChooseFile")),this.$fileInputField=i.makeElement("<input>").attr("type","file").prop("multiple",this.multiSelect).attr("accept",this.acceptTypes).on("change",this._onFileChange.bind(this)),t.device.supportsFile()?(this.$fileInputField.appendTo(this.$container),this.$container.on("dragenter",this._onDragEnterOrOver.bind(this)).on("dragover",this._onDragEnterOrOver.bind(this)).on("drop",this._onDrop.bind(this)),this.$content.appendDiv("file-chooser-label").text(this.session.text("ui.FileChooserHint")),this.$files=this.$content.appendElement("<ul>","file-chooser-files"),t.scrollbars.install(this.$files,{parent:this})):(this.$legacyFormTarget=this.$fileInputField.appendElement("<iframe>").attr("name","legacyFileUpload"+this.id).on("load",function(){try{var i=this.$legacyFormTarget.contents().text();if(t.strings.hasText(i)){var o=e.parseJSON(i);this.session.responseQueue.process(o)}}finally{this.session.setBusy(!1)}}.bind(this)),this.$fileInputField.attr("name","file").addClass("legacy-upload-file-input"),this.$legacyForm=this.$content.appendElement("<form>","legacy-upload-form").attr("action","upload/"+this.session.uiSessionId+"/"+this.id).attr("enctype","multipart/form-data").attr("method","post").attr("target","legacyFileUpload"+this.id).append(this.$fileInputField),this.$legacyForm.appendElement("<input>").attr("name","legacyFormTextPlainAnswer").attr("type","hidden")),this.$buttons=this.$container.appendDiv("file-chooser-buttons");var n=new t.BoxButtons(this.$buttons);t.device.supportsFile()&&(this.$addFileButton=n.addButton({text:this.session.text("ui.Browse"),onClick:this._onAddFileButtonClicked.bind(this)})),this.$uploadButton=n.addButton({text:this.session.text("ui.Upload"),onClick:this._onUploadButtonClicked.bind(this),enabled:!1}),this.$cancelButton=n.addButton({text:this.session.text("Cancel"),onClick:this._onCancelButtonClicked.bind(this)}),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.FormLayout(this)),this.htmlComp.pixelBasedSizing=!1,this.$container.addClassForAnimation("animate-open"),this.$container.addClass("calc-helper"),this.$container.css("min-width",this.$container.width()),this.$container.removeClass("calc-helper"),n.updateButtonWidths(this.$container.width()),this._position()},t.FileChooser.prototype._postRender=function(){t.FileChooser.parent.prototype._postRender.call(this),this.session.focusManager.installFocusContext(this.$container,t.focusRule.AUTO)},t.FileChooser.prototype._remove=function(){this._glassPaneRenderer.removeGlassPanes(),this.session.focusManager.uninstallFocusContext(this.$container),t.FileChooser.parent.prototype._remove.call(this)},t.FileChooser.prototype._position=function(){this.$container.cssMarginLeft(-this.$container.outerWidth()/2)},t.FileChooser.prototype._doUpload=function(){if(t.device.supportsFile()){if(0===this._files.length)return void this._doCancel();this.session.uploadFiles(this,this._files,i,this.maximumUploadSize)}else this.$fileInputField[0].value&&(this.session.setBusy(!0),this.$legacyForm[0].submit())},t.FileChooser.prototype._doCancel=function(){this.trigger("cancel")},t.FileChooser.prototype._doAddFile=function(){this.$fileInputField.click()},t.FileChooser.prototype._onUploadButtonClicked=function(t){this.$uploadButton.setEnabled(!1),this._doUpload(),this.session.listen().done(function(){this.$uploadButton.setEnabled(!0)}.bind(this))},t.FileChooser.prototype._onCancelButtonClicked=function(t){this._doCancel()},t.FileChooser.prototype._onAddFileButtonClicked=function(t){this._doAddFile()},t.FileChooser.prototype._onFileChange=function(e){t.device.supportsFile()?this.addFiles(this.$fileInputField[0].files):this.$uploadButton.setEnabled(this.$fileInputField[0].value)},t.FileChooser.prototype.addFiles=function(e){for(var i=0;i<e.length;i++){var o=e[i];this.multiSelect?this._files.push(o):(this._files=[o],this.$files.empty());var n=this.$files.appendElement("<li>","file",o.name);n.append(" ");var r=n.appendSpan("remove menu-item").on("click",this.removeFile.bind(this,o,n)),s=n.makeElement("<a>","remove-link",this.session.text("Remove"));r.appendTextNode("("),r.append(s),r.appendTextNode(")")}this.$uploadButton.setEnabled(this._files.length>0),t.scrollbars.update(this.$files)},t.FileChooser.prototype.removeFile=function(e,i){var o=this._files.indexOf(e);o>-1&&this._files.splice(o,1),i&&i.remove(),this.$uploadButton.setEnabled(this._files.length>0),t.scrollbars.update(this.$files)},t.FileChooser.prototype._onDragEnterOrOver=function(e){t.dragAndDrop.verifyDataTransferTypesScoutTypes(e,t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)},t.FileChooser.prototype._onDrop=function(i){t.dragAndDrop.dataTransferTypesContainsScoutTypes(i.originalEvent.dataTransfer,t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)&&(e.suppressEvent(i),this.addFiles(i.originalEvent.dataTransfer.files))},t.FileChooser.prototype._attach=function(){this.$parent.append(this.$container),this.session.detachHelper.afterAttach(this.$container),t.FileChooser.parent.prototype._attach.call(this)},t.FileChooser.prototype._detach=function(){this.session.detachHelper.beforeDetach(this.$container),this.$container.detach(),t.FileChooser.parent.prototype._detach.call(this)},t.FileChooser.prototype.close=function(){this.$cancelButton&&this.session.focusManager.requestFocus(this.$cancelButton)&&this.$cancelButton.click()},t.FileChooserAdapter=function(){t.FileChooserAdapter.parent.call(this)},t.inherits(t.FileChooserAdapter,t.ModelAdapter),t.FileChooserAdapter.prototype._onWidgetCancel=function(t){this._send("cancel")},t.FileChooserAdapter.prototype._onWidgetEvent=function(e){"cancel"===e.type?this._onWidgetCancel(e):t.FileChooserAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.FileChooserController=function(t,e){this.displayParent=t,this.session=e},t.FileChooserController.prototype.registerAndRender=function(t){t._setProperty("displayParent",this.displayParent),this.displayParent.fileChoosers.push(t),this._render(t)},t.FileChooserController.prototype.unregisterAndRemove=function(e){e&&(t.arrays.remove(this.displayParent.fileChoosers,e),this._remove(e))},t.FileChooserController.prototype.remove=function(){this.displayParent.fileChoosers.forEach(this._remove.bind(this))},t.FileChooserController.prototype.render=function(){this.displayParent.fileChoosers.forEach(this._render.bind(this))},t.FileChooserController.prototype._render=function(t){this.displayParent.rendered&&(t.rendered||(t.render(this.session.desktop.$container),this.displayParent.inFront()||t.detach()))},t.FileChooserController.prototype._remove=function(t){t.remove()},t.FileChooserController.prototype.attach=function(){this.displayParent.fileChoosers.forEach(function(t){
t.attach()},this)},t.FileChooserController.prototype.detach=function(){this.displayParent.fileChoosers.forEach(function(t){t.detach()},this)},t.Slider=function(){t.Slider.parent.call(this),this.value,this.minValue,this.maxValue,this.step},t.inherits(t.Slider,t.Widget),t.Slider.prototype._init=function(e){t.Slider.parent.prototype._init.call(this,e),this.value=e.value,this.minValue=e.minValue,this.maxValue=e.maxValue,this.step=e.step},t.Slider.prototype._render=function(e){this.$container=e.appendDiv("slider"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.SliderLayout(this)),this.$sliderInput=this.$container.appendElement("<input>","slider-input").attr("type","range").on("change",this._onValueChange.bind(this)),this.$sliderValue=this.$container.appendSpan("slider-value",this.value)},t.Slider.prototype._renderProperties=function(){t.Slider.parent.prototype._renderProperties.call(this),this._renderValue(),this._renderMinValue(),this._renderMaxValue(),this._renderStep()},t.Slider.prototype._renderValue=function(){var e=t.nvl(this.value,0);this.$sliderInput.val(e),this.$sliderValue.text(e)},t.Slider.prototype._renderMinValue=function(){this.minValue?this.$sliderInput.attr("min",this.minValue):this.$sliderInput.removeAttr("min")},t.Slider.prototype._renderMaxValue=function(){this.maxValue?this.$sliderInput.attr("max",this.maxValue):this.$sliderInput.removeAttr("max")},t.Slider.prototype._renderStep=function(){this.step?this.$sliderInput.attr("step",this.step):this.$sliderInput.removeAttr("step")},t.Slider.prototype._onValueChange=function(t){this.setValue(this.$sliderInput.val())},t.Slider.prototype.setValue=function(t){this.setProperty("value",t)},t.SliderAdapter=function(){t.SliderAdapter.parent.call(this),this._addRemoteProperties(["value"])},t.inherits(t.SliderAdapter,t.ModelAdapter),t.SliderLayout=function(e){t.SliderLayout.parent.call(this),this.slider=e},t.inherits(t.SliderLayout,t.AbstractLayout),t.SliderLayout.prototype.layout=function(e){var i=t.graphics.getSize(e);this.slider.$sliderInput.css("height",i.height),this.slider.$sliderValue.css("height",i.height)},t.Form=function(){t.Form.parent.call(this),this._addAdapterProperties(["rootGroupBox","views","dialogs","initialFocus","messageBoxes","fileChoosers"]),this.displayHint=t.Form.DisplayHint.DIALOG,this.maximizeEnabled=!0,this.maximized=!1,this.minimizeEnabled=!0,this.minimized=!1,this.modal=!0,this.dialogs=[],this.views=[],this.messageBoxes=[],this.fileChoosers=[],this.closable=!0,this.cacheBounds=!1,this.resizable=!0,this.rootGroupBox,this._locked,this.formController,this.messageBoxController,this.fileChooserController,this._glassPaneRenderer,this.renderInitialFocusEnabled=!0},t.inherits(t.Form,t.Widget),t.Form.DisplayHint={DIALOG:"dialog",POPUP_WINDOW:"popupWindow",VIEW:"view"},t.Form.prototype._init=function(e){t.Form.parent.prototype._init.call(this,e),this.formController=new t.FormController(this,this.session),this.messageBoxController=new t.MessageBoxController(this,this.session),this.fileChooserController=new t.FileChooserController(this,this.session),this._syncRootGroupBox(this.rootGroupBox);var i=this.modal&&!(this.parent instanceof t.WrappedFormField);this._glassPaneRenderer=new t.GlassPaneRenderer(this.session,this,i);var o=function(t){t.newProperties.displayParent&&this._glassPaneRenderer.renderGlassPanes()}.bind(this);this.on("propertyChange",o),this.one("destroy",function(){this.off("propertyChange",o)}.bind(this))},t.Form.prototype._syncRootGroupBox=function(e){this._setProperty("rootGroupBox",e),this.rootGroupBox&&(this.isDialog()||this.searchForm||this.parent instanceof t.WrappedFormField)&&this.rootGroupBox.menuBar.bottom()},t.Form.prototype._renderProperties=function(){t.Form.parent.prototype._renderProperties.call(this),this._updateTitle()},t.Form.prototype._render=function(t){this._renderForm(t)},t.Form.prototype._renderForm=function(i){var o,n;if(this.$container=i.appendDiv().addClass(this.isDialog()?"dialog":"form").data("model",this),this.uiCssClass&&this.$container.addClass(this.uiCssClass),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.pixelBasedSizing=!1,this.isDialog()){if(o=new t.DialogLayout(this),this.htmlComp.validateRoot=!0,n=this.$container.appendDiv("drag-handle"),this.$container.makeDraggable(n,e.throttle(this.onMove.bind(this),1e3/60)),this.closable&&this.$container.appendDiv("closer").on("click",this.close.bind(this)),this.resizable){var r=this.$container.window();this.$container.resizable({start:function(t,e){this.$container.resizable("option","maxHeight",r.height()-t.target.offsetTop),this.$container.resizable("option","maxWidth",r.width()-t.target.offsetLeft)}.bind(this)}),this.$container.on("resize",function(t){var e=this.htmlComp.layout.autoSize;return this.htmlComp.layout.autoSize=!1,this.htmlComp.revalidateLayout(),this.htmlComp.layout.autoSize=e,!1}.bind(this))}this._updateTitle()}else o=new t.FormLayout(this);this.htmlComp.setLayout(o),this.rootGroupBox.render(this.$container),this._locked&&this.disable(),this.isDialog()&&this.$container.addClassForAnimation("animate-open")},t.Form.prototype.close=function(){this._send("formClosing")},t.Form.prototype._postRender=function(){t.Form.parent.prototype._postRender.call(this),this._installFocusContext(),this.renderInitialFocusEnabled&&this.renderInitialFocus(),this.formController.render(),this.messageBoxController.render(),this.fileChooserController.render()},t.Form.prototype._updateTitle=function(){this.isPopupWindow()?this._updateTitleForWindow():this.isDialog()&&this._updateTitleForDom()},t.Form.prototype._updateTitleForWindow=function(){var e=t.strings.join(" - ",this.title,this.subTitle),i=this.session.desktop.title;this.popupWindow.title(e||i)},t.Form.prototype._updateTitleForDom=function(){function e(t,e){var i=t.children("."+e);return 0===i.length&&(i=t.appendDiv(e)),i}function i(t,e){t.children("."+e).remove()}var o=this.title;if(!o&&this.closable&&(o=t.strings.plainText("&nbsp;")),o||this.subTitle){var n=e(this.$container,"title-box");o?e(n,"title").text(o).icon(this.iconId):i(n,"title"),t.strings.hasText(o)?e(n,"sub-title").text(this.subTitle):i(n,"sub-title")}else i(this.$container,"title-box");this.invalidateLayoutTree()},t.Form.prototype.isDialog=function(){return this.displayHint===t.Form.DisplayHint.DIALOG},t.Form.prototype.isPopupWindow=function(){return this.displayHint===t.Form.DisplayHint.POPUP_WINDOW},t.Form.prototype.isView=function(){return this.displayHint===t.Form.DisplayHint.VIEW},t.Form.prototype._isClosable=function(){var e,i,o=this.rootGroupBox.systemButtons;for(e=0;e<o.length;e++)if(i=o[e],i.visible&&i.systemType===t.Button.SystemType.CANCEL||i.systemType===t.Button.SystemType.CLOSE)return!0;return!1},t.Form.prototype.onMove=function(t){this.trigger("move",t)},t.Form.prototype.appendTo=function(t){this.$container.appendTo(t)},t.Form.prototype._remove=function(){this.formController.remove(),this.messageBoxController.remove(),this.fileChooserController.remove(),this._glassPaneRenderer.removeGlassPanes(),this._uninstallFocusContext(),t.Form.parent.prototype._remove.call(this)},t.Form.prototype._renderTitle=function(){this._updateTitle()},t.Form.prototype._renderSubTitle=function(){this._updateTitle()},t.Form.prototype._renderIconId=function(){this._updateTitle()},t.Form.prototype.setEnabled=function(e,o){t.Form.parent.prototype.setEnabled.call(this,e),this.rootGroupBox.setEnabled(e,i,o)},t.Form.prototype.setDisabledStyle=function(t){this.rootGroupBox.setDisabledStyle(t)},t.Form.prototype._attach=function(){this.$parent.append(this.$container),this.isView()&&this.invalidateLayoutTree(!1),this.session.detachHelper.afterAttach(this.$container),!this.isView()&&!this.isDialog()||this.detailForm||this.session.desktop._setFormActivated(this),this.formController.attachDialogs(),this.messageBoxController.attach(),this.fileChooserController.attach(),t.Form.parent.prototype._attach.call(this)},t.Form.prototype._detach=function(){this.formController.detachDialogs(),this.messageBoxController.detach(),this.fileChooserController.detach(),this.session.detachHelper.beforeDetach(this.$container),this.$container.detach(),t.Form.parent.prototype._detach.call(this)},t.Form.prototype.renderInitialFocus=function(){this.rendered&&this.session.focusManager.requestFocus(this._initialFocusElement())},t.Form.prototype._initialFocusElement=function(){var t,e=this.initialFocus;return e&&(t=e.getFocusableElement()),t||(t=this.session.focusManager.findFirstFocusableElement(this.$container)),t},t.Form.prototype._installFocusContext=function(){(this.isDialog()||this.isPopupWindow())&&this.session.focusManager.installFocusContext(this.$container,t.focusRule.NONE)},t.Form.prototype._uninstallFocusContext=function(){(this.isDialog()||this.isPopupWindow())&&this.session.focusManager.uninstallFocusContext(this.$container)},t.Form.prototype.inFront=function(){return this.rendered&&this.attached},t.Form.prototype.requestFocus=function(t){t&&t.focus()},t.Form.prototype.visitFields=function(t){this.rootGroupBox.visit(t)},t.FormAdapter=function(){t.FormAdapter.parent.call(this),this._addAdapterProperties(["rootGroupBox","views","dialogs","initialFocus","messageBoxes","fileChoosers"])},t.inherits(t.FormAdapter,t.ModelAdapter),t.FormAdapter.prototype.onModelAction=function(e){"requestFocus"===e.type?this._onRequestFocus(e.formField):t.FormAdapter.parent.prototype.onModelAction.call(this,e)},t.FormAdapter.prototype._onRequestFocus=function(t){var e=this.session.getOrCreateWidget(t,this.widget);this.widget.requestFocus(e)},t.FormLayout=function(e){t.FormLayout.parent.call(this),this._form=e},t.inherits(t.FormLayout,t.AbstractLayout),t.FormLayout.prototype.layout=function(i){var o,n=t.HtmlComponent.get(i),r=this._htmlRootGroupBox();o=n.getAvailableSize().subtract(n.getInsets()).subtract(r.getMargins()),this._form.isDialog()&&(o.height-=this._titleHeight()),e.log.trace("(FormLayout#layout) rootGbSize="+o),r.setSize(o)},t.FormLayout.prototype.preferredLayoutSize=function(e){var i,o=t.HtmlComponent.get(e),n=this._htmlRootGroupBox();return i=n.getPreferredSize().add(o.getInsets()).add(n.getMargins()),i.height+=this._titleHeight(),i},t.FormLayout.prototype._htmlRootGroupBox=function(){var e=this._form.$container.children(".root-group-box");return t.HtmlComponent.get(e)},t.FormLayout.prototype._titleHeight=function(){var e=this._form.$container.children(".title-box");return t.graphics.prefSize(e,{includeMargin:!0}).height},t.FormLifecycle=function(){this.askSaveChanges=!0,this.askSaveChangesText,this.events=new t.EventSupport,this.handlers={save:this._defaultSave.bind(this)}},t.FormLifecycle.prototype.init=function(e){t.assertParameter("form",e,t.Form),this.form=e,this.askSaveChangesText=this.session().text("FormSaveChangesQuestion"),this.markAsSaved()},t.FormLifecycle.prototype.doCancel=function(){var t=this.requiresSave()&&this.askSaveChanges;t?this._showYesNoCancelMessageBox(this.askSaveChangesText,this.doOk.bind(this),this.doClose.bind(this)):(this.doFinally(),this.disposeForm())},t.FormLifecycle.prototype.disposeForm=function(){this.events.trigger("disposeForm")},t.FormLifecycle.prototype.doReset=function(){throw new Error("doReset not implemented yet")},t.FormLifecycle.prototype._whenInvalid=function(e){var i=e.call(this);if(!(i instanceof t.Status))throw new Error("Expected function to return a scout.Status object");return!i.isValid()&&(this._showStatusMessageBox(i),!0)},t.FormLifecycle.prototype.doOk=function(){if(!this._whenInvalid(this._validateForm)){if(this.requiresSave()){if(this._whenInvalid(this._save))return;this.markAsSaved()}this.doFinally(),this.disposeForm()}},t.FormLifecycle.prototype._showYesNoCancelMessageBox=function(e,i,o){var n=this.session(),r={parent:this.form,severity:t.MessageBox.SEVERITY.WARNING,header:e,yesButtonText:n.text("Yes"),noButtonText:n.text("No"),cancelButtonText:n.text("Cancel")},s=this.form.messageBoxController,a=t.create("MessageBox",r);a.on("action",function(t){s.unregisterAndRemove(a),"yes"===t.option?i():"no"===t.option&&o()}),s.registerAndRender(a)},t.FormLifecycle.prototype._showStatusMessageBox=function(e){var i={parent:this.form,severity:t.MessageBox.SEVERITY.ERROR,html:e.message,yesButtonText:this.session().text("Ok")},o=this.form.messageBoxController,n=t.create("MessageBox",i);n.on("action",o.unregisterAndRemove.bind(o,n)),o.registerAndRender(n)},t.FormLifecycle.prototype._validateForm=function(){var e=[],i=[];this.form.visitFields(function(t){var o=t.validate();if(!o.valid)return o.validByMandatory?o.validByErrorStatus?void 0:void i.push(t):void e.push(t)});var o=new t.Status;return 0===e.length&&0===i.length?o.severity=t.Status.Severity.OK:(o.severity=t.Status.Severity.ERROR,o.message=this._createInvalidFieldsMessageHtml(e,i)),o},t.FormLifecycle.prototype._createInvalidFieldsMessageHtml=function(t,i){function o(t,e,i){t.appendElement("<strong>").text(this.session().text(e));var o=t.appendElement("<ul>");i.forEach(function(t){o.appendElement("<li>").text(t.label)})}var n=e("<div>"),r=t.length>0,s=i.length>0;return r&&o.call(this,n,"FormEmptyMandatoryFieldsMessage",t),r&&s&&n.appendElement("<br>"),s&&o.call(this,n,"FormInvalidFieldsMessage",i),n.html()},t.FormLifecycle.prototype._defaultSave=function(){return t.Status.ok()},t.FormLifecycle.prototype._save=function(){var t=this.handlers.save();return this.events.trigger("save"),t},t.FormLifecycle.prototype.doSave=function(){throw new Error("doSave not implemented yet")},t.FormLifecycle.prototype.doClose=function(){this.doFinally(),this.disposeForm()},t.FormLifecycle.prototype.doFinally=function(){this.events.trigger("finally")},t.FormLifecycle.prototype.markAsSaved=function(){this.form.visitFields(function(t){t.markAsSaved()})},t.FormLifecycle.prototype.requiresSave=function(){var t=!1;return this.form.visitFields(function(e){e.updateRequiresSave(),e.requiresSave&&(t=!0)}),t},t.FormLifecycle.prototype.session=function(){return this.form.session},t.FormLifecycle.prototype.handle=function(t,e){var i=["save"];if(i.indexOf(t)===-1)throw new Error("Cannot register handler for unsupported type '"+t+"'");this.handlers[t]=e},t.FormLifecycle.prototype.on=function(t,e){return this.events.on(t,e)},t.FormLifecycle.prototype.off=function(t,e){return this.events.off(t,e)},t.FormMenu=function(){t.FormMenu.parent.call(this),this.form,this.toggleAction=!0,this._addAdapterProperties("form")},t.inherits(t.FormMenu,t.Menu),t.FormMenu.PopupStyle={DEFAULT:"default",MOBILE:"mobile"},t.FormMenu.prototype._init=function(e){t.FormMenu.parent.prototype._init.call(this,e),this.popupStyle||(this.session.userAgent.deviceType===t.Device.Type.MOBILE?this.popupStyle=t.FormMenu.PopupStyle.MOBILE:this.popupStyle=t.FormMenu.PopupStyle.DEFAULT)},t.FormMenu.prototype._renderForm=function(){this.rendered&&this._renderSelected()},t.FormMenu.prototype.clone=function(e){return e=e||{},e.form=this.form,t.FormMenu.parent.prototype.clone.call(this,e)},t.FormMenu.prototype._createPopup=function(){return this.form.rootGroupBox.menuBar.bottom(),this.popupStyle===t.FormMenu.PopupStyle.MOBILE?t.create("MobilePopup",{parent:this.session.desktop,widget:this.form,title:this.form.title}):t.create("FormMenuPopup",{parent:this,formMenu:this,openingDirectionX:this.popupOpeningDirectionX,openingDirectionY:this.popupOpeningDirectionY})},t.FormMenu.prototype._doActionTogglesPopup=function(){return!!this.form},t.FormMenu.prototype._handleSelectedInEllipsis=function(){return this.popupStyle!==t.FormMenu.PopupStyle.MOBILE?void t.FormMenu.parent.prototype._handleSelectedInEllipsis.call(this):void(this._doActionTogglesPopup()&&(this.selected?this._openPopup():this._closePopup()))},t.FormMenu.prototype._createActionKeyStroke=function(){return new t.FormMenuActionKeyStroke(this)},t.FormMenuActionKeyStroke=function(e){t.FormMenuActionKeyStroke.parent.call(this,e)},t.inherits(t.FormMenuActionKeyStroke,t.ActionKeyStroke),t.FormMenuActionKeyStroke.prototype.handle=function(t){this.field.toggle()};t.FormMenuActionKeyStroke.prototype._postRenderKeyBox=function(t){if(this.field.iconId){var e=t.find(".icon").width(),i=t.find(".key-box").outerWidth(),o=Number(t.css("padding-left").replace("px","")),n=e/2-i/2+o;t.find(".key-box").css("left",n+"px")}};t.FormMenuAdapter=function(){t.FormMenuAdapter.parent.call(this),this._addAdapterProperties("form")},t.inherits(t.FormMenuAdapter,t.MenuAdapter),t.FormMenuPopup=function(){t.FormMenuPopup.parent.call(this),this.formMenu,this.formMenuPropertyChangeHandler=this._onFormMenuPropertyChange.bind(this),this._addAdapterProperties("form")},t.inherits(t.FormMenuPopup,t.PopupWithHead),t.FormMenuPopup.prototype._init=function(e){e.form=e.formMenu.form,e.initialFocus=e.formMenu.form._initialFocusElement.bind(e.formMenu.form),t.FormMenuPopup.parent.prototype._init.call(this,e),this.$formMenu=this.formMenu.$container,this.$headBlueprint=this.$formMenu},t.FormMenuPopup.prototype._createLayout=function(){return new t.FormMenuPopupLayout(this)},t.FormMenuPopup.prototype._render=function(e){t.FormMenuPopup.parent.prototype._render.call(this,e),this.$container.addClass("form-menu-popup"),this.form.renderInitialFocusEnabled=!1,this.form.render(this.$body),this.form.htmlComp.pixelBasedSizing=!0,this._headVisible&&this.formMenu.on("propertyChange",this.formMenuPropertyChangeHandler)},t.FormMenuPopup.prototype._remove=function(){t.FormMenuPopup.parent.prototype._remove.call(this),this._headVisible&&this.formMenu.off("propertyChange",this.formMenuPropertyChangeHandler)},t.FormMenuPopup.prototype._renderHead=function(){t.FormMenuPopup.parent.prototype._renderHead.call(this),this.formMenu.uiCssClass&&this._copyCssClassToHead(this.formMenu.uiCssClass),this.formMenu.cssClass&&this._copyCssClassToHead(this.formMenu.cssClass),this._copyCssClassToHead("unfocusable")},t.FormMenuPopup.prototype._onFormMenuPropertyChange=function(t){this.session.layoutValidator.schedulePostValidateFunction(function(){this.rendered&&(this.rerenderHead(),this.position())}.bind(this))},t.FormMenuPopupLayout=function(e){t.FormMenuPopupLayout.parent.call(this,e),this.popup=e},t.inherits(t.FormMenuPopupLayout,t.PopupWithHeadLayout),t.FormMenuPopupLayout.prototype.layout=function(e){var i,o=this.popup.form.htmlComp;t.FormMenuPopupLayout.parent.prototype.layout.call(this,e),i=t.graphics.getSize(this.popup.$body),i=i.subtract(t.graphics.getInsets(this.popup.$body)),o.setSize(i)},t.FormMenuPopupLayout.prototype.preferredLayoutSize=function(e){var i,o=this.popup.htmlComp,n=this.popup.form.htmlComp;return i=n.getPreferredSize().add(o.getInsets()).add(t.graphics.getInsets(this.popup.$body,{includeMargin:!0})).add(n.getMargins())},t.DialogLayout=function(e){t.DialogLayout.parent.call(this,e),this.autoSize=!0},t.inherits(t.DialogLayout,t.FormLayout),t.DialogLayout.prototype.layout=function(e){if(!this.autoSize)return void t.DialogLayout.parent.prototype.layout.call(this,e);var i=this._form.htmlComp,o=this._form.$container.window(),n=i.getMargins(),r=new t.Dimension(o.width(),o.height()),s=new t.Dimension,a=i.getBounds(),l=this.preferredLayoutSize(e);a.width-=n.horizontal(),a.height-=n.vertical();var h=r.width-n.horizontal()-a.x,d=r.height-n.vertical()-a.y;s.width=Math.min(h,l.width),s.height=Math.min(d,l.height),i.layouted&&(s.width=Math.max(s.width,a.width),s.height=Math.max(s.height,a.height)),t.graphics.setSize(i.$comp,s),t.DialogLayout.parent.prototype.layout.call(this,e)},t.Table=function(){t.Table.parent.call(this),this.rowIconVisible=!1,this.autoResizeColumns=!1,this.columnAddable=!1,this.checkable=!1,this.enabled=!0,this.headerEnabled=!0,this.headerVisible=!0,this.hasReloadHandler=!1,this.keyStrokes=[],this.keyboardNavigation=!0,this.menus=[],this.contextMenu,this.multiCheck=!0,this.multiSelect=!0,this.multilineText=!1,this.rows=[],this.scrollToSelection=!1,this.scrollTop=0,this.selectedRows=[],this.sortEnabled=!0,this.tableControls=[],this.tableStatusVisible=!1,this.footerVisible=!1,this.filters=[],this.columns=[],this.rowsMap={},this.rowWidth=0,this.rowBorderWidth,this.rowBorderLeftWidth=0,this.rowBorderRightWidth=0,this.staticMenus=[],this.selectionHandler=new t.TableSelectionHandler(this),this.header,this.footer,this._filterMap={},this._filteredRows=[],this._filteredRowsDirty=!0,this.tooltips=[],this._aggregateRows=[],this._animationRowLimit=25,this._blockLoadThreshold=25,this.menuBar,this._doubleClickSupport=new t.DoubleClickSupport,this.checkableStyle=t.Table.CheckableStyle.CHECKBOX,this.$container,this.$data,this._addAdapterProperties(["tableControls","menus","keyStrokes"]),this._permanentHeadSortColumns=[],this._permanentTailSortColumns=[],this.viewRangeSize=10,this.viewRangeRendered=new t.Range(0,0),this._filterMenusHandler=this._filterMenus.bind(this),this.virtual=!0,this.contextColumn},t.inherits(t.Table,t.Widget),t.Table.CheckableStyle={CHECKBOX:"checkbox",TABLE_ROW:"tableRow"},t.Table.SELECTION_CLASSES="select-middle select-top select-bottom select-single selected",t.Table.prototype._init=function(e){t.Table.parent.prototype._init.call(this,e),this._initColumns(),this.rows.forEach(function(t,e){this.rows[e]=this._initRow(t)},this),this.menuBar=t.create("MenuBar",{parent:this,menuOrder:new t.MenuItemsOrder(this.session,"Table"),menuFilter:this._filterMenusHandler}),this.menuBar.bottom(),this._syncSelectedRows(this.selectedRows),this.setFilters(this.filters),this._syncKeyStrokes(this.keyStrokes),this._syncMenus(this.menus),this._syncTableControls(this.tableControls),this._syncTableStatus(this.tableStatus),this._applyFilters(this.rows),this._calculateValuesForBackgroundEffect(),this._group()},t.Table.prototype._initRow=function(e){return e instanceof t.TableRow||(e.parent=this,e=t.create("TableRow",e)),this.rowsMap[e.id]=e,this.trigger("rowInitialized",{row:e}),e},t.Table.prototype._initColumns=function(){var e,i;for(i=0;i<this.columns.length;i++)this.columns[i].session=this.session,e=t.create(this.columns[i]),e.table=this,this.columns[i]=e,e.checkable&&(this.checkableColumn=e);this.rowIconVisible&&this._insertRowIconColumn(),this._syncCheckable(this.checkable),this._syncHeadAndTailSortColumns()},t.Table.prototype._createLoadingSupport=function(){return new t.LoadingSupport({widget:this})},t.Table.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.Table.prototype._initKeyStrokeContext=function(){t.Table.parent.prototype._initKeyStrokeContext.call(this),this._initTableKeyStrokeContext()},t.Table.prototype._initTableKeyStrokeContext=function(){this.keyStrokeContext.registerKeyStroke([new t.TableNavigationUpKeyStroke(this),new t.TableNavigationDownKeyStroke(this),new t.TableNavigationPageUpKeyStroke(this),new t.TableNavigationPageDownKeyStroke(this),new t.TableNavigationHomeKeyStroke(this),new t.TableNavigationEndKeyStroke(this),new t.TableFocusFilterFieldKeyStroke(this),new t.TableStartCellEditKeyStroke(this),new t.TableSelectAllKeyStroke(this),new t.TableRefreshKeyStroke(this),new t.TableToggleRowKeyStroke(this),new t.TableCopyKeyStroke(this),new t.ContextMenuKeyStroke(this,this.onContextMenu,this),new t.AppLinkKeyStroke(this,this.handleAppLinkAction)]),this.keyStrokeContext.registerStopPropagationInterceptor(function(e){e.ctrlKey||e.altKey||!t.isOneOf(e.which,t.keys.UP,t.keys.DOWN)||(e.stopPropagation(),e.preventDefault())})},t.Table.prototype._insertBooleanColumn=function(){if(this.checkableStyle!==t.Table.CheckableStyle.TABLE_ROW){var e=t.create("BooleanColumn",{session:this.session,fixedWidth:!0,fixedPosition:!0,guiOnly:!0,disallowHeaderMenu:!0,showSeparator:!1,width:t.Column.NARROW_MIN_WIDTH,table:this});t.arrays.insert(this.columns,e,0),this.checkableColumn=e}},t.Table.prototype._insertRowIconColumn=function(){var e=0,i=t.create("IconColumn",{session:this.session,fixedWidth:!0,fixedPosition:!0,guiOnly:!0,disallowHeaderMenu:!0,showSeparator:!1,width:t.Column.NARROW_MIN_WIDTH,table:this});this.columns[0]===this.checkableColumn&&(e=1),t.arrays.insert(this.columns,i,e),this.rowIconColumn=i},t.Table.prototype.handleAppLinkAction=function(t){var i=e(t.target),o=this._columnAtX(i.offset().left);this._triggerAppLinkAction(o,i.data("ref"))},t.Table.prototype._render=function(e){if(this.$container=this.$parent.appendDiv("table"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.TableLayout(this)),this.htmlComp.pixelBasedSizing=!1,this.uiCssClass&&this.$container.addClass(this.uiCssClass),this.$data=this.$container.appendDiv("table-data"),this.$data.on("mousedown",".table-row",this._onRowMouseDown.bind(this)).on("mouseup",".table-row",this._onRowMouseUp.bind(this)).on("dblclick",".table-row",this._onRowDoubleClick.bind(this)).on("scroll",this._onDataScroll.bind(this)).on("contextmenu",".table-row",function(t){return t.preventDefault(),t.stopPropagation(),!1}),t.scrollbars.install(this.$data,{parent:this,axis:"both"}),this._installImageListeners(),this._installCellTooltipSupport(),this.menuBar.render(this.$container),t.device.tableAdditionalDivRequired){var i=this.$data.appendDiv("table-cell");i.text("&nbsp;"),this.cellHorizontalPadding=i.cssPxValue("padding-left")+i.cssPxValue("padding-right"),i.remove()}this._calculateRowBorderWidth(),this._updateRowWidth(),this._updateRowHeight(),this._renderViewport(),this.scrollToSelection&&this.revealSelection()},t.Table.prototype._renderProperties=function(){t.Table.parent.prototype._renderProperties.call(this),this._renderTableHeader(),this._renderFooterVisible(),this._renderDropType(),this._renderCheckableStyle()},t.Table.prototype._remove=function(){t.scrollbars.uninstall(this.$data,this.session),this._uninstallDragAndDropHandler(),this.header=null,this._removeAggregateRows(),this._uninstallImageListeners(),this._uninstallCellTooltipSupport(),this._removeRows(),this.$fillBefore=null,this.$fillAfter=null,this.$data=null,this.$emptyData=null,t.Table.parent.prototype._remove.call(this)},t.Table.prototype.setTableControls=function(t){this.setProperty("tableControls",t)},t.Table.prototype._renderTableControls=function(){this.footer&&this.footer._renderControls()},t.Table.prototype._syncTableControls=function(t){var e;for(e=0;e<this.tableControls.length;e++)this.keyStrokeContext.unregisterKeyStroke(this.tableControls[e]);for(this._setProperty("tableControls",t),e=0;e<this.tableControls.length;e++)this.keyStrokeContext.registerKeyStroke(this.tableControls[e]);this._updateFooterVisibility(),this.tableControls.forEach(function(t){t.tableFooter=this.footer},this)},t.Table.prototype._onImageLoadOrError=function(t){var i=e(t.target).closest(".table-row"),o=i.data("row");o.height=i.outerHeight(!0),this.invalidateLayoutTree()},t.Table.prototype._onRowMouseDown=function(i){if(this._doubleClickSupport.mousedown(i),this._$mouseDownRow=e(i.currentTarget),this._mouseDownColumn=this._columnAtX(i.pageX),this._$mouseDownRow.window().one("mouseup",function(){this._$mouseDownRow=null}.bind(this)),this.selectionHandler.onMouseDown(i),this.checkableStyle===t.Table.CheckableStyle.TABLE_ROW){var o=this._$mouseDownRow.data("row");this.checkRow(o,!o.checked)}this.setContextColumn(this._columnAtX(i.pageX))},t.Table.prototype._onRowMouseUp=function(t){var i,o,n,r,s,a=t.which;this._doubleClickSupport.doubleClicked()||(o=e(t.currentTarget),this.selectionHandler.onMouseUp(t,o),this._$mouseDownRow&&this._$mouseDownRow[0]===o[0]&&(i=o,n=this._columnAtX(t.pageX),n===this._mouseDownColumn&&(1===a&&(n.onMouseUp(t,i),r=this._find$AppLink(t)),s=i.data("row"),r?this._triggerAppLinkAction(n,r.data("ref")):this._triggerRowClicked(s,a))))},t.Table.prototype._onRowDoubleClick=function(t){var i=e(t.currentTarget),o=this._columnAtX(t.pageX);this.doRowAction(i.data("row"),o)},t.Table.prototype.onContextMenu=function(e){var i=function(e){e.preventDefault();var i;if(this.selectedRows.length>0){if(i=this._filterMenus(this.menus,t.MenuDestinations.CONTEXT_MENU,!0,!1,["Header"]),!e.pageX&&!e.pageY){var o=this.selectionHandler.lastActionRow?this.selectionHandler.lastActionRow.$row:this.selectedRows[this.selectedRows.length-1].$row,n=o.offset();e.pageX=n.left+10,e.pageY=n.top+o.outerHeight()/2}i.length>0&&(this.contextMenu=t.create("ContextMenuPopup",{parent:this,menuItems:i,location:{x:e.pageX,y:e.pageY},$anchor:this.$data,menuFilter:this._filterMenusHandler}),this.contextMenu.open(),this.enabled&&(this.$container.addClass("focused"),this.contextMenu.on("close",function(t){this.$container.removeClass("focused"),this.contextMenu=null}.bind(this))))}};t.menus.showContextMenuWithWait(this.session,i.bind(this),e)},t.Table.prototype._onDataScroll=function(){var t=this.$data[0].scrollTop;this.scrollTop!==t&&(this._renderViewport(),this.scrollTop=t)},t.Table.prototype._renderTableStatus=function(){this.trigger("statusChanged")},t.Table.prototype.setContextColumn=function(t){this.setProperty("contextColumn",t)},t.Table.prototype._hasVisibleTableControls=function(){return this.tableControls.some(function(t){return!!t.visible})},t.Table.prototype.hasAggregateTableControl=function(){return this.tableControls.some(function(e){return e instanceof t.AggregateTableControl})},t.Table.prototype._createHeader=function(){return t.create("TableHeader",{parent:this,table:this,enabled:this.headerEnabled})},t.Table.prototype._createFooter=function(){return t.create("TableFooter",{parent:this,table:this})},t.Table.prototype._installCellTooltipSupport=function(){t.tooltips.install(this.$data,{parent:this,selector:".table-cell",text:this._cellTooltipText.bind(this),arrowPosition:50,arrowPositionUnit:"%",nativeTooltip:!t.device.isCustomEllipsisTooltipPossible()})},t.Table.prototype._uninstallCellTooltipSupport=function(){t.tooltips.uninstall(this.$data)},t.Table.prototype._cellTooltipText=function(t){var e,i,o=t.parent(),n=this.$cellsForRow(o).index(t),r=this.columns[n],s=o.data("row");return s&&(e=this.cell(r,s),i=e.tooltipText),i?i:this._isTruncatedCellTooltipEnabled(r)&&t.isContentTruncated()?t.text():void 0},t.Table.prototype._isTruncatedCellTooltipEnabled=function(t){return!this.headerVisible||t.fixedWidth},t.Table.prototype.reload=function(){this.hasReloadHandler&&(this._removeRows(),this._renderFiller(),this._triggerReload())},t.Table.prototype.exportToClipboard=function(){this._triggerExportToClipboard()},t.Table.prototype.toggleSelection=function(){this.selectedRows.length===this.filteredRows().length?this.deselectAll():this.selectAll()},t.Table.prototype.selectAll=function(){this.selectRows(this.filteredRows())},t.Table.prototype.deselectAll=function(){this.selectRows([])},t.Table.prototype.checkAll=function(t){this.checkRows(this.filteredRows(),{checked:t})},t.Table.prototype.uncheckAll=function(){this.checkAll(!1)},t.Table.prototype.updateScrollbars=function(){t.scrollbars.update(this.$data)},t.Table.prototype._sort=function(e){var i=this._sortColumns();return!!this._isUiSortPossible(i)&&(this.clearAggregateRows(e),!i.length||(i=t.arrays.union(i,this.columns),this._sortImpl(i),this._filteredRowsDirty=!0,this._triggerRowOrderChanged(),this.rendered&&this._renderRowOrderChanges(),this._group(e),!0))},t.Table.prototype._isUiSortPossible=function(e){var i=t.nvl(this.uiSortPossible,!0);return i&&this._isColumnsUiSortPossible(e)},t.Table.prototype._sortColumns=function(){for(var t=[],e=0;e<this.columns.length;e++){var i=this.columns[e],o=i.sortIndex;o>=0&&(t[o]=i)}return t},t.Table.prototype._sortImpl=function(t){function e(e,i){for(var o=0;o<t.length;o++){var n=t[o],r=n.compare(e,i);if(n.sortActive&&!n.sortAscending&&(r=-r),0!==r)return r}return 0}this.rows.sort(e.bind(this))},t.Table.prototype._isColumnsUiSortPossible=function(t){return t.every(function(t){return t.isUiSortPossible()})},t.Table.prototype._renderRowOrderChanges=function(){var t,o=this.$rows(),n={};o.length===this.filteredRows().length&&o.each(function(i,o){var r=!1,s=e(o),a=s.data("row");if(this._insertedRows)for(var l=0;l<this._insertedRows.length;l++)if(this._insertedRows[l].id===a.id){r=!0;break}r||(t=!0,n[a.id]=s.offset().top)}.bind(this)),this._rerenderViewport(),
this._order$AggregateRows(),t&&(o=this.$rows(),o.each(function(t,o){var r=e(o),s=r.data("row"),a=n[s.id];a!==i&&r.css("top",a-r.offset().top).animate({top:0},{progress:this._triggerRowOrderChanged.bind(this,s,!0)})}.bind(this)))},t.Table.prototype.sort=function(e,i,o,n){var r,s,a;o=t.nvl(o,!1),n=t.nvl(n,!1),a=!o,n?this._removeSortColumn(e):this._addSortColumn(e,i,o),this.header&&this.header.onSortingChanged(),s=this._sort(a),r={columnId:e.id,sortAscending:e.sortAscending},n&&(r.sortingRemoved=!0),o&&(r.multiSort=!0),s?this._send("rowsSorted",r):(this._send("sortRows",r),this._animateAggregateRows=a)},t.Table.prototype._addSortColumn=function(e,i,o){var n,r;i=t.nvl(i,e.sortAscending?"asc":"desc"),o=t.nvl(o,!0),this._updateSortIndexForColumn(e,o),o||(n=this._groupedColumns().length,r=this._sortColumns().length,1===r&&1===n||(e.grouped=!1)),e.sortAscending="asc"===i,e.sortActive=!0},t.Table.prototype._updateSortIndexForColumn=function(e,o){var n,r=-1;o?e.sortActive&&e.sortIndex!==-1||(r=Math.max(-1,t.arrays.max(this.columns.map(function(t){return t.sortIndex===i||t.initialAlwaysIncludeSortAtEnd?-1:t.sortIndex}))),e.sortIndex=r+1,this._permanentTailSortColumns.forEach(function(t){t.sortIndex++})):(e.initialAlwaysIncludeSortAtBegin||e.initialAlwaysIncludeSortAtEnd||(e.sortIndex=this._permanentHeadSortColumns.length),t.arrays.eachSibling(this.columns,e,function(t){t.sortActive&&this._removeSortColumnInternal(t)}.bind(this)),n=e.initialAlwaysIncludeSortAtBegin||e.initialAlwaysIncludeSortAtEnd?0:1,this._permanentTailSortColumns.forEach(function(t,e){t.sortIndex=this._permanentHeadSortColumns.length+n+e},this))},t.Table.prototype._removeSortColumn=function(e){e.initialAlwaysIncludeSortAtBegin||e.initialAlwaysIncludeSortAtEnd||(t.arrays.eachSibling(this.columns,e,function(t){t.sortIndex>e.sortIndex&&(t.sortIndex=t.sortIndex-1)}),this._removeSortColumnInternal(e))},t.Table.prototype._removeSortColumnInternal=function(t){t.initialAlwaysIncludeSortAtBegin||t.initialAlwaysIncludeSortAtEnd||(t.sortActive=!1,t.grouped=!1,t.sortIndex=-1)},t.Table.prototype.isGroupingPossible=function(e){var i=!0;return!!this.sortEnabled&&(!(!this._permanentHeadSortColumns||0!==this._permanentHeadSortColumns.length)||(e.initialAlwaysIncludeSortAtBegin?(i=!0,t.arrays.eachSibling(this._permanentHeadSortColumns,e,function(t){t.sortIndex<e.sortIndex&&(i=i&&t.grouped)}),i):!e.initialAlwaysIncludeSortAtEnd&&(this._permanentHeadSortColumns.forEach(function(t){i=i&&t.grouped}),i)))},t.Table.prototype.isAggregationPossible=function(e){return e instanceof t.NumberColumn&&(!e.grouped&&(this.isGrouped()||this.hasAggregateTableControl()))},t.Table.prototype.changeAggregation=function(t,e){this.changeAggregations([t],[e])},t.Table.prototype.changeAggregations=function(t,e){t.forEach(function(t,i){var o=e[i];t.setAggregationFunction(o),this._triggerAggregationFunctionChanged(t)},this),this._group()},t.Table.prototype._addGroupColumn=function(e,o,n){var r=-1;this.isGroupingPossible(e)&&(o=t.nvl(o,e.sortAscending?"asc":"desc"),n=t.nvl(n,!0),e.initialAlwaysIncludeSortAtBegin||e.initialAlwaysIncludeSortAtEnd?e.initialAlwaysIncludeSortAtBegin&&(e.grouped=!0):(n?(r=Math.max(-1,t.arrays.max(this.columns.map(function(t){return t.sortIndex===i||t.initialAlwaysIncludeSortAtEnd||!t.grouped?-1:t.sortIndex}))),e.sortActive?(t.arrays.eachSibling(this.columns,e,function(t){t.sortActive&&!t.initialAlwaysIncludeSortAtBegin&&!t.initialAlwaysIncludeSortAtEnd&&t.sortIndex>r&&t.sortIndex<e.sortIndex&&t.sortIndex++}),e.sortIndex=r+1):(e.sortIndex=r+1,t.arrays.eachSibling(this.columns,e,function(t){t.sortActive&&!t.initialAlwaysIncludeSortAtBegin&&!t.initialAlwaysIncludeSortAtEnd&&t.sortIndex>r&&t.sortIndex++}),this._permanentTailSortColumns.forEach(function(t){t.sortIndex++}))):(r=this._permanentHeadSortColumns.length,e.sortActive?(t.arrays.eachSibling(this.columns,e,function(t){t.sortActive&&!t.initialAlwaysIncludeSortAtBegin&&!t.initialAlwaysIncludeSortAtEnd&&t.sortIndex>=r&&t.sortIndex<e.sortIndex&&t.sortIndex++}),e.sortIndex=r):(t.arrays.eachSibling(this.columns,e,function(t){t.sortActive&&!t.initialAlwaysIncludeSortAtBegin&&!t.initialAlwaysIncludeSortAtEnd&&t.sortIndex>=r&&t.sortIndex++}),e.sortIndex=r,this._permanentTailSortColumns.forEach(function(t){t.sortIndex++})),t.arrays.eachSibling(this.columns,e,function(t){t.sortActive&&!t.initialAlwaysIncludeSortAtBegin&&!t.initialAlwaysIncludeSortAtEnd&&t.sortIndex>=r&&(t.grouped=!1)})),e.sortAscending="asc"===o,e.sortActive=!0),e.grouped=!0)},t.Table.prototype._removeGroupColumn=function(t){t.grouped=!1,t.initialAlwaysIncludeSortAtBegin&&this.columns.forEach(function(e){e.sortIndex>=t.sortIndex&&(e.grouped=!1)}),this._removeSortColumn(t)},t.Table.prototype._buildRowDiv=function(e){var i=this.rowWidth,o="table-row";e.cssClass&&(o+=" "+e.cssClass),e.enabled||(o+=" disabled"),e.checked&&this.checkableStyle===t.Table.CheckableStyle.TABLE_ROW&&(o+=" checked");for(var n='<div class="'+o+'" style="width: '+i+'px"'+t.device.unselectableAttribute.string+">",r=0;r<this.columns.length;r++)n+=this.columns[r].buildCellForRow(e);return n+="</div>"},t.Table.prototype._calculateRowBorderWidth=function(){var t=this.$data.appendDiv("table-row");this.rowBorderLeftWidth=t.cssBorderLeftWidth(),this.rowBorderRightWidth=t.cssBorderRightWidth(),this.rowBorderWidth=this.rowBorderLeftWidth+this.rowBorderRightWidth,t.remove()},t.Table.prototype._updateRowWidth=function(){this.rowWidth=this.rowBorderWidth;for(var t=0;t<this.columns.length;t++)this.rowWidth+=this.columns[t].width},t.Table.prototype._updateRowHeight=function(){var t=this.$data.appendDiv("table-row"),e=this.$data.appendDiv("table-aggregate-row");t.appendDiv("table-cell").html("&nbsp;"),e.appendDiv("table-cell").html("&nbsp;"),this.rowHeight=t.outerHeight(!0),this.aggregateRowHeight=e.outerHeight(!0),t.remove(),e.remove()},t.Table.prototype._updateRowHeights=function(){this.rows.forEach(function(t){t.$row?t.height=t.$row.outerHeight(!0):t.height=null}),this._aggregateRows.forEach(function(t){t.$row?t.height=t.$row.outerHeight(!0):t.height=null})},t.Table.prototype._renderRowsInRange=function(i){var o,n="",r=0,s=!1,a=this.filteredRows();if(0!==a.length){var l=new t.Range(0,this.rows.length);if(i=l.intersect(i),!i.intersect(this.viewRangeRendered).equals(new t.Range(0,0)))throw new Error("New range must not intersect with existing.");i.to<=this.viewRangeRendered.from&&(s=!0);var h=this.viewRangeRendered.union(i);if(2===h.length)throw new Error("Can only prepend or append rows to the existing range. Existing: "+this.viewRangeRendered+". New: "+h);this.viewRangeRendered=h[0],this._removeEmptyData();for(var d=i.from;d<i.to;d++){var p=a[d];n+=this._buildRowDiv(p),r++}o=this.$data.makeElement(n),o=s?this.$fillBefore?o.insertAfter(this.$fillBefore):o.prependTo(this.$data):this.$fillAfter?o.insertBefore(this.$fillAfter):o.appendTo(this.$data),o.each(function(o,n){var r=e(n),s=a[i.from+o];t.Table.linkRowToDiv(s,r),this._installRow(s)}.bind(this)),e.log.isTraceEnabled()&&(e.log.trace(r+" new rows rendered from "+i),e.log.trace(this._rowsRenderedInfo()))}},t.Table.prototype._rowsRenderedInfo=function(){var t=this.$rows().length,e="("+this.viewRangeRendered+")",i=t+" rows rendered "+e;return i},t.Table.prototype._removeRowsInRange=function(i){var o,n,r,s,a=0,l=this.filteredRows(),h=new t.Range(0,l.length);i=h.intersect(i),o=l[i.from],n=l[i.to];var d=this.viewRangeRendered.subtract(i);if(2===d.length)throw new Error("Can only remove rows at the beginning or end of the existing range. "+this.viewRangeRendered+". New: "+d);for(this.viewRangeRendered=d[0],this._removeEmptyData(),s=i.from;s<i.to;s++)r=l[s],this._removeRow(r),a++;e.log.isTraceEnabled()&&(e.log.trace(a+" rows removed from "+i+"."),e.log.trace(this._rowsRenderedInfo()))},t.Table.prototype._removeAllRows=function(){this.$rows().each(function(t,i){var o=e(i),n=o.data("row");o.hasClass("hiding")||this._removeRow(n)}.bind(this)),this.viewRangeRendered=new t.Range(0,0)},t.Table.prototype._removeRows=function(e){return e?(e=t.arrays.ensure(e),void e.forEach(function(t){var e=this.filteredRows().indexOf(t);if(e===-1)throw new Error("Row not found, cannot remove $row");if(!t.$row&&this.viewRangeRendered.contains(e)&&!t.$row)throw new Error("Inconsistency found while removing row. Row is not but inside rendered view range. RowIndex: "+e);if(t.$row&&!this.viewRangeRendered.contains(e))throw new Error("Inconsistency found while removing row. Row is rendered but not inside rendered view range. RowIndex: "+e);this._removeRow(t),(this.viewRangeRendered.contains(e)||e<this.viewRangeRendered.from)&&(e<this.viewRangeRendered.from?(this.viewRangeRendered.from--,this.viewRangeRendered.to--):e<=this.viewRangeRendered.to&&this.viewRangeRendered.to--)}.bind(this))):(e=t.arrays.ensure(e),void this._removeAllRows())},t.Table.prototype._removeRow=function(t){var e=t.$row;e&&(this._destroyTooltipsForRow(t),this._removeCellEditorForRow(t),e.hasClass("hiding")||(e.remove(),t.$row=null))},t.Table.prototype._showRow=function(t){var e=t.$row;e&&(e.is(".showing")||(e.setVisible(!1),e.addClass("showing"),e.removeClass("hiding"),e.stop().slideDown({duration:250,complete:function(){e.removeClass("showing"),this.updateScrollbars()}.bind(this)})))},t.Table.prototype._hideRow=function(t){var e=t.$row;e&&(e.is(".hiding")||(e.addClass("hiding"),e.removeClass("showing"),e.stop().slideUp({duration:250,complete:function(){t.$row&&(e.remove(),e[0]===t.$row[0]&&(t.$row=null),this.updateScrollbars())}.bind(this)})))},t.Table.prototype._installRow=function(t){if(t.height=t.$row.outerHeight(!0),t.hasError&&this._showCellErrorForRow(t),this.cellEditorPopup&&!this.cellEditorPopup.rendered&&this.cellEditorPopup.row.id===t.id){var e=this.cellEditorPopup.cell.field;this.startCellEdit(this.cellEditorPopup.column,t,e)}},t.Table.prototype._showCellErrorForRow=function(t){var i=this.$cellsForRow(t.$row),o=this;i.each(function(i){var n=e(this),r=o.cellByCellIndex(i,t);r.errorStatus&&o._showCellError(t,n,r.errorStatus)})},t.Table.prototype._showCellError=function(e,i,o){var n,r,s=o.message;r={parent:this,text:s,autoRemove:!1,$anchor:i,table:this},n=t.create("TableTooltip",r),n.render(),n.row=e,this.tooltips.push(n)},t.Table.prototype._columnAtX=function(e){var i=0,o=this.$data.offset().left+this.rowBorderLeftWidth,n=this.$data.scrollLeft();if(e<o)return this.columns[0];o-=n;var r=t.arrays.find(this.columns,function(t){return i=o+t.width,e>=o&&e<i||void(o=i)});return r||(r=this.columns[this.columns.length-1]),r},t.Table.prototype._find$AppLink=function(t){for(var i=e(t.target),o=e(t.delegateTarget);i.length>0;){if(i.hasClass("app-link"))return i;if(i[0]===o[0])return null;i=i.parent()}return null},t.Table.prototype._filterMenus=function(e,i,o,n,r){return t.menus.filterAccordingToSelection("Table",this.selectedRows.length,e,i,o,n,r)},t.Table.prototype.setStaticMenus=function(t){this._setProperty("staticMenus",t),this._updateMenuBar()},t.Table.prototype._removeMenus=function(){},t.Table.prototype.notifyRowSelectionFinished=function(){this._triggerRowsSelectedPending&&(this._triggerRowsSelected(),this._triggerRowsSelectedPending=!1),this._updateMenuBar()},t.Table.prototype._triggerRowClicked=function(t,e,i){var o={row:t,mouseButton:e};this.trigger("rowClicked",o)},t.Table.prototype._triggerRowAction=function(t,e){this.trigger("rowAction",{row:t,column:e})},t.Table.prototype.prepareCellEdit=function(e,i,o){this.openFieldPopupOnCellEdit=t.nvl(o,!1);var n=e.createDefaultEditor(i);this.startCellEdit(e,i,n)},t.Table.prototype.cell=function(e,i){return e===this.rowIconColumn?t.create("Cell",{iconId:i.iconId,cssClass:t.strings.join(" ","row-icon-cell",i.cssClass)}):e===this.checkableColumn?t.create("Cell",{value:i.checked,editable:!0,cssClass:i.cssClass}):i.cells[e.index]},t.Table.prototype.cellByCellIndex=function(t,e){return this.cell(this.columns[t],e)},t.Table.prototype.cellValue=function(t,e){var o=this.cell(t,e);return o?o.value!==i?o.value:o.text||"":o},t.Table.prototype.cellText=function(t,e){var i=this.cell(t,e);return i?i.text||"":""},t.Table.prototype.nextEditableCellPos=function(e,i,o){var n,r,s,a,l,h=this.columns.indexOf(e);return r=h+1,o&&(r=h-1),(n=this.nextEditableCellPosForRow(r,i,o))?n:(l=function(t){return!!t.$row&&(r=0,o&&(r=this.columns.length-1),n=this.nextEditableCellPosForRow(r,t,o),!!n||void 0)}.bind(this),s=this.rows.indexOf(i),a=s+1,o&&(a=s-1),t.arrays.findFrom(this.rows,a,l,o),n)},t.Table.prototype.nextEditableCellPosForRow=function(e,i,o){var n,r,s;if(s=function(t){return!t.guiOnly&&(n=this.cell(t,i),this.enabled&&i.enabled&&n.editable)}.bind(this),r=t.arrays.findFrom(this.columns,e,s,o))return{column:r,row:i}},t.Table.prototype.clearAggregateRows=function(t){this._aggregateRows.forEach(function(t){t.prevRow&&(t.prevRow.aggregateRowAfter=null),t.nextRow&&(t.nextRow.aggregateRowBefore=null)},this),this.rendered&&(this._removeAggregateRows(t),this._renderSelection()),this._aggregateRows=[]},t.Table.prototype._forEachColumn=function(t,e,i){var o;this.columns.forEach(function(n,r){n[t]&&(i&&(o=n.cellValueForGrouping(i)),e[r]=n[t](e[r],o))})},t.Table.prototype._group=function(t){var e,i,o,n=this._groupedColumns(),r=[];this.clearAggregateRows(),n.length&&(e=this.filteredRows(),this._forEachColumn("aggrStart",r),e.forEach(function(t,s){this._forEachColumn("aggrStep",r,t),i=e[s+1],o=s===e.length-1||this._isNewGroup(n,t,i),o&&(this._forEachColumn("aggrFinish",r),this._addAggregateRow(r,t,i),this._forEachColumn("aggrStart",r))}.bind(this)),this.rendered&&(this._renderAggregateRows(t),this._renderSelection()))},t.Table.prototype._isNewGroup=function(t,e,i){var o,n,r,s=!1;if(!i)return!0;for(o=0;o<t.length;o++)if(n=t[o],r=n&&n.cellTextForGrouping&&"function"==typeof n.cellTextForGrouping,s=s||r&&n.cellTextForGrouping(e)!==n.cellTextForGrouping(i),s=s||!r&&this.cellText(n,e)!==this.cellText(n,i))return!0;return!1},t.Table.prototype._groupedColumns=function(){return this.columns.filter(function(t){return t.grouped})},t.Table.prototype._addAggregateRow=function(t,e,i){var o={contents:t.slice(),prevRow:e,nextRow:i};this._aggregateRows.push(o),e&&(e.aggregateRowAfter=o),i&&(i.aggregateRowBefore=o)},t.Table.prototype._removeAggregateRows=function(e){0!==this._aggregateRows.length&&(e=t.nvl(e,!1),e?this._aggregateRows.forEach(function(t,e){this._hideRow(t)},this):(this._aggregateRows.forEach(function(t){this._removeRow(t)},this),this.updateScrollbars()))},t.Table.prototype._renderAggregateRows=function(i){var o,n,r,s,a,l,h;i=t.nvl(i,!1),this._aggregateRows.forEach(function(d,p){if(!d.$row&&(s=d.prevRow,s&&s.$row)){for(h=this.$container.makeDiv("table-aggregate-row").data("aggregateRow",d),a=d.contents,o=0;o<this.columns.length;o++)r=this.columns[o],n=r.grouped?r.createAggrGroupCell(s):r instanceof t.NumberColumn?r.createAggrValueCell(a[o]):r.createAggrEmptyCell(s),l=e(r.buildCell(n,{})),l.appendTo(h);h.insertAfter(s.$row).width(this.rowWidth),d.height=h.outerHeight(!0),d.$row=h,i&&this._showRow(d)}},this)},t.Table.prototype.groupColumn=function(e,i,o,n){var r,s;i=t.nvl(i,!1),n=t.nvl(n,!1),n&&this._removeGroupColumn(e),this.isGroupingPossible(e)&&(n||this._addGroupColumn(e,o,i),this.header&&this.header.onSortingChanged(),s=this._sort(!0),r={columnId:e.id,groupAscending:e.sortAscending},n&&(r.groupingRemoved=!0),i&&(r.multiGroup=!0),this._triggerGroupingChanged(),s?this._send("rowsGrouped",r):(this._send("groupRows",r),this._animateAggregateRows=!0))},t.Table.prototype.removeColumnGrouping=function(t){t&&this.groupColumn(t,!1,"asc",!0)},t.Table.prototype.isGrouped=function(){return this.columns.some(function(t){return!!t.grouped})},t.Table.prototype.setColumnBackgroundEffect=function(t,e){t.setBackgroundEffect(e)},t.Table.prototype._updateBackgroundEffect=function(){this.columns.forEach(function(t){t.backgroundEffect&&t.updateBackgroundEffect()},this)},t.Table.prototype._calculateValuesForBackgroundEffect=function(){this.columns.forEach(function(t){t.backgroundEffect&&t.calculateMinMaxValues()},this)},t.Table.prototype.checkRow=function(t,e){this.checkRows([t],{checked:e})},t.Table.prototype.checkRows=function(i,o){var n=e.extend({checked:!0,checkOnlyEnabled:!0},o),r=[];!this.checkable||!this.enabled&&n.checkOnlyEnabled||(i=t.arrays.ensure(i),i.forEach(function(t){if((t.enabled||!n.checkOnlyEnabled)&&t.checked!==n.checked){if(!this.multiCheck&&n.checked)for(var e=0;e<this.rows.length;e++)this.rows[e].checked&&(this.rows[e].checked=!1,r.push(this.rows[e]));t.checked=n.checked,r.push(t)}},this),this.rendered&&r.forEach(function(t){this._renderRowChecked(t)},this),this._triggerRowsChecked(r))},t.Table.prototype.uncheckRow=function(t){this.uncheckRows([t])},t.Table.prototype.uncheckRows=function(t,i){var o=e.extend({checked:!1},i);this.checkRows(t,o)},t.Table.prototype.doRowAction=function(e,i){1===this.selectedRows.length&&this.selectedRows[0]===e&&(i=i||this.columns[0],i&&i.guiOnly&&(i=t.arrays.find(this.columns,function(t){return!t.guiOnly})),e&&i&&this._triggerRowAction(e,i))},t.Table.prototype.insertRow=function(t){this.insertRows([t])},t.Table.prototype.insertRows=function(e,i){var o=0===this.rows.length;e.forEach(function(t,i){t=this._initRow(t),e[i]=t,this.rows.push(t)},this),this._triggerRowsInserted(e),this._applyFilters(e),this._calculateValuesForBackgroundEffect(),i=t.nvl(i,!1),i?o&&this._group():this._sort(),this._rebuildingTable=!1,this.rendered&&(this._insertedRows?t.arrays.pushAll(this._insertedRows,e):(this._insertedRows=e,setTimeout(function(){this._insertedRows=null}.bind(this),0)),this.viewRangeDirty=!0,this._renderViewport(),this.invalidateLayoutTree())},t.Table.prototype.deleteRow=function(t){this.deleteRows([t])},t.Table.prototype.deleteRows=function(e){var i,o;e.forEach(function(e){this.rendered&&(this.cellEditorPopup&&this.cellEditorPopup.row.id===e.id&&this.cellEditorPopup.cancelEdit(),this._removeRows(e),i=!0),t.arrays.remove(this.rows,e),this._filterCount()>0&&t.arrays.remove(this._filteredRows,e)&&(o=!0),delete this.rowsMap[e.id],this.selectionHandler.lastActionRow===e&&this.selectionHandler.clearLastSelectedRowMarker()}.bind(this)),this.deselectRows(e),o&&this._rowsFiltered(),this._group(),this._updateBackgroundEffect(),this._triggerRowsDeleted(e),i&&(this._renderViewport(),this._renderRangeMarkers(),this._renderFiller(),this.invalidateLayoutTree())},t.Table.prototype.deleteAllRows=function(){var t=this._filterCount()>0&&this._filteredRows.length>0,e=this.rows;this.rendered&&(this.cellEditorPopup&&this.cellEditorPopup.cancelEdit(),this.selectionHandler.clearLastSelectedRowMarker(),this._removeRows()),this.rows=[],this.rowsMap={},this.deselectAll(),this._filteredRows=[],t&&this._rowsFiltered(),this._group(),this._updateBackgroundEffect(),this._triggerAllRowsDeleted(e),this.rendered&&(this._renderFiller(),this._renderViewport(),this.invalidateLayoutTree())},t.Table.prototype.updateRow=function(t){this.updateRows([t])},t.Table.prototype.updateRows=function(i){var o,n=[];i.forEach(function(i){var r=this.rowsMap[i.id];if(!r)throw new Error("Update event received for non existing row. RowId: "+i.id);if(i=this._initRow(i),this.selectionHandler.lastActionRow===r&&(this.selectionHandler.lastActionRow=i),t.arrays.replace(this.rows,r,i),t.arrays.replace(this.selectedRows,r,i),i.filterAccepted=r.filterAccepted,this._filterCount()>0&&(this._applyFiltersForRow(i)?(o=!0,i.filterAccepted||n.push(i)):this._filteredRowsDirty=!0),this.rendered&&r.$row){var s=e(this._buildRowDiv(i));s.copyCssClasses(r.$row,t.Table.SELECTION_CLASSES+" first last"),r.$row.replaceWith(s),t.Table.linkRowToDiv(i,s),this._destroyTooltipsForRow(i),this._removeCellEditorForRow(i),this._installRow(i)}},this),this._triggerRowsUpdated(i),o&&(this._rowsFiltered(n),this.rendered&&this._rerenderViewport()),this._group(),this._updateBackgroundEffect()},t.Table.prototype.updateRowOrder=function(e){if(e=t.arrays.ensure(e),e.length!==this.rows.length)throw new Error("Row order may not be updated because lengths of the arrays differ.");this.rows=e.slice(),this._filteredRowsDirty=!0,this.clearAggregateRows(this._animateAggregateRows),this.rendered&&this._renderRowOrderChanges(),this._triggerRowOrderChanged(),this._group(this._animateAggregateRows),this._animateAggregateRows=!1},t.Table.prototype._destroyTooltipsForRow=function(t){for(var e=this.tooltips.length-1;e>=0;e--)this.tooltips[e].row.id===t.id&&(this.tooltips[e].destroy(),this.tooltips.splice(e,1))},t.Table.prototype._removeCellEditorForRow=function(t){this.cellEditorPopup&&this.cellEditorPopup.rendered&&this.cellEditorPopup.row.id===t.id&&this.cellEditorPopup.remove()},t.Table.prototype.startCellEdit=function(t,e,i){if(!this.rendered)return void this._postRenderActions.push(this.startCellEdit.bind(this,t,e,i));this.ensureRowRendered(e);var o=t.startCellEdit(e,i);return this.cellEditorPopup=o,o},t.Table.prototype.endCellEdit=function(e,i){if(!this.rendered)return void this._postRenderActions.push(this.endCellEdit.bind(this,e,i));if(this.cellEditorPopup){var o=this.cellEditorPopup;this.cellEditorPopup.destroy(),this.cellEditorPopup=null,i=t.nvl(i,!1),i&&this.setCellValue(o.column,o.row,e.value)}e.destroy()},t.Table.prototype.completeCellEdit=function(t){this.endCellEdit(t,!0)},t.Table.prototype.cancelCellEdit=function(t){this.endCellEdit(t)},t.Table.prototype.scrollTo=function(e){0!==this.viewRangeRendered.size()&&(this.ensureRowRendered(e),t.scrollbars.scrollTo(this.$data,e.$row))},t.Table.prototype.scrollPageUp=function(){var t=Math.max(0,this.$data[0].scrollTop-this.$data.height());this.setScrollTop(t)},t.Table.prototype.scrollPageDown=function(){var t=Math.min(this.$data[0].scrollHeight,this.$data[0].scrollTop+this.$data.height());this.setScrollTop(t)},t.Table.prototype.setScrollTop=function(t){this.setProperty("scrollTop",t),this.rendered&&this._renderViewport()},t.Table.prototype._renderScrollTop=function(){t.scrollbars.scrollTop(this.$data,this.scrollTop)},t.Table.prototype.revealSelection=function(){return this.rendered?void(this.selectedRows.length>0&&this.scrollTo(this.selectedRows[0])):void this.session.layoutValidator.schedulePostValidateFunction(this.revealSelection.bind(this))},t.Table.prototype.revealChecked=function(){var e=t.arrays.find(this.rows,function(t){return t.checked===!0});e&&this.scrollTo(e)},t.Table.prototype._rowById=function(t){return this.rowsMap[t]},t.Table.prototype._rowsByIds=function(t){return t.map(this._rowById.bind(this))},t.Table.prototype._rowsToIds=function(t){return t.map(function(t){return t.id})},t.Table.prototype._renderSelection=function(e){e=t.arrays.ensure(e||this.selectedRows);for(var i=function(t,e,i){var o=t.hasClass(i);return e&&!o?(t.addClass(i),!0):!(e||!o)&&(t.removeClass(i),!0)},o=0;o<e.length;o++){var n=e[o];if(n.$row){var r=this.selectedRows.indexOf(n)!==-1,s=this.filteredRows(),a=s.indexOf(n)-1,l=a>=0&&this.selectedRows.indexOf(s[a])!==-1,h=s.indexOf(n)+1,d=h<s.length&&this.selectedRows.indexOf(s[h])!==-1;r&&l&&n.aggregateRowBefore&&(l=!1),r&&d&&n.aggregateRowAfter&&(d=!1);var p=0+i(n.$row,r,"selected")+i(n.$row,r&&!l&&d,"select-top")+i(n.$row,r&&l&&!d,"select-bottom")+i(n.$row,r&&!l&&!d,"select-single")+i(n.$row,r&&l&&d,"select-middle");p&&l&&e.indexOf(s[a])===-1&&e.push(s[a]),p&&d&&e.indexOf(s[h])===-1&&e.push(s[h])}}this.cellEditorPopup&&this.cellEditorPopup.rendered&&this.selectedRows.indexOf(this.cellEditorPopup.row)>-1&&(this.cellEditorPopup.position(),this.cellEditorPopup.pack())},t.Table.prototype._removeSelection=function(){this.selectedRows.forEach(function(e){e.$row&&(e.$row.select(!1),e.$row.toggleClass(t.Table.SELECTION_CLASSES,!1))},this)},t.Table.prototype.addRowToSelection=function(t,e){this.selectedRows.indexOf(t)>-1||(e=e===i||e,this.selectedRows.push(t),t.$row&&this.rendered&&(t.$row.select(!0),this._renderSelection(t),this.scrollToSelection&&this.revealSelection()),this._triggerRowsSelectedPending=!0,e||this.notifyRowSelectionFinished())},t.Table.prototype.removeRowFromSelection=function(e,o){o=o===i||o,t.arrays.remove(this.selectedRows,e)&&(this.rendered&&this._renderSelection(e),o?this._triggerRowsSelectedPending=!0:this._triggerRowsSelected())},t.Table.prototype.selectRows=function(e,i){e=t.arrays.ensure(e);var o=t.arrays.equalsIgnoreOrder(e,this.selectedRows);o||(this.rendered&&this._removeSelection(),!this.multiSelect&&e.length>1&&(e=[e[0]]),this.selectedRows=e.slice(),this._triggerRowsSelected(i),this._updateMenuBar(),this.rendered&&(this._renderSelection(),this.scrollToSelection&&this.revealSelection()))},t.Table.prototype.deselectRows=function(e){e=t.arrays.ensure(e);var i=this.selectedRows.slice();t.arrays.removeAll(i,e)&&this.selectRows(i)},t.Table.prototype.isRowSelected=function(t){return this.selectedRows.indexOf(t)>-1},t.Table.prototype._filterCount=function(){return Object.keys(this._filterMap).length},t.Table.prototype.filteredRows=function(){return this._filteredRowsDirty&&(0===this._filterCount()?this._filteredRows=this.rows:(this._filteredRows=[],this.rows.forEach(function(t){t.filterAccepted&&this._filteredRows.push(t)},this)),this._filteredRowsDirty=!1),this._filteredRows},t.Table.prototype.$rows=function(t){var e=".table-row";return t&&(e+=", .table-aggregate-row"),this.$data.find(e)},t.Table.prototype.$aggregateRows=function(){return this.$data.find(".table-aggregate-row")},t.Table.prototype.selectedRow=function(){return this.selectedRows.length>0?this.selectedRows[0]:null},t.Table.prototype.$selectedRows=function(){return this.$data?this.$data.find(".selected"):e()},t.Table.prototype.$cellsForColIndex=function(t,e){var i=".table-row > div:nth-of-type("+t+")";return e&&(i+=", .table-aggregate-row > div:nth-of-type("+t+")"),this.$data.find(i)},t.Table.prototype.$cellsForColIndexWidthFix=function(t,e){var i=".table-row > div:nth-of-type("+t+") > .width-fix ";return e&&(i+=", .table-aggregate-row > div:nth-of-type("+t+") > .width-fix"),this.$data.find(i)},t.Table.prototype.$cellsForRow=function(t){return t.children(".table-cell")},t.Table.prototype.$cell=function(t,e){var i=this.columns.indexOf(t);return e.children().eq(i)},t.Table.prototype._columnById=function(e){return t.arrays.find(this.columns,function(t){return t.id===e})},t.Table.prototype._columnsByIds=function(t){return t.map(this._columnById.bind(this))},t.Table.prototype.filter=function(){var t=!0,e=0,i=[],o=[];this.rows.forEach(function(t){var e=this._applyFiltersForRow(t);e&&(t.filterAccepted?o.push(t):i.push(t))},this),e=i.length+o.length,0!==e&&(this._rowsFiltered(i),this._group(t),this.rendered&&(t=e<=this._animationRowLimit,t?(i.forEach(function(t){this._hideRow(t)}.bind(this)),this._rerenderViewport(),this._order$Rows().insertAfter(this.$fillBefore),this._order$AggregateRows(),o.forEach(function(t){this._showRow(t)},this)):this._rerenderViewport(),this._renderEmptyData()))},t.Table.prototype._order$Rows=function(t){return t=t||this.$rows(),t.sort(function(t,i){var o=e(t),n=e(i),r=o.data("row"),s=n.data("row");return this.rows.indexOf(r)-this.rows.indexOf(s)}.bind(this))},t.Table.prototype._order$AggregateRows=function(t){t=t||this.$aggregateRows(),t.each(function(t,i){var o=e(i),n=o.data("aggregateRow");n&&n.prevRow&&o.insertAfter(n.prevRow.$row)})},t.Table.prototype._rowsFiltered=function(t){this.deselectRows(t),this._filteredRowsDirty=!0,this._triggerRowsFiltered()},t.Table.prototype._rowAcceptedByFilters=function(t){for(var e in this._filterMap){var i=this._filterMap[e];if(!i.accept(t))return!1}return!0},t.Table.prototype._applyFiltersForRow=function(t){if(this._rowAcceptedByFilters(t)){if(!t.filterAccepted)return t.filterAccepted=!0,!0}else if(t.filterAccepted)return t.filterAccepted=!1,!0;return!1},t.Table.prototype._applyFilters=function(t){var e,i=[];return 0===this._filterCount()?void(this._filteredRowsDirty=!0):(t.forEach(function(t){this._applyFiltersForRow(t)&&(e=!0,t.filterAccepted||i.push(t)),t.filterAccepted&&(e=!0)},this),void(e&&this._rowsFiltered(i)))},t.Table.prototype.filteredBy=function(){var t=[];for(var e in this._filterMap){var i=this._filterMap[e];t.push(i.createLabel())}return t},t.Table.prototype.resetFilter=function(){for(var t in this._filterMap)this.removeFilterByKey(t);this._filterMap={},this.filter(),this._triggerFilterResetted()},t.Table.prototype.resizeToFit=function(e){if(!e.fixedWidth){var i=e.calculateOptimalWidth();t.device.browser===t.Device.Browser.INTERNET_EXPLORER&&i!==e.minWidth&&i++,e.width!==i&&this.resizeColumn(e,i)}},t.Table.prototype.addFilter=function(t){var e=t.createKey();if(!e)throw new Error("key has to be defined");this._filterMap[e]=t,this.trigger("addFilter",{filter:t})},t.Table.prototype.removeFilter=function(t){this.removeFilterByKey(t.createKey())},t.Table.prototype.removeFilterByKey=function(t){if(!t)throw new Error("key has to be defined");var e=this._filterMap[t];e&&(delete this._filterMap[t],this.trigger("removeFilter",{filter:e}))},t.Table.prototype.getFilter=function(t){if(!t)throw new Error("key has to be defined");return this._filterMap[t]},t.Table.prototype.resizeColumn=function(e,i){if(!e.fixedWidth){var o=this.columns.indexOf(e)+1;i=Math.floor(i),e.width=i,this._updateRowWidth(),this.$cellsForColIndex(o,!0).css("min-width",i).css("max-width",i),t.device.tableAdditionalDivRequired&&this.$cellsForColIndexWidthFix(o,!0).css("max-width",i-this.cellHorizontalPadding-2),this.$rows(!0).css("width",this.rowWidth),this._updateRowHeights(),this._renderFiller(),this._renderViewport(),this.updateScrollbars(),this._triggerColumnResized(e),e.resizingInProgress?this._renderEmptyData():this._renderEmptyData(this.rowWidth-this.rowBorderWidth)}},t.Table.prototype.moveColumn=function(e,i,o,n){this.columns.forEach(function(t,e){t.fixedPosition&&o<=e&&(o=e+1)}),t.arrays.remove(this.columns,e),t.arrays.insert(this.columns,e,o),this._triggerColumnMoved(e,i,o,n),this._aggregateRows.forEach(function(e){t.arrays.move(e.contents,i,o)}),this._rerenderViewport()},t.Table.prototype._renderColumnOrderChanges=function(t){var i,o,n,r,s,a,l,h=this;this.header&&this.header.onOrderChanged(t),this.$rows(!0).each(function(){for(l=e(this),r=e(),a=l.children(),o=0;o<h.columns.length;o++){for(i=h.columns[o],n=0;n<t.length;n++)if(t[n]===i){s=a[n];break}r.push(s)}l.prepend(r)})},t.Table.prototype._triggerRowsInserted=function(t){this.trigger("rowsInserted",{rows:t})},t.Table.prototype._triggerRowsDeleted=function(t){this.trigger("rowsDeleted",{rows:t})},t.Table.prototype._triggerRowsUpdated=function(t){this.trigger("rowsUpdated",{rows:t})},t.Table.prototype._triggerAllRowsDeleted=function(t){this.trigger("allRowsDeleted",{rows:t})},t.Table.prototype._triggerRowsSelected=function(t){this.trigger("rowsSelected",{debounce:t})},t.Table.prototype._triggerRowsChecked=function(t){this.trigger("rowsChecked",{rows:t})},t.Table.prototype._triggerRowsFiltered=function(){this.trigger("rowsFiltered")},t.Table.prototype._triggerFilterResetted=function(){this.trigger("filterResetted")},t.Table.prototype._triggerAppLinkAction=function(t,e){this.trigger("appLinkAction",{column:t,ref:e})},t.Table.prototype._triggerReload=function(){this.trigger("reload")},t.Table.prototype._triggerExportToClipboard=function(){this.trigger("exportToClipboard")},t.Table.prototype._triggerRowOrderChanged=function(t,e){var i={row:t,animating:e};this.trigger("rowOrderChanged",i)};t.Table.prototype._triggerColumnResized=function(t){var e={column:t};this.trigger("columnResized",e)};t.Table.prototype._triggerColumnMoved=function(t,e,i,o){var n={column:t,oldPos:e,newPos:i,dragged:o};this.trigger("columnMoved",n)},t.Table.prototype._triggerAggregationFunctionChanged=function(t){var e={column:t};this.trigger("aggregationFunctionChanged",e)},t.Table.prototype._triggerGroupingChanged=function(){this.trigger("groupingChanged")},t.Table.prototype._renderHeaderVisible=function(){this._renderTableHeader()},t.Table.prototype._renderHeaderEnabled=function(){this._removeTableHeader(),this._renderTableHeader()},t.Table.prototype._syncCheckable=function(e){this._setProperty("checkable",e);var i=this.checkableColumn;this.checkable&&!i?this._insertBooleanColumn():!this.checkable&&i&&(t.arrays.remove(this.columns,i),
this.checkableColumn=null)},t.Table.prototype.hasPermanentHeadOrTailSortColumns=function(){return 0!==this._permanentHeadSortColumns.length||0!==this._permanentTailSortColumns.length},t.Table.prototype._syncHeadAndTailSortColumns=function(){var t=this.columns.filter(function(t){return t.sortIndex>=0});t.sort(function(t,e){return t.sortIndex-e.sortIndex}),this._permanentHeadSortColumns=[],this._permanentTailSortColumns=[],t.forEach(function(t){t.initialAlwaysIncludeSortAtBegin?this._permanentHeadSortColumns.push(t):t.initialAlwaysIncludeSortAtEnd&&this._permanentTailSortColumns.push(t)},this)},t.Table.prototype._syncRowIconVisible=function(e){this._setProperty("rowIconVisible",e);var i=this.rowIconColumn;this.rowIconVisible&&!i?this._insertRowIconColumn():!this.rowIconVisible&&i&&(t.arrays.remove(this.columns,i),this.rowIconColumn=null)},t.Table.prototype._syncSelectedRows=function(t){"string"==typeof t[0]&&(t=this._rowsByIds(t)),this._setProperty("selectedRows",t)},t.Table.prototype.setMenus=function(t){this.setProperty("menus",t)},t.Table.prototype._syncMenus=function(t,e){this.updateKeyStrokes(t,e),this._setProperty("menus",t),this._updateMenuBar(),this.header&&this.header.updateMenuBar()},t.Table.prototype._updateMenuBar=function(){var e=["Header"],i=this._filterMenus(this.menus,t.MenuDestinations.MENU_BAR,!1,!0,e);if(i=this.staticMenus.concat(i),this.menuBar.setMenuItems(i),this.contextMenu){var o=this._filterMenus(this.menus,t.MenuDestinations.CONTEXT_MENU,!0,!1,["Header"]);this.contextMenu.updateMenuItems(o)}},t.Table.prototype._syncKeyStrokes=function(t){this.updateKeyStrokes(t,this.keyStrokes),this._setProperty("keyStrokes",t)},t.Table.prototype.setFilters=function(t){for(var e in this._filterMap)this.removeFilterByKey(e);t&&t.forEach(function(t){t=this._ensureFilter(t),this.addFilter(t)},this)},t.Table.prototype._ensureFilter=function(e){return e instanceof t.TableUserFilter?e:(e.column&&(e.column=this._columnById(e.column)),e.table=this,e.session=this.session,t.create(e))},t.Table.prototype._syncTableStatus=function(e){e=t.Status.ensure(e),this._setProperty("tableStatus",e)},t.Table.prototype.setTableStatusVisible=function(t){this.setProperty("tableStatusVisible",t),this._updateFooterVisibility()},t.Table.prototype._updateFooterVisibility=function(){this.setFooterVisible(this.tableStatusVisible||this._hasVisibleTableControls())},t.Table.prototype.setFooterVisible=function(t){this._setProperty("footerVisible",t),t&&!this.footer&&(this.footer=this._createFooter()),this.rendered&&this._renderFooterVisible(),!t&&this.footer&&(this.footer.destroy(),this.footer=null)},t.Table.prototype.setHeaderVisible=function(t){this.setProperty("headerVisible",t)},t.Table.prototype._renderBackgroundEffect=function(){this.columns.forEach(function(t){t.backgroundEffect&&t._renderBackgroundEffect()},this)},t.Table.prototype._renderRowChecked=function(e){if(this.checkable&&e.$row){var i;if(this.checkableStyle===t.Table.CheckableStyle.TABLE_ROW)i=e.$row;else{if(!this.checkableColumn)throw new Error("checkableColumn not set");i=this.checkableColumn.$checkBox(e.$row)}i.toggleClass("checked",e.checked)}},t.Table.prototype._renderCheckable=function(){this._redraw()},t.Table.prototype._renderRowIconVisible=function(){this._redraw()},t.Table.prototype._redraw=function(){this._rerenderHeaderColumns(),this._rerenderViewport()},t.Table.prototype._rerenderHeaderColumns=function(){this.header&&(this.header.rerenderColumns(),this.invalidateLayoutTree())},t.Table.prototype._renderTableHeader=function(){var t=!1;this.headerVisible&&!this.header?(this.header=this._createHeader(),this.header.render(),this._renderEmptyData(),t=!0):!this.headerVisible&&this.header&&(this._removeTableHeader(),t=!0),this.$container.toggleClass("header-invisible",!this.header),t&&this.invalidateLayoutTree()},t.Table.prototype._removeTableHeader=function(){this.header&&(this.header.destroy(),this.header=null)},t.Table.prototype._renderEmptyData=function(e){if(this.header&&0===this.filteredRows().length){this.$emptyData||(this.$emptyData=this.$data.appendDiv().html("&nbsp;"));var i=t.graphics.getInsets(this.$data).horizontal(),o=t.nvl(e,this.header.$container[0].scrollWidth)-i;this.$emptyData.css("min-width",o).css("max-width",o)}this.updateScrollbars()},t.Table.prototype._removeEmptyData=function(){this.filteredRows().length>0&&this.$emptyData&&(this.$emptyData.remove(),this.$emptyData=i,this.updateScrollbars())},t.Table.prototype._renderFooterVisible=function(){this.footer&&(this.footerVisible?this._renderFooter():this._removeFooter(),this.invalidateLayoutTree())},t.Table.prototype._renderFooter=function(){this.footer.rendered||this.footer.render()},t.Table.prototype._removeFooter=function(){this.footer.rendered&&this.footer.remove()},t.Table.prototype._renderEnabled=function(){t.Table.parent.prototype._renderEnabled.call(this);var i=this.enabled;this.$data.setEnabled(i),this.$container.setTabbable(i),this.rendered&&this.$rows().each(function(){var t=e(this),o=t.data("row");t.find("input").setEnabled(i&&o.enabled)})},t.Table.prototype._renderDisabledStyle=function(){t.Table.parent.prototype._renderDisabledStyle.call(this),this._renderDisabledStyleInternal(this.$data)},t.Table.prototype._renderAutoResizeColumns=function(){this.autoResizeColumns&&this.invalidateLayoutTree()},t.Table.prototype._renderDropType=function(){this.dropType?this._installDragAndDropHandler():this._uninstallDragAndDropHandler()},t.Table.prototype._renderCheckableStyle=function(){this.$container.toggleClass("checkable",this.checkableStyle===t.Table.CheckableStyle.TABLE_ROW)},t.Table.prototype._installDragAndDropHandler=function(i){this.dragAndDropHandler||(this.dragAndDropHandler=t.dragAndDrop.handler(this,{supportedScoutTypes:t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER,dropType:function(){return this.dropType}.bind(this),dropMaximumSize:function(){return this.dropMaximumSize}.bind(this),additionalDropProperties:function(t){var i=e(t.currentTarget),o={rowId:""};if(i.hasClass("table-row")){var n=i.data("row");o.rowId=n.id}return o}.bind(this)}),this.dragAndDropHandler.install(this.$container,".table-data,.table-row"))},t.Table.prototype._uninstallDragAndDropHandler=function(t){this.dragAndDropHandler&&(this.dragAndDropHandler.uninstall(),this.dragAndDropHandler=null)},t.Table.prototype._installImageListeners=function(){this._imageLoadListener=this._onImageLoadOrError.bind(this),this.$data[0].addEventListener("load",this._imageLoadListener,!0),this.$data[0].addEventListener("error",this._imageLoadListener,!0)},t.Table.prototype._uninstallImageListeners=function(){this.$data[0].removeEventListener("load",this._imageLoadListener,!0),this.$data[0].removeEventListener("error",this._imageLoadListener,!0)},t.Table.prototype.calculateViewRangeSize=function(){if(this._updateRowHeight(),0===this.rowHeight)throw new Error("Cannot calculate view range with rowHeight = 0");return 2*Math.ceil(this.$data.outerHeight()/this.rowHeight)},t.Table.prototype.setViewRangeSize=function(t){this.viewRangeSize!==t&&(this._setProperty("viewRangeSize",t),this.rendered&&this._renderViewport())},t.Table.prototype._calculateCurrentViewRange=function(){var t,e=this.$data[0].scrollTop,i=this.$data[0].scrollHeight-this.$data[0].clientHeight;return t=0===i?0:this._rowIndexAtScrollTop(e),this._calculateViewRangeForRowIndex(t)},t.Table.prototype._rowIndexAtScrollTop=function(t){var e=0,i=-1;return this.filteredRows().some(function(o,n){if(e+=this._heightForRow(o),t<e)return i=n,!0}.bind(this)),i},t.Table.prototype._heightForRow=function(t){var e=0,i=t.aggregateRowAfter;return e=t.height?t.height:this.rowHeight,i&&(e+=i.height?i.height:this.aggregateRowHeight),e},t.Table.prototype._calculateViewRangeForRowIndex=function(e){if(!this.virtual)return new t.Range(0,this.filteredRows().length);var i,o=new t.Range,n=Math.floor(this.viewRangeSize/4);return o.from=Math.max(e-n,0),o.to=Math.min(o.from+this.viewRangeSize,this.filteredRows().length),i=this.viewRangeSize-o.size(),i>0&&(o.from=Math.max(o.to-this.viewRangeSize,0)),o},t.Table.prototype._renderViewport=function(){var t=this._calculateCurrentViewRange();this._renderViewRange(t)},t.Table.prototype._rerenderViewport=function(){this._removeRows(),this._removeAggregateRows(),this._renderFiller(),this._renderViewport()},t.Table.prototype._renderViewRangeForRowIndex=function(t){var e=this._calculateViewRangeForRowIndex(t);this._renderViewRange(e)},t.Table.prototype._renderViewRange=function(t){if(t.from!==this.viewRangeRendered.from||t.to!==this.viewRangeRendered.to||this.viewRangeDirty){this._removeRangeMarkers();var e=t.subtract(this.viewRangeRendered),i=this.viewRangeRendered.subtract(t);if(i.forEach(function(t){this._removeRowsInRange(t)}.bind(this)),e.forEach(function(t){this._renderRowsInRange(t)}.bind(this)),this.viewRangeRendered.size()>0){var o=this.filteredRows(),n=o[this.viewRangeRendered.from],r=o[this.viewRangeRendered.to-1];if(!n.$row||!r.$row)throw new Error("Rows not rendered as expected. "+this.viewRangeRendered+". First: "+n.$row+". Last: "+r.$row)}this._renderRangeMarkers(),this._removeAggregateRows(),this._renderAggregateRows(),this._renderFiller(),this._renderEmptyData(),this._renderBackgroundEffect(),this._renderSelection(),this.viewRangeDirty=!1}},t.Table.prototype._removeRangeMarkers=function(){var t,e;0!==this.viewRangeRendered.size()&&(t=this.filteredRows()[this.viewRangeRendered.from],e=this.filteredRows()[this.viewRangeRendered.to-1],t.$row.removeClass("first"),e.$row.removeClass("last"))},t.Table.prototype._renderRangeMarkers=function(){var t,e;0!==this.viewRangeRendered.size()&&(t=this.filteredRows()[this.viewRangeRendered.from],e=this.filteredRows()[this.viewRangeRendered.to-1],t.$row.addClass("first"),e.$row.addClass("last"))},t.Table.prototype.ensureRowRendered=function(t){if(!t.$row){var e=this.filteredRows().indexOf(t);this._renderViewRangeForRowIndex(e)}},t.Table.prototype._renderFiller=function(){this.$fillBefore||(this.$fillBefore=this.$data.prependDiv("table-data-fill"),this._applyFillerStyle(this.$fillBefore));var i=this._calculateFillerHeight(new t.Range(0,this.viewRangeRendered.from));this.$fillBefore.cssHeight(i),this.$fillBefore.cssWidth(this.rowWidth),e.log.trace("FillBefore height: "+i),this.$fillAfter||(this.$fillAfter=this.$data.appendDiv("table-data-fill"),this._applyFillerStyle(this.$fillAfter));var o=this._calculateFillerHeight(new t.Range(this.viewRangeRendered.to,this.filteredRows().length));this.$fillAfter.cssHeight(o),this.$fillAfter.cssWidth(this.rowWidth),e.log.trace("FillAfter height: "+o)},t.Table.prototype._applyFillerStyle=function(t){var e=t.css("background-color"),i=(100*(1-1/this.rowHeight)).toFixed(2)+"%";t.css({background:"linear-gradient(to bottom, transparent, transparent "+i+", "+e+" "+i+", "+e+")",backgroundSize:"100% "+this.rowHeight+"px",backgroundColor:"transparent"})},t.Table.prototype._calculateFillerHeight=function(t){for(var e=0,i=t.from;i<t.to;i++){var o=this.filteredRows()[i];e+=this._heightForRow(o)}return e},t.Table.prototype.containsNumberColumn=function(){return this.columns.some(function(e){return e instanceof t.NumberColumn})},t.Table.prototype.updateColumnStructure=function(t){this._rebuildingTable=!0,this.columns=t,this._initColumns(),this.rendered&&(this._updateRowWidth(),this.$rows(!0).css("width",this.rowWidth),this._rerenderHeaderColumns()),this.trigger("columnStructureChanged")},t.Table.prototype.updateColumnOrder=function(e){var i,o,n,r;if(e.length!==this.columns.length)throw new Error("Column order may not be updated because lengths of the arrays differ.");for(r=this.columns.slice(),i=0;i<e.length;i++){if(o=e[i],n=this.columns.indexOf(o),n<0)throw new Error("Column with id "+o.id+"not found.");n!==i&&(t.arrays.remove(this.columns,o),t.arrays.insert(this.columns,o,i))}this.rendered&&this._renderColumnOrderChanges(r)},t.Table.prototype.updateColumnHeaders=function(i){for(var o,n,r=0;r<i.length;r++)t.defaultValues.applyTo(i[r],"Column"),o=this._columnById(i[r].id),n=e.extend(n,o),o.text=i[r].text,o.tooltipText=i[r].tooltipText,o.headerCssClass=i[r].headerCssClass,o.headerBackgroundColor=i[r].headerBackgroundColor,o.headerForegroundColor=i[r].headerForegroundColor,o.headerFont=i[r].headerFont,o.headerIconId=i[r].headerIconId,o.sortActive=i[r].sortActive,o.sortAscending=i[r].sortAscending,o.sortActive||o.sortIndex===-1?o.sortActive&&o.sortIndex===-1?this._addSortColumn(o):o.sortIndex=i[r].sortIndex:this._removeSortColumn(o),this.rendered&&this.header&&this.header.updateHeader(o,n)},t.Table.prototype.requestFocusInCell=function(t,e){if(!this.rendered)return void this._postRenderActions.push(this.requestFocusInCell.bind(this,t,e));var i=this.cell(t,e);this.enabled&&e.enabled&&i.editable&&this.prepareCellEdit(t,e,!0)},t.Table.prototype._attach=function(){this.$parent.append(this.$container);var e=this.htmlComp.getParent();this.htmlComp.setSize(e.getSize()),this.session.detachHelper.afterAttach(this.$container),t.Table.parent.prototype._attach.call(this)},t.Table.prototype._detach=function(){this.session.detachHelper.beforeDetach(this.$container),this.$container.detach(),t.Table.parent.prototype._detach.call(this)},t.Table.prototype.setVirtual=function(t){this._setProperty("virtual",t)},t.Table.prototype.setCellValue=function(t,e,i){t.setCellValue(e,i),this.updateRow(e)},t.Table.parseHorizontalAlignment=function(t){return t>0?"right":0===t?"center":"left"},t.Table.linkRowToDiv=function(t,e){t&&(t.$row=e),e&&e.data("row",t)},t.TableAdapter=function(){t.TableAdapter.parent.call(this),this._addAdapterProperties(["tableControls","menus","keyStrokes"]),this._addRemoteProperties(["contextColumn"])},t.inherits(t.TableAdapter,t.ModelAdapter),t.TableAdapter.prototype._sendRowsSelected=function(t,e){var i={rowIds:t};this._send("rowsSelected",i,{delay:e?250:0,coalesce:function(t){return this.id===t.id&&this.type===t.type}})},t.TableAdapter.prototype._sendRowClicked=function(t,e,i){var o={rowId:t,columnId:i,mouseButton:e};this._send("rowClicked",o)},t.TableAdapter.prototype._onWidgetRowsSelected=function(t){var e=this.widget._rowsToIds(this.widget.selectedRows);this._sendRowsSelected(e,t.debounce)},t.TableAdapter.prototype._onWidgetRowClicked=function(t){var e;t.column!==i&&(e=t.column.id),this._sendRowClicked(t.row.id,t.mouseButton,e)},t.TableAdapter.prototype._onWidgetAddFilter=function(e){var i=e.filter;i instanceof t.TableUserFilter&&this._send("addFilter",i.createAddFilterEventData())},t.TableAdapter.prototype._onWidgetRemoveFilter=function(e){var i=e.filter;i instanceof t.TableUserFilter&&this._send("removeFilter",i.createRemoveFilterEventData())},t.TableAdapter.prototype._onWidgetColumnResized=function(t){this._sendColumnResized(t.column)},t.TableAdapter.prototype._sendColumnResized=function(t){if(!t.fixedWidth&&!this.widget.autoResizeColumns){var e={columnId:t.id,width:t.width};this._send("columnResized",e,{delay:750,coalesce:function(t){return this.id===t.id&&this.type===t.type&&this.columnId===t.columnId},showBusyIndicator:!1})}},t.TableAdapter.prototype._onWidgetAggregationFunctionChanged=function(t){this._sendAggregationFunctionChanged(t.column)},t.TableAdapter.prototype._sendAggregationFunctionChanged=function(t){var e={columnId:t.id,aggregationFunction:t.aggregationFunction};this._send("aggregationFunctionChanged",e)},t.TableAdapter.prototype._onWidgetColumnBackgroundEffectChanged=function(t){this._sendColumnBackgroundEffectChanged(t.column)},t.TableAdapter.prototype._sendColumnBackgroundEffectChanged=function(t){var e={columnId:t.id,backgroundEffect:t.backgroundEffect};this._send("columnBackgroundEffectChanged",e)},t.TableAdapter.prototype._onWidgetColumnOrganizeAction=function(t){this._send("columnOrganizeAction",{action:t.action,columnId:t.column.id})},t.TableAdapter.prototype._onWidgetColumnMoved=function(t){var e=t.newPos;this.widget.columns.forEach(function(t,i){t.guiOnly&&e--}),this._sendColumnMoved(t.column,e)},t.TableAdapter.prototype._sendColumnMoved=function(t,e){var i={columnId:t.id,index:e};this._send("columnMoved",i)},t.TableAdapter.prototype._onWidgetPrepareCellEdit=function(t){this._sendPrepareCellEdit(t.row,t.column)},t.TableAdapter.prototype._sendPrepareCellEdit=function(t,e){var i={rowId:t.id,columnId:e.id};this._send("prepareCellEdit",i)},t.TableAdapter.prototype._onWidgetCompleteCellEdit=function(t){this._sendCompleteCellEdit(t.field)},t.TableAdapter.prototype._sendCompleteCellEdit=function(t){var e={fieldId:t.id};this._send("completeCellEdit",e)},t.TableAdapter.prototype._onWidgetCancelCellEdit=function(t){this._sendCancelCellEdit(t.field)},t.TableAdapter.prototype._sendCancelCellEdit=function(t){var e={fieldId:t.id};this._send("cancelCellEdit",e)},t.TableAdapter.prototype._onWidgetRowsChecked=function(t){this._sendRowsChecked(t.rows)},t.TableAdapter.prototype._sendRowsChecked=function(t){for(var e={rows:[]},i=0;i<t.length;i++)e.rows.push({rowId:t[i].id,checked:t[i].checked});this._send("rowsChecked",e)},t.TableAdapter.prototype._onWidgetRowsFiltered=function(t){var e=this.widget._rowsToIds(this.widget.filteredRows());this._sendRowsFiltered(e)},t.TableAdapter.prototype._sendRowsFiltered=function(t){var e={};t.length===this.widget.rows.length?e.remove=!0:e.rowIds=t,this._send("rowsFiltered",e,{delay:250,coalesce:function(t){return this.id===t.id&&this.type===t.type&&this.remove===t.remove},showBusyIndicator:!1})},t.TableAdapter.prototype._onWidgetRowAction=function(t){this._sendRowAction(t.row,t.column)},t.TableAdapter.prototype._sendRowAction=function(t,e){this._send("rowAction",{rowId:t.id,columnId:e.id})},t.TableAdapter.prototype._onWidgetAppLinkAction=function(t){this._sendAppLinkAction(t.column,t.ref)},t.TableAdapter.prototype._sendAppLinkAction=function(t,e){this._send("appLinkAction",{columnId:t.id,ref:e})},t.TableAdapter.prototype._sendContextColumn=function(t){t.guiOnly&&(t=null,this.widget.contextColumn=null);var e=null;t&&(e=t.id),this._send("property",{contextColumn:e})},t.TableAdapter.prototype._onWidgetReload=function(t){this._send("reload")},t.TableAdapter.prototype._onWidgetExportToClipbaord=function(t){this._send("exportToClipboard")},t.TableAdapter.prototype._onWidgetEvent=function(e){"rowsSelected"===e.type?this._onWidgetRowsSelected(e):"rowsChecked"===e.type?this._onWidgetRowsChecked(e):"rowsFiltered"===e.type?this._onWidgetRowsFiltered(e):"rowClicked"===e.type?this._onWidgetRowClicked(e):"rowAction"===e.type?this._onWidgetRowAction(e):"prepareCellEdit"===e.type?this._onWidgetPrepareCellEdit(e):"completeCellEdit"===e.type?this._onWidgetCompleteCellEdit(e):"cancelCellEdit"===e.type?this._onWidgetCancelCellEdit(e):"appLinkAction"===e.type?this._onWidgetAppLinkAction(e):"exportToClipboard"===e.type?this._onWidgetExportToClipbaord(e):"reload"===e.type?this._onWidgetReload(e):"addFilter"===e.type?this._onWidgetAddFilter(e):"removeFilter"===e.type?this._onWidgetRemoveFilter(e):"columnResized"===e.type?this._onWidgetColumnResized(e):"columnMoved"===e.type?this._onWidgetColumnMoved(e):"columnBackgroundEffectChanged"===e.type?this._onWidgetColumnBackgroundEffectChanged(e):"columnOrganizeAction"===e.type?this._onWidgetColumnOrganizeAction(e):"aggregationFunctionChanged"===e.type?this._onWidgetAggregationFunctionChanged(e):t.TableAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.TableAdapter.prototype._onRowsInserted=function(t){this.widget.insertRows(t,!0)},t.TableAdapter.prototype._onRowsDeleted=function(t){var e=this.widget._rowsByIds(t);this.addFilterForWidgetEventType("rowsSelected"),this.widget.deleteRows(e)},t.TableAdapter.prototype._onAllRowsDeleted=function(){this.addFilterForWidgetEventType("rowsSelected"),this.widget.deleteAllRows()},t.TableAdapter.prototype._onRowsUpdated=function(t){this.widget.updateRows(t)},t.TableAdapter.prototype._onRowsSelected=function(t){var e=this.widget._rowsByIds(t);this.addFilterForWidgetEventType("rowsSelected"),this.widget.selectRows(e),this.widget.selectionHandler.clearLastSelectedRowMarker()},t.TableAdapter.prototype._onRowsChecked=function(t){var e=[],i=[];t.forEach(function(t){var o=this.widget._rowById(t.id);t.checked?e.push(o):i.push(o)},this),this.addFilterForWidgetEventType("rowsChecked"),this.widget.checkRows(e,{checked:!0,checkOnlyEnabled:!1}),this.widget.uncheckRows(i,{checkOnlyEnabled:!1})},t.TableAdapter.prototype._onRowOrderChanged=function(t){var e=this.widget._rowsByIds(t);this.widget.updateRowOrder(e)},t.TableAdapter.prototype._onColumnStructureChanged=function(t){this.widget.updateColumnStructure(t)},t.TableAdapter.prototype._onColumnOrderChanged=function(t){var e=this.widget._columnsByIds(t);this.widget.updateColumnOrder(e)},t.TableAdapter.prototype._onColumnHeadersUpdated=function(t){this.widget.updateColumnHeaders(t)},t.TableAdapter.prototype._onStartCellEdit=function(t,e,i){var o=this.widget._columnById(t),n=this.widget._rowById(e),r=this.session.getOrCreateWidget(i,this.widget);this.widget.startCellEdit(o,n,r)},t.TableAdapter.prototype._onEndCellEdit=function(t){var e=this.session.getModelAdapter(t);this.widget.endCellEdit(e.widget)},t.TableAdapter.prototype._onRequestFocus=function(){this.widget.requestFocus()},t.TableAdapter.prototype._onScrollToSelection=function(){this.widget.revealSelection()},t.TableAdapter.prototype._onColumnBackgroundEffectChanged=function(t){t.eventParts.forEach(function(t){var e=this.widget._columnById(t.columnId),i=t.backgroundEffect;this.addFilterForWidgetEvent(function(t){return"columnBackgroundEffectChanged"===t.type&&t.column.id===e.id&&t.column.backgroundEffect===i}),e.setBackgroundEffect(i)},this)},t.TableAdapter.prototype._onRequestFocusInCell=function(t){var e=this.widget._rowById(t.rowId),i=this.widget._columnById(t.columnId);this.widget.requestFocusInCell(i,e)},t.TableAdapter.prototype._onAggregationFunctionChanged=function(t){var e=[],i=[];t.eventParts.forEach(function(t){var o=t.aggregationFunction,n=this.widget._columnById(t.columnId);this.addFilterForWidgetEvent(function(t){return"aggregationFunctionChanged"===t.type&&t.column.id===n.id&&t.column.aggregationFunction===o}),e.push(n),i.push(o)},this),this.widget.changeAggregations(e,i)},t.TableAdapter.prototype._onFiltersChanged=function(t){this.addFilterForWidgetEventType("addFilter"),this.addFilterForWidgetEventType("removeFilter"),this.widget.setFilters(t),this.widget._rebuildingTable||this.widget.filter()},t.TableAdapter.prototype.onModelAction=function(e){"rowsInserted"===e.type?this._onRowsInserted(e.rows):"rowsDeleted"===e.type?this._onRowsDeleted(e.rowIds):"allRowsDeleted"===e.type?this._onAllRowsDeleted():"rowsSelected"===e.type?this._onRowsSelected(e.rowIds):"rowOrderChanged"===e.type?this._onRowOrderChanged(e.rowIds):"rowsUpdated"===e.type?this._onRowsUpdated(e.rows):"filtersChanged"===e.type?this._onFiltersChanged(e.filters):"rowsChecked"===e.type?this._onRowsChecked(e.rows):"columnStructureChanged"===e.type?this._onColumnStructureChanged(e.columns):"columnOrderChanged"===e.type?this._onColumnOrderChanged(e.columnIds):"columnHeadersUpdated"===e.type?this._onColumnHeadersUpdated(e.columns):"startCellEdit"===e.type?this._onStartCellEdit(e.columnId,e.rowId,e.fieldId):"endCellEdit"===e.type?this._onEndCellEdit(e.fieldId):"requestFocus"===e.type?this._onRequestFocus():"scrollToSelection"===e.type?this._onScrollToSelection():"aggregationFunctionChanged"===e.type?this._onAggregationFunctionChanged(e):"columnBackgroundEffectChanged"===e.type?this._onColumnBackgroundEffectChanged(e):"requestFocusInCell"===e.type?this._onRequestFocusInCell(e):t.TableAdapter.parent.prototype.onModelAction.call(this,e)},t.TableAdapter.prototype.exportAdapterData=function(e){return e=t.TableAdapter.parent.prototype.exportAdapterData.call(this,e),delete e.selectedRows,e.rows=[],e.columns.forEach(function(t){delete t.classId,delete t.modelClass}),e},t.TableRow=function(){this.$row,this.aggregateRowAfter,this.cells=[],this.checked=!1,this.enabled=!0,this.filterAccepted=!0,this.height,this.hasError=!1,this.id},t.TableRow.prototype.init=function(t){this._init(t)},t.TableRow.prototype._init=function(i){if(!i.parent)throw new Error("missing property 'parent'");e.extend(this,i),t.defaultValues.applyTo(this),this._initCells()},t.TableRow.prototype._initCells=function(){this.getTable().columns.forEach(function(t){if(!t.guiOnly){var e=this.cells[t.index];e=t.initCell(e,this),this.cells[t.index]=e}},this)},t.TableRow.prototype.getTable=function(){return this.parent},t.TableMatrix=function(t,e){this.session=e,this.locale=e.locale,this._allData=[],this._allAxis=[],this._columns=t.columns,this._rows=t.rows,this._table=t},t.TableMatrix.DateGroup={NONE:0,YEAR:256,MONTH:257,WEEKDAY:258},t.TableMatrix.NumberGroup={COUNT:-1,SUM:1,AVG:2},t.TableMatrix.prototype.addData=function(e,i){var o=[],n=this.locale;return this._allData.push(o),o.column=e,o.format=function(t){return n.decimalFormat.format(t)},i===t.TableMatrix.NumberGroup.COUNT?(o.norm=function(t){return 1},o.group=function(t){return t.length}):i===t.TableMatrix.NumberGroup.SUM?(o.norm=function(t){return isNaN(t)||null===t||""===t?null:parseFloat(t)},o.group=function(t){return t.reduce(function(t,e){return t+e})}):i===t.TableMatrix.NumberGroup.AVG&&(o.norm=function(t){return isNaN(t)||null===t||""===t?null:parseFloat(t)},o.group=function(t){var e=t.reduce(function(t,e){return t+e}),i=t.reduce(function(t,e){return null===e?t:t+1},0);return 0===i?null:e/i}),o},t.TableMatrix.prototype.addAxis=function(e,i){var o=[],n=this.locale,r=this.session,s=this.session.text.bind(this.session),a=s("ui.EmptyCell");return this._allAxis.push(o),o.column=e,o.normTable=[],o.add=function(t){o.indexOf(t)===-1&&o.push(t)},o.reorder=function(){o.sort(function(t,e){return null===t?1:null===e?-1:t-e})},o.norm=function(t){if(null===t||""===t)return null;var e=o.normTable.indexOf(t);return e===-1?o.normTable.push(t)-1:e},o.format=function(t){return null===t?a:o.normTable[t]},e instanceof t.DateColumn?i===t.TableMatrix.DateGroup.NONE?(o.norm=function(t){return null===t||""===t?null:t.getTime()},o.format=function(i){if(null===i)return null;var o=e.format;return o=o?new t.DateFormat(n,o):n.dateFormat,o.format(new Date(i))}):i===t.TableMatrix.DateGroup.YEAR?(o.norm=function(t){return null===t||""===t?null:t.getFullYear()},o.format=function(t){return null===t?a:String(t)}):i===t.TableMatrix.DateGroup.MONTH?(o.norm=function(t){return null===t||""===t?null:t.getMonth()},o.format=function(t){return null===t?a:n.dateFormatSymbols.months[t]}):i===t.TableMatrix.DateGroup.WEEKDAY&&(o.norm=function(t){if(null===t||""===t)return null;var e=(t.getDay()+7-n.dateFormatSymbols.firstDayOfWeek)%7;return e},o.format=function(t){return null===t?a:n.dateFormatSymbols.weekdaysOrdered[t]}):e instanceof t.NumberColumn?(o.norm=function(t){return isNaN(t)||null===t||""===t?null:parseFloat(t)},o.format=function(t){return isNaN(t)||null===t?a:e.decimalFormat.format(t)}):e instanceof t.BooleanColumn?(o.norm=function(t){return t?1:0},o.format=function(t){return s(0===t?"ui.BooleanColumnGroupingFalse":"ui.BooleanColumnGroupingTrue")}):e instanceof t.IconColumn?o.textIsIcon=!0:o.reorder=function(){var e=t.comparators.TEXT;e.install(r),o.sort(function(t,i){return null===t?1:null===i?-1:e.compare(o.format(t),o.format(i))})},o},t.TableMatrix.prototype.calculate=function(){var e,o,n,r,s,a,l,h={};for(e=0;e<this._rows.length;e++){var d=this._rows[e],p=[];for(n=0;n<this._allAxis.length;n++){var u=this._allAxis[n].column;s=u.cellValueForGrouping(d),l=this._allAxis[n].norm(s),l!==i&&(this._allAxis[n].add(l),p.push(l))}p=JSON.stringify(p);var c=[];for(o=0;o<this._allData.length;o++)r=this._table.cellValue(this._allData[o].column,d),a=this._allData[o].norm(r),a!==i&&c.push(a);h[p]?h[p].push(c):h[p]=[c]}for(o=0;o<this._allData.length;o++){r=this._allData[o],r.total=0,r.min=null,r.max=null;for(n in h)if(h.hasOwnProperty(n)){for(var f=h[n],y=[],g=0;g<f.length;g++)y.push(f[g][o]);var m=this._allData[o].group(y);if(h[n][o]=m,r.total+=m,null===m)continue;(m<r.min||null===r.min)&&(r.min=m),(m>r.max||null===r.min)&&(r.max=m)}0===t.nvl(r.max,0)&&(r.max=.1);var _=Math.ceil(Math.log(r.max)/Math.LN10)-1;r.max=Math.ceil(r.max/Math.pow(10,_))*Math.pow(10,_),r.max=4*Math.ceil(r.max/4)}for(n=0;n<this._allAxis.length;n++)s=this._allAxis[n],s.min=Math.min.apply(null,s),s.max=Math.max.apply(null,s),s.indexOf(null)>-1&&(s.max=s.max+1),s.reorder();return h.getValue=function(t){return t=JSON.stringify(t),h.hasOwnProperty(t)?h[t]:null},h},t.TableMatrix.prototype.columnCount=function(){for(var e=[],i=0,o=0;o<this._columns.length;o++){var n=this._columns[o];if(!(n instanceof t.NumberColumn)){e.push([n,[]]);for(var r=0;r<this._rows.length;r++){var s=this._rows[r],a=this._table.cellValue(n,s);e[i][1].indexOf(a)===-1&&e[i][1].push(a)}e[i][1]=e[i][1].length,i++}}return e},t.TableMatrix.prototype.isEmpty=function(){return 0===this._rows.length||0===this._columns.length},t.TableFooter=function(){t.TableFooter.parent.call(this),this._tableRowsChangedHandler=this._onTableRowsChanged.bind(this),this._tableRowsFilteredHandler=this._onTableRowsFiltered.bind(this),this._tableAddFilterHandler=this._onTableAddFilter.bind(this),this._tableRemoveFilterHandler=this._onTableRemoveFilter.bind(this),this._tableRowsSelectedHandler=this._onTableRowsSelected.bind(this),this._tableStatusChangedHandler=this._onTableStatusChanged.bind(this),this._tableColumnStructureChangedHandler=this._onColumnStructureChanged.bind(this)},t.inherits(t.TableFooter,t.Widget),t.TableFooter.prototype._init=function(e){t.TableFooter.parent.prototype._init.call(this,e),this.table=e.table,this.searchFieldKeyStrokeContext=new t.InputFieldKeyStrokeContext,this.searchFieldKeyStrokeContext.$bindTarget=function(){return this._$textFilter}.bind(this),this.searchFieldKeyStrokeContext.$scopeTarget=function(){return this._$textFilter}.bind(this)},t.TableFooter.prototype._render=function(i){var o;i=i||this.table.$container,this.$container=i.appendDiv("table-footer"),this._$window=i.window(),this._$body=i.body(),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.TableFooterLayout(this)),this.$controlContainer=this.$container.appendDiv("table-control-container").hide(),this.$controlContent=this.$controlContainer.appendDiv("table-control-content"),this._$controls=this.$container.appendDiv("table-controls"),this._$info=this.$container.appendDiv("table-info"),this._$textFilter=t.fields.makeTextField(i,"table-text-filter").appendTo(this._$info).on("input","",this._onFilterInput.bind(this)).on("input","",e.debounce(this._onFilterInputDebounce.bind(this))).placeholder(this.session.text("ui.FilterBy_")),o=this.table.getFilter(t.TableTextUserFilter.Type),o&&this._$textFilter.val(o.text),this._$infoLoad=this._$info.appendDiv("table-info-item table-info-load").on("click","",this._onInfoLoadClick.bind(this)),this._$infoFilter=this._$info.appendDiv("table-info-item table-info-filter").on("click","",this._onInfoFilterClick.bind(this)),this._$infoSelection=this._$info.appendDiv("table-info-item table-info-selection").on("click","",this._onInfoSelectionClick.bind(this)),this._$infoTableStatus=this._$info.appendDiv("table-info-item table-info-status").on("mousedown",this._onStatusMousedown.bind(this)),this._$infoTableStatusIcon=this._$infoTableStatus.appendSpan("font-icon icon"),this._renderControls(),this._renderInfo(),this._updateInfoVisibility(),this.table.on("rowsInserted",this._tableRowsChangedHandler),this.table.on("rowsDeleted",this._tableRowsChangedHandler),this.table.on("allRowsDeleted",this._tableRowsChangedHandler),this.table.on("rowsFiltered",this._tableRowsFilteredHandler),this.table.on("addFilter",this._tableAddFilterHandler),this.table.on("removeFilter",this._tableRemoveFilterHandler),this.table.on("rowsSelected",this._tableRowsSelectedHandler),this.table.on("statusChanged",this._tableStatusChangedHandler),this.table.on("columnStructureChanged",this._tableColumnStructureChangedHandler),this.session.keyStrokeManager.installKeyStrokeContext(this.searchFieldKeyStrokeContext)},t.TableFooter.prototype._remove=function(){
this.session.keyStrokeManager.uninstallKeyStrokeContext(this.searchFieldKeyStrokeContext),this._hideTableStatusTooltip(),this.$resizer=null,this.open=!1,this.table.off("rowsInserted",this._tableRowsChangedHandler),this.table.off("rowsDeleted",this._tableRowsChangedHandler),this.table.off("allRowsDeleted",this._tableRowsChangedHandler),this.table.off("rowsFiltered",this._tableRowsFilteredHandler),this.table.off("addFilter",this._tableAddFilterHandler),this.table.off("removeFilter",this._tableRemoveFilterHandler),this.table.off("rowsSelected",this._tableRowsSelectedHandler),this.table.off("statusChanged",this._tableStatusChangedHandler),this.table.off("columnStructureChanged",this._tableColumnStructureChangedHandler),t.TableFooter.parent.prototype._remove.call(this)},t.TableFooter.prototype._renderResizerVisible=function(){this.selectedControl.resizerVisible?(this._renderResizer(),this.$controlContainer.addClass("has-resizer")):this.$resizer&&(this.$resizer.remove(),this.$resizer=null,this.$controlContainer.removeClass("has-resizer"))},t.TableFooter.prototype._renderResizer=function(){function t(t){function e(t){if(this.rendered){var e=Math.floor(t.pageY),i=e-n,r=this.table.$container.height()-this.table.footer.$container.height(),s=Math.min(o-i,r);this.$controlContainer.height(s),this.$controlContent.outerHeight(s),this._revalidateTableLayout()}}function i(){this.rendered&&this.$controlContainer.height()<100&&this.selectedControl.setSelected(!1),this._$window.off("mousemove.tablefooter"),this._$body.removeClass("row-resize")}var o=this.$controlContainer.height(),n=Math.floor(t.pageY);return this._$window.on("mousemove.tablefooter",e.bind(this)).one("mouseup",i.bind(this)),this._$body.addClass("row-resize"),!1}this.$resizer||(this.$resizer=this.$controlContainer.prependDiv("table-control-resize").on("mousedown","",t.bind(this)))},t.TableFooter.prototype._renderControls=function(){var t=this.table.tableControls;t?t.forEach(function(t){t.setParent(this),t.render(this._$controls)}.bind(this)):this._$controls.empty()},t.TableFooter.prototype._renderInfo=function(){this._renderInfoLoad(),this._renderInfoTableStatus(),this._renderInfoFilter(),this._renderInfoSelection()},t.TableFooter.prototype._renderInfoLoad=function(){var t=this._$infoLoad,e=this.table.rows.length;t.empty(),this._compactStyle?(t.appendSpan().text(this.session.text("ui.NumRowsLoadedMin")),t.appendBr(),t.appendSpan("table-info-button").text(this.computeCountInfo(e))):(t.appendSpan().text(this.session.text("ui.NumRowsLoaded",this.computeCountInfo(e))),this.table.hasReloadHandler&&(t.appendBr(),t.appendSpan("table-info-button").text(this.session.text("ui.ReloadData")).appendTo(t))),t.setEnabled(this.table.hasReloadHandler),this.htmlComp.layouting||this.invalidateLayoutTree(!1)},t.TableFooter.prototype._renderInfoFilter=function(){var t=this._$infoFilter,e=this.table.filteredRows().length,i=this.table.filteredBy().join(", ");t.empty(),this._compactStyle?(t.appendSpan().text(this.session.text("ui.NumRowsFilteredMin")),t.appendBr(),t.appendSpan("table-info-button").text(this.computeCountInfo(e))):(i?t.appendSpan().text(this.session.text("ui.NumRowsFilteredBy",this.computeCountInfo(e),i)):t.appendSpan().text(this.session.text("ui.NumRowsFiltered",this.computeCountInfo(e))),t.appendBr(),t.appendSpan("table-info-button").text(this.session.text("ui.RemoveFilter")).appendTo(t)),this.htmlComp.layouting||this.invalidateLayoutTree(!1)},t.TableFooter.prototype._renderInfoSelection=function(){var t=this._$infoSelection,e=this.table.filteredRows().length,i=this.table.selectedRows.length,o=e>0&&e===i;t.empty(),this._compactStyle?(t.appendSpan().text(this.session.text("ui.NumRowsSelectedMin")),t.appendBr(),t.appendSpan("table-info-button").text(this.computeCountInfo(i))):(t.appendSpan().text(this.session.text("ui.NumRowsSelected",this.computeCountInfo(i))),t.appendBr(),t.appendSpan("table-info-button").text(this.session.text(o?"ui.SelectNone":"ui.SelectAll")).appendTo(t)),this.htmlComp.layouting||this.invalidateLayoutTree(!1)},t.TableFooter.prototype._renderInfoTableStatus=function(){var e=this._$infoTableStatus,i=this.table.tableStatus;e.removeClass(t.Status.cssClasses),i&&e.addClass(i.cssClass()),this.htmlComp.layouting||this.invalidateLayoutTree(!1)},t.TableFooter.prototype._updateInfoVisibility=function(){this._updateInfoFilterVisibility(),this._updateInfoSelectionVisibility(),this._updateInfoTableStatusVisibility()},t.TableFooter.prototype._updateInfoFilterVisibility=function(){var t=this.table.filteredBy().length>0;this._setInfoVisible(this._$infoFilter,t)},t.TableFooter.prototype._updateInfoSelectionVisibility=function(){var t=this.table.multiSelect;this._setInfoVisible(this._$infoSelection,t)},t.TableFooter.prototype._updateInfoTableStatusVisibility=function(){var e=this.table.tableStatus;if(e){var i=null;t.isOneOf(this.table.tableStatus.uiState,"user-hidden","auto-hidden")||(this._$infoTableStatus.addClass("tooltip-active"),i=function(){this.table.tableStatus&&!t.isOneOf(this.table.tableStatus.uiState,"user-hidden","auto-hidden")&&this._showTableStatusTooltip()}.bind(this)),this._setInfoVisible(this._$infoTableStatus,!0,i)}else this._hideTableStatusTooltip(),this._setInfoVisible(this._$infoTableStatus,!1)},t.TableFooter.prototype._setInfoVisible=function(t,e,i){if(!(t.isVisible()!==e||e&&t.data("hiding")))return void(i&&i());var o=this.rendered;if(!o)return void t.setVisible(e);if(e){var n={progress:this.revalidateLayout.bind(this),complete:function(){i&&i()}.bind(this)};t.data("animationComplete",n.complete),""===t[0].style.width&&t.cssWidth(0),t.show().stop().widthToContent(n)}else t.data("hiding",!0),t.stop().animate({width:0},{progress:this.revalidateLayout.bind(this),complete:function(){t.removeData("hiding"),t.hide()}})},t.TableFooter.prototype._toggleTableInfoTooltip=function(e,i){this._tableInfoTooltip?this._tableInfoTooltip.destroy():(this._tableInfoTooltip=t.create(i,{parent:this,tableFooter:this,cssClass:"table-info-tooltip",arrowPosition:50,arrowPositionUnit:"%",$anchor:e}),this._tableInfoTooltip.one("destroy",function(){this._tableInfoTooltip=null}.bind(this)),this._tableInfoTooltip.render())},t.TableFooter.prototype.computeCountInfo=function(e){return 0===t.nvl(e,0)?this._compactStyle?this.session.text("ui.TableRowCount",0):this.session.text("ui.TableRowCount0"):1===e?this.session.text("ui.TableRowCount1"):this.session.text("ui.TableRowCount",e)},t.TableFooter.prototype._revalidateTableLayout=function(){this.table.htmlComp.revalidateLayoutTree()},t.TableFooter.prototype.openControlContainer=function(e){this.open,this.opening=!0,this.open=!0;var i=t.graphics.getInsets(this.$controlContainer),o=e.height-i.top-i.bottom;this.$controlContent.outerHeight(o),""===this.$controlContainer[0].style.height&&this.$controlContainer.outerHeight(0),this.$controlContainer.outerHeight()>e.height&&this.table.invalidateLayoutTree(),this.$controlContainer.stop(!0).show().delay(1).animate({height:e.height},{duration:this.rendered?e.animateDuration:0,complete:function(){this.opening=!1,e.onControlContainerOpened(),this.table.invalidateLayoutTree()}.bind(this)})},t.TableFooter.prototype.closeControlContainer=function(t){this.open&&(this.open=!1,this.opening=!1,this.table.invalidateLayoutTree(),this.$controlContainer.stop(!0).show().animate({height:0},{duration:t.animateDuration,done:function(){this.$controlContainer.hide(),t.onControlContainerClosed()}.bind(this)}))},t.TableFooter.prototype._hideTableStatusTooltip=function(){clearTimeout(this._autoHideTableStatusTooltipTimeoutId),this._tableStatusTooltip&&this._tableStatusTooltip.destroy()},t.TableFooter.prototype._showTableStatusTooltip=function(){this._tableStatusTooltip&&this._tableStatusTooltip.destroy();var e=this.table.tableStatus,i=e?e.message:null;if(!t.strings.empty(i)){var o={parent:this,text:i,severity:e.severity,autoRemove:!e.isError(),$anchor:this._$infoTableStatusIcon};this._tableStatusTooltip=t.create("Tooltip",o),this._tableStatusTooltip.one("destroy",function(){this._tableStatusTooltip=null}.bind(this)),this._tableStatusTooltip.render(),this._$infoTableStatus.addClass("tooltip-active"),this._tableStatusTooltip.on("remove",function(){this._$infoTableStatus.removeClass("tooltip-active"),clearTimeout(this._autoHideTableStatusTooltipTimeoutId),this.table.tableStatus&&!this.table.tableStatus.isError()&&(this.table.tableStatus.uiState="auto-hidden")}.bind(this)),clearTimeout(this._autoHideTableStatusTooltipTimeoutId),e.isError()||this.table.tableStatus.uiState||(this.table.tableStatus.uiState="auto-hidden",this._autoHideTableStatusTooltipTimeoutId=setTimeout(function(){this._hideTableStatusTooltip()}.bind(this),5e3))}},t.TableFooter.prototype.onControlSelected=function(t){var e=this.selectedControl;this.selectedControl=t,t&&(this._renderResizerVisible(),e&&e.height!==t.height&&this.openControlContainer(t))},t.TableFooter.prototype._onStatusMousedown=function(t){this._tableStatusTooltip?(this._hideTableStatusTooltip(),this.table.tableStatus.uiState="user-hidden"):(this._showTableStatusTooltip(),this._tableStatusTooltip.rendered&&(this.table.tableStatus.uiState="user-shown"))},t.TableFooter.prototype._onFilterInput=function(t){var i=e(t.currentTarget),o=i.val();o&&i.val(o.toLowerCase())},t.TableFooter.prototype._onFilterInputDebounce=function(i){var o,n=e(i.currentTarget),r=n.val();r?(o=t.create("TableTextUserFilter",{session:this.session,table:this.table}),o.text=r,this.table.addFilter(o)):this.table.removeFilterByKey(t.TableTextUserFilter.Type),this.table.filter(),this.validateLayoutTree(),i.stopPropagation()},t.TableFooter.prototype._onInfoLoadClick=function(){this._$infoLoad.isEnabled()&&(this._compactStyle?this._toggleTableInfoTooltip(this._$infoLoad,"TableInfoLoadTooltip"):this.table.reload())},t.TableFooter.prototype._onInfoFilterClick=function(){this._compactStyle?this._toggleTableInfoTooltip(this._$infoFilter,"TableInfoFilterTooltip"):this.table.resetFilter()},t.TableFooter.prototype._onInfoSelectionClick=function(){this._compactStyle?this._toggleTableInfoTooltip(this._$infoSelection,"TableInfoSelectionTooltip"):this.table.toggleSelection()},t.TableFooter.prototype._onTableRowsChanged=function(t){this._renderInfoLoad()},t.TableFooter.prototype._onTableRowsFiltered=function(t){this._renderInfoFilter(),this._renderInfoSelection()},t.TableFooter.prototype._onTableAddFilter=function(e){this._renderInfoFilter(),this._updateInfoFilterVisibility(),e.filter.filterType===t.TableTextUserFilter.Type&&this._$textFilter.val(e.filter.text)},t.TableFooter.prototype._onTableRemoveFilter=function(e){this._renderInfoFilter(),this._updateInfoFilterVisibility(),e.filter.filterType===t.TableTextUserFilter.Type&&this._$textFilter.val("")},t.TableFooter.prototype._onTableRowsSelected=function(t){this._renderInfoSelection()},t.TableFooter.prototype._onTableStatusChanged=function(t){this._renderInfoTableStatus(),this._updateInfoTableStatusVisibility()},t.TableFooter.prototype._onColumnStructureChanged=function(t){var e=this.table.tableControls;e?e.forEach(function(t){t.selected&&(t.removeContent(),t.renderContent())}.bind(this)):this._$controls.empty()},t.TableFooterLayout=function(e){t.TableFooterLayout.parent.call(this),this._tableFooter=e},t.inherits(t.TableFooterLayout,t.AbstractLayout),t.TableFooterLayout.prototype.layout=function(i){var o,n,r,s=this._tableFooter._$controls,a=this._tableFooter._$info,l=a.find(".table-info-item"),h=t.graphics.getSize(i).width;n=t.graphics.getSize(s).width,r=t.graphics.getSize(a).width,l.each(function(){var t=e(this);t.isVisible()&&!t.data("hiding")&&(t.data("oldWidth",t.outerWidth()),t.css("width","auto"))}),a.css("max-width",""),this._tableFooter._compactStyle&&(this._tableFooter._compactStyle=!1,this._tableFooter._renderInfo()),r=t.graphics.getSize(a).width,n+r<=h&&(this._tableFooter._tableInfoTooltip&&this._tableFooter._tableInfoTooltip.destroy(),o=!0),o||(this._tableFooter._compactStyle=!0,this._tableFooter._renderInfo(),r=t.graphics.getSize(a).width,n+r<=h&&(o=!0),a.css("max-width",Math.max(h-n,0)));var d=this._tableFooter.htmlComp.layouted;this._setInfoItemsSize(l,d),this._tableFooter._tableStatusTooltip&&this._tableFooter._tableStatusTooltip.rendered&&this._tableFooter._tableStatusTooltip.position(),this._tableFooter._tableInfoTooltip&&this._tableFooter._tableInfoTooltip.rendered&&this._tableFooter._tableInfoTooltip.position(),this._tableFooter.table.tableControls.forEach(function(t){t.revalidateLayout()})},t.TableFooterLayout.prototype._setInfoItemsSize=function(t,i){t.each(function(){var t=e(this);if(t.isVisible()&&!t.data("hiding")){var o=t.data("animationComplete");i?(t.stop().cssWidthAnimated(t.data("oldWidth"),t.outerWidth(),{complete:o}),t.removeData("oldWidth")):t.cssWidth(t.outerWidth())}})},t.TableInfoFilterTooltip=function(){t.TableInfoFilterTooltip.parent.call(this)},t.inherits(t.TableInfoFilterTooltip,t.Tooltip),t.TableInfoFilterTooltip.prototype._init=function(e){t.TableInfoFilterTooltip.parent.prototype._init.call(this,e),this.tableFooter=e.tableFooter},t.TableInfoFilterTooltip.prototype._renderText=function(){var t=this.tableFooter.table,e=t.filteredRows().length,i=t.filteredBy().join(", ");this.$content.appendSpan().text(this.session.text("ui.NumRowsFilteredBy",this.tableFooter.computeCountInfo(e),i)),this.$content.appendBr(),this.$content.appendSpan("link").text(this.session.text("ui.RemoveFilter")).on("click",this._onRemoveFilterClick.bind(this))},t.TableInfoFilterTooltip.prototype._onRemoveFilterClick=function(){this.tableFooter.table.resetFilter(),this.destroy()},t.TableInfoLoadTooltip=function(){t.TableInfoLoadTooltip.parent.call(this)},t.inherits(t.TableInfoLoadTooltip,t.Tooltip),t.TableInfoLoadTooltip.prototype._init=function(e){t.TableInfoLoadTooltip.parent.prototype._init.call(this,e),this.tableFooter=e.tableFooter},t.TableInfoLoadTooltip.prototype._renderText=function(){var t=this.tableFooter.table,e=t.rows.length;this.$content.appendSpan().text(this.session.text("ui.NumRowsLoaded",this.tableFooter.computeCountInfo(e))),this.$content.appendBr(),this.$content.appendSpan("link").text(this.session.text("ui.ReloadData")).on("click",this._onReloadClick.bind(this))},t.TableInfoLoadTooltip.prototype._onReloadClick=function(){this.tableFooter.table.reload(),this.destroy()},t.TableInfoSelectionTooltip=function(){t.TableInfoSelectionTooltip.parent.call(this)},t.inherits(t.TableInfoSelectionTooltip,t.Tooltip),t.TableInfoSelectionTooltip.prototype._init=function(e){t.TableInfoSelectionTooltip.parent.prototype._init.call(this,e),this.tableFooter=e.tableFooter},t.TableInfoSelectionTooltip.prototype._renderText=function(){var t=this.tableFooter.table,e=t.selectedRows.length;this.$content.appendSpan().text(this.session.text("ui.NumRowsSelected",this.tableFooter.computeCountInfo(e))),this.$content.appendBr(),this.$content.appendSpan("link").text(this.session.text("ui.SelectNone")).on("click",this._onSelectNoneClick.bind(this)),this.$content.appendBr(),this.$content.appendSpan("link").text(this.session.text("ui.SelectAll")).on("click",this._onSelectAllClick.bind(this))},t.TableInfoSelectionTooltip.prototype._onSelectNoneClick=function(){this.tableFooter.table.deselectAll(),this.destroy()},t.TableInfoSelectionTooltip.prototype._onSelectAllClick=function(){this.tableFooter.table.selectAll(),this.destroy()},t.TableHeader=function(){t.TableHeader.parent.call(this),this._tableDataScrollHandler=this._onTableDataScroll.bind(this),this._tableAddRemoveFilterHandler=this._onTableAddRemoveFilter.bind(this),this._tableColumnResizedHandler=this._onTableColumnResized.bind(this),this._tableColumnMovedHandler=this._onTableColumnMoved.bind(this),this.dragging=!1,this._renderedColumns=[]},t.inherits(t.TableHeader,t.Widget),t.TableHeader.prototype._init=function(e){t.TableHeader.parent.prototype._init.call(this,e),this.table=e.table,this.enabled=e.enabled,this.menuBar=t.create("MenuBar",{parent:this,menuOrder:new t.GroupBoxMenuItemsOrder}),this.menuBar.tabbable=!1,this.menuBar.bottom(),this.menuBar.on("propertyChange",this._onMenuBarPropertyChange.bind(this)),this.updateMenuBar()};t.TableHeader.prototype._render=function(t){this.$container=this.table.$data.beforeDiv("table-header"),this.$filler=this.$container.appendDiv("table-header-item filler").css("visibility","hidden"),this.enabled||(this.menuBar.hiddenByUi=!0),this.$menuBarContainer=this.$container.appendDiv("menubar-container"),this.$menuBarContainer.setVisible(this.menuBar.visible),this.menuBar.render(this.$menuBarContainer),this._$window=this.$container.window(),this._$body=this.$container.body(),this._renderColumns(),this.table.$data.on("scroll",this._tableDataScrollHandler),this.table.on("addFilter",this._tableAddRemoveFilterHandler),this.table.on("removeFilter",this._tableAddRemoveFilterHandler),this.table.on("columnResized",this._tableColumnResizedHandler),this.table.on("columnMoved",this._tableColumnMovedHandler)};t.TableHeader.prototype._remove=function(){this.table.$data.off("scroll",this._tableDataScrollHandler),this.table.off("addFilter",this._tableAddRemoveFilterHandler),this.table.off("removeFilter",this._tableAddRemoveFilterHandler),this.table.off("columnResized",this._tableColumnResizedHandler),this.table.off("columnMoved",this._tableColumnMovedHandler),this._removeColumns(),t.TableHeader.parent.prototype._remove.call(this)},t.TableHeader.prototype.rerenderColumns=function(){this._removeColumns(),this._renderColumns()},t.TableHeader.prototype._renderColumns=function(){this.table.columns.forEach(this._renderColumn,this),0===this.table.columns.length&&this.$filler.css("visibility","visible").html("&nbsp;").addClass("empty"),this._reconcileScrollPos()},t.TableHeader.prototype._renderColumn=function(e,i){var o=e.width,n="",r="",s=0===i,a=i===this.table.columns.length-1;s?n=this.table.rowBorderLeftWidth:a&&(r=this.table.rowBorderRightWidth);var l=this.$filler.beforeDiv("table-header-item").setEnabled(this.enabled).data("column",e).css("min-width",o+"px").css("max-width",o+"px").css("margin-left",n).css("margin-right",r);l.appendSpan("table-header-item-text"),this.enabled&&l.on("click",this._onHeaderItemClick.bind(this)).on("mousedown",this._onHeaderItemMousedown.bind(this)),this.session.inspector&&t.inspector.applyInfo(e,l),s?l.addClass("first"):a&&l.addClass("last"),e.$header=l,t.tooltips.install(l,{parent:this,text:this._headerItemTooltipText.bind(this),arrowPosition:50,arrowPositionUnit:"%",nativeTooltip:!t.device.isCustomEllipsisTooltipPossible()}),this._decorateHeader(e),l.addClass("halign-"+t.Table.parseHorizontalAlignment(e.horizontalAlignment));var h=e.showSeparator;if(a&&!this.enabled&&(h=!1),h){var d=this.$filler.beforeDiv("table-header-resize");e.fixedWidth||!this.enabled?d.setEnabled(!1):d.on("mousedown","",this._onSeparatorMousedown.bind(this)).on("dblclick",this._onSeparatorDblclick.bind(this)),e.$separator=d}this._renderedColumns.push(e)},t.TableHeader.prototype._removeColumns=function(){this._renderedColumns.slice().forEach(this._removeColumn,this)},t.TableHeader.prototype._removeColumn=function(e){e.$header&&(e.$header.remove(),e.$header=null),e.$separator&&(e.$separator.remove(),e.$separator=null),t.arrays.remove(this._renderedColumns,e)},t.TableHeader.prototype.resizeHeaderItem=function(e){if(e&&e.$header){var i,o,n,r=e.$header,s=e.width,a="",l="",h=this.menuBar.visible?this.$menuBarContainer.outerWidth(!0):0,d=0===this.table.columns.indexOf(e),p=this.table.columns.indexOf(e)===this.table.columns.length-1;if(d)a=this.table.rowBorderLeftWidth;else if(p&&(l=this.table.rowBorderRightWidth,i=this.$container.width()-this.table.rowWidth+t.graphics.getInsets(this.table.$data).right,n=r.next(".table-header-resize"),i<h)){o=h,o+=n.width(),i>0&&(o-=i);var u=s;s=Math.max(s-o,e.minWidth-o),this.$filler.cssWidth(u-s)}r.css("min-width",s).css("max-width",s).css("margin-left",a).css("margin-right",l),this._tableHeaderMenu&&this._tableHeaderMenu.rendered&&this._tableHeaderMenu.column===e&&this._tableHeaderMenu.onColumnResized()}},t.TableHeader.prototype._reconcileScrollPos=function(){var t=this.table.$data.scrollLeft(),e=this.table.columns[this.table.columns.length-1];this.resizeHeaderItem(e),this.$container.scrollLeft(t),this.$menuBarContainer.cssRight(-1*t)},t.TableHeader.prototype._arrangeHeaderItems=function(i){var o=this;i.each(function(){e(this).css("left",e(this).data("old-pos")-e(this).offset().left).animate({left:0},{progress:function(i,n,r){var s=e(this);s.isSelected()&&(t.scrollbars.scrollHorizontalTo(o.table.$data,s),o._tableHeaderMenu&&o._tableHeaderMenu.rendered&&o._tableHeaderMenu.position())}})})},t.TableHeader.prototype._headerItemTooltipText=function(e){var i=e.data("column");return i&&t.strings.hasText(i.headerTooltipText)?i.headerTooltipText:e.isContentTruncated()||e.width()+e.position().left>e.parent().width()?(e=e.clone(),e.children(".table-header-item-state").remove(),e.text()):void 0},t.TableHeader.prototype.openTableHeaderMenu=function(e){var i=e.$header;this._tableHeaderMenu=t.create("TableHeaderMenu",{parent:this,column:i.data("column"),tableHeader:this,$anchor:i,focusableContainer:!0}),this._tableHeaderMenu.open()},t.TableHeader.prototype.closeTableHeaderMenu=function(){this._tableHeaderMenu.destroy(),this._tableHeaderMenu=null},t.TableHeader.prototype.onColumnActionsChanged=function(t){this._tableHeaderMenu&&this._tableHeaderMenu.onColumnActionsChanged(t)},t.TableHeader.prototype.findHeaderItems=function(){return this.$container.find(".table-header-item:not(.filler)")},t.TableHeader.prototype.updateHeader=function(t,e){this._decorateHeader(t,e)},t.TableHeader.prototype._decorateHeader=function(t,e){var i=t.$header;t.disallowHeaderMenu&&i.addClass("disabled"),this._renderColumnCssClass(t,e),this._renderColumnText(t),this._renderColumnIconId(t),this._renderColumnState(t),this._renderColumnLegacyStyle(t)},t.TableHeader.prototype._renderColumnCssClass=function(t,e){var i=t.$header;e&&i.removeClass(e.headerCssClass),i.addClass(t.headerCssClass)},t.TableHeader.prototype._renderColumnText=function(e){var i=e.text,o=e.$header,n=o.children(".table-header-item-text");n.htmlOrNbsp(t.strings.nl2br(i),"empty"),this._updateColumnIconAndTextStyle(e)},t.TableHeader.prototype._renderColumnIconId=function(t){t.$header.icon(t.headerIconId),this._updateColumnIconAndTextStyle(t)},t.TableHeader.prototype._updateColumnIconAndTextStyle=function(t){var e=t.$header.data("$icon"),i=t.$header.children(".table-header-item-text");e&&e.toggleClass("with-text",!!t.text),i.setVisible(!(e&&"&nbsp;"===i.html()))},t.TableHeader.prototype._renderColumnLegacyStyle=function(e){t.styles.legacyStyle(e,e.$header,"header")},t.TableHeader.prototype._renderColumnState=function(t){var e,i,o=t.$header,n=this.table.getFilter(t.id);if(o.children(".table-header-item-state").remove(),i=o.appendSpan("table-header-item-state"),i.empty(),o.removeClass("sort-asc sort-desc sorted group-asc group-desc grouped filtered"),i.removeClass("sort-asc sort-desc sorted group-asc group-desc grouped filtered"),t.sortActive&&(e=t.sortAscending?"asc":"desc",t.grouped&&o.addClass("group-"+e),o.addClass("sorted sort-"+e),i.addClass("sorted sort-"+e)),t.grouped||n){var r=i.appendDiv("left");t.grouped&&(o.addClass("grouped"),i.addClass("grouped"),r.appendDiv().text("G")),n&&(o.addClass("filtered"),i.addClass("filtered"),r.appendDiv().text("F"))}i.appendDiv("right"),this._adjustColumnMinWidth(t)},t.TableHeader.prototype._adjustColumnMinWidth=function(e){var i=this.table.getFilter(e.id);e.sortActive||e.grouped||i?(e.minWidth<t.Column.DEFAULT_MIN_WIDTH&&(e.prefMinWidth=e.minWidth,e.minWidth=t.Column.DEFAULT_MIN_WIDTH),e.width<e.minWidth&&this.table.resizeColumn(e,e.minWidth)):e.prefMinWidth&&(e.minWidth=e.prefMinWidth,e.prefMinWidth=null,e.width===t.Column.DEFAULT_MIN_WIDTH&&this.table.resizeColumn(e,e.minWidth))},t.TableHeader.prototype.updateMenuBar=function(){var e=this.table._filterMenus(this.table.menus,t.MenuDestinations.HEADER);this.menuBar.setMenuItems(e)},t.TableHeader.prototype._onTableColumnResized=function(t){var e=t.column,i=this.table.columns[this.table.columns.length-1];this.resizeHeaderItem(e),i!==e&&this.resizeHeaderItem(i)},t.TableHeader.prototype.onSortingChanged=function(){for(var t=0;t<this.table.columns.length;t++){var e=this.table.columns[t];this._renderColumnState(e)}},t.TableHeader.prototype._onTableColumnMoved=function(t){var i=t.column,o=t.oldPos,n=t.newPos,r=i.$header,s=this.findHeaderItems(),a=s.eq(o),l=a.next(),h=this.table.columns.length-1;s.each(function(){e(this).data("old-pos",e(this).offset().left)}),n<o?(s.eq(n).before(a),s.eq(n).before(l)):(s.eq(n).after(a),s.eq(n).after(l)),s.length>0&&(s.eq(0).removeClass("first"),s.eq(s.length-1).removeClass("last")),this.table.columns.length>0&&(this.table.columns[0].$header.addClass("first"),this.table.columns[this.table.columns.length-1].$header.addClass("last")),o!==h&&n!==h||this.table.columns.forEach(function(t){this.resizeHeaderItem(t)}.bind(this)),t.dragged?r.css("left",parseInt(r.css("left"),0)+r.data("old-pos")-r.offset().left).animateAVCSD("left",0):this._arrangeHeaderItems(s)},t.TableHeader.prototype.onOrderChanged=function(t){var i,o,n,r,s=this.findHeaderItems();for(s.each(function(){e(this).data("old-pos",e(this).offset().left)}),o=0;o<this.table.columns.length;o++)i=this.table.columns[o],n=i.$header,r=n.next(".table-header-resize"),this.$container.append(n),this.$container.append(r);this._arrangeHeaderItems(s)},t.TableHeader.prototype._onHeaderItemClick=function(t){var i=e(t.currentTarget),o=i.data("column");if(!o.disallowHeaderMenu)return this.dragging||this.columnMoved?(this.dragging=!1,this.columnMoved=!1):this.table.sortEnabled&&(t.shiftKey||t.ctrlKey)?(this.table.removeColumnGrouping(),this.table.sort(o,i.hasClass("sort-asc")?"desc":"asc",t.shiftKey)):this._tableHeaderMenu&&this._tableHeaderMenu.isOpenFor(i)?this.closeTableHeaderMenu():this.openTableHeaderMenu(o),!1},t.TableHeader.prototype._onHeaderItemMousedown=function(t){function i(t){if(s=Math.floor(t.pageX)-l,0!==s){a.dragging=!0,h.addClass("moving"),a.$container.addClass("moving"),h.css("left",s);var i=n(h);f.each(function(t){var o=n(e(this));i<o&&t<p?e(this).css("left",c):i>o&&t>=p?e(this).css("left",-c):e(this).css("left",0)}),a._tableHeaderMenu&&(a._tableHeaderMenu.destroy(),a._tableHeaderMenu=null)}}function o(t){var e=t.html(),i=t.html("<span>"+e+"</span>").find("span:first").width();return t.html(e),i}function n(t){return t.hasClass("halign-right")?t.offset().left+t.outerWidth()-o(t)/2:t.offset().left+o(t)/2}function r(t){if(a._$window.off("mousemove.tableheader"),!a.dragging)return!0;var i=s<0?f:e(f.get().reverse());i.each(function(t){if("0px"!==e(this).css("left"))return u=a.table.columns.indexOf(e(this).data("column")),!1}),u>-1&&p!==u?(a.table.moveColumn(h.data("column"),p,u,!0),a.dragging=!1,a.columnMoved=!0):h.animateAVCSD("left","",function(){a.dragging=!1}),f.each(function(){e(this).css("left","")}),h.removeClass("moving"),a.$container.removeClass("moving")}var s=0,a=this,l=Math.floor(t.pageX),h=e(t.currentTarget),d=h.data("column"),p=this.table.columns.indexOf(d),u=p,c=h.outerWidth(),f=h.siblings(".table-header-item:not(.filler)");d.fixedPosition||(this.dragging=!1,this.columnMoved=!1,this._$window.on("mousemove.tableheader","",i).one("mouseup","",r))},t.TableHeader.prototype._onSeparatorDblclick=function(t){var i=e(t.target).prev(),o=i.data("column");this.table.resizeToFit(o)},t.TableHeader.prototype._onSeparatorMousedown=function(t){function i(t){var e=Math.floor(t.pageX)-n,i=l+e;i=Math.max(i,s.minWidth),i!==s.width&&a.table.resizeColumn(s,i)}function o(t){delete s.resizingInProgress,a.$headerColumnResizeHelper.remove(),a.$headerColumnResizeHelper=null,a.$dataColumnResizeHelper.remove(),a.$dataColumnResizeHelper=null,a._$window.off("mousemove.tableheader"),a._$body.removeClass("col-resize"),a.table.resizeColumn(s,s.width)}var n=Math.floor(t.pageX),r=e(t.target).prev(),s=r.data("column"),a=this,l=s.width;s.resizingInProgress=!0,this.$headerColumnResizeHelper=this.$container.appendDiv("table-column-resize-helper").css("width",this.table.rowWidth+this.table.rowBorderWidth),this.$dataColumnResizeHelper=this.table.$data.appendDiv("table-column-resize-helper").css("width",this.table.rowWidth),this._$window.on("mousemove.tableheader",i).one("mouseup",o),this._$body.addClass("col-resize"),t.preventDefault()},t.TableHeader.prototype._onTableDataScroll=function(){t.scrollbars.fix(this.$menuBarContainer),this._reconcileScrollPos(),this._fixTimeout=t.scrollbars.unfix(this.$menuBarContainer,this._fixTimeout)},t.TableHeader.prototype._onMenuBarPropertyChange=function(t){t.changedProperties.indexOf("visible")!==-1&&this.$menuBarContainer.setVisible(t.newProperties.visible)},t.TableHeader.prototype._onTableAddRemoveFilter=function(e){var i=e.filter.column;e.filter.filterType===t.ColumnUserFilter.Type&&i.$header&&this._renderColumnState(i)},t.TableHeaderMenu=function(){t.TableHeaderMenu.parent.call(this),this.tableHeader,this.table,this.$headerItem,this.$columnActions,this.$columnFilters,this.filterCheckedMode=t.TableHeaderMenu.CheckedMode.ALL,this._tableHeaderScrollHandler=this._onAnchorScroll.bind(this),this.on("locationChanged",this._onLocationChanged.bind(this))},t.inherits(t.TableHeaderMenu,t.Popup),t.TableHeaderMenu.CheckedMode={ALL:{checkAll:!0,text:"ui.SelectAllFilter"},NONE:{checkAll:!1,text:"ui.SelectNoneFilter"}},t.TableHeaderMenu.prototype._init=function(e){e.scrollType=e.scrollType||"none",t.TableHeaderMenu.parent.prototype._init.call(this,e),this.tableHeader=e.tableHeader,this.column=e.column,this.table=this.tableHeader.table,this.$headerItem=this.$anchor,this.filter=this.table.getFilter(this.column.id),this.filter||(this.filter=this.column.createFilter()),this.filter.calculate(),this.filter.on("filterFieldsChanged",this._updateFilterTable.bind(this)),this._updateFilterTableCheckedMode(),this.hasFilterTable=this.filter.availableValues.length>0,this.hasFilterFields=this.filter.hasFilterFields,this.hasFilterTable&&(this._tableFilterHandler=this._onFilterTableChanged.bind(this),this.table.on("addFilter",this._tableFilterHandler),this.table.on("removeFilter",this._tableFilterHandler),this._filterTableRowsCheckedHandler=this._onFilterTableRowsChecked.bind(this))},t.TableHeaderMenu.prototype._createLayout=function(){return new t.TableHeaderMenuLayout(this)},t.TableHeaderMenu.prototype._render=function(e){function i(t){t.length&&(o(t[0],"first"),o(t[t.length-1],"last"))}function o(e,i){var o=e instanceof t.TableHeaderMenuGroup?e.$container:e;o.addClass(i)}var n=[],r=[];if(this.$headerItem.select(!0),this.$container=e.appendDiv("table-header-menu"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.$body=this.$container.appendDiv("table-header-menu-body"),t.HtmlComponent.install(this.$body,this.session),t.scrollbars.install(this.$body,{parent:this,axis:"y"}),this.$columnActions=this.$body.appendDiv("table-header-menu-actions"),this.hasFilterTable||this.hasFilterFields){this.$columnFilters=this.$body.appendDiv("table-header-menu-filters");var s=t.HtmlComponent.install(this.$columnFilters,this.session);s.setLayout(new t.RowLayout)}this.tableHeader.$container.on("scroll",this._tableHeaderScrollHandler),this.$whiter=this.$container.appendDiv("table-header-menu-whiter"),this.withFocusContext&&this.focusableContainer&&this.$container.attr("tabindex",-1);var a=this.table.columns.filter(function(t){return!t.fixedPosition});a.length>1&&!this.column.fixedPosition&&n.push(this._renderMovingGroup()),this.table.sortEnabled&&n.push(this._renderSortingGroup()),n.push(this._renderColumnActionsGroup()),(this.table.isGroupingPossible(this.column)||this.column.grouped)&&n.push(this._renderGroupingGroup()),this.table.isAggregationPossible(this.column)&&n.push(this._renderAggregationGroup()),this.column instanceof t.NumberColumn&&n.push(this._renderColoringGroup()),this.hasFilterTable&&r.push(this._renderFilterTable()),this.hasFilterFields&&r.push(this._renderFilterFields()),
i(n),i(r),this.table.enabled&&this.table.$container.addClass("focused")},t.TableHeaderMenu.prototype._remove=function(){this.filterTable&&this.filterTable.off("rowsChecked",this._filterTableRowsCheckedHandler),this.tableHeader.$container.off("scroll",this._tableHeaderScrollHandler),this.$headerItem.select(!1),this.table.off("addFilter",this._tableFilterHandler),this.table.off("removeFilter",this._tableFilterHandler),t.scrollbars.uninstall(this.$body,this.session),t.TableHeaderMenu.parent.prototype._remove.call(this),this.table.rendered&&this.table.$container.removeClass("focused")},t.TableHeaderMenu.prototype._renderMovingGroup=function(){var e=this.table,i=this.column,o=e.columns.indexOf(i),n=t.create("TableHeaderMenuGroup",{parent:this,textKey:"ui.Move",cssClass:"first"});return t.create("TableHeaderMenuButton",{parent:n,textKey:"ui.toBegin",cssClass:"move move-top",clickHandler:function(){e.moveColumn(i,o,0),o=e.columns.indexOf(i)}}),t.create("TableHeaderMenuButton",{parent:n,textKey:"ui.forward",cssClass:"move move-up",clickHandler:function(){e.moveColumn(i,o,Math.max(o-1,0)),o=e.columns.indexOf(i)}}),t.create("TableHeaderMenuButton",{parent:n,textKey:"ui.backward",cssClass:"move move-down",clickHandler:function(){e.moveColumn(i,o,Math.min(o+1,e.header.findHeaderItems().length-1)),o=e.columns.indexOf(i)}}),t.create("TableHeaderMenuButton",{parent:n,textKey:"ui.toEnd",cssClass:"move move-bottom",clickHandler:function(){e.moveColumn(i,o,e.header.findHeaderItems().length-1),o=e.columns.indexOf(i)}}),n.render(this.$columnActions),n},t.TableHeaderMenu.prototype._renderColumnActionsGroup=function(){function e(t){o.close(),this.table.trigger("columnOrganizeAction",{action:t,column:i})}var i=this.column,o=this;return this.columnActionsGroup=t.create("TableHeaderMenuGroup",{parent:this,textKey:"ui.Column"}),this.addColumnButton=t.create("TableHeaderMenuButton",{parent:this.columnActionsGroup,textKey:"ui.addColumn",cssClass:"add-column",visible:this.table.columnAddable,clickHandler:e.bind(this,"add")}),this.removeColumnButton=t.create("TableHeaderMenuButton",{parent:this.columnActionsGroup,textKey:"ui.removeColumn",cssClass:"remove-column",visible:this.column.removable,clickHandler:e.bind(this,"remove")}),this.modifyColumnButton=t.create("TableHeaderMenuButton",{parent:this.columnActionsGroup,textKey:"ui.changeColumn",cssClass:"change-column",visible:this.column.modifiable,clickHandler:e.bind(this,"modify")}),this.columnActionsGroup.render(this.$columnActions),this.columnActionsGroup},t.TableHeaderMenu.prototype.onColumnActionsChanged=function(t){this.addColumnButton.setVisible(t.addVisible),this.removeColumnButton.setVisible(t.removeVisible),this.modifyColumnButton.setVisible(t.modifyVisible);var e=this.columnActionsGroup.children.some(function(t){return t.visible});this.columnActionsGroup.setVisible(e)},t.TableHeaderMenu.prototype._renderSortingGroup=function(){function e(){s.close(),o(this.direction,!1,this.selected)}function i(){s.close(),o(this.direction,!0,this.selected)}function o(t,e,i){n.sort(r,t,e,i),s._updateSortingSelectedState()}var n=this.table,r=this.column,s=this;return this.sortingGroup=t.create("TableHeaderMenuGroup",{parent:this,textKey:"ColumnSorting"}),n.hasPermanentHeadOrTailSortColumns()||(this.sortAscButton=t.create("TableHeaderMenuButton",{parent:this.sortingGroup,textKey:"ui.ascending",cssClass:"sort sort-asc",direction:"asc",togglable:!0,clickHandler:e}),this.sortDescButton=t.create("TableHeaderMenuButton",{parent:this.sortingGroup,textKey:"ui.descending",cssClass:"sort sort-desc",direction:"desc",togglable:!0,clickHandler:e})),this.sortAscAddButton=t.create("TableHeaderMenuButton",{parent:this.sortingGroup,textKey:"ui.ascendingAdditionally",cssClass:"sort sort-asc-add",direction:"asc",togglable:!0,clickHandler:i}),this.sortDescAddButton=t.create("TableHeaderMenuButton",{parent:this.sortingGroup,textKey:"ui.descendingAdditionally",cssClass:"sort sort-desc-add",direction:"desc",togglable:!0,clickHandler:i}),this._updateSortingSelectedState(),this.sortingGroup.render(this.$columnActions),this.sortingGroup},t.TableHeaderMenu.prototype._updateSortingSelectedState=function(){if(this.table.sortEnabled){var t,e=!1,i=this._sortColumnCount();this.sortingGroup.children.forEach(function(t){t.setSelected(!1)}),1!==i||this.table.hasPermanentHeadOrTailSortColumns()?(i>1||this.table.hasPermanentHeadOrTailSortColumns())&&(e=!0,this.column.sortActive&&(this.column.sortAscending?this.sortAscAddButton.setSelected(!0):this.sortDescAddButton.setSelected(!0),t=this.column.sortIndex+1,this.sortAscAddButton.setIcon(t),this.sortDescAddButton.setIcon(t))):this.column.sortActive?this.column.sortAscending?this.sortAscButton.setSelected(!0):this.sortDescButton.setSelected(!0):e=!0,this.sortAscAddButton.setVisible(e),this.sortDescAddButton.setVisible(e)}},t.TableHeaderMenu.prototype._renderGroupingGroup=function(){function e(){this.toggle();var t=n.sortIndex>=0&&!n.sortAscending?"desc":"asc";i.close(),o.groupColumn(n,this.additional,t,!this.selected)}var i=this,o=this.table,n=this.column,r=this._groupColumnCount(),s=t.create("TableHeaderMenuGroup",{parent:this,textKey:"ui.Grouping"}),a=t.create("TableHeaderMenuButton",{parent:s,textKey:"ui.groupingApply",cssClass:"group",additional:!1,togglable:!0,clickHandler:e}),l=t.create("TableHeaderMenuButton",{parent:s,textKey:"ui.additionally",cssClass:"group-add",additional:!0,togglable:!0,clickHandler:e});return 0===r?l.setVisible(!1):1===r&&this.column.grouped?(a.setSelected(!0),l.setVisible(!1)):r>1&&l.setVisible(!0),o.hasPermanentHeadOrTailSortColumns()&&r>0&&(a.setVisible(!1),l.setVisible(!0)),this.column.grouped&&(1===r?l.setSelected(!0):r>1&&(l.setSelected(!0),l.setIcon(this.column.sortIndex+1))),s.render(this.$columnActions),s},t.TableHeaderMenu.prototype._renderAggregationGroup=function(){function e(){r.close(),i.changeAggregation(o,this.aggregation)}var i=this.table,o=this.column,n=o.aggregationFunction,r=this,s=t.create("TableHeaderMenuGroup",{parent:this,textKey:"ui.Aggregation"});return t.create("TableHeaderMenuButton",{parent:s,textKey:"ui.Sum",cssClass:"aggregation-function sum",aggregation:"sum",clickHandler:e}),t.create("TableHeaderMenuButton",{parent:s,textKey:"ui.Average",cssClass:"aggregation-function avg",aggregation:"avg",clickHandler:e}),t.create("TableHeaderMenuButton",{parent:s,textKey:"ui.Minimum",cssClass:"aggregation-function min",aggregation:"min",clickHandler:e}),t.create("TableHeaderMenuButton",{parent:s,textKey:"ui.Maximum",cssClass:"aggregation-function max",aggregation:"max",clickHandler:e}),s.children.forEach(function(t){t.setSelected(t.aggregation===n)}),s.render(this.$columnActions),s},t.TableHeaderMenu.prototype._renderColoringGroup=function(){function e(){n.close(),i.setColumnBackgroundEffect(o,this.selected?null:this.backgroundEffect),this.toggle()}var i=this.table,o=this.column,n=this,r=o.backgroundEffect,s=t.create("TableHeaderMenuGroup",{parent:this,textKey:"ui.Coloring"});return t.create("TableHeaderMenuButton",{parent:s,textKey:"ui.fromRedToGreen",cssClass:"color color-gradient1",backgroundEffect:"colorGradient1",togglable:!0,clickHandler:e}),t.create("TableHeaderMenuButton",{parent:s,textKey:"ui.fromGreenToRed",cssClass:"color color-gradient2",backgroundEffect:"colorGradient2",togglable:!0,clickHandler:e}),t.device.supportsCssGradient()&&t.create("TableHeaderMenuButton",{parent:s,textKey:"ui.withBarChart",cssClass:"color color-bar-chart",backgroundEffect:"barChart",togglable:!0,clickHandler:e}),s.children.forEach(function(t){t.setSelected(t.backgroundEffect===r)}),s.render(this.$columnActions),s},t.TableHeaderMenu.prototype._renderFilterTable=function(){var e;this.$filterTableGroup=this.$columnFilters.appendDiv("table-header-menu-group first");var i=t.HtmlComponent.install(this.$filterTableGroup,this.session);i.setLayout(new t.RowLayout),e=this.$filterTableGroup.appendDiv("table-header-menu-filter-actions"),this.$filterToggleChecked=e.appendDiv("table-header-menu-filter-toggle-checked").text(this.session.text(this.filterCheckedMode.text)).on("click",this._onClickFilterCheckedMode.bind(this)),this.$filterTableGroupTitle=this.$filterTableGroup.appendDiv("table-header-menu-group-text").text(this._filterByText()),t.HtmlComponent.install(this.$filterTableGroupTitle,this.session),this.filterTable=t.create("Table",{parent:this,headerVisible:!1,multiSelect:!1,autoResizeColumns:!0,checkable:!0,checkableStyle:t.Table.CheckableStyle.TABLE_ROW,columns:[t.create("Column",{index:0,text:"filter-value",width:160,session:this.session}),t.create("Column",{index:1,type:"number",horizontalAlignment:1,text:"aggregate-count",width:40,session:this.session})]}),this.filterTable.on("rowsChecked",this._filterTableRowsCheckedHandler);var o,n=[];return this.filter.availableValues.forEach(function(t){o={cells:[{text:t.text,iconId:t.iconId},t.count],checked:this.filter.selectedValues.indexOf(t.key)>-1,dataMap:{filterValue:t}},n.push(o)},this),this.filterTable.insertRows(n),this.filterTable.render(this.$filterTableGroup),this.filterTable.htmlComp.pixelBasedSizing=!0,setTimeout(this.filterTable.revealChecked.bind(this.filterTable)),this.$filterTableGroup},t.TableHeaderMenu.prototype._filterByText=function(){var t=this.session.text("ui.Filter"),e=this.filter.selectedValues.length,i=this.filter.availableValues.length;return e&&i?t+=" "+this.session.text("ui.FilterInfoXOfY",e,i):i&&(t+=" "+this.session.text("ui.FilterInfoCount",i)),t},t.TableHeaderMenu.prototype._onClickFilterCheckedMode=function(){var e=t.TableHeaderMenu.CheckedMode,i=this.filterCheckedMode.checkAll;this.filter.selectedValues=[],this.filterCheckedMode===e.ALL?(this.filterCheckedMode=e.NONE,this.filter.availableValues.forEach(function(t){this.filter.selectedValues.push(t.key)},this)):this.filterCheckedMode=e.ALL,this.filterTable.checkAll(i),this._updateFilterTableActions()},t.TableHeaderMenu.prototype._updateFilterTable=function(){this.filter.filterActive()?this.table.addFilter(this.filter):this.table.removeFilterByKey(this.column.id),this.table.filter()},t.TableHeaderMenu.prototype._updateFilterTableActions=function(){this.$filterToggleChecked.text(this.session.text(this.filterCheckedMode.text))},t.TableHeaderMenu.prototype._renderFilterFields=function(){this.filterFieldsGroupBox=t.create("GroupBox:FilterFields",{parent:this,column:this.column,filter:this.filter}),this.$filterFieldsGroup=this.$columnFilters.appendDiv("table-header-menu-group");var e=t.HtmlComponent.install(this.$filterFieldsGroup,this.session);e.setLayout(new t.RowLayout);var i=this.$filterFieldsGroup.appendDiv("table-header-menu-group-text").text(this.filter.filterFieldsTitle());return e=t.HtmlComponent.install(i,this.session),this.filterFieldsGroupBox.render(this.$filterFieldsGroup),this.$filterFieldsGroup},t.TableHeaderMenu.prototype.isOpenFor=function(t){return this.rendered&&this.belongsTo(t)},t.TableHeaderMenu.prototype._sortColumnCount=function(){var t,e=0;for(t=0;t<this.table.columns.length;t++)this.table.columns[t].sortActive&&e++;return e},t.TableHeaderMenu.prototype._groupColumnCount=function(){var t,e=0;for(t=0;t<this.table.columns.length;t++)this.table.columns[t].grouped&&e++;return e},t.TableHeaderMenu.prototype._computeWhitherWidth=function(){var t=this.tableHeader.$container,e=this.$headerItem.outerWidth()-this.$headerItem.cssBorderWidthX(),i=this.$container.outerWidth()-this.$container.cssBorderWidthX(),o=t.outerWidth()-this.tableHeader.menuBar.$container.outerWidth(),n=Math.min(e,i);n=Math.min(n,o-this.$headerItem.position().left);var r=t.offset().left-this.$headerItem.offset().left-this.tableHeader.table.$container.cssBorderLeftWidth();return r>0&&(n-=r),n},t.TableHeaderMenu.prototype._renderCompact=function(){this.$body.toggleClass("compact",this.compact),this.invalidateLayoutTree()},t.TableHeaderMenu.prototype.setCompact=function(t){this.setProperty("compact",t)},t.TableHeaderMenu.prototype._onLocationChanged=function(e){var i,o,n=t.scrollbars.isLocationInView,r=t.graphics.offsetBounds(this.$headerItem),s=this.tableHeader.$container;this.$container.setVisible(!0),o=t.graphics.offsetBounds(this.$container),i=n(new t.Point(r.x,r.y),s),i||(i=n(new t.Point(r.x+r.width,r.y+r.height),s),i=i&&n(new t.Point(o.x+o.width,o.y),s)),this.$container.setVisible(i),o=t.graphics.offsetBounds(this.$container),this.$whiter.cssLeft(Math.max(r.x-o.x,s.offset().left-o.x-this.tableHeader.table.$container.cssBorderLeftWidth())).width(this._computeWhitherWidth())},t.TableHeaderMenu.prototype._onAnchorScroll=function(t){this.position()},t.TableHeaderMenu.prototype._onFilterTableRowsChecked=function(t){this.filter.selectedValues=[],this.filterTable.rows.forEach(function(t){t.checked&&this.filter.selectedValues.push(t.dataMap.filterValue.key)},this),this._updateFilterTable()},t.TableHeaderMenu.prototype._onFilterTableChanged=function(){this.$filterTableGroupTitle.text(this._filterByText()),this._updateFilterTableCheckedMode(),this._updateFilterTableActions()},t.TableHeaderMenu.prototype._updateFilterTableCheckedMode=function(){0===this.filter.selectedValues.length?this.filterCheckedMode=t.TableHeaderMenu.CheckedMode.ALL:this.filterCheckedMode=t.TableHeaderMenu.CheckedMode.NONE},t.TableHeaderMenu.prototype._onMouseDownOutside=function(t){this.$headerItem.isOrHas(t.target)||this.close()},t.TableHeaderMenu.prototype.onColumnResized=function(){this.$whiter.width(this._computeWhitherWidth())},t.TableHeaderMenuLayout=function(e){t.TableHeaderMenuLayout.parent.call(this,e),this.popup=e},t.inherits(t.TableHeaderMenuLayout,t.PopupLayout),t.TableHeaderMenuLayout.TEXT_FIELD_HEIGHT=29,t.TableHeaderMenuLayout.TABLE_MAX_HEIGHT=330,t.TableHeaderMenuLayout.prototype.layout=function(e){if(t.TableHeaderMenuLayout.parent.prototype.layout.call(this,e),this.popup.hasFilterFields||this.popup.hasFilterTable){var i,o,n=this.popup.$columnFilters,r=t.graphics.getInsets(n),s=t.graphics.getMargins(n),a=new t.Dimension;if(this.popup.$body.hasClass("compact")?o=t.HtmlComponent.get(n).getPreferredSize():(o=this.preferredLayoutSize(e).subtract(t.graphics.getInsets(e)),o=o.subtract(s)),o.width=n.cssWidth(),n.cssHeight(o.height),this.popup.hasFilterFields){var l=this.popup.$filterFieldsGroup,h=t.HtmlComponent.get(l.find(".form-field"));h.setSize(new t.Dimension(o.width-r.horizontal(),this._filterFieldsGroupBoxHeight())),a=t.graphics.getSize(l,!0)}if(this.popup.hasFilterTable){var d,p=this.popup.$filterTableGroup,u=t.graphics.getInsets(p),c=this.popup.filterTable.htmlComp;d=o.height,d-=a.height,d-=this._groupTitleHeight(p),d-=u.vertical(),d=Math.min(d,t.TableHeaderMenuLayout.TABLE_MAX_HEIGHT),c.setSize(new t.Dimension(o.width-r.horizontal(),d))}this._setMaxWidth(),i=t.graphics.getSize(this.popup.$columnActions),this._setMaxWidth(i.width)}},t.TableHeaderMenuLayout.prototype._adjustSizeWithAnchor=function(e){var i,o=this.popup.htmlComp,n=this.popup.windowPaddingX,r=o.getMargins(),s=o.getBounds(),a=this.popup.$container.window(),l=a.width();i=l-r.horizontal()-s.x-n;var h=s.width>i;return h&&(this.popup.$body.addClass("compact",h),e=this.preferredLayoutSize(this.popup.$container)),t.TableHeaderMenuLayout.parent.prototype._adjustSizeWithAnchor.call(this,e)},t.TableHeaderMenuLayout.prototype._groupTitleHeight=function(e){return t.graphics.getSize(e.find(".table-header-menu-group-text"),!0).height},t.TableHeaderMenuLayout.prototype._filterFieldsGroupBoxHeight=function(){return this.popup.filterFieldsGroupBox.htmlComp.getPreferredSize().height},t.TableHeaderMenuLayout.prototype.preferredLayoutSize=function(e){var i,o,n=0,r=0,s=t.graphics.getInsets(e),a=this._getMaxWidth();if(this._setMaxWidth(),r=t.graphics.getSize(this.popup.$columnActions,!0).height,this.popup.hasFilterTable){var l,h=this.popup.$filterTableGroup,d=this.popup.filterTable.htmlComp.getSize(!0).height,p=t.graphics.getInsets(h);d=Math.min(d,t.TableHeaderMenuLayout.TABLE_MAX_HEIGHT),l=d,l+=this._groupTitleHeight(h),l+=p.vertical(),n+=l}if(this.popup.hasFilterFields){var u,c=this.popup.$filterFieldsGroup,f=t.graphics.getInsets(c);u=this._filterFieldsGroupBoxHeight(),u+=this._groupTitleHeight(c),u+=f.vertical(),n+=u}return(this.popup.hasFilterFields||this.popup.hasFilterTable)&&(o=t.graphics.getMargins(this.popup.$columnFilters),n+=o.vertical()),i=t.graphics.prefSize(e),this.popup.$body.hasClass("compact")?i.height=r+n+s.vertical():i.height=Math.max(r,n)+s.vertical(),this._setMaxWidth(a),i},t.TableHeaderMenuLayout.prototype._getMaxWidth=function(){return this.popup.$columnActions.css("max-width")},t.TableHeaderMenuLayout.prototype._setMaxWidth=function(t){this.popup.$columnActions.css("max-width",t||"")},t.TableHeaderMenuGroup=function(){t.TableHeaderMenuGroup.parent.call(this),this.text,this.textKey,this.cssClass,this.visible=!0,this.last=!1},t.inherits(t.TableHeaderMenuGroup,t.Widget),t.TableHeaderMenuGroup.prototype._init=function(i){t.TableHeaderMenuGroup.parent.prototype._init.call(this,i),e.extend(this,i),this.text=this.session.text(this.textKey)},t.TableHeaderMenuGroup.prototype._render=function(t){this.$container=t.appendDiv("table-header-menu-group buttons"),this.$text=this.$container.appendDiv("table-header-menu-group-text"),this.cssClass&&this.$container.addClass(this.cssClass),this._renderText(),this.children.forEach(function(t){t.render(this.$container)},this)},t.TableHeaderMenuGroup.prototype.appendText=function(t){this.text=this.session.text(this.textKey)+" "+t,this.rendered&&this._renderText()},t.TableHeaderMenuGroup.prototype.resetText=function(){this.text=this.session.text(this.textKey),this.rendered&&this._renderText()},t.TableHeaderMenuGroup.prototype._renderText=function(){this.$text.text(this.text)},t.TableHeaderMenuGroup.prototype.setLast=function(t){this.setProperty("last",t)},t.TableHeaderMenuGroup.prototype._renderLast=function(){this.$container.toggleClass("last",this.last)},t.TableHeaderMenuButton=function(){t.TableHeaderMenuButton.parent.call(this),this.text,this.cssClass,this.enabled=!0,this.visible=!0,this.selected=!1,this.togglable=!1,this.icon},t.inherits(t.TableHeaderMenuButton,t.Widget),t.TableHeaderMenuButton.prototype._init=function(i){t.TableHeaderMenuButton.parent.prototype._init.call(this,i),e.extend(this,i),this.text=this.session.text(this.textKey),this.visible=t.nvl(i.visible,!0)},t.TableHeaderMenuButton.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.TableHeaderMenuButton.prototype._initKeyStrokeContext=function(){t.TableHeaderMenuButton.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke([new t.TableHeaderMenuButtonKeyStroke(this)])},t.TableHeaderMenuButton.prototype._render=function(t){this.$container=t.appendDiv("table-header-menu-command").unfocusable().on("click",this._onClick.bind(this)).on("mouseenter",this._onMouseOver.bind(this)).on("mouseleave",this._onMouseOut.bind(this)),this.cssClass&&this.$container.addClass(this.cssClass),this._renderSelected(),this._renderTogglable(),this._renderIcon()},t.TableHeaderMenuButton.prototype._onClick=function(){this.enabled&&this.clickHandler.call(this)},t.TableHeaderMenuButton.prototype._onMouseOver=function(){if(this.enabled){var t=this.selected?this.session.text("ui.remove"):this.text;this.parent.appendText(t)}},t.TableHeaderMenuButton.prototype._onMouseOut=function(){this.parent.resetText()},t.TableHeaderMenuButton.prototype._renderSelected=function(){this.$container.select(this.selected)},t.TableHeaderMenuButton.prototype._renderTogglable=function(){this.$container.toggleClass("togglable",this.togglable)},t.TableHeaderMenuButton.prototype._renderIcon=function(){this.icon?this.$container.attr("data-icon",this.icon):this.$container.removeAttr("data-icon")},t.TableHeaderMenuButton.prototype.setSelected=function(t){this.setProperty("selected",t),this._updateEnabled()},t.TableHeaderMenuButton.prototype._updateEnabled=function(){var t=!0;this.selected&&(t=this.togglable),this.enabled=t,this.rendered&&this._renderEnabled()},t.TableHeaderMenuButton.prototype._renderEnabled=function(){this.$container.toggleClass("disabled",!this.enabled),this.$container.setTabbable(this.enabled&&!t.device.supportsTouch())},t.TableHeaderMenuButton.prototype.setIcon=function(t){this.setProperty("icon",t)},t.TableHeaderMenuButton.prototype.toggle=function(){this.setSelected(!this.selected)},t.TableHeaderMenuButtonKeyStroke=function(e){t.TableHeaderMenuButtonKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.ENTER,t.keys.SPACE],this.renderingHints.render=!0,this.stopPropagation=!0},t.inherits(t.TableHeaderMenuButtonKeyStroke,t.KeyStroke),t.TableHeaderMenuButtonKeyStroke.prototype.handle=function(t){this.field._onClick()},t.TableLayout=function(e){t.TableLayout.parent.call(this),this.table=e},t.inherits(t.TableLayout,t.AbstractLayout),t.TableLayout.prototype.layout=function(e){var i,o=this.table.menuBar,n=this.table.footer,r=this.table.header,s=this.table.$data,a=this.table.columns[this.table.columns.length-1],l=0,h=t.HtmlComponent.get(o.$container),d=this.table.htmlComp,p=d.getAvailableSize().subtract(d.getInsets());if(d.isAttachedAndVisible()&&d.$comp.isEveryParentVisible()){o.visible&&(i=t.MenuBarLayout.size(h,p),h.setSize(i),l+=i.height),n&&(n.revalidateLayout(),l+=t.graphics.getSize(n.$container).height,n.opening?l+=n.selectedControl.height:n.open&&(l+=t.graphics.getSize(n.$controlContainer).height)),r&&(l+=t.graphics.getSize(r.$container).height);var u=t.graphics.getMargins(s);l+=u.top+u.bottom,s.css("height","calc(100% - "+l+"px)"),this.table.autoResizeColumns&&this._layoutColumns(),r&&r.resizeHeaderItem(a),this.table.setViewRangeSize(this.table.calculateViewRangeSize()),this.table._renderScrollTop(),this.table._renderViewport(),this.table.tooltips.forEach(function(t){t.position()}.bind(this)),this.table.cellEditorPopup&&this.table.cellEditorPopup.rendered&&(this.table.cellEditorPopup.position(),this.table.cellEditorPopup.pack()),this.table.updateScrollbars()}},t.TableLayout.prototype._layoutColumns=function(){var e,i,o=[],n=0,r=0,s=Math.floor(this.table.$data.width()-this.table.rowBorderWidth);if(this.table.columns.forEach(function(t){t.fixedWidth?s-=t.width:(o.push(t),n+=t.width,r+=t.initialWidth)}.bind(this)),s!==n){var a=s,l=o.filter(function(t){var n=Math.max(t.minWidth,t.initialWidth);return i=0===r?1/o.length:t.initialWidth/r,e=Math.floor(i*a),e<n&&(e=n,a=Math.max(a-e,0),!0)}.bind(this));l.forEach(function(i,n){var s=Math.max(i.minWidth,i.initialWidth);t.arrays.remove(o,i),e=s,r-=i.initialWidth,n===l.length-1&&a>0&&0===o.length&&(e+=a,a=0),e!==i.width&&this.table.resizeColumn(i,e)}.bind(this)),s=a,o.forEach(function(t,n){i=0===r?1/o.length:t.initialWidth/r,e=Math.floor(i*s),a-=e,n===o.length-1&&a>0&&(e+=a,a=0),e!==t.width&&this.table.resizeColumn(t,e)}.bind(this))}},t.TableSelectionHandler=function(t){this.table=t,this.mouseMoveSelectionEnabled=!0,this._mouseDown,this.lastActionRow,this._allRows,this.mouseOverHandler,this.select=!0,this.counterDebug=0,this.fromIndex,this.toIndex,this._prevSelectedRowIndex,this._maxSelectedRowIndex},t.TableSelectionHandler.prototype.clearLastSelectedRowMarker=function(){this.lastActionRow=i},t.TableSelectionHandler.prototype.onMouseDown=function(t){if(3===t.which&&2===t.button&&(0===t.buttons||4===t.buttons))return!1;var o=e(t.currentTarget),n=o.data("row"),r=o.isSelected();if(this._mouseDown=!0,this._allRows=this.table.filteredRows(),this.table.multiSelect&&t.shiftKey){if(this.table.selectedRows.indexOf(n)>-1)return;this.fromIndex=this._allRows.indexOf(this.lastActionRow)}else t.ctrlKey?this.select=!r:(this.select=!0,(!r||this.table.selectedRows.length>1&&3!==t.which)&&(this.table._removeSelection(),this.table.selectedRows=[]));return(this.fromIndex===i||this.fromIndex<0)&&(this.fromIndex=this._allRows.indexOf(n)),3===t.which&&r||(this.toIndex=this._allRows.indexOf(n),this.handleSelection(t),this.table.notifyRowSelectionFinished()),this.mouseMoveSelectionEnabled&&3!==t.which&&(this.table.$data.off("mouseover",this.mouseOverHandler),this.mouseOverHandler=this.onMouseOver.bind(this),this.table.$data.on("mouseover",".table-row",this.mouseOverHandler)),o.window().one("mouseup.selectionHandler",this.onMouseUp.bind(this)),this.lastActionRow=n,3===t.which?(this.table.onContextMenu(t),!1):void 0},t.TableSelectionHandler.prototype.onMouseOver=function(t){var i=e(t.currentTarget),o=i.data("row");this.toIndex=this._allRows.indexOf(o),this.handleSelection(t),this.lastActionRow=o},t.TableSelectionHandler.prototype.handleSelection=function(t){var e;if(this.table.multiSelect){var i=this.toIndex,o=i<this._prevSelectedRowIndex,n=i>this._prevSelectedRowIndex,r=this._prevSelectedRowIndex<this.fromIndex,s=this._prevSelectedRowIndex>this.fromIndex;t.ctrlKey||(o&&s?e=this._allRows.slice(i+1,this._maxSelectedRowIndex+1):n&&r&&(e=this._allRows.slice(this._maxSelectedRowIndex,i)),e&&e.forEach(function(t){this.table.removeRowFromSelection(t,!0)},this)),this._maxSelectedRowIndex=o?Math.min(this._maxSelectedRowIndex,i):n?Math.max(this._maxSelectedRowIndex,i):i,this._prevSelectedRowIndex=i}else this.select&&(this.table._removeSelection(),this.table.selectedRows=[]),this.fromIndex=this.toIndex;this._selectRange(this.fromIndex,this.toIndex,this.select)},t.TableSelectionHandler.prototype._selectRange=function(t,e,i){var o=Math.min(t,e),n=Math.max(t,e)+1,r=this._allRows.slice(o,n);i?r.forEach(function(t){this.table.addRowToSelection(t,!0)},this):r.forEach(function(t){this.table.removeRowFromSelection(t,!0)},this)},t.TableSelectionHandler.prototype.onMouseUp=function(t){this._mouseDown&&this.table.rendered&&(this._mouseDown=!1,this.table.$data.off("mouseover",this.mouseOverHandler),this._allRows=null,this.fromIndex=-1,this.toIndex=-1,this.selected=!0,this.table.notifyRowSelectionFinished())},t.TableRowDetail=function(){t.TableRowDetail.parent.call(this),this.table,this.row},t.inherits(t.TableRowDetail,t.Widget),t.TableRowDetail.prototype._init=function(e){t.TableRowDetail.parent.prototype._init.call(this,e),this.table=e.table,this.row=e.row},t.TableRowDetail.prototype._render=function(e){this.$container=e.appendDiv("table-row-detail"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this._renderRow()},t.TableRowDetail.prototype._renderRow=function(){this.table.columns.forEach(function(e){var i=e.text,o=this.table.cellText(e,this.row);if(!t.strings.empty(o)){var n=this.$container.appendDiv("table-row-detail-field");n.appendSpan("table-row-detail-name").text(i+": "),n.appendSpan("table-row-detail-value").text(o)}},this)},t.TableTooltip=function(){t.TableTooltip.parent.call(this)},t.inherits(t.TableTooltip,t.Tooltip),t.TableTooltip.prototype._init=function(e){t.TableTooltip.parent.prototype._init.call(this,e),this.table=e.table},t.TableTooltip.prototype._render=function(e){t.TableTooltip.parent.prototype._render.call(this,e),this._rowOrderChangedFunc=function(t){t.animating?t.row===this.row&&this.position():this.position()}.bind(this),this.table.on("rowOrderChanged",this._rowOrderChangedFunc)},t.TableTooltip.prototype._remove=function(){t.TableTooltip.parent.prototype._remove.call(this),this.table.off("rowOrderChanged",this._rowOrderChangedFunc)},t.comparators={TEXT:{collator:null,installed:!1,install:function(i){return this.installed?!!this.collator:(t.device.supportsInternationalization()?(this.collator=new window.Intl.Collator(i.locale.languageTag),e.log.info("(comparators.TEXT#install) Browser supports i18n - installed Intl.Collator, can sort in Browser")):e.log.info("(comparators.TEXT#install) Browser doesn't support i18n. Must sort on server"),this.installed=!0,!!this.collator)},compare:function(e,i){return this.collator?this.collator.compare(e,i):(e=t.nvl(e,""),i=t.nvl(i,""),e<i?-1:e>i?1:0)}},NUMERIC:{install:function(t){return!0},compare:function(t,e){return t<e?-1:t>e?1:0}},ALPHANUMERIC:{collator:null,installed:!1,install:function(e){return t.comparators.TEXT.install(e),this.collator=t.comparators.TEXT.collator,!!this.collator&&t.comparators.NUMERIC.install(e)},compare:function(e,i){if(!e&&!i)return 0;if(!e)return-1;if(!i)return 1;for(var o="(([0-9]+)|([^0-9]+))",n=new RegExp(o,"g"),r=new RegExp(o,"g"),s=n.exec(e),a=r.exec(i);s&&a;){var l=parseInt(s[1],0),h=parseInt(a[1],0);if(isNaN(l)||isNaN(h)){var d=t.comparators.TEXT.compare(s[1],a[1]);if(0!==d)return d}else{var p=t.comparators.NUMERIC.compare(l,h);if(0!==p)return p}s=n.exec(e),a=r.exec(i)}return s||a?s?1:-1:0}}},t.Column=function(){this.cssClass,this.editable=!1,this.removable=!1,this.modifiable=!1,this.fixedWidth=!1,this.horizontalAlignment=-1,this.htmlEnabled=!1,this.mandatory=!1,this.sortActive=!1,this.sortAscending=!0,this.sortIndex=-1,this.summary=!1,this.type="text",this.width=60,this.minWidth=t.Column.DEFAULT_MIN_WIDTH,this.showSeparator=!0,this.filterType="TextColumnUserFilter",this.comparator=t.comparators.TEXT},t.Column.DEFAULT_MIN_WIDTH=50,t.Column.NARROW_MIN_WIDTH=32,t.Column.prototype.init=function(o){this.session=o.session,e.extend(this,o),t.defaultValues.applyTo(this),this.initialWidth===i&&(this.initialWidth=t.nvl(this.width,0)),this.aggregationFunction&&this.setAggregationFunction(this.aggregationFunction),t.texts.resolveTextProperty(this)},t.Column.prototype.initCell=function(e,i){if(e instanceof t.Cell)return e;var o=this._createCellModelInternal(e);return t.create("Cell",o)},t.Column.prototype._createCellModelInternal=function(e){var i;return i=e&&t.objects.isPlainObject(e)?e:this._createCellModel(e),this._initCell(i),i},t.Column.prototype._createCellModel=function(t){return{text:t}},t.Column.prototype._initCell=function(t){t.horizontalAlignment===i&&(t.horizontalAlignment=this.horizontalAlignment)},t.Column.prototype.buildCellForRow=function(t){var e=this.cell(t);return this.buildCell(e,t)},t.Column.prototype.buildCell=function(e,i){t.assertParameter("cell",e,t.Cell);var o=e.text||"";e.htmlEnabled||(o=e.encodedText()||"",this.table.multilineText&&(o=t.strings.nl2br(o,!1)));var n=e.iconId,r=this._icon(n,!!o)||"",s=this._cellCssClass(e),a=this._cellStyle(e);e.errorStatus&&(i.hasError=!0);var l;o||r?l=r+o:(l="&nbsp;",s=t.strings.join(" ",s,"empty"));var h="";return h+='<div class="'+s+'" style="'+a+'"'+t.device.unselectableAttribute.string+">",t.device.tableAdditionalDivRequired&&(h+='<div class="width-fix" style="max-width: '+(this.width-this.table.cellHorizontalPadding-2)+'px; ">'),h+=l,t.device.tableAdditionalDivRequired&&(h+="</div>"),h+="</div>"},t.Column.prototype._icon=function(e,i){var o,n;if(e)return o="table-cell-icon",i&&(o+=" with-text"),n=t.icons.parseIconId(e),n.isFontIcon()?(o+=" font-icon",'<span class="'+n.appendCssClass(o)+'">'+n.iconCharacter+"</span>"):(o+=" image-icon",'<img class="'+o+'" src="'+n.iconUrl+'">')},t.Column.prototype._cellCssClass=function(e){var i="table-cell";this.mandatory&&(i+=" mandatory"),this.table.multilineText&&this.textWrap||(i+=" white-space-nowrap"),e.editable&&(i+=" editable"),e.errorStatus&&(i+=" has-error"),i+=" halign-"+t.Table.parseHorizontalAlignment(e.horizontalAlignment);var o=this.table.columns.indexOf(this);return 0===o&&(i+=" first"),o===this.table.columns.length-1&&(i+=" last"),e.cssClass?i+=" "+e.cssClass:this.cssClass&&(i+=" "+this.cssClass),i},t.Column.prototype._cellStyle=function(e){var o,n=this.width;if(0===n)return"display: none;";if(o="min-width: "+n+"px; max-width: "+n+"px; ",o+=t.styles.legacyStyle(e),this.backgroundEffect&&e.value!==i){this.backgroundEffectFunc||(this.backgroundEffectFunc=this._resolveBackgroundEffectFunc());var r=this.backgroundEffectFunc(this._preprocessValueForGrouping(e.value));r.backgroundColor&&(o+="background-color: "+r.backgroundColor+";"),r.backgroundImage&&(o+="background-image: "+r.backgroundImage+";")}return o},t.Column.prototype.onMouseUp=function(t,e){var i=e.data("row"),o=this.cell(i);this.isCellEditable(i,o,t)&&this.table.prepareCellEdit(this,i,!0)},t.Column.prototype.isCellEditable=function(t,e,i){return this.table.enabled&&t.enabled&&e.editable&&!i.ctrlKey&&!i.shiftKey},t.Column.prototype.startCellEdit=function(e,i){var o,n=e.$row,r=this.cell(e),s=this.table.$cell(this,n);
return r.field=i,r.field.gridData.horizontalAlignment=r.horizontalAlignment,o=t.create("CellEditorPopup",{parent:this.table,column:this,row:e,cell:r}),o.$anchor=s,o.open(this.table.$data),o},t.Column.prototype.cellValueForGrouping=function(t){var e=this.cell(t);return e.value!==i?this._preprocessValueForGrouping(e.value):e.text?this._preprocessTextForValueGrouping(e.text,e.htmlEnabled):null},t.Column.prototype._preprocessValueForGrouping=function(t){return t},t.Column.prototype._preprocessTextForValueGrouping=function(t,e){return this._preprocessText(t,{removeHtmlTags:e,removeNewlines:!0,trim:!0})},t.Column.prototype.cellTextForGrouping=function(t){var e=this.cell(t);return this._preprocessTextForGrouping(e.text,e.htmlEnabled)},t.Column.prototype.cell=function(t){return this.table.cell(this,t)},t.Column.prototype.selectedCell=function(){var t=this.table.selectedRow();return this.table.cell(this,t)},t.Column.prototype._preprocessTextForGrouping=function(t,e){return this._preprocessText(t,{removeHtmlTags:e,trim:!0})},t.Column.prototype.cellTextForTextFilter=function(t){var e=this.cell(t);return this._preprocessTextForTextFilter(e.text,e.htmlEnabled)},t.Column.prototype._preprocessTextForTextFilter=function(t,e){return this._preprocessText(t,{removeHtmlTags:e})},t.Column.prototype._preprocessText=function(e,o){return null===e||e===i?e:(o=o||{},o.removeHtmlTags&&(e=t.strings.plainText(e)),o.removeNewlines&&(e=e.replace("\n"," ")),o.trim&&(e=e.trim()),e)},t.Column.prototype.setAggregationFunction=function(e){this.aggregationFunction=e,"sum"===e?(this.aggrStart=t.aggregation.sumStart,this.aggrStep=t.aggregation.sumStep,this.aggrFinish=t.aggregation.sumFinish,this.aggrSymbol=t.aggregation.sumSymbol):"avg"===e?(this.aggrStart=t.aggregation.avgStart,this.aggrStep=t.aggregation.avgStep,this.aggrFinish=t.aggregation.avgFinish,this.aggrSymbol=t.aggregation.avgSymbol):"min"===e?(this.aggrStart=t.aggregation.minStart,this.aggrStep=t.aggregation.minStep,this.aggrFinish=t.aggregation.minFinish,this.aggrSymbol=t.aggregation.minSymbol):"max"===e&&(this.aggrStart=t.aggregation.maxStart,this.aggrStep=t.aggregation.maxStep,this.aggrFinish=t.aggregation.maxFinish,this.aggrSymbol=t.aggregation.maxSymbol)},t.Column.prototype.setCellValue=function(t,e){var i=this._createCellModelInternal(e);this.cell(t).update(i)},t.Column.prototype.createAggrGroupCell=function(t){var e=this.cell(t);return this.initCell({value:e.value,text:this.cellTextForGrouping(t),iconId:e.iconId,horizontalAlignment:this.horizontalAlignment,cssClass:"table-aggregate-cell"})},t.Column.prototype.createAggrEmptyCell=function(){return this.initCell({empty:!0})},t.Column.prototype.setBackgroundEffect=function(t){this.backgroundEffect!==t&&(this.backgroundEffect=t,this.backgroundEffectFunc=this._resolveBackgroundEffectFunc(),this.table.trigger("columnBackgroundEffectChanged",{column:this}),!this.backgroundEffect||this.minValue!==i&&this.maxValue!==i||this.calculateMinMaxValues(),this.backgroundEffect||(this.minValue=i,this.maxValue=i),this.table.rendered&&this._renderBackgroundEffect())},t.Column.prototype.updateBackgroundEffect=function(){this.calculateMinMaxValues(),this.table.rendered&&this._renderBackgroundEffect()},t.Column.prototype._resolveBackgroundEffectFunc=function(){var t=this.backgroundEffect;return"colorGradient1"===t?this._colorGradient1.bind(this):"colorGradient2"===t?this._colorGradient2.bind(this):"barChart"===t?this._barChart.bind(this):null!==t?(e.log.warn("Unsupported backgroundEffect: "+t),function(){return{}}):void 0},t.Column.prototype._renderBackgroundEffect=function(){this.table.filteredRows().forEach(function(t){if(t.$row){var e=this.cell(t),o=this.table.$cell(this,t.$row);e.value!==i&&(o[0].style.cssText=this._cellStyle(e))}},this)},t.Column.prototype.calculateOptimalWidth=function(){for(var t,i=this.table.rows,o=this.minWidth,n=0;n<i.length;n++){t=i[n];var r=e(this.buildCellForRow(t));r.removeAttr("style"),r.hide(),this.table.$data.append(r),o=o<r.outerWidth()?r.outerWidth():o,r.remove()}return o},t.Column.prototype.calculateMinMaxValues=function(){for(var t,e,o,n,r=this.table.rows,s=0;s<r.length;s++)t=r[s],n=this.cellValueForGrouping(t),(n<e||e===i)&&(e=n),(n>o||o===i)&&(o=n);this.minValue=e,this.maxValue=o},t.Column.prototype._colorGradient1=function(e){var i=t.styles.get("column-background-effect-gradient1-start","backgroundColor"),o=t.styles.get("column-background-effect-gradient1-end","backgroundColor"),n=t.styles.rgb(i.backgroundColor),r=t.styles.rgb(o.backgroundColor);return this._colorGradient(e,n,r)},t.Column.prototype._colorGradient2=function(e){var i=t.styles.get("column-background-effect-gradient2-start","backgroundColor"),o=t.styles.get("column-background-effect-gradient2-end","backgroundColor"),n=t.styles.rgb(i.backgroundColor),r=t.styles.rgb(o.backgroundColor);return this._colorGradient(e,n,r)},t.Column.prototype._colorGradient=function(t,e,i){var o=(t-this.minValue)/(this.maxValue-this.minValue),n=Math.ceil(e.red-o*(e.red-i.red)),r=Math.ceil(e.green-o*(e.green-i.green)),s=Math.ceil(e.blue-o*(e.blue-i.blue));return{backgroundColor:"rgb("+n+","+r+", "+s+")"}},t.Column.prototype._barChart=function(e){var i=Math.ceil((e-this.minValue)/(this.maxValue-this.minValue)*100)+"",o=t.styles.get("column-background-effect-bar-chart","backgroundColor").backgroundColor;return{backgroundImage:"linear-gradient(to left, "+o+" 0%, "+o+" "+i+"%, transparent "+i+"%, transparent 100% )"}},t.Column.prototype.createFilter=function(e){return t.create(this.filterType,{session:this.session,table:this.table,column:this})},t.Column.prototype.createDefaultEditor=function(e){var i=t.create("StringField",{parent:this.table,labelVisible:!1});return i.setValue(this.cell(e).text),i},t.Column.prototype.installComparator=function(){return this.comparator.install(this.session)},t.Column.prototype.isUiSortPossible=function(){var e=t.nvl(this.uiSortPossible,!0);return e&&this.installComparator()},t.Column.prototype.compare=function(t,e){var i=this.table.cellValue(this,t),o=this.table.cellValue(this,e);return this.comparator.compare(i,o)},t.AlphanumericSortingStringColumn=function(){t.AlphanumericSortingStringColumn.parent.call(this),this.comparator=t.comparators.ALPHANUMERIC},t.inherits(t.AlphanumericSortingStringColumn,t.Column),t.BeanColumn=function(){t.BeanColumn.parent.call(this),this.additionalDivMode=t.BeanColumn.AdditionalDivMode.AUTO},t.inherits(t.BeanColumn,t.Column),t.BeanColumn.AdditionalDivMode={NEVER:0,AUTO:1},t.BeanColumn.prototype.buildCellForRow=function(i){var o,n;return o=e(t.BeanColumn.parent.prototype.buildCellForRow.call(this,i)),o.empty(),o.removeClass("empty"),n=this.table.cellValue(this,i),this._renderValue(o,n),this.additionalDivMode===t.BeanColumn.AdditionalDivMode.AUTO&&t.device.tableAdditionalDivRequired&&o.html('<div class="width-fix" style="max-width: '+(this.width-this.table.cellHorizontalPadding-2)+'px; ">'+o.html()+"</div>"),o[0].outerHTML},t.BeanColumn.prototype._renderValue=function(t,e){},t.BeanColumn.prototype._plainTextForRow=function(e){var i=this.table.cell(this,e);if(!i.plainText){var o=this.buildCellForRow(e);i.plainText=t.strings.plainText(o)}return i.plainText},t.BeanColumn.prototype.cellValueForGrouping=function(t){var e=this._plainTextForRow(t);return this._preprocessTextForValueGrouping(e)},t.BeanColumn.prototype.cellTextForGrouping=function(t){var e=this._plainTextForRow(t);return this._preprocessTextForGrouping(e)},t.BeanColumn.prototype.cellTextForTextFilter=function(t){var e=this._plainTextForRow(t);return this._preprocessTextForTextFilter(e)},t.BeanColumn.prototype.compare=function(t,e){var i=this._plainTextForRow(t),o=this._plainTextForRow(e);return this.comparator.compare(i,o)},t.BooleanColumn=function(){t.BooleanColumn.parent.call(this),this.minWidth=t.Column.NARROW_MIN_WIDTH,this.filterType="ColumnUserFilter",this.comparator=t.comparators.NUMERIC,this.triStateEnabled=!1},t.inherits(t.BooleanColumn,t.Column),t.BooleanColumn.prototype.buildCell=function(e,i){var o,n,r,s,a,l,h=i.enabled;return e.empty?t.BooleanColumn.parent.prototype.buildCell.call(this,e,i):(h=h&&e.editable,a=this._cellCssClass(e),o=this._cellStyle(e),h||(a+=" disabled"),r=e.tooltipText,s=t.strings.empty(r)?"":' title="'+r+'"',l="check-box",e.value===!0&&(l+=" checked"),this.triStateEnabled&&e.value!==!0&&e.value!==!1&&(l+=" undefined"),h||(l+=" disabled"),n='<div class="'+l+'"/>','<div class="'+a+'" style="'+o+'"'+s+t.device.unselectableAttribute.string+">"+n+"</div>")},t.BooleanColumn.prototype.$checkBox=function(t){var e=this.table.$cell(this,t);return e.children(".check-box")},t.BooleanColumn.prototype._cellCssClass=function(e){var i=t.BooleanColumn.parent.prototype._cellCssClass.call(this,e);return i=i.replace(" editable",""),i+=" checkable"},t.BooleanColumn.prototype.onMouseUp=function(t,e){var i=e.data("row"),o=this.cell(i);this.table.checkableColumn===this?this.table.checkRow(i,!i.checked):this.isCellEditable(i,o,t)&&this._toggleCellValue(i,o)},t.BooleanColumn.prototype._toggleCellValue=function(t,e){this.table.setCellValue(this,t,!e.value)},t.BooleanColumn.prototype._createCellModel=function(t){return{value:t}},t.CodeColumn=function(){t.CodeColumn.parent.call(this),this.codeType,this.uiSortPossible=!0,this.comparator=t.comparators.NUMERIC},t.inherits(t.CodeColumn,t.Column),t.CodeColumn.prototype._createCellModel=function(e){if(t.objects.isNullOrUndefined(e))return t.CodeColumn.parent.prototype._createCellModel("");var i=t.codes.get(this.codeType,e);return{text:i.text(this.session.locale),value:i}},t.DateColumn=function(){t.DateColumn.parent.call(this),this.hasDate=!0,this.hasTime=!1,this.filterType="DateColumnUserFilter",this.comparator=t.comparators.NUMERIC};t.inherits(t.DateColumn,t.Column);t.DateColumn.DATE_PATTERN="dd.MM.yyyy",t.DateColumn.TIME_PATTERN="HH:mm",t.DateColumn.prototype.init=function(e){t.DateColumn.parent.prototype.init.call(this,e),this.groupFormatFormatter=new t.DateFormat(this.session.locale,this.groupFormat)},t.DateColumn.prototype._createCellModel=function(e){var i=t.dates.parseJsonDate(e),o=t.dates.format(i,this.session.locale,this._createDatePattern());return{text:o,value:i}},t.DateColumn.prototype._createDatePattern=function(){return this.hasDate&&this.hasTime?t.DateColumn.DATE_PATTERN+" "+t.DateColumn.TIME_PATTERN:this.hasDate?t.DateColumn.DATE_PATTERN:t.DateColumn.TIME_PATTERN},t.DateColumn.prototype._initCell=function(e){t.DateColumn.parent.prototype._initCell.call(this,e),"string"==typeof e.value&&(e.value=t.dates.parseJsonDate(e.value))},t.DateColumn.prototype.cellTextForGrouping=function(e){if(this.groupFormat===i||this.groupFormat===this.format||!this.groupFormatFormatter)return t.DateColumn.parent.prototype.cellTextForGrouping.call(this,e);var o=this.table.cellValue(this,e);return this.groupFormatFormatter.format(o)},t.IconColumn=function(){t.IconColumn.parent.call(this),this.minWidth=t.Column.NARROW_MIN_WIDTH,this.filterType="ColumnUserFilter"},t.inherits(t.IconColumn,t.Column),t.IconColumn.prototype._initCell=function(e){return t.IconColumn.parent.prototype._initCell.call(this,e),e.text=null,e.iconId=e.value||e.iconId,e},t.IconColumn.prototype.cellTextForGrouping=function(t){var e=this.table.cell(this,t);return e.value},t.IconColumn.prototype.createAggrGroupCell=function(e){var i=t.IconColumn.parent.prototype.createAggrGroupCell.call(this,e);return i.text=null,i},t.NumberColumn=function(){t.NumberColumn.parent.call(this),this.filterType="NumberColumnUserFilter",this.comparator=t.comparators.NUMERIC},t.inherits(t.NumberColumn,t.Column),t.NumberColumn.prototype.init=function(e){t.NumberColumn.parent.prototype.init.call(this,e),this.decimalFormat instanceof t.DecimalFormat||(this.decimalFormat=new t.DecimalFormat(this.session.locale,this.decimalFormat))},t.NumberColumn.prototype._initCell=function(e){t.NumberColumn.parent.prototype._initCell.call(this,e),e.value===i&&e.text&&(e.value=Number(e.text))},t.NumberColumn.prototype._createCellModel=function(t){var e=this.decimalFormat.format(t);return{text:e,value:t}},t.NumberColumn.prototype.createAggrValueCell=function(t){var e=this.decimalFormat.format(t);return this.initCell({text:e,iconId:e?this.aggrSymbol:null,horizontalAlignment:this.horizontalAlignment,cssClass:"table-aggregate-cell"})},t.NumberColumn.prototype.cellValueForGrouping=function(t){var e=this.table.cell(this,t);return this._preprocessValueForGrouping(e.value)},t.NumberColumn.prototype._preprocessValueForGrouping=function(t){return this.decimalFormat.round(t)},t.SmartColumn=function(){t.SmartColumn.parent.call(this),this.codeType,this.lookupCall},t.inherits(t.SmartColumn,t.Column),t.SmartColumn.prototype.init=function(e){t.SmartColumn.parent.prototype.init.call(this,e),this._syncLookupCall(this.lookupCall)},t.SmartColumn.prototype._syncLookupCall=function(e){"string"==typeof e&&(e=t.create(e)),this.lookupCall=e},t.SmartColumn.prototype._createCellModel=function(t){return{value:t}},t.SmartColumn.prototype.initCell=function(e,i){var o=t.SmartColumn.parent.prototype.initCell.call(this,e),n=o.value;return t.objects.isNullOrUndefined(n)?o:(this.lookupCall.textById(n).done(function(t){o.setText(t),this.table.rows.indexOf(i)>-1&&this.table.updateRow(i)}.bind(this)),o)},t.TableControl=function(){t.TableControl.parent.call(this),this.tableFooter,this.contentRendered=!1,this.height=t.TableControl.CONTAINER_SIZE,this.animateDuration=t.TableControl.CONTAINER_ANIMATE_DURATION,this.resizerVisible=!0},t.inherits(t.TableControl,t.Action),t.TableControl.CONTAINER_SIZE=345,t.TableControl.CONTAINER_ANIMATE_DURATION=350,t.TableControl.prototype._init=function(e){this.parent=e.parent,this.table=this.getTable(),t.TableControl.parent.prototype._init.call(this,e)},t.TableControl.prototype._initKeyStrokeContext=function(){t.TableControl.parent.prototype._initKeyStrokeContext.call(this),this.tableControlKeyStrokeContext=this._createKeyStrokeContextForTableControl()},t.TableControl.prototype._createKeyStrokeContextForTableControl=function(){var e=new t.KeyStrokeContext;return e.$scopeTarget=function(){return this.tableFooter.$controlContent}.bind(this),e.$bindTarget=function(){return this.tableFooter.$controlContent}.bind(this),e.registerKeyStroke(new t.TableControlCloseKeyStroke(this)),e},t.TableControl.prototype._createLayout=function(){return new t.NullLayout},t.TableControl.prototype._render=function(e){var i="table-control ";this.cssClass&&(i+=this.cssClass+"-table-control"),this.$container=e.appendDiv(i).on("mousedown",this._onMouseDown.bind(this)).data("control",this),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout())},t.TableControl.prototype.remove=function(){this.removeContent(),t.TableControl.parent.prototype.remove.call(this)},t.TableControl.prototype._renderContent=function(t){},t.TableControl.prototype._removeContent=function(){},t.TableControl.prototype.removeContent=function(){this.contentRendered&&(this._removeContent(),this.cssClass&&(this.tableFooter.$controlContainer.removeClass(this.cssClass+"-table-control-container"),this.tableFooter.$controlContent.removeClass(this.cssClass+"-table-control-content")),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.tableControlKeyStrokeContext),this.contentRendered=!1)},t.TableControl.prototype.renderContent=function(){(this.contentRendered||this.isContentAvailable())&&(this.tableFooter.open||this.tableFooter.openControlContainer(this),this.contentRendered||(this.cssClass&&(this.tableFooter.$controlContainer.addClass(this.cssClass+"-table-control-container"),this.tableFooter.$controlContent.addClass(this.cssClass+"-table-control-content")),this._renderContent(this.tableFooter.$controlContent),this.session.keyStrokeManager.installKeyStrokeContext(this.tableControlKeyStrokeContext),this.htmlComp&&this.htmlComp.invalidateLayoutTree(!1),this.contentRendered=!0))},t.TableControl.prototype._renderSelected=function(e,i){e=t.nvl(e,this.selected),i=t.nvl(i,!0),this.$container.select(e),e?(this.tableFooter.onControlSelected(this),this.renderContent()):this.rendered&&(i&&this===this.tableFooter.selectedControl?(this.tableFooter.onControlSelected(null),this.tableFooter.closeControlContainer(this)):this.removeContent()),this._updateTooltip()},t.TableControl.prototype.isContentAvailable=function(){return!0},t.TableControl.prototype.toggle=function(){this.enabled&&(this.tableFooter.selectedControl===this?this.setSelected(!1):this.setSelected(!0))},t.TableControl.prototype.setSelected=function(t,e){t&&!this.visible||t!==this.selected&&(this.tableFooter&&this.tableFooter.selectedControl&&this.tableFooter.selectedControl!==this&&this.tableFooter.selectedControl.setSelected(!1,!1),this._setProperty("selected",t),this.rendered&&this._renderSelected(t,e))},t.TableControl.prototype._configureTooltip=function(){var e=t.TableControl.parent.prototype._configureTooltip.call(this);return e.cssClass="table-control-tooltip",e},t.TableControl.prototype._onMouseDown=function(){this.toggle()},t.TableControl.prototype.onControlContainerOpened=function(){},t.TableControl.prototype.onControlContainerClosed=function(){this.removeContent()},t.TableControl.prototype._createActionKeyStroke=function(){return new t.TableControlActionKeyStroke(this)},t.TableControl.prototype.getTable=function(){for(var e=this.parent;e;){if(e instanceof t.Table)return e;e=e.parent}return null},t.TableControlActionKeyStroke=function(e){t.TableControlActionKeyStroke.parent.call(this,e),this.renderingHints.offset=6},t.inherits(t.TableControlActionKeyStroke,t.ActionKeyStroke),t.TableControlActionKeyStroke.prototype.handle=function(t){this.field.toggle()},t.TableControlActionKeyStroke.prototype._postRenderKeyBox=function(t){if(this.field.iconId){var e=t.find(".icon").width(),i=t.find(".key-box").outerWidth(),o=Number(t.css("padding-left").replace("px","")),n=e/2-i/2+o;t.find(".key-box").css("left",n+"px")}},t.TableControlAdapter=function(){t.TableControlAdapter.parent.call(this)},t.inherits(t.TableControlAdapter,t.ActionAdapter),t.TableControlAdapter.prototype._goOffline=function(){this.widget.isContentAvailable()||(this._enabledBeforeOffline=this.widget.enabled,this.widget.setEnabled(!1))},t.TableControlAdapter.prototype._goOnline=function(){this.widget.isContentAvailable()||this.widget.setEnabled(this._enabledBeforeOffline)},t.TableControlAdapterMenu=function(){t.TableControlAdapterMenu.parent.call(this),this._tableControlPropertyChangeHandler=this._onTableControlPropertyChange.bind(this),this._tableControlDestroyHandler=this._onTableControlDestroy.bind(this),this._addCloneProperties(["tableControl"])},t.inherits(t.TableControlAdapterMenu,t.FormMenu),t.TableControlAdapterMenu.prototype._init=function(e){if(t.TableControlAdapterMenu.parent.prototype._init.call(this,e),!this.tableControl)throw new Error("Cannot adapt to undefined tableControl");this._installListeners()},t.TableControlAdapterMenu.prototype._installListeners=function(){this.tableControl.on("propertyChange",this._tableControlPropertyChangeHandler),this.tableControl.on("destroy",this._tableControlDestroyHandler)},t.TableControlAdapterMenu.prototype._uninstallListeners=function(){this.tableControl.off("propertyChange",this._tableControlPropertyChangeHandler),this.tableControl.off("destroy",this._tableControlDestroyHandler)},t.TableControlAdapterMenu.prototype._render=function(e){t.TableControlAdapterMenu.parent.prototype._render.call(this,e),this.$container.attr("data-tableControlAdapter",this.tableControl.id)},t.TableControlAdapterMenu.prototype._onTableControlPropertyChange=function(e){var i={};e.changedProperties.forEach(function(t){i[t]=e.newProperties[t]}),i=t.TableControlAdapterMenu.adaptTableControlProperties(i);for(var o in i)this.setProperty(o,i[o])},t.TableControlAdapterMenu.prototype._onTableControlDestroy=function(t){this.destroy(),this._uninstallListeners()},t.TableControlAdapterMenu.prototype.doAction=function(){return this.tableControl.doAction()},t.TableControlAdapterMenu.prototype.setSelected=function(t){this.tableControl.setSelected(t)},t.TableControlAdapterMenu.adaptTableControlProperties=function(t,e){e=e||{},["text","iconId","enabled","visible","selected","tooltipText","keyStroke","keyStrokes","modelClass","classId","form"].forEach(function(i){e[i]=t[i]});for(var o in e)e[o]===i&&delete e[o];return e},t.AggregateTableControl=function(){t.AggregateTableControl.parent.call(this),this._tableDataScrollHandler=this._onTableDataScroll.bind(this),this._tableRowsChangedHandler=this._onTableRowsChanged.bind(this),this._tableRowsFilteredHandler=this._onTableRowsFiltered.bind(this),this._tableRowsSelectedHandler=this._onTableRowsSelected.bind(this),this._tableColumnResizedHandler=this._onTableColumnResized.bind(this),this._tableColumnMovedHandler=this._onTableColumnMoved.bind(this),this._tableColumnStructureChangedHandler=this._onTableColumnStructureChanged.bind(this),this._tableAggregationFunctionHandler=this._onTableAggregationFunctionChanged.bind(this),this._tableGroupingHandler=this._onTableGroupingChanged.bind(this),this.cssClass="aggregate",this.height=t.AggregateTableControl.CONTAINER_SIZE,this.animateDuration=t.AggregateTableControl.CONTAINER_ANIMATE_DURATION,this.resizerVisible=!1,this.aggregateRow},t.inherits(t.AggregateTableControl,t.TableControl),t.AggregateTableControl.CONTAINER_SIZE=40,t.AggregateTableControl.CONTAINER_ANIMATE_DURATION=200,t.AggregateTableControl.prototype._init=function(e){t.AggregateTableControl.parent.prototype._init.call(this,e),this.table.on("columnStructureChanged",this._tableColumnStructureChangedHandler)},t.AggregateTableControl.prototype.destroy=function(){t.AggregateTableControl.parent.prototype.destroy.call(this),this.table.off("columnStructureChanged",this._tableColumnStructureChangedHandler)},t.AggregateTableControl.prototype._render=function(e){t.AggregateTableControl.parent.prototype._render.call(this,e),this._updateEnabledAndSelectedState()},t.AggregateTableControl.prototype._renderContent=function(t){this.$contentContainer=t.appendDiv("table-aggregate"),this._aggregate(),this._renderAggregate(),this._reconcileScrollPos(),this.table.$data.on("scroll",this._tableDataScrollHandler),this.table.on("rowsInserted",this._tableRowsChangedHandler),this.table.on("rowsDeleted",this._tableRowsChangedHandler),this.table.on("allRowsDeleted",this._tableRowsChangedHandler),this.table.on("rowsFiltered",this._tableRowsFilteredHandler),this.table.on("rowsSelected",this._tableRowsSelectedHandler),this.table.on("columnResized",this._tableColumnResizedHandler),this.table.on("columnMoved",this._tableColumnMovedHandler),this.table.on("aggregationFunctionChanged",this._tableAggregationFunctionHandler),this.table.on("groupingChanged",this._tableGroupingHandler)},t.AggregateTableControl.prototype._removeContent=function(){this.$contentContainer.remove(),this.table.$data.off("scroll",this._tableDataScrollHandler),this.table.off("rowsInserted",this._tableRowsChangedHandler),this.table.off("rowsDeleted",this._tableRowsChangedHandler),this.table.off("allRowsDeleted",this._tableRowsChangedHandler),this.table.off("rowsFiltered",this._tableRowsFilteredHandler),this.table.off("rowsSelected",this._tableRowsSelectedHandler),this.table.off("columnResized",this._tableColumnResizedHandler),this.table.off("columnMoved",this._tableColumnMovedHandler),this.table.off("aggregationFunctionChanged",this._tableAggregationFunctionHandler),this.table.off("groupingChanged",this._tableGroupingHandler)},t.AggregateTableControl.prototype._renderAggregate=function(){this.table.columns.forEach(function(t,o){var n,r,s;n=this.aggregateRow[o],r=n===i||null===n||t.grouped?t.createAggrEmptyCell():t.createAggrValueCell(n),s=e(t.buildCell(r,{})),this.aggregateRow.selection&&s.addClass("selection"),s.appendTo(this.$contentContainer)},this),this.aggregateRow.selection&&this.$contentContainer.addClass("selection")},t.AggregateTableControl.prototype._rerenderAggregate=function(){this.$contentContainer.empty(),this._renderAggregate()},t.AggregateTableControl.prototype._aggregate=function(){var t,e=[],i=this.table.selectedRows;i.length>1?(t=i,e.selection=!0):t=this.table.filteredRows(),this.table._forEachColumn("aggrStart",e),t.forEach(function(t){this.table._forEachColumn("aggrStep",e,t)},this),this.table._forEachColumn("aggrFinish",e),this.aggregateRow=e},t.AggregateTableControl.prototype._reconcileScrollPos=function(){var t=this.table.$data.scrollLeft();this.$contentContainer.scrollLeft(t)},t.AggregateTableControl.prototype._updateEnabledAndSelectedState=function(){var t=this.table.containsNumberColumn();!t&&this.selected&&this.setSelected(!1),this.setEnabled(t)},t.AggregateTableControl.prototype._syncEnabled=function(t){this._setProperty("enabled",t),this._updateEnabledAndSelectedState()},t.AggregateTableControl.prototype._syncSelected=function(t){this._setProperty("selected",t),this._updateEnabledAndSelectedState()},t.AggregateTableControl.prototype._onTableDataScroll=function(){this._reconcileScrollPos()},t.AggregateTableControl.prototype._onTableRowsChanged=function(t){this._aggregate(),this._rerenderAggregate()},t.AggregateTableControl.prototype._onTableRowsFiltered=function(t){this._aggregate(),this._rerenderAggregate()},t.AggregateTableControl.prototype._onTableRowsSelected=function(t){this._aggregate(),this._rerenderAggregate()},t.AggregateTableControl.prototype._onTableColumnResized=function(t){this._rerenderAggregate()},t.AggregateTableControl.prototype._onTableColumnMoved=function(e){t.arrays.move(this.aggregateRow,e.oldPos,e.newPos),this._rerenderAggregate()},t.AggregateTableControl.prototype._onTableColumnStructureChanged=function(t){this._updateEnabledAndSelectedState(),this.selected&&this.rendered&&(this._aggregate(),this._rerenderAggregate())},t.AggregateTableControl.prototype._onTableAggregationFunctionChanged=function(t){this._aggregate(),this._rerenderAggregate()},t.AggregateTableControl.prototype._onTableGroupingChanged=function(t){this._aggregate(),this._rerenderAggregate()},t.AggregateTableControlAdapter=function(){t.AggregateTableControlAdapter.parent.call(this)},t.inherits(t.AggregateTableControlAdapter,t.TableControlAdapter),t.FormTableControl=function(){t.FormTableControl.parent.call(this),this._addAdapterProperties("form")},t.inherits(t.FormTableControl,t.TableControl),t.FormTableControl.prototype._init=function(e){t.FormTableControl.parent.prototype._init.call(this,e),this._syncForm(this.form)},t.FormTableControl.prototype._createLayout=function(){return new t.FormTableControlLayout(this)},t.FormTableControl.prototype._renderContent=function(e){this.form.renderInitialFocusEnabled=!1,this.form.render(e);var i=this.form.rootGroupBox;i.fields[0]instanceof t.TabBox&&i.fields[0].$container.addClass("in-table-control"),this.form.$container.height(e.height()),this.form.$container.width(e.width()),this.form.htmlComp.pixelBasedSizing=!0,this.form.htmlComp.validateRoot=!0,this.form.htmlComp.validateLayout()},t.FormTableControl.prototype._removeContent=function(){this.form.remove()},t.FormTableControl.prototype._removeForm=function(){this.removeContent()},t.FormTableControl.prototype._renderForm=function(t){this.renderContent()},t.FormTableControl.prototype.isContentAvailable=function(){return!!this.form},t.FormTableControl.prototype._syncForm=function(t){t&&t.rootGroupBox.menuBar.bottom(),this._setProperty("form",t)},t.FormTableControl.prototype.onControlContainerOpened=function(){this.form.renderInitialFocus()},t.FormTableControlAdapter=function(){t.FormTableControlAdapter.parent.call(this),this._addAdapterProperties("form")},t.inherits(t.FormTableControlAdapter,t.TableControlAdapter),t.FormTableControlLayout=function(e){t.FormTableControlLayout.parent.call(this),this.control=e},t.inherits(t.FormTableControlLayout,t.AbstractLayout),t.FormTableControlLayout.prototype.layout=function(e){if(this.control.contentRendered){var i,o=t.graphics.getSize(this.control.tableFooter.$controlContent);if(this.control.form){var n=this.control.form.htmlComp;i=o.subtract(n.getMargins()),n.setSize(i)}}},t.CellEditorPopup=function(){t.CellEditorPopup.parent.call(this),this.table,this.column,this.row,this.cell},t.inherits(t.CellEditorPopup,t.Popup),t.CellEditorPopup.prototype._init=function(e){e.scrollType=e.scrollType||"position",t.CellEditorPopup.parent.prototype._init.call(this,e),this.table=e.column.table,this.column=e.column,this.row=e.row,this.cell=e.cell,this.link(this.cell.field)},t.CellEditorPopup.prototype._createLayout=function(){return new t.CellEditorPopupLayout(this)},t.CellEditorPopup.prototype._initKeyStrokeContext=function(){t.CellEditorPopup.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke([new t.CellEditorCompleteEditKeyStroke(this),new t.CellEditorTabKeyStroke(this)])},t.CellEditorPopup.prototype._createCloseKeyStroke=function(){return new t.CellEditorCancelEditKeyStroke(this)},t.CellEditorPopup.prototype._open=function(t,e){this.render(t,e),this.position(),this.pack()},t.CellEditorPopup.prototype._render=function(e){t.CellEditorPopup.parent.prototype._render.call(this,e);var i=0===this.table.columns.indexOf(this.column);this.$container.addClass("cell-editor-popup"),this.$container.data("popup",this),i&&this.$container.addClass("first");var o=this.cell.field;o.mode=t.FormField.MODE_CELLEDITOR,o.render(this.$container),o.prepareForCellEdit({firstCell:i}),this.$anchor.css("visibility","hidden"),this._rowOrderChangedFunc=function(t){t.animating?t.row===this.row&&this.position():this.position()}.bind(this),this.table.on("rowOrderChanged",this._rowOrderChangedFunc),this.table.enabled&&this.table.$container.addClass("focused")},t.CellEditorPopup.prototype._postRender=function(){t.CellEditorPopup.parent.prototype._postRender.call(this);var e=this.cell.field;e.onCellEditorRendered&&e.onCellEditorRendered({openFieldPopup:this.table.openFieldPopupOnCellEdit})},t.CellEditorPopup.prototype._remove=function(){t.CellEditorPopup.parent.prototype._remove.call(this),this.table.off("rowOrderChanged",this._rowOrderChangedFunc),this.table.rendered&&this.table.$container.removeClass("focused"),this.$anchor.css("visibility","")},t.CellEditorPopup.prototype.position=function(){var e,i,o=this.table.$data,n=this.row.$row,r=this.$anchor,s=o.cssPxValue("padding-left")+n.cssBorderLeftWidth();e=t.graphics.bounds(r,!1,!0),i=t.graphics.bounds(n,!1,!0),this.setLocation(new t.Point(s+e.x,o.scrollTop()+i.y))},t.CellEditorPopup.prototype.completeEdit=function(){var t=this.cell.field;this.completeCellEditRequested||(t.acceptInput(),this.table.completeCellEdit(t),this.completeCellEditRequested=!0)},t.CellEditorPopup.prototype.cancelEdit=function(){this.table.cancelCellEdit(this.cell.field),this.remove()},t.CellEditorPopup.prototype._onMouseDownOutside=function(t){this.completeEdit()},t.CellEditorPopupLayout=function(e){t.CellEditorPopupLayout.parent.call(this),this.cellEditorPopup=e,this._field=e.cell.field,this._htmlContainer=e.htmlComp},t.inherits(t.CellEditorPopupLayout,t.AbstractLayout),t.CellEditorPopupLayout.prototype.layout=function(t){var e,i=this._field.htmlComp;e=this._htmlContainer.getAvailableSize().subtract(this._htmlContainer.getInsets()).subtract(i.getMargins()),i.setSize(e)},t.CellEditorPopupLayout.prototype.preferredLayoutSize=function(e){var i,o,n,r=this.cellEditorPopup.row.$row,s=this.cellEditorPopup.$anchor;return i=t.graphics.bounds(s,!1,!0),o=t.graphics.bounds(r,!1,!0),n=this.cellEditorPopup.$container.cssMarginLeft(),n<0&&(i.width=i.width+-n),new t.Dimension(i.width,o.height)},t.CellEditorCancelEditKeyStroke=function(e){t.CellEditorCancelEditKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.ESC],this.stopPropagation=!0},t.inherits(t.CellEditorCancelEditKeyStroke,t.KeyStroke),t.CellEditorCancelEditKeyStroke.prototype.handle=function(t){this.field.cancelEdit()},t.CellEditorCompleteEditKeyStroke=function(e){t.CellEditorCompleteEditKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.ENTER],this.stopPropagation=!0},
t.inherits(t.CellEditorCompleteEditKeyStroke,t.KeyStroke),t.CellEditorCompleteEditKeyStroke.prototype.handle=function(t){this.field.completeEdit()},t.CellEditorTabKeyStroke=function(e){t.CellEditorTabKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.TAB],this.shift=i},t.inherits(t.CellEditorTabKeyStroke,t.KeyStroke),t.CellEditorTabKeyStroke.prototype._accept=function(e){var i=t.CellEditorTabKeyStroke.parent.prototype._accept.call(this,e);return i&&!this.field.completeCellEditRequested},t.CellEditorTabKeyStroke.prototype.handle=function(t){var e,i=t.shiftKey,o=this.field.table,n=this.field.column,r=this.field.row;this.field.completeEdit(),e=o.nextEditableCellPos(n,r,i),e&&o.prepareCellEdit(e.column,e.row)},t.AbstractTableNavigationKeyStroke=function(e){t.AbstractTableNavigationKeyStroke.parent.call(this),this.repeatable=!0,this.field=e,this.shift=!!e.multiSelect&&i,this.stopPropagation=!0,this.keyStrokeMode=t.KeyStrokeMode.DOWN},t.inherits(t.AbstractTableNavigationKeyStroke,t.KeyStroke),t.AbstractTableNavigationKeyStroke.prototype._accept=function(e){var i=t.AbstractTableNavigationKeyStroke.parent.prototype._accept.call(this,e);if(!i)return!1;if(!this.field.filteredRows().length)return!1;var o=this.field.$container.activeElement(!0),n=o.tagName.toLowerCase();return!!("table-text-filter"===o.className||"textarea"!==n&&"input"!==n||e.originalEvent&&(!e.originalEvent||e.originalEvent.smartFieldEvent))},t.AbstractTableNavigationKeyStroke.prototype._viewportInfo=function(){var e,i,o,n,r,s,a,l=this.field,h={},d=l.filteredRows();return 0===d.length?h:(o=t.graphics.offsetBounds(l.$data),n=t.graphics.getInsets(l.$data),r=l.$data.cssMarginTop(),o=o.subtract(n),r<0&&(o.y-=Math.abs(r),o.height+=Math.abs(r)),e=o.x+1,i=o.y+1,s=this._findFirstRowInViewport(l,o),a=this._findLastRowInViewport(l,d.indexOf(s),o),h.firstRow=s,h.lastRow=a,h)},t.AbstractTableNavigationKeyStroke.prototype.firstRowAfterSelection=function(){var t=this.field.$selectedRows();if(t.length){var e=this.field.filteredRows(),i=t.last().data("row"),o=this.field.filteredRows().indexOf(i);return e[o+1]}},t.AbstractTableNavigationKeyStroke.prototype.firstRowBeforeSelection=function(){var t=this.field.$selectedRows();if(t.length){var e=this.field.filteredRows(),i=t.first().data("row"),o=this.field.filteredRows().indexOf(i);return e[o-1]}},t.AbstractTableNavigationKeyStroke.prototype._findLastSelectedRowBefore=function(e,i){var o,n=e.filteredRows();return 0===i?n[i]:(o=t.arrays.findFromPrev(n,i,function(t,i){var o=n[i-1];return!!o&&!e.isRowSelected(o)}),o||(o=n[0]),o)},t.AbstractTableNavigationKeyStroke.prototype._findLastSelectedRowAfter=function(e,i){var o,n=e.filteredRows();return i===n.length-1?n[i]:(o=t.arrays.findFromPrev(n,i,function(t,i){var o=n[i+1];return!!o&&!e.isRowSelected(o)}),o||(o=n[n.length-1]),o)},t.AbstractTableNavigationKeyStroke.prototype._findFirstRowInViewport=function(e,i){var o=e.filteredRows();return t.arrays.find(o,function(t,e){var o,n,r=t.$row;return!!t.$row&&(o=r.offset(),n=t.$row.cssMarginTop(),n<0&&(o.top+=Math.abs(n)),i.contains(o.left,o.top))})},t.AbstractTableNavigationKeyStroke.prototype._findLastRowInViewport=function(e,i,o){var n=e.filteredRows();return i===n.length-1?n[i]:t.arrays.findFromNext(n,i,function(e,i){var r,s,a=n[i+1];return!a||(!(s=a.$row)||(r=t.graphics.offsetBounds(s),!o.contains(r.x,r.y+r.height)))})},t.TableControlCloseKeyStroke=function(e){t.TableControlCloseKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.ESC],this.stopPropagation=!0,this.renderingHints.render=!1},t.inherits(t.TableControlCloseKeyStroke,t.KeyStroke),t.TableControlCloseKeyStroke.prototype.handle=function(t){this.field.toggle()},t.TableCopyKeyStroke=function(e){t.TableCopyKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.C],this.ctrl=!0,this.renderingHints.render=!1},t.inherits(t.TableCopyKeyStroke,t.KeyStroke),t.TableCopyKeyStroke.prototype.handle=function(t){this.field.exportToClipboard()},t.TableSelectAllKeyStroke=function(e){t.TableSelectAllKeyStroke.parent.call(this),this.field=e,this.ctrl=!0,this.which=[t.keys.A],this.renderingHints.offset=14,this.renderingHints.$drawingArea=function(t,e){return this.field.footer?this.field.footer._$infoSelection.find(".table-info-button"):null}.bind(this)},t.inherits(t.TableSelectAllKeyStroke,t.KeyStroke),t.TableSelectAllKeyStroke.prototype.handle=function(t){var e=this.field;e.toggleSelection(),e.selectionHandler.lastActionRow=null},t.TableStartCellEditKeyStroke=function(e){t.TableStartCellEditKeyStroke.parent.call(this),this.field=e,this.ctrl=!0,this.which=[t.keys.ENTER],this.renderingHints.$drawingArea=function(t,e){var i=e._editPosition;return this.field.$cell(i.column,i.row.$row)}.bind(this)},t.inherits(t.TableStartCellEditKeyStroke,t.KeyStroke),t.TableStartCellEditKeyStroke.prototype._accept=function(e){var i=t.TableStartCellEditKeyStroke.parent.prototype._accept.call(this,e);if(!i)return!1;var o=this.field.selectedRows;if(!o.length)return!1;var n=this.field.nextEditableCellPosForRow(0,o[0]);return!!n&&(e._editPosition=n,!0)},t.TableStartCellEditKeyStroke.prototype.handle=function(t){var e=t._editPosition;this.field.prepareCellEdit(e.column,e.row,!0)},t.TableRefreshKeyStroke=function(e){t.TableRefreshKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.F5],this.renderingHints.offset=14,this.renderingHints.$drawingArea=function(t,e){return this.field.footer?this.field.footer._$infoLoad.find(".table-info-button"):null}.bind(this)},t.inherits(t.TableRefreshKeyStroke,t.KeyStroke),t.TableRefreshKeyStroke.prototype._accept=function(e){var i=t.TableRefreshKeyStroke.parent.prototype._accept.call(this,e);return i&&this.field.hasReloadHandler},t.TableRefreshKeyStroke.prototype.handle=function(t){this.field.reload()},t.TableToggleRowKeyStroke=function(e){t.TableToggleRowKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.SPACE],this.stopPropagation=!0,this.renderingHints.render=!1},t.inherits(t.TableToggleRowKeyStroke,t.KeyStroke),t.TableToggleRowKeyStroke.prototype._accept=function(e){var i=t.TableToggleRowKeyStroke.parent.prototype._accept.call(this,e);return i&&this.field.checkable&&this.field.selectedRows.length},t.TableToggleRowKeyStroke.prototype.handle=function(t){var e=this.field,i=e.selectedRows,o=i[0].checked;i.forEach(function(t){e.checkRow(t,!o)})},t.TableNavigationUpKeyStroke=function(e){t.TableNavigationUpKeyStroke.parent.call(this,e),this.which=[t.keys.UP],this.renderingHints.text="↑",this.renderingHints.$drawingArea=function(t,e){var i=this.firstRowBeforeSelection();if(i)return i.$row}.bind(this)},t.inherits(t.TableNavigationUpKeyStroke,t.AbstractTableNavigationKeyStroke),t.TableNavigationUpKeyStroke.prototype.handle=function(e){var i,o,n=this.field,r=n.filteredRows(),s=n.selectedRows,a=n.selectionHandler.lastActionRow,l=-1,h=-1;if(a&&(l=r.indexOf(a)),r.length>1&&(s.length>0||l>-1)){if(l<0&&(a=r.length===s.length?t.arrays.last(r):t.arrays.first(s),l=r.indexOf(a)),0===l)return;h=l-1,o=r[h],i=[o],e.shiftKey&&(n.isRowSelected(o)?(i=[],t.arrays.pushAll(i,s),t.arrays.remove(i,a)):(i=t.arrays.union(i,s),o=this._findLastSelectedRowBefore(n,h)))}else i=[t.arrays.last(r)],o=i[0];n.selectionHandler.lastActionRow=o,n.selectRows(i,!0),n.scrollTo(o)},t.TableNavigationDownKeyStroke=function(e){t.TableNavigationDownKeyStroke.parent.call(this,e),this.which=[t.keys.DOWN],this.renderingHints.text="↓",this.renderingHints.$drawingArea=function(t,e){var i=this.firstRowAfterSelection();if(i)return i.$row}.bind(this)},t.inherits(t.TableNavigationDownKeyStroke,t.AbstractTableNavigationKeyStroke),t.TableNavigationDownKeyStroke.prototype.handle=function(e){var i,o,n=this.field,r=n.filteredRows(),s=n.selectedRows,a=n.selectionHandler.lastActionRow,l=-1,h=-1;if(a&&(l=r.indexOf(a)),r.length>1&&(s.length>0||l>-1)){if(l<0&&(a=r.length===s.length?t.arrays.first(r):t.arrays.last(s),l=r.indexOf(a)),l===r.length-1)return;h=l+1,o=r[h],i=[o],e.shiftKey&&(n.isRowSelected(o)?(i=[],t.arrays.pushAll(i,s),t.arrays.remove(i,a)):(i=t.arrays.union(s,i),o=this._findLastSelectedRowAfter(n,h)))}else i=[t.arrays.first(r)],o=i[0];n.selectionHandler.lastActionRow=o,n.selectRows(i,!0),n.scrollTo(o)},t.TableNavigationHomeKeyStroke=function(e){t.TableNavigationHomeKeyStroke.parent.call(this,e),this.which=[t.keys.HOME],this.renderingHints.text="Home",this.renderingHints.$drawingArea=function(t,e){var i=this._viewportInfo();if(i.firstRow)return i.firstRow.$row}.bind(this)},t.inherits(t.TableNavigationHomeKeyStroke,t.AbstractTableNavigationKeyStroke),t.TableNavigationHomeKeyStroke.prototype.handle=function(e){var i=this.field,o=i.filteredRows(),n=t.arrays.first(o),r=i.selectedRows,s=[],a=i.selectionHandler.lastActionRow,l=-1;e.shiftKey&&r.length>0?(a&&(l=o.indexOf(a)),l<0&&(a=t.arrays.first(r),l=o.indexOf(a)),s=o.slice(0,l),s=t.arrays.union(s,r)):s=n,i.selectionHandler.lastActionRow=n,i.selectRows(s),i.scrollTo(n)},t.TableNavigationEndKeyStroke=function(e){t.TableNavigationEndKeyStroke.parent.call(this,e),this.which=[t.keys.END],this.renderingHints.text="End",this.renderingHints.$drawingArea=function(t,e){var i=this._viewportInfo();if(i.lastRow)return i.lastRow.$row}.bind(this)},t.inherits(t.TableNavigationEndKeyStroke,t.AbstractTableNavigationKeyStroke),t.TableNavigationEndKeyStroke.prototype.handle=function(e){var i=this.field,o=i.filteredRows(),n=t.arrays.last(o),r=i.selectedRows,s=[],a=i.selectionHandler.lastActionRow,l=-1;e.shiftKey&&r.length>0?(a&&(l=o.indexOf(a)),l<0&&(a=t.arrays.last(r),l=o.indexOf(a)),s=o.slice(l+1,o.length),s=t.arrays.union(r,s)):s=n,i.selectionHandler.lastActionRow=n,i.selectRows(s),i.scrollTo(n)},t.TableNavigationPageUpKeyStroke=function(e){t.TableNavigationPageUpKeyStroke.parent.call(this,e),this.which=[t.keys.PAGE_UP],this.renderingHints.text="PgUp",this.renderingHints.$drawingArea=function(t,e){var i=this._viewportInfo();if(i.firstRow)return i.firstRow.$row}.bind(this)},t.inherits(t.TableNavigationPageUpKeyStroke,t.AbstractTableNavigationKeyStroke),t.TableNavigationPageUpKeyStroke.prototype.handle=function(e){var i,o=this.field,n=this._viewportInfo(),r=o.filteredRows(),s=o.selectedRows,a=t.arrays.first(s),l=o.selectionHandler.lastActionRow,h=-1;(n.firstRow||(o.scrollPageUp(),n=this._viewportInfo(),n.firstRow))&&(l&&(h=r.indexOf(l)),h<0&&(l=a,h=r.indexOf(l)),(!(s.length>0&&l===n.firstRow)||s.length>1&&!e.shiftKey||(o.scrollPageUp(),n=this._viewportInfo(),n.firstRow))&&(e.shiftKey&&s.length>0?(i=r.slice(r.indexOf(n.firstRow),h),i=t.arrays.union(s,i)):i=[n.firstRow],o.selectionHandler.lastActionRow=n.firstRow,o.selectRows(i,!0)))},t.TableNavigationPageDownKeyStroke=function(e){t.TableNavigationPageDownKeyStroke.parent.call(this,e),this.which=[t.keys.PAGE_DOWN],this.renderingHints.text="PgDn",this.renderingHints.$drawingArea=function(t,e){var i=this._viewportInfo();if(i.lastRow)return i.lastRow.$row}.bind(this)},t.inherits(t.TableNavigationPageDownKeyStroke,t.AbstractTableNavigationKeyStroke),t.TableNavigationPageDownKeyStroke.prototype.handle=function(e){var i,o=this.field,n=this._viewportInfo(),r=o.filteredRows(),s=o.selectedRows,a=t.arrays.last(s),l=o.selectionHandler.lastActionRow,h=-1;(n.lastRow||(o.scrollPageDown(),n=this._viewportInfo(),n.lastRow))&&(l&&(h=r.indexOf(l)),h<0&&(l=a,h=r.indexOf(l)),(!(s.length>0&&l===n.lastRow)||s.length>1&&!e.shiftKey||(o.scrollPageDown(),n=this._viewportInfo(),n.lastRow))&&(e.shiftKey&&s.length>0?(i=r.slice(h+1,r.indexOf(n.lastRow)+1),i=t.arrays.union(s,i)):i=[n.lastRow],o.selectionHandler.lastActionRow=n.lastRow,o.selectRows(i,!0)))},t.TableFocusFilterFieldKeyStroke=function(e){t.TableFocusFilterFieldKeyStroke.parent.call(this),this.field=e,this.renderingHints.$drawingArea=function(t,e){return e._$filterInput}.bind(this),this.virtualKeyStrokeWhich="a-Z;a-z;0-9",this.preventDefault=!1,this.keyStrokeMode=t.KeyStrokeMode.DOWN},t.inherits(t.TableFocusFilterFieldKeyStroke,t.KeyStroke),t.TableFocusFilterFieldKeyStroke.prototype._accept=function(t){if(!this._isKeyStrokeInRange(t))return!1;var i=e(".table-text-filter",this.field.$container);if(!i.length)return!1;var o=this.field.$container.activeElement(!0),n=o.tagName.toLowerCase(),r="textarea"===n||"input"===n;return("table-text-filter"!==o.className||!r)&&(t._$filterInput=i,this._isKeyStrokeInRange(t),!0)},t.TableFocusFilterFieldKeyStroke.prototype.handle=function(e){var i=e._$filterInput;if(this.field.session.focusManager.requestFocus(i)){i.focus();var o=t.nvl(i.val(),"").length;i[0].setSelectionRange(o,o)}},t.TableFocusFilterFieldKeyStroke.prototype.keys=function(){return[new t.Key(this,this.virtualKeyStrokeWhich)]},t.TableFocusFilterFieldKeyStroke.prototype.renderKeyBox=function(t,e){var i=e._$filterInput,o=i.position(),n=o.left+parseInt(i.css("margin-left").replace("px",""),0)+4;return i.beforeDiv("key-box char","a - z").css("left",n+"px"),i.parent()},t.TableFocusFilterFieldKeyStroke.prototype._isKeyStrokeInRange=function(e){return e.which===this.virtualKeyStrokeWhich||!(e.altKey|e.ctrlKey)&&(e.which>=t.keys.a&&e.which<=t.keys.z||e.which>=t.keys.A&&e.which<=t.keys.Z||e.which>=t.keys[0]&&e.which<=t.keys[9]||e.which>=t.keys.NUMPAD_0&&e.which<=t.keys.NUMPAD_9)},t.TableUserFilter=function(){},t.TableUserFilter.prototype.init=function(t){if(this.session=t.session,!this.session)throw new Error("Session expected: "+this);this._init(t)},t.TableUserFilter.prototype._init=function(t){e.extend(this,t)},t.TableUserFilter.prototype.createAddFilterEventData=function(){return{filterType:this.filterType}};t.TableUserFilter.prototype.createRemoveFilterEventData=function(){return{filterType:this.filterType}};t.TableUserFilter.prototype.createKey=function(){return this.filterType},t.TableUserFilter.prototype.createLabel=function(){return""},t.TableUserFilter.prototype.accept=function(t){},t.ColumnUserFilter=function(){t.ColumnUserFilter.parent.call(this),this.filterType=t.ColumnUserFilter.Type,this.events=new t.EventSupport,this.hasFilterFields=!1,this.availableValues=[],this.selectedValues=[]},t.inherits(t.ColumnUserFilter,t.TableUserFilter),t.ColumnUserFilter.Type="column",t.ColumnUserFilter.prototype.axisGroup=function(){return t.TableMatrix.NumberGroup.COUNT},t.ColumnUserFilter.prototype.calculate=function(){var e,i;this.matrix=new t.TableMatrix(this.table,this.session),this.matrix.addData(this.column,t.TableMatrix.NumberGroup.COUNT),this.xAxis=this.matrix.addAxis(this.column,this.axisGroup());var o=this.matrix.calculate();this.selectedValues.forEach(function(t){e=!1,this._useTextInsteadOfNormValue(t)&&(t=this.xAxis.norm(t)),this.xAxis.some(function(i){if(i===t)return e=!0,!0},this),e||(this.xAxis.push(t),i=!0)},this),i&&this.xAxis.reorder();var n,r,s,a;this.availableValues=[],this.xAxis.forEach(function(t){r=t,n=this.xAxis.format(t),a=null,this._useTextInsteadOfNormValue(t)&&(r=n),null!==t&&this.xAxis.textIsIcon&&(a=n,n=null),s=o.getValue([t]),this.availableValues.push({key:r,text:n,iconId:a,count:s?s[0]:0})},this)},t.ColumnUserFilter.prototype._useTextInsteadOfNormValue=function(t){return!1},t.ColumnUserFilter.prototype.createAddFilterEventData=function(){var e=t.ColumnUserFilter.parent.prototype.createAddFilterEventData.call(this);return e.columnId=this.column.id,e.selectedValues=this.selectedValues,e},t.ColumnUserFilter.prototype.createRemoveFilterEventData=function(){var e=t.ColumnUserFilter.parent.prototype.createRemoveFilterEventData.call(this);return e.columnId=this.column.id,e},t.ColumnUserFilter.prototype.createLabel=function(){return this.column.text||""},t.ColumnUserFilter.prototype.createKey=function(){return this.column.id},t.ColumnUserFilter.prototype.accept=function(t){this.xAxis||this.calculate();var e=!0,i=!0,o=this.column.cellValueForGrouping(t),n=this.xAxis.norm(o);return this._useTextInsteadOfNormValue(n)&&(n=this.xAxis.format(n)),this.tableFilterActive()&&(e=this.selectedValues.indexOf(n)>-1),this.fieldsFilterActive()&&(i=this.acceptByFields(o,n,t)),e&&i},t.ColumnUserFilter.prototype.filterActive=function(){return this.tableFilterActive()||this.fieldsFilterActive()},t.ColumnUserFilter.prototype.tableFilterActive=function(){return this.selectedValues.length>0},t.ColumnUserFilter.prototype.triggerFilterFieldsChanged=function(t){this.events.trigger("filterFieldsChanged",t)},t.ColumnUserFilter.prototype.on=function(t,e){this.events.on(t,e)},t.ColumnUserFilter.prototype.off=function(t,e){this.events.off(t,e)},t.ColumnUserFilter.prototype.acceptByFields=function(t,e,i){return!0},t.ColumnUserFilter.prototype.fieldsFilterActive=function(){return!1},t.ColumnUserFilter.prototype.addFilterFields=function(t){},t.ColumnUserFilter.prototype.modifyFilterFields=function(){},t.ColumnUserFilter.prototype.filterFieldsTitle=function(){return null},t.ColumnUserFilter.prototype.createComparator=function(){return t.comparators.NUMERIC},t.DateColumnUserFilter=function(){t.DateColumnUserFilter.parent.call(this),this.dateFrom,this.dateFromField,this.dateTo,this.dateToField,this.hasFilterFields=!0},t.inherits(t.DateColumnUserFilter,t.ColumnUserFilter),t.DateColumnUserFilter.prototype._init=function(e){t.DateColumnUserFilter.parent.prototype._init.call(this,e),this.dateFrom=t.dates.parseJsonDate(this.dateFrom),this.dateTo=t.dates.parseJsonDate(this.dateTo)},t.DateColumnUserFilter.prototype.axisGroup=function(){return this.column.hasDate?t.TableMatrix.DateGroup.YEAR:t.TableMatrix.DateGroup.NONE},t.DateColumnUserFilter.prototype.createAddFilterEventData=function(){var e=t.DateColumnUserFilter.parent.prototype.createAddFilterEventData.call(this);return e.dateFrom=t.dates.toJsonDate(this.dateFrom),e.dateTo=t.dates.toJsonDate(this.dateTo),e},t.DateColumnUserFilter.prototype.fieldsFilterActive=function(){return this.dateFrom||this.dateTo},t.DateColumnUserFilter.prototype.acceptByFields=function(e,i,o){if(!e)return!1;var n=e.valueOf(),r=this.dateFrom?this.dateFrom.valueOf():null,s=this.dateTo?t.dates.shift(this.dateTo,0,0,1).valueOf()-1:null;if(r&&s)return n>=r&&n<=s;if(r)return n>=r;if(s)return n<=s;throw new Error("illegal state")},t.DateColumnUserFilter.prototype.filterFieldsTitle=function(){return this.session.text("ui.DateRange")},t.DateColumnUserFilter.prototype.addFilterFields=function(e){function i(e){return e?t.dates.toJsonDate(e):null}this.dateFromField=e.addFilterField("DateField","ui.from",0),this.dateFromField.setTimestamp(i(this.dateFrom)),this.dateFromField.on("timestampChanged",this._onDisplayTextChanged.bind(this)),this.dateToField=e.addFilterField("DateField","ui.to",1),this.dateToField.setTimestamp(i(this.dateTo)),this.dateToField.on("timestampChanged",this._onDisplayTextChanged.bind(this))},t.DateColumnUserFilter.prototype._onDisplayTextChanged=function(t){this.dateFrom=this.dateFromField.timestampAsDate,this.dateTo=this.dateToField.timestampAsDate,e.log.debug("(DateColumnUserFilter#_onDisplayTextChanged) dateFrom="+this.dateFrom+" dateTo="+this.dateTo),this.triggerFilterFieldsChanged(t)},t.DateColumnUserFilter.prototype.modifyFilterFields=function(){this.dateFromField.$field.on("input","",e.debounce(this._onInput.bind(this))),this.dateToField.$field.on("input","",e.debounce(this._onInput.bind(this)))},t.DateColumnUserFilter.prototype._onInput=function(t){this.dateFromField.rendered&&(this.dateFrom=this._readDate(this.dateFromField),this.dateTo=this._readDate(this.dateToField),this.triggerFilterFieldsChanged(t))},t.DateColumnUserFilter.prototype._readDate=function(t){var e=t.$dateField.val();if(!e)return null;var i=t._predictDate(e);return i&&i.date?t._newTimestampAsDate(i.date,t.timestampAsDate):void 0},t.NumberColumnUserFilter=function(){t.NumberColumnUserFilter.parent.call(this),this.numberFrom,this.numberFromField,this.numberTo,this.numberToField,this.hasFilterFields=!0},t.inherits(t.NumberColumnUserFilter,t.ColumnUserFilter),t.NumberColumnUserFilter.prototype.createAddFilterEventData=function(){var e=t.NumberColumnUserFilter.parent.prototype.createAddFilterEventData.call(this);return e.numberFrom=this.numberFrom,e.numberTo=this.numberTo,e},t.NumberColumnUserFilter.prototype.fieldsFilterActive=function(){return t.objects.isNumber(this.numberFrom)||t.objects.isNumber(this.numberTo)},t.NumberColumnUserFilter.prototype.acceptByFields=function(e,i,o){var n=t.objects.isNumber(this.numberFrom),r=t.objects.isNumber(this.numberTo);return n&&r?i>=this.numberFrom&&i<=this.numberTo:n?i>=this.numberFrom:r?i<=this.numberTo:void 0},t.NumberColumnUserFilter.prototype.filterFieldsTitle=function(){return this.session.text("ui.NumberRange")},t.NumberColumnUserFilter.prototype.addFilterFields=function(t){this.numberFromField=t.addFilterField("NumberField","ui.from",0),this.numberFromField.decimalFormat=this.column.decimalFormat,this.numberFromField.setDisplayText(this.numberFrom),this.numberFromField.on("displayTextChanged",this._onDisplayTextChanged.bind(this)),this.numberToField=t.addFilterField("NumberField","ui.to",1),this.numberToField.decimalFormat=this.column.decimalFormat,this.numberToField.setDisplayText(this.numberTo),this.numberToField.on("displayTextChanged",this._onDisplayTextChanged.bind(this))},t.NumberColumnUserFilter.prototype._onDisplayTextChanged=function(t){this.numberFrom=this.numberFromField.parse(),this.numberTo=this.numberToField.parse(),e.log.debug("(NumberColumnUserFilter#_onDisplayTextChanged) numberFrom="+this.numberFrom+" numberTo="+this.numberTo),this.triggerFilterFieldsChanged(t)},t.TextColumnUserFilter=function(){t.TextColumnUserFilter.parent.call(this),this.freeText,this.freeTextField,this.hasFilterFields=!0},t.inherits(t.TextColumnUserFilter,t.ColumnUserFilter),t.TextColumnUserFilter.prototype.createAddFilterEventData=function(){var e=t.TextColumnUserFilter.parent.prototype.createAddFilterEventData.call(this);return e.freeText=this.freeText,e},t.TextColumnUserFilter.prototype.fieldsFilterActive=function(){return t.strings.hasText(this.freeText)},t.TextColumnUserFilter.prototype.acceptByFields=function(e,i,o){var n=t.strings.nvl(this.freeText).toLowerCase(),r=t.strings.nvl(this.column.cellTextForTextFilter(o)).toLowerCase();return r.indexOf(n)>-1},t.TextColumnUserFilter.prototype._useTextInsteadOfNormValue=function(t){return null!==t},t.TextColumnUserFilter.prototype.filterFieldsTitle=function(){return this.session.text("ui.FreeText")},t.TextColumnUserFilter.prototype.addFilterFields=function(e){this.freeTextField=t.create("StringField",{parent:e,labelVisible:!1,statusVisible:!1,maxLength:100,displayText:this.freeText,updateDisplayTextOnModify:!0}),this.freeTextField.on("displayTextChanged",this._onDisplayTextChanged.bind(this)),e.addField0(this.freeTextField)},t.TextColumnUserFilter.prototype._onDisplayTextChanged=function(t){this.freeText=this.freeTextField.$field.val().trim(),e.log.debug("(TextColumnUserFilter#_onDisplayTextChanged) freeText="+this.freeText),this.triggerFilterFieldsChanged(t)},t.TextColumnUserFilter.prototype.modifyFilterFields=function(){this.freeTextField.removeMandatoryIndicator()},t.TableTextUserFilter=function(){t.TableTextUserFilter.parent.call(this),this.filterType=t.TableTextUserFilter.Type},t.inherits(t.TableTextUserFilter,t.TableUserFilter),t.TableTextUserFilter.Type="text",t.TableTextUserFilter.prototype.createAddFilterEventData=function(){var e=t.ColumnUserFilter.parent.prototype.createAddFilterEventData.call(this);return e.text=this.text,e},t.TableTextUserFilter.prototype.createLabel=function(){return this.text},t.TableTextUserFilter.prototype.accept=function(t){for(var e="",i=0;i<this.table.columns.length;i++){var o=this.table.columns[i];e+=o.cellTextForTextFilter(t)+" "}return e=e.trim().toLowerCase(),e.indexOf(this.text)>-1},t.Tree=function(){t.Tree.parent.call(this),this.displayStyle=t.Tree.DisplayStyle.DEFAULT,this.autoCheckChildren=!1,this.checkable=!1,this.enabled=!0,this.filterEnabled=!1,this.lazyExpandingEnabled=!0,this.menus=[],this.contextMenu,this.menuBar,this.keyStrokes=[],this.multiCheck=!0,this.nodes=[],this.nodesMap={},this.scrollToSelection=!1,this.scrollTop=0,this.selectedNodes=[],this.checkedNodes=[],this.groupedNodes={},this.visibleNodesFlat=[],this.visibleNodesMap={},this._addAdapterProperties(["menus","keyStrokes"]),this._additionalContainerClasses="",this._treeItemPaddingLeft=23,this._treeItemCheckBoxPaddingLeft=29,this._treeItemPaddingLevel=15,this._filters=[],this._doubleClickSupport=new t.DoubleClickSupport,this._$animationWrapper,this._$expandAnimationWrappers=[],this._filterMenusHandler=this._filterMenus.bind(this),this._inSelectionPathList={},this.viewRangeRendered=new t.Range(0,0),this.viewRangeSize=20,this.startAnimationFunc=function(){this.runningAnimations++}.bind(this),this.runningAnimations=0,this.runningAnimationsFinishFunc=function(){this.runningAnimations--,this.runningAnimations<=0&&(this.runningAnimations=0,this._renderViewportBlocked=!1,this.invalidateLayoutTree())}.bind(this),this.nodeHeight=0,this.nodeWidth=0,this.maxNodeWidth=0,this.nodeWidthDirty=!1,this.$data,this._scrolldirections="both"},t.inherits(t.Tree,t.Widget),t.Tree.DisplayStyle={DEFAULT:"default",BREADCRUMB:"breadcrumb"},t.Tree.prototype._init=function(e){t.Tree.parent.prototype._init.call(this,e),this.addFilter(new t.LazyNodeFilter(this),!0),this.breadcrumbFilter=new t.TreeBreadcrumbFilter(this),this.displayStyle===t.Tree.DisplayStyle.BREADCRUMB&&this.addFilter(this.breadcrumbFilter,!0,!0),this.initialTraversing=!0,this._ensureTreeNodes(this.nodes),this._visitNodes(this.nodes,this._initTreeNode.bind(this)),this._visitNodes(this.nodes,this._updateFlatListAndSelectionPath.bind(this)),this.initialTraversing=!1,this.selectedNodes=this._nodesByIds(this.selectedNodes),this.menuBar=t.create("MenuBar",{parent:this,menuOrder:new t.MenuItemsOrder(this.session,"Tree"),menuFilter:this._filterMenusHandler}),this.menuBar.bottom(),this._updateItemPath(!0),this._syncDisplayStyle(this.displayStyle),this._syncKeyStrokes(this.keyStrokes),this._syncMenus(this.menus)},t.Tree.prototype._ensureTreeNodes=function(e){var i,o;for(i=0;i<e.length;i++)o=e[i],o.childNodeIndex=t.nvl(o.childNodeIndex,i),o instanceof t.TreeNode||(e[i]=this._createTreeNode(o))},t.Tree.prototype._createTreeNode=function(e){return e.parent=this,t.create("TreeNode",e)},t.Tree.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.Tree.prototype._initKeyStrokeContext=function(){t.Tree.parent.prototype._initKeyStrokeContext.call(this),this._initTreeKeyStrokeContext()},t.Tree.prototype._initTreeKeyStrokeContext=function(){var e=t.keyStrokeModifier.NONE;this.keyStrokeContext.registerKeyStroke([new t.TreeSpaceKeyStroke(this),new t.TreeNavigationUpKeyStroke(this,e),new t.TreeNavigationDownKeyStroke(this,e),new t.TreeCollapseAllKeyStroke(this,e),new t.TreeCollapseOrDrillUpKeyStroke(this,e),new t.TreeNavigationEndKeyStroke(this,e),new t.TreeExpandOrDrillDownKeyStroke(this,e)]),this.keyStrokeContext.registerStopPropagationInterceptor(function(e){e.ctrlKey||e.altKey||!t.isOneOf(e.which,t.keys.UP,t.keys.DOWN)||(e.stopPropagation(),e.preventDefault())})},t.Tree.prototype._syncMenus=function(t){this.updateKeyStrokes(t,this.menus),this._setProperty("menus",t),this._updateMenuBar()},t.Tree.prototype._updateMenuBar=function(){var e=this._filterMenus(this.menus,t.MenuDestinations.MENU_BAR,!1,!0);this.menuBar.setMenuItems(e);var i=this._filterMenus(this.menus,t.MenuDestinations.CONTEXT_MENU,!0);this.contextMenu&&this.contextMenu.updateMenuItems(i)},t.Tree.prototype._syncKeyStrokes=function(t){this.updateKeyStrokes(t,this.keyStrokes),this._setProperty("keyStrokes",t)},t.Tree.prototype._resetTreeNode=function(t,e){t.reset()},t.Tree.prototype._isSelectedNode=function(t){return this.initialTraversing?this.selectedNodes.indexOf(t.id)>-1:this.selectedNodes.indexOf(t)>-1},t.Tree.prototype._updateFlatListAndSelectionPath=function(t,e){if(this._isSelectedNode(t)&&(t.parentNode&&!this.visibleNodesMap[t.parentNode.id]||0===t.level))for(var i=t;i;)this._inSelectionPathList[i.id]=!0,i.filterDirty=!0,i!==t&&(t.expanded=!0,0===i.level&&(this._applyFiltersForNode(i),this._addToVisibleFlatList(i,!1),this._addChildrenToFlatList(i,this.visibleNodesFlat.length-1,!1,null,!0))),i=i.parentNode;else t.parentNode&&this._isSelectedNode(t.parentNode)&&(this._inSelectionPathList[t.id]=!0);this._applyFiltersForNode(t),this._addToVisibleFlatList(t,!1)},t.Tree.prototype._initTreeNode=function(t,e){this.nodesMap[t.id]=t,e&&(t.parentNode=e,t.level=t.parentNode.level+1),t.checked&&this.checkedNodes.push(t),this._initTreeNodeInternal(t,e),this._updateMarkChildrenChecked(t,!0,t.checked),t.initialized=!0},t.Tree.prototype._applyNodeDefaultValues=function(e){t.defaultValues.applyTo(e,"TreeNode")},t.Tree.prototype._initTreeNodeInternal=function(t,e){this._applyNodeDefaultValues(t)},t.Tree.prototype.destroy=function(){t.Tree.parent.prototype.destroy.call(this),this._visitNodes(this.nodes,this._destroyTreeNode.bind(this))},t.Tree.prototype._destroyTreeNode=function(e,i){delete this.nodesMap[e.id],t.arrays.remove(this.selectedNodes,e),this._removeFromFlatList(e,!1),e.destroy(),this._onNodeDeleted&&this._onNodeDeleted(e)},t.Tree.prototype._visitNodes=function(e,i,o){return t.Tree.visitNodes(e,i,o)},t.Tree.prototype._render=function(e){this.$container=e.appendDiv("tree"),this._additionalContainerClasses&&this.$container.addClass(this._additionalContainerClasses);var i=new t.TreeLayout(this);this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(i),this.htmlComp.pixelBasedSizing=!1,this.$data=this.$container.appendDiv("tree-data").on("contextmenu",this._onContextMenu.bind(this)).on("mousedown",".tree-node",this._onNodeMouseDown.bind(this)).on("mouseup",".tree-node",this._onNodeMouseUp.bind(this)).on("dblclick",".tree-node",this._onNodeDoubleClick.bind(this)).on("mousedown",".tree-node-control",this._onNodeControlMouseDown.bind(this)).on("mouseup",".tree-node-control",this._onNodeControlMouseUp.bind(this)).on("dblclick",".tree-node-control",this._onNodeControlDoubleClick.bind(this)).on("scroll",this._onDataScroll.bind(this)),t.HtmlComponent.install(this.$data,this.session),this.isHorizontalScrollingEnabled()&&this.$data.toggleClass("scrollable-tree",!0),t.scrollbars.install(this.$data,{parent:this,axis:this._scrolldirections}),this._installNodeTooltipSupport(),this.menuBar.render(this.$container),this._updateNodeDimensions(),this._renderDisplayStyle(),this._renderViewport()},t.Tree.prototype._postRender=function(){t.Tree.parent.prototype._postRender.call(this),this._renderSelection()},t.Tree.prototype._remove=function(){this._$animationWrapper&&this._$animationWrapper.stop(!1,!0),this._visitNodes(this.nodes,this._resetTreeNode.bind(this)),t.scrollbars.uninstall(this.$data,this.session),this._uninstallDragAndDropHandler(),this._uninstallNodeTooltipSupport(),this.$fillBefore=null,this.$fillAfter=null,this.$data=null,this.viewRangeRendered=new t.Range(0,0),t.Tree.parent.prototype._remove.call(this)},t.Tree.prototype._renderProperties=function(){t.Tree.parent.prototype._renderProperties.call(this),this._renderDropType()},t.Tree.prototype.isHorizontalScrollingEnabled=function(){return"both"===this._scrolldirections||"x"===this._scrolldirections},t.Tree.prototype._onDataScroll=function(){var t=this.scrollToSelection;this.scrollToSelection=!1;var e=this.$data[0].scrollTop;this.scrollTop!==e&&(this._renderViewport(),this.scrollTop=e,this.scrollToSelection=t)},t.Tree.prototype.setScrollTop=function(t){this.setProperty("scrollTop",t),this.rendered&&this._renderViewport()},t.Tree.prototype._renderScrollTop=function(){t.scrollbars.scrollTop(this.$data,this.scrollTop)},t.Tree.prototype._renderViewport=function(){if(!(this.runningAnimations>0||this._renderViewportBlocked)){var t=this._calculateCurrentViewRange();this._renderViewRange(t)}},t.Tree.prototype._calculateCurrentViewRange=function(){var t,e=this.$data[0].scrollTop,i=this.$data[0].scrollHeight-this.$data[0].clientHeight;return t=0===i&&this.visibleNodesFlat.length>0?this.visibleNodesFlat[0]:this._nodeAtScrollTop(e),this._calculateViewRangeForNode(t)},t.Tree.prototype._rerenderViewport=function(){this._renderViewportBlocked||(this._removeRenderedNodes(),
this._renderFiller(),this._updateDomNodeWidth(),this._renderViewport())},t.Tree.prototype._removeRenderedNodes=function(){var i=this.$data.find(".tree-node");i.each(function(t,i){var o=e(i),n=o.data("node");o.hasClass("hiding")||this._removeNode(n)}.bind(this)),this.viewRangeRendered=new t.Range(0,0)},t.Tree.prototype._renderViewRangeForNode=function(t){var e=this._calculateViewRangeForNode(t);this._renderViewRange(e)},t.Tree.prototype._renderNodesInRange=function(i){var o=!1,n=this.visibleNodesFlat;if(0!==n.length){var r=new t.Range(0,n.length);if(i=r.intersect(i),!i.intersect(this.viewRangeRendered).equals(new t.Range(0,0)))throw new Error("New range must not intersect with existing.");i.to<=this.viewRangeRendered.from&&(o=!0);var s=this.viewRangeRendered.union(i);if(2===s.length)throw new Error("Can only prepend or append rows to the existing range. Existing: "+this.viewRangeRendered+". New: "+s);this.viewRangeRendered=s[0];var a=this.ensureRangeVisible(i);e.log.isTraceEnabled()&&e.log.trace(a+" new nodes rendered from "+i)}},t.Tree.prototype.ensureRangeVisible=function(t){for(var e=this.visibleNodesFlat,i=0,o=t.from;o<t.to;o++){var n=e[o];n.attached||(this._insertNodeInDOM(n),i++)}return i},t.Tree.prototype._renderFiller=function(){this.$fillBefore||(this.$fillBefore=this.$data.prependDiv("tree-data-fill"));var i=this._calculateFillerDimension(new t.Range(0,this.viewRangeRendered.from));this.$fillBefore.cssHeight(i.height),this.isHorizontalScrollingEnabled()&&(this.$fillBefore.cssWidth(i.width),this.maxNodeWidth=Math.max(i.width,this.maxNodeWidth)),e.log.trace("FillBefore height: "+i.height),this.$fillAfter||(this.$fillAfter=this.$data.appendDiv("tree-data-fill"));var o={height:0,width:0};o=this._calculateFillerDimension(new t.Range(this.viewRangeRendered.to,this.visibleNodesFlat.length)),this.$fillAfter.cssHeight(o.height),this.isHorizontalScrollingEnabled()&&(this.$fillAfter.cssWidth(o.width),this.maxNodeWidth=Math.max(o.width,this.maxNodeWidth)),e.log.trace("FillAfter height: "+o.height)},t.Tree.prototype._calculateFillerDimension=function(t){for(var e={height:0,width:Math.max(this.$data.outerWidth(),this.maxNodeWidth)},i=t.from;i<t.to;i++){var o=this.visibleNodesFlat[i];e.height+=this._heightForNode(o),e.width=Math.max(e.width,this._widthForNode(o))}return e},t.Tree.prototype._removeNodesInRange=function(i){var o,n,r,s,a=0,l=this.visibleNodesFlat,h=new t.Range(0,l.length);i=h.intersect(i),o=l[i.from],n=l[i.to];var d=this.viewRangeRendered.subtract(i);if(2===d.length)throw new Error("Can only remove nodes at the beginning or end of the existing range. "+this.viewRangeRendered+". New: "+d);for(this.viewRangeRendered=d[0],s=i.from;s<i.to;s++)r=l[s],this._removeNode(r),a++;e.log.isTraceEnabled()&&e.log.trace(a+" nodes removed from "+i+".")},t.Tree.prototype._removeNode=function(t){var e=t.$node;e&&(e.hasClass("hiding")||(e.detach(),t.attached=!1))},t.Tree.prototype._renderViewRange=function(e){if(e.from!==this.viewRangeRendered.from||e.to!==this.viewRangeRendered.to||this.viewRangeDirty){if(this.viewRangeDirty)this.viewRangeRendered=e,this.ensureRangeVisible(e);else{var i=e.subtract(this.viewRangeRendered),o=this.viewRangeRendered.subtract(e),n=new t.Range(0,this.visibleNodesFlat.length);o.forEach(function(t){this._removeNodesInRange(t),n.to<t.to&&(this.viewRangeRendered=e)}.bind(this)),i.forEach(function(t){this._renderNodesInRange(t)}.bind(this))}if(this.viewRangeRendered.size()>0){var r=this.visibleNodesFlat,s=r[this.viewRangeRendered.from],a=r[this.viewRangeRendered.to-1];if(this.viewRangeDirty){var l=s.$node.prevAll(".tree-node"),h=a.$node.nextAll(".tree-node");this._cleanupNodes(l),this._cleanupNodes(h)}if(!s.attached||!a.attached)throw new Error("Nodes not rendered as expected. "+this.viewRangeRendered+". First: "+s.$node+". Last: "+a.$node)}this._postRenderViewRange(),this.viewRangeDirty=!1}},t.Tree.prototype._postRenderViewRange=function(){this._renderFiller(),this._updateDomNodeWidth(),this._renderSelection()},t.Tree.prototype._updateDomNodeWidth=function(t){if(this.isHorizontalScrollingEnabled()&&this.rendered&&this.nodeWidthDirty){for(var e=this.viewRangeRendered.from;e<this.viewRangeRendered.to;e++)this.maxNodeWidth=Math.max(this.visibleNodesFlat[e].width,this.maxNodeWidth);this.$data.find(".tree-node").css("width",this.maxNodeWidth),this.nodeWidthDirty=!1}},t.Tree.prototype._cleanupNodes=function(t){for(var e=0;e<t.length;e++)this._removeNode(t.eq(e).data("node"))},t.Tree.prototype._nodeAtScrollTop=function(t){var e,i=0;this.visibleNodesFlat.some(function(o,n){if(i+=this._heightForNode(o),t<i)return e=o,!0}.bind(this));var o=this.visibleNodesFlat.length;return!e&&o>0&&(e=this.visibleNodesFlat[o-1]),e},t.Tree.prototype._heightForNode=function(t){var e=0;return e=t.height?t.height:this.nodeHeight},t.Tree.prototype._widthForNode=function(t){var e=0;return e=t.width?t.width:this.nodeWidth},t.Tree.prototype._calculateViewRangeForNode=function(e){var i,o=new t.Range,n=Math.floor(this.viewRangeSize/4),r=this.visibleNodesFlat.indexOf(e);return o.from=Math.max(r-n,0),o.to=Math.min(o.from+this.viewRangeSize,this.visibleNodesFlat.length),e&&r!==-1?(i=this.viewRangeSize-o.size(),i>0&&(o.from=Math.max(o.to-this.viewRangeSize,0)),o):o},t.Tree.prototype.calculateViewRangeSize=function(){if(this._updateNodeDimensions(),0===this.nodeHeight)throw new Error("Cannot calculate view range with nodeHeight = 0");return 2*Math.ceil(this.$data.outerHeight()/this.nodeHeight)},t.Tree.prototype.setViewRangeSize=function(t){this.viewRangeSize!==t&&(this._setProperty("viewRangeSize",t),this.rendered&&this._renderViewport())},t.Tree.prototype._updateNodeDimensions=function(){var t={level:0},e=this._$buildNode(t).appendTo(this.$data);if(this._renderNodeText(t),this.nodeHeight=e.outerHeight(!0),this.isHorizontalScrollingEnabled()){var i=this.nodeWidth;this.nodeWidth=e.outerWidth(!0),i!==this.nodeWidth&&(this.viewRangeDirty=!0)}e.remove()},t.Tree.prototype.updateNodeHeights=function(){this.visibleNodesFlat.forEach(function(t){t.attached?t.height=t.$node.outerHeight(!0):t.height=null})},t.Tree.prototype._removeNodes=function(t,e){if(0!==t.length){t.forEach(function(t){this._removeFromFlatList(t,!0),t.childNodes.length>0&&this._removeNodes(t.childNodes,t),t.$node&&(this._$animationWrapper&&this._$animationWrapper.find(t.$node).length>0&&this._$animationWrapper.stop(!1,!0),t.reset())},this);var o=e?e.$node:i;if(o){var n=e.childNodes;n&&0!==n.length||(o.removeClass("expanded"),o.removeClass("lazy"))}this.rendered&&(this.viewRangeDirty=!0,this.invalidateLayoutTree())}},t.Tree.prototype._$buildNode=function(t){var e=this.$container.makeDiv("tree-node").data("node",t).attr("data-nodeid",t.id).attr("data-level",t.level).css("padding-left",this._computeTreeItemPaddingLeft(t.level));return t.$node=e,e.appendSpan("text"),this._renderTreeItemControl(t),this.checkable&&this._renderTreeItemCheckbox(t),e},t.Tree.prototype._decorateNode=function(e){var i,o=e.$node;if(o&&(i="tree-node",o.isSelected()&&(i+=" selected"),o.hasClass("ancestor-of-selected")&&(i+=" ancestor-of-selected"),o.hasClass("parent-of-selected")&&(i+=" parent-of-selected"),o.removeClass(),o.addClass(i),o.addClass(e.cssClass),o.toggleClass("leaf",!!e.leaf),o.toggleClass("expanded",!!e.expanded&&e.childNodes.length>0),o.toggleClass("lazy",o.hasClass("expanded")&&e.expandedLazy),o.toggleClass("group",!!this.groupedNodes[e.id]),o.setEnabled(!!e.enabled),o.children(".tree-node-control").setVisible(!e.leaf),o.children(".tree-node-checkbox").children(".check-box").toggleClass("disabled",!(this.enabled&&e.enabled)),e.parentNode||0!==this.selectedNodes.length?e.parentNode&&this.selectedNodes.indexOf(e.parentNode)>-1&&o.addClass("child-of-selected"):o.addClass("child-of-selected"),this._renderNodeText(e),t.styles.legacyStyle(e,o),e.parentNode&&e.parentNode.expandedLazy)){var n=e.parentNode.childNodes.some(function(t){if(this.visibleNodesMap[t.id])return!0}.bind(this));!n&&e.parentNode.$node&&e.parentNode.$node.removeClass("lazy")}},t.Tree.prototype._renderTreeItemControl=function(t){var e=t.$node,i=e.prependDiv("tree-node-control");this.checkable&&i.addClass("checkable"),i.setVisible(!t.leaf)},t.Tree.prototype._renderTreeItemCheckbox=function(t){var e=t.$node,i=e.prependDiv("tree-node-checkbox"),o=i.appendDiv("check-box").toggleClass("checked",t.checked).toggleClass("disabled",!(this.enabled&&t.enabled));t.childrenChecked?o.toggleClass("children-checked",!0):o.toggleClass("children-checked",!1)},t.Tree.prototype._renderNodeText=function(t){var e=t.$node,i=e.children(".text");t.htmlEnabled?i.html(t.text):i.textOrNbsp(t.text)},t.Tree.prototype._renderNodeChecked=function(t){t.$node&&t.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("checked",t.checked)},t.Tree.prototype._removeMenus=function(){},t.Tree.prototype._filterMenus=function(e,i,o,n){return t.menus.filterAccordingToSelection("Tree",this.selectedNodes.length,e,i,o,n)},t.Tree.prototype._renderEnabled=function(){var t=this.enabled;this.$data.setEnabled(t),this.$container.setTabbable(t),this.rendered&&this.$nodes().each(function(){var i=e(this),o=i.data("node");i.children(".tree-node-checkbox").children(".check-box").toggleClass("disabled",!(t&&o.enabled))})},t.Tree.prototype._renderCheckable=function(){var t=function(t){return!!t.$node},e=function(i){var o=i.$node,n=o.children(".tree-node-control"),r=o.children(".tree-node-checkbox");this.checkable?(n.addClass("checkable"),0===r.length&&this._renderTreeItemCheckbox(i)):(n.removeClass("checkable"),r.remove()),o.css("padding-left",this._computeTreeItemPaddingLeft(parseFloat(o.attr("data-level")))),i.childNodes&&i.childNodes.filter(t).forEach(e)}.bind(this);this.nodes.filter(t).forEach(e)},t.Tree.prototype._renderDisplayStyle=function(){this.$container.toggleClass("breadcrumb",this.isBreadcrumbStyleActive()),this.invalidateLayoutTree()},t.Tree.prototype._renderExpansion=function(t,i){var o={expandLazyChanged:!1,expansionChanged:!1};e.extend(o,i);var n=t.$node,r=t.expanded;if(n&&0!==n.length){if(0===t.childNodes.length)return!0;n.toggleClass("lazy",r&&t.expandedLazy),(o.expansionChanged||o.expandLazyChanged)&&(r?n.addClass("expanded"):n.removeClass("expanded"))}},t.Tree.prototype._renderSelection=function(){0===this.selectedNodes.length&&this.nodes.forEach(function(t){t.rendered&&t.$node.addClass("child-of-selected")},this),this.selectedNodes.forEach(function(t){if(this.visibleNodesMap[t.id]){var e=t.parentNode;for(e&&e.rendered&&e.$node.addClass("parent-of-selected");e;)e.rendered&&e.$node.addClass("ancestor-of-selected"),e=e.parentNode;t.expanded&&t.childNodes.forEach(function(t){t.rendered&&t.$node.addClass("child-of-selected")},this),t.rendered&&t.$node.select(!0)}},this);for(var t=this.viewRangeRendered.from;t<this.viewRangeRendered.to&&!(t>=this.visibleNodesFlat.length);t++){var e=this.visibleNodesFlat[t];e&&e.rendered&&e.$node.toggleClass("group",!!this.groupedNodes[e.id])}this.scrollToSelection&&this.revealSelection()},t.Tree.prototype._removeSelection=function(){0===this.selectedNodes.length&&this.nodes.forEach(function(t){t.rendered&&t.$node.removeClass("child-of-selected")},this),this.selectedNodes.forEach(this._removeNodeSelection,this)},t.Tree.prototype._removeNodeSelection=function(t){t.rendered&&t.$node.select(!1);var e=t.parentNode;for(e&&e.rendered&&e.$node.removeClass("parent-of-selected");e&&e.rendered;)e.$node.removeClass("ancestor-of-selected"),e=e.parentNode;t.expanded&&t.childNodes.forEach(function(t){t.rendered&&t.$node.removeClass("child-of-selected")},this)},t.Tree.prototype._renderDropType=function(){this.dropType?this._installDragAndDropHandler():this._uninstallDragAndDropHandler()},t.Tree.prototype._installDragAndDropHandler=function(i){this.dragAndDropHandler||(this.dragAndDropHandler=t.dragAndDrop.handler(this,{supportedScoutTypes:t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER,dropType:function(){return this.dropType}.bind(this),dropMaximumSize:function(){return this.dropMaximumSize}.bind(this),additionalDropProperties:function(t){var i=e(t.currentTarget),o={nodeId:""};if(i.hasClass("tree-node")){var n=i.data("node");o.nodeId=n.id}return o}.bind(this)}),this.dragAndDropHandler.install(this.$container,".tree-data,.tree-node"))},t.Tree.prototype._uninstallDragAndDropHandler=function(t){this.dragAndDropHandler&&(this.dragAndDropHandler.uninstall(),this.dragAndDropHandler=null)},t.Tree.prototype._updateMarkChildrenChecked=function(t,e,i,o){if(this.checkable){if(o){for(var n=!1,r=0;r<t.childNodes.length>0;r++){var s=t.childNodes[r];if(s.checked||s.childrenChecked){t.childrenChecked=!0,i=!0,n=!0,this.rendered&&t.$node&&t.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("children-checked",!0);break}}n||(t.childrenChecked=!1,this.rendered&&t.$node&&t.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("children-checked",!1))}if(t.parentNode&&!t.parentNode.checked){var a=!1;if(!i&&!e){for(var l=!1,h=0;h<t.parentNode.childNodes.length>0;h++){var d=t.parentNode.childNodes[h];if(d.checked||d.childrenChecked){l=!0;break}}l!==t.parentNode.childrenChecked&&(t.parentNode.childrenChecked=l,a=!0)}i&&!t.parentNode.childrenChecked&&(t.parentNode.childrenChecked=!0,a=!0),a&&(this._updateMarkChildrenChecked(t.parentNode,e,i),this.rendered&&t.parentNode.$node&&(i?t.parentNode.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("children-checked",!0):t.parentNode.$node.children(".tree-node-checkbox").children(".check-box").toggleClass("children-checked",!1)))}}},t.Tree.prototype._installNodeTooltipSupport=function(){t.tooltips.install(this.$data,{parent:this,selector:".tree-node",text:this._nodeTooltipText.bind(this),arrowPosition:50,arrowPositionUnit:"%",nativeTooltip:!t.device.isCustomEllipsisTooltipPossible()})},t.Tree.prototype._uninstallNodeTooltipSupport=function(){t.tooltips.uninstall(this.$data)},t.Tree.prototype._nodeTooltipText=function(t){var e=t.data("node");return e.tooltipText?e.tooltipText:this._isTruncatedNodeTooltipEnabled()&&t.isContentTruncated()?t.children(".text").text():void 0},t.Tree.prototype._isTruncatedNodeTooltipEnabled=function(){return!0},t.Tree.prototype.setDisplayStyle=function(t){this.displayStyle!==t&&(this._renderViewportBlocked=!0,this._syncDisplayStyle(t),this.rendered&&this._renderDisplayStyle(),this._renderViewportBlocked=!1)},t.Tree.prototype._syncDisplayStyle=function(e){if(this._setProperty("displayStyle",e),e&&this.selectedNodes.length>0){var i=this.selectedNodes[0];i.expanded||this.expandNode(i)}this.displayStyle===t.Tree.DisplayStyle.BREADCRUMB?(this.addFilter(this.breadcrumbFilter,!0,!0),this.filterVisibleNodes()):this.displayStyle!==t.Tree.DisplayStyle.BREADCRUMB&&(this.removeFilter(this.breadcrumbFilter,!0),this.filter())},t.Tree.prototype.setBreadcrumbStyleActive=function(e){e?this.setDisplayStyle(t.Tree.DisplayStyle.BREADCRUMB):this.setDisplayStyle(t.Tree.DisplayStyle.DEFAULT)},t.Tree.prototype.isNodeInBreadcrumbVisible=function(t){return this._inSelectionPathList[t.id]!==i&&this._inSelectionPathList[t.id]},t.Tree.prototype.isBreadcrumbStyleActive=function(){return this.displayStyle===t.Tree.DisplayStyle.BREADCRUMB},t.Tree.prototype.setBreadcrumbTogglingThreshold=function(t){this.setProperty("breadcrumbTogglingThreshold",t)},t.Tree.prototype.expandNode=function(t,e){this.setNodeExpanded(t,!0,e)},t.Tree.prototype.collapseNode=function(t,e){this.setNodeExpanded(t,!1,e)},t.Tree.prototype.collapseAll=function(){this.rebuildSuppressed=!0,this._visitNodes(this.nodes,function(t){this.collapseNode(t)}.bind(this)),this.rendered&&this._rerenderViewport(),this.rebuildSuppressed=!1},t.Tree.prototype.setNodeExpanded=function(e,i,o){o=o||{};var n=t.nvl(o.lazy,e.lazyExpandingEnabled),r=t.nvl(o.renderAnimated,!0);if(this.lazyExpandingEnabled||(n=!1),this.isBreadcrumbStyleActive()&&!i&&this.selectedNodes.indexOf(e)>-1)return void this.setNodeExpanded(e,!0,o);if(o.collapseChildNodes){var s=t.objects.valueCopy(o);s.renderExpansion=!1,e.childNodes.forEach(function(t){t.expanded&&this.collapseNode(t,s)}.bind(this))}var a={expansionChanged:!1,expandLazyChanged:!1};if(e.expanded!==i||e.expandedLazy!==n){a.expansionChanged=e.expanded!==i,a.expandLazyChanged=e.expandedLazy!==n,e.expanded=i,e.expandedLazy=n,this.groupedNodes[e.id]&&this._updateItemPath(!1,e);var l=this._applyFiltersForNode(e);l&&a.expansionChanged?this._rebuildParent(e.parentNode,o):a.expandLazyChanged&&e.childNodes.forEach(function(t){this._applyFiltersForNode(t)}.bind(this)),e.expanded?e.ensureLoadChildren().done(this._addChildrenToFlatList.bind(this,e,null,r,null,!0)):this._removeChildrenFromFlatList(e,r),this.trigger("nodeExpanded",{node:e,expanded:i,expandedLazy:n}),this.viewRangeDirty=!0}this.rendered&&t.nvl(o.renderExpansion,!0)&&this._renderExpansion(e,a)},t.Tree.prototype.setNodeExpandedRecursive=function(t,e,i){this._visitNodes(t,function(t){this.setNodeExpanded(t,e,i)}.bind(this))},t.Tree.prototype._rebuildParent=function(e,i){if(!this.rebuildSuppressed&&(e.expanded||e.expandedLazy?this._addChildrenToFlatList(e,null,!1,null,!0):this._removeChildrenFromFlatList(e,!1),this.rendered&&t.nvl(i.renderExpansion,!0))){var o={expansionChanged:!0};this._renderExpansion(e,o)}},t.Tree.prototype._removeChildrenFromFlatList=function(t,i){function o(t){t.forEach(function(t){t.$node.detach(),t.$node.css("display",t.displayBackup),t.displayBackup=null}),this._$animationWrapper&&(this._$animationWrapper.remove(),this._$animationWrapper=null),this.runningAnimationsFinishFunc()}if(this.visibleNodesMap[t.id]){var n=this.visibleNodesFlat.indexOf(t),r=0,s=t.level,a=[];i=i&&this.rendered,this._$animationWrapper&&this._$animationWrapper.stop(!1,!0),this._$expandAnimationWrappers.forEach(function(t){t.stop(!1,!0)});for(var l=n+1;l<this.visibleNodesFlat.length&&this.visibleNodesFlat[l].level>s;l++){var h=this.visibleNodesFlat[l];this.isHorizontalScrollingEnabled()&&h.width===this.maxNodeWidth&&(this.maxNodeWidth=0,this.nodeWidthDirty=!0),delete this.visibleNodesMap[this.visibleNodesFlat[l].id],h.attached&&i?(this._$animationWrapper||(this._$animationWrapper=e('<div class="animation-wrapper">').insertBefore(h.$node),this._$animationWrapper.data("parentNode",t)),h.isChildOf(this._$animationWrapper.data("parentNode"))&&this._$animationWrapper.append(h.$node),h.attached=!1,h.displayBackup=h.$node.css("display"),a.push(h)):h.attached&&!i&&this.hideNode(h,!1,!1),r++}return this.visibleNodesFlat.splice(n+1,r),i&&(this._renderViewportBlocked=!0,a.length>0?this._$animationWrapper.animate({height:0},{start:this.startAnimationFunc,complete:o.bind(this,a),duration:200,queue:!1}):this._$animationWrapper?(this._$animationWrapper.remove(),this._$animationWrapper=null,o.call(this,a)):this._renderViewportBlocked=!1),a}},t.Tree.prototype._removeFromFlatList=function(e,i){var o=[];if(this.visibleNodesMap[e.id]){var n=this.visibleNodesFlat.indexOf(e);this._removeChildrenFromFlatList(e,!1),this.isHorizontalScrollingEnabled()&&e.width===this.maxNodeWidth&&(this.maxNodeWidth=0,this.nodeWidthDirty=!0),o=t.arrays.ensure(this.visibleNodesFlat.splice(n,1)),delete this.visibleNodesMap[e.id],this.hideNode(e,i)}return o.push(e),o},t.Tree.prototype._addToVisibleFlatList=function(t,e){if(!this.visibleNodesMap[t.id]&&t.isFilterAccepted()&&(!t.parentNode||t.parentNode.expanded&&this.visibleNodesMap[t.parentNode.id]))if(this.initialTraversing)this._addToVisibleFlatListNoCheck(t,this.visibleNodesFlat.length,e);else{var i=this._findIndexToInsertNode(t);this._addToVisibleFlatListNoCheck(t,i,e)}},t.Tree.prototype._findIndexToInsertNode=function(t){var e,i,o=function(t,e){for(var i=t-1;i>=0;i--)if(this.visibleNodesMap[e[i].id])return e[i];return null}.bind(this),n=function(t){if(t.expanded)for(var e=t.childNodes.length-1;e>=0;e--)if(this.visibleNodesMap[t.childNodes[e].id])return n(t.childNodes[e]);return t}.bind(this),r=t.parentNode;return r?(e=o(t.childNodeIndex,t.parentNode.childNodes),i=e?n(e):r,this.visibleNodesFlat.indexOf(i)+1):(e=o(t.childNodeIndex,this.nodes))?(i=n(e),this.visibleNodesFlat.indexOf(i)+1):0},t.Tree.prototype._addChildrenToFlatList=function(t,e,i,o,n){if(!this.visibleNodesMap[t.id])return 0;var r=!!o;return e=e?e:this.visibleNodesFlat.indexOf(t),i=i&&this.rendered,this._$animationWrapper&&!r&&this._$animationWrapper.stop(!1,!0),o=o?o:this.setUpInsertBatch(e+1),t.childNodes.forEach(function(e,r){var s=this.visibleNodesMap[e.id];if(e.initialized&&e.isFilterAccepted(n)&&!s)o.insertNodes.push(e),this.visibleNodesMap[e.id]=!0,o=this.checkAndHandleBatch(o,t,i),e.expanded&&(o=this._addChildrenToFlatList(e,o.lastBatchInsertIndex(),i,o,n));else if(e.initialized&&e.isFilterAccepted(n)&&s){this.insertBatchInVisibleNodes(o,this.viewRangeRendered.from+this.viewRangeSize>=o.lastBatchInsertIndex()&&this.viewRangeRendered.from<=o.lastBatchInsertIndex(),i),this.checkAndHandleBatchAnimationWrapper(t,i,o);var a=o.insertedAny()?2:1;o=this.setUpInsertBatch(o.lastBatchInsertIndex()+a),e.expanded&&(o=this._addChildrenToFlatList(e,o.lastBatchInsertIndex(),i,o,n)),i=!1}}.bind(this)),r||(this.insertBatchInVisibleNodes(o,this.viewRangeRendered.from+this.viewRangeSize>=o.lastBatchInsertIndex()&&this.viewRangeRendered.from<=o.lastBatchInsertIndex(),i),this.invalidateLayoutTree()),o},t.Tree.prototype.setUpInsertBatch=function(t){return{insertNodes:[t,0],$animationWrapper:null,lastBatchInsertIndex:function(){return 2===this.insertNodes.length?this.insertNodes[0]:this.insertNodes[0]+this.insertNodes.length-3},insertedAny:function(){return this.insertNodes.length>2}}},t.Tree.prototype.checkAndHandleBatchAnimationWrapper=function(i,o,n){function r(){n.$animationWrapper.replaceWith(n.$animationWrapper.contents()),t.arrays.remove(this._$expandAnimationWrappers,n.$animationWrapper),n.$animationWrapper=null,this.runningAnimationsFinishFunc()}if(o&&this.viewRangeRendered.from<=n.lastBatchInsertIndex()&&this.viewRangeRendered.to>=n.lastBatchInsertIndex()&&!n.$animationWrapper){var s=n.lastBatchInsertIndex()-1,a=this.viewRangeRendered.from===n.lastBatchInsertIndex()?null:this.visibleNodesFlat[s];if(a&&s>=this.viewRangeRendered.from&&s<this.viewRangeRendered.to&&!a.attached&&this.showNode(a,!1,s),a&&a.attached)n.$animationWrapper=e('<div class="animation-wrapper">').insertAfter(a.$node);else if(i.attached)n.$animationWrapper=e('<div class="animation-wrapper">').insertAfter(i.$node);else if(this.$fillBefore)n.$animationWrapper=e('<div class="animation-wrapper">').insertAfter(this.$fillBefore);else{var l=this.visibleNodesFlat[n.lastBatchInsertIndex()];n.$animationWrapper=e('<div class="animation-wrapper">').insertBefore(l.$node)}n.animationCompleteFunc=r,this._$expandAnimationWrappers.push(n.$animationWrapper)}},t.Tree.prototype.checkAndHandleBatch=function(t,e,i){return this.viewRangeRendered.from-1===t.lastBatchInsertIndex()&&(this.insertBatchInVisibleNodes(t,!1,!1),t=this.setUpInsertBatch(t.lastBatchInsertIndex()+1)),this.checkAndHandleBatchAnimationWrapper(e,i,t),this.viewRangeRendered.from+this.viewRangeSize-1===t.lastBatchInsertIndex()&&(this.insertBatchInVisibleNodes(t,!0,i),t=this.setUpInsertBatch(t.lastBatchInsertIndex()+1)),t},t.Tree.prototype.insertBatchInVisibleNodes=function(t,e,i){if(!(t.insertNodes<3)&&(this.visibleNodesFlat.splice.apply(this.visibleNodesFlat,t.insertNodes),e)){for(var o=t.insertNodes[0],n=2;n<t.insertNodes.length;n++){var r=t.insertNodes[n];this.showNode(r,!1,o),t.$animationWrapper&&t.$animationWrapper.append(r.$node),o++}if(t.$animationWrapper){var s=t.$animationWrapper.outerHeight();t.$animationWrapper.css("height",0).animate({height:s},{start:this.startAnimationFunc,complete:t.animationCompleteFunc.bind(this),duration:200,queue:!1})}}},t.Tree.prototype._addToVisibleFlatListNoCheck=function(e,i,o){t.arrays.insert(this.visibleNodesFlat,e,i),this.visibleNodesMap[e.id]=!0,this.rendered&&this.showNode(e,o,i)},t.Tree.prototype.scrollTo=function(e){0!==this.viewRangeRendered.size()&&(e.attached||this._renderViewRangeForNode(e),t.scrollbars.scrollTo(this.$data,e.$node))},t.Tree.prototype.revealSelection=function(){return this.rendered?void(this.selectedNodes.length>0&&(this.visibleNodesMap[this.selectedNodes[0].id]||this._expandAllParentNodes(this.selectedNodes[0]),this.scrollTo(this.selectedNodes[0]))):void this.session.layoutValidator.schedulePostValidateFunction(this.revealSelection.bind(this))},t.Tree.prototype.deselectAll=function(){this.selectNodes([])},t.Tree.prototype.selectNode=function(t,e){this.selectNodes(t)},t.Tree.prototype.selectNodes=function(e,i){var o;e=t.arrays.ensure(e),t.arrays.equalsIgnoreOrder(e,this.selectedNodes)||(this.rendered&&(this.isBreadcrumbStyleActive()&&(o=this.$data[0].scrollTop),this._removeSelection()),this.selectedNodes=e.slice(),this._nodesSelectedInternal(),this._triggerNodesSelected(i),this.selectedNodes.length>0&&!this.visibleNodesMap[this.selectedNodes[0].id]&&this._expandAllParentNodes(this.selectedNodes[0]),this._updateItemPath(!0),this.isBreadcrumbStyleActive()&&(this.selectedNodes.length>0&&!this.selectedNodes[0].expanded&&(this.expandNode(this.selectedNodes[0]),this.selectedNodes[0].filterDirty=!0),this.filter(!0)),this._updateMenuBar(),this.rendered&&(this._renderSelection(),this.isBreadcrumbStyleActive()&&(this.$data[0].scrollTop=o)))},t.Tree.prototype._nodesSelectedInternal=function(t){},t.Tree.prototype.deselectNode=function(t){this.deselectNodes(t)},t.Tree.prototype.deselectNodes=function(e){e=t.arrays.ensure(e);var i=this.selectedNodes.slice();t.arrays.removeAll(i,e)&&this.selectNodes(i)},t.Tree.prototype.isNodeSelected=function(t){return this.selectedNodes.indexOf(t)>-1},t.Tree.prototype._computeTreeItemPaddingLeft=function(t,e){return this.checkable?t*this._treeItemPaddingLevel+this._treeItemPaddingLeft+this._treeItemCheckBoxPaddingLeft:t*this._treeItemPaddingLevel+this._treeItemPaddingLeft},t.Tree.prototype._expandAllParentNodes=function(t){var e,i=t,o=[];i=t;for(var n=[];i.parentNode;)o.push(i.parentNode),this.visibleNodesMap[i.id]||n.push(i),i=i.parentNode;for(e=o.length-1;e>=0;e--)n.indexOf(o[e])!==-1&&this._addToVisibleFlatList(o[e],!1),o[e].expanded||this.expandNode(o[e],{renderExpansion:!1,renderAnimated:!1});this.rendered&&n.length>0&&(this._rerenderViewport(),this.invalidateLayoutTree())},t.Tree.prototype._updateChildNodeIndex=function(e,i){for(var o=t.nvl(i,0);o<e.length;o++)e[o].childNodeIndex=o},t.Tree.prototype.insertNodes=function(e,i){if(this._ensureTreeNodes(e),i&&!(i instanceof t.TreeNode))throw new Error("parent has to be a tree node: "+i);if(e.sort(function(t,e){return t.childNodeIndex-e.childNodeIndex}),i){if(i.childNodes&&i.childNodes.length>0?(e.forEach(function(e){t.arrays.insert(i.childNodes,e,e.childNodeIndex)}.bind(this)),this._updateChildNodeIndex(i.childNodes,e[0].childNodeIndex)):e.forEach(function(t){i.childNodes.push(t)}.bind(this)),this._visitNodes(e,this._initTreeNode.bind(this),i),this._visitNodes(e,this._updateFlatListAndSelectionPath.bind(this),i),this.groupedNodes[i.id]&&this._updateItemPath(!1,i),this.rendered){var o={expansionChanged:!0};this._renderExpansion(i,o)}}else this.nodes&&this.nodes.length>0?(e.forEach(function(e){t.arrays.insert(this.nodes,e,e.childNodeIndex)}.bind(this)),this._updateChildNodeIndex(this.nodes,e[0].childNodeIndex)):t.arrays.pushAll(this.nodes,e),this._visitNodes(e,this._initTreeNode.bind(this),i),this._visitNodes(e,this._updateFlatListAndSelectionPath.bind(this),i);this.rendered&&(this.viewRangeDirty=!0,this.invalidateLayoutTree()),this.trigger("nodesInserted",{nodes:e,parentNode:i})},t.Tree.prototype.updateNode=function(t){this.updateNodes([t])},t.Tree.prototype.updateNodes=function(t){t.forEach(function(t){var e,i=this.nodesMap[t.id];t===i?e=!0:(this._applyNodeDefaultValues(t),e=this._applyUpdatedNodeProperties(i,t)),e&&(this._applyFiltersForNode(i)&&(i.isFilterAccepted()?this._addToVisibleFlatList(i,!1):(this._nodesFiltered([i]),this._removeFromFlatList(i,!1))),this._updateItemPath(!1,i.parentNode),this.rendered&&this._decorateNode(i))},this),this.trigger("nodesUpdated",{nodes:t})},t.Tree.prototype._applyUpdatedNodeProperties=function(t,e){var i=!1;return t.leaf!==e.leaf&&(t.leaf=e.leaf,i=!0),t.enabled!==e.enabled&&(t.enabled=e.enabled,i=!0),t.lazyExpandingEnabled!==e.lazyExpandingEnabled&&(t.lazyExpandingEnabled=e.lazyExpandingEnabled,t.expandedLazy=e.lazyExpandingEnabled&&this.lazyExpandingEnabled,i=!0),i},t.Tree.prototype.deleteNodes=function(e,i){var o=[];e.forEach(function(e){if(i){if(e.parentNode!==i)throw new Error("Unexpected parent. Node.parent: "+e.parentNode+", parentNode: "+i);t.arrays.remove(i.childNodes,e)}else t.arrays.remove(this.nodes,e);this._destroyTreeNode(e,e.parentNode),o.push(e),this._updateMarkChildrenChecked(e,!1,!1),this._visitNodes(e.childNodes,this._destroyTreeNode.bind(this))},this),i?this._updateChildNodeIndex(i.childNodes):this._updateChildNodeIndex(this.nodes),this.rendered&&this._removeNodes(o,i),this.trigger("nodesDeleted",{nodes:e,parentNode:i})},t.Tree.prototype.deleteAllChildNodes=function(t){function e(t,e){this._destroyTreeNode(t,e),this._updateMarkChildrenChecked(t,!1,!1)}var i;t?(i=t.childNodes,t.childNodes=[]):(i=this.nodes,this.nodes=[]),this._visitNodes(i,e.bind(this)),this.rendered&&this._removeNodes(i,t),this.trigger("allChildNodesDeleted",{parentNode:t})},t.Tree.prototype.updateNodeOrder=function(e,i){if(e=t.arrays.ensure(e),this._updateChildNodeIndex(e),i){if(i.childNodes.length!==e.length)throw new Error("Node order may not be updated because lengths of the arrays differ.");i.childNodes=e.slice(),this._removeChildrenFromFlatList(i,!1),i.expanded&&this._addChildrenToFlatList(i,null,!1)}else{if(this.nodes.length!==e.length)throw new Error("Node order may not be updated because lengths of the arrays differ.");this.nodes=e.slice(),this.nodes.forEach(function(t){this._removeFromFlatList(t,!1),this._addToVisibleFlatList(t,!1),t.expanded&&this._addChildrenToFlatList(t,null,!1)},this)}this.trigger("childNodeOrderChanged",{parentNode:i})},t.Tree.prototype.checkNode=function(t,e){this.checkNodes([t],{checked:e})},t.Tree.prototype.checkNodes=function(i,o){var n={checked:!0,checkOnlyEnabled:!0,checkChildren:this.autoCheckChildren};e.extend(n,o);var r=[];!this.checkable||!this.enabled&&n.checkOnlyEnabled||(i=t.arrays.ensure(i),i.forEach(function(t){if(!t.enabled&&n.checkOnlyEnabled||t.checked===n.checked)return void(n.checkChildren&&this.checkNodes(t.childNodes,n));if(!this.multiCheck&&n.checked){for(var e=0;e<this.checkedNodes.length;e++)this.checkedNodes[e].checked=!1,this._updateMarkChildrenChecked(this.checkedNodes[e],!1,!1,!0),r.push(this.checkedNodes[e]);this.checkedNodes=[]}t.checked=n.checked,t.checked&&this.checkedNodes.push(t),r.push(t),this._updateMarkChildrenChecked(t,!1,n.checked,!0),n.checkChildren&&this.checkNodes(t.childNodes,n)},this),r.length>0&&this.trigger("nodesChecked",{nodes:r}),this.rendered&&r.forEach(function(t){this._renderNodeChecked(t)},this))},t.Tree.prototype.uncheckNode=function(t){this.uncheckNodes([t],{checkOnlyEnabled:!0})},t.Tree.prototype.uncheckNodes=function(t,e){e.checked=!1,this.checkNodes(t,e)},t.Tree.prototype._triggerNodesSelected=function(t){this.trigger("nodesSelected",{debounce:t})},t.Tree.prototype._showContextMenu=function(i){var o=function(i){i.preventDefault();var o=this._filterMenus(this.menus,t.MenuDestinations.CONTEXT_MENU,!0),n=e(i.currentTarget);0!==o.length&&(this.contextMenu=t.create("ContextMenuPopup",{parent:this,menuItems:o,location:{x:i.pageX,y:i.pageY},$anchor:n,menuFilter:this._filterMenusHandler}),this.contextMenu.open(),this.enabled&&(this.$container.addClass("focused"),this.contextMenu.on("close",function(t){this.$container.removeClass("focused"),this.contextMenu=null}.bind(this))))};t.menus.showContextMenuWithWait(this.session,o.bind(this),i)},t.Tree.prototype._onNodeMouseDown=function(i){if(this._doubleClickSupport.mousedown(i),this._doubleClickSupport.doubleClicked())return!1;var o=e(i.currentTarget),n=o.data("node");return this.hasNode(n)?(this._$mouseDownNode=o,o.window().one("mouseup",function(){
this._$mouseDownNode=null}.bind(this)),this.selectNodes(n),this.checkable&&this._isCheckboxClicked(i)&&(t.device.supportsFocusEmptyBeforeDiv()||(this.session.focusManager.requestFocus(this.$container),i.preventDefault()),this.checkNode(n,!n.checked)),!0):void 0},t.Tree.prototype._onNodeMouseUp=function(t){if(this._doubleClickSupport.doubleClicked())return!1;var i=e(t.currentTarget),o=i.data("node");return this._$mouseDownNode&&this._$mouseDownNode[0]===i[0]?(this.trigger("nodeClicked",{node:o}),!0):void 0},t.Tree.prototype._isCheckboxClicked=function(t){return e(t.target).is(".check-box")},t.Tree.prototype._updateItemPath=function(t,e){function i(t){t.forEach(function(t){this.groupedNodes[t.id]=!0,this._decorateNode(t),t.expanded&&t.isFilterAccepted()&&i.call(this,t.childNodes)}.bind(this))}var o,n,r;if(t&&(this.groupedNodes={},this._inSelectionPathList={}),!e){if(o=this.selectedNodes,0===o.length)return;for(n=o[0],t&&(this._inSelectionPathList[n.id]=!0,n.childNodes&&n.childNodes.forEach(function(t){this._inSelectionPathList[t.id]=!0}.bind(this))),r=n.level;n.parentNode;){var s=n.parentNode;if(this._isGroupingEnd(s)&&!e&&(e=n,!t))break;t&&(this._inSelectionPathList[s.id]=!0),n=s}e=e||o[0],this.groupedNodes[e.id]=!0}n=e,n&&n.expanded&&this.groupedNodes[n.id]&&i.call(this,n.childNodes)},t.Tree.prototype._isGroupingEnd=function(t){return!1},t.Tree.prototype.selectedNode=function(){return 0===this.selectedNodes.length?null:this.selectedNodes[0]},t.Tree.prototype.$selectedNodes=function(){return this.$data.find(".selected")},t.Tree.prototype.$nodes=function(){return this.$data.find(".tree-node")},t.Tree.prototype.addFilter=function(t,e,i){return this._filters.indexOf(t)<0&&(this._filters.push(t),e||this.filter(i),!0)},t.Tree.prototype.removeFilter=function(e,i){t.arrays.remove(this._filters,e),this.filter(i)},t.Tree.prototype.filter=function(e){var i=!e,o=[],n=[];this._visitNodes(this.nodes,function(e){var r=this._applyFiltersForNode(e);return r?(o.push(e),e.isFilterAccepted()?this._addToVisibleFlatList(e,i):t.arrays.pushAll(n,this._removeFromFlatList(e,i)),this.viewRangeDirty=!0):this.showNode(e,i),!e.expanded&&!e.expandedLazy||!e.isFilterAccepted()}.bind(this)),this._nodesFiltered(n)},t.Tree.prototype.filterVisibleNodes=function(e){for(var i=[],o=0;o<this.visibleNodesFlat.length;o++){var n=this.visibleNodesFlat[o],r=this._applyFiltersForNode(n);r&&(n.isFilterAccepted()||(o--,t.arrays.pushAll(i,this._removeFromFlatList(n,e))),this.viewRangeDirty=!0)}this._nodesFiltered(i)},t.Tree.prototype._nodesFiltered=function(t){this.deselectNodes(t)},t.Tree.prototype._nodeAcceptedByFilters=function(t){for(var e=0;e<this._filters.length;e++){var i=this._filters[e];if(!i.accept(t))return!1}return!0},t.Tree.prototype._applyFiltersForNode=function(t){var e=t.filterDirty;return this._nodeAcceptedByFilters(t)?t.filterAccepted||(t.filterAccepted=!0,e=!0):t.filterAccepted&&(t.filterAccepted=!1,e=!0),!!e&&(t.filterDirty=!1,t.childNodes.forEach(function(t){t.filterDirty=!0}),!0)};t.Tree.prototype._insertNodeInDOM=function(t,e){if(this.rendered||this.rendering){var o=e===i?this.visibleNodesFlat.indexOf(t):e;if(o!==-1&&this.viewRangeRendered.from+this.viewRangeSize>=o&&this.viewRangeRendered.from<=o&&this.viewRangeRendered.size()>0&&!t.attached){if(t.$node||this._$buildNode(t),this._decorateNode(t),this._insertNodeInDOMAtPlace(t,o),t.height=t.$node.outerHeight(!0),this.isHorizontalScrollingEnabled()){var n=t.width?t.width:0,r=t.$node.css("display");t.$node.css("width","auto"),t.$node.css("display","inline-block");var s=t.$node.outerWidth();n===this.maxNodeWidth&&s<this.maxNodeWidth?(this.maxNodeWidth=0,this.nodeWidthDirty=!0):s>this.maxNodeWidth&&(this.maxNodeWidth=s,this.nodeWidthDirty=!0),this.nodeWidthDirty||t.$node.css("width",this.maxNodeWidth),t.$node.css("display",r),t.width=s}t.rendered=!0,t.attached=!0}}};t.Tree.prototype._ensureNodeInDOM=function(t,e,i){t&&!t.attached&&t===this.visibleNodesFlat[i]&&i>=this.viewRangeRendered.from&&i<this.viewRangeRendered.to&&this.showNode(t,e,i)},t.Tree.prototype._insertNodeInDOMAtPlace=function(t,e){var i=t.$node;if(0===e)return void(this.$fillBefore?i.insertAfter(this.$fillBefore):this.$data.prepend(i));var o=this.visibleNodesFlat[e-1];if(this._ensureNodeInDOM(o,!1,e-1),o.attached)return void i.insertAfter(o.$node);if(e+1<this.visibleNodesFlat.length){var n=this.visibleNodesFlat[e+1];if(n.attached)return void i.insertBefore(n.$node)}this.$fillBefore?i.insertAfter(this.$fillBefore):this.$data.prepend(i)},t.Tree.prototype.showNode=function(t,e,i){if(!t.attached&&this.rendered&&(this._ensureNodeInDOM(t.parentNode,e,i-1),this._insertNodeInDOM(t,i),t.rendered)){var o=t.$node;if(!o.is(".showing")){o.addClass("showing"),o.removeClass("hiding");var n=this;e&&(o.data("oldStyle",o.attr("style")),o.setVisible(!1),o.stop().slideDown({duration:250,start:n.startAnimationFunc,complete:function(){n.runningAnimationsFinishFunc();var t=o.data("oldStyle");t&&(o.removeData("oldStyle"),o.attrOrRemove("style",t))}}))}}},t.Tree.prototype.hideNode=function(t,e,i){if(t.attached){this.viewRangeDirty=!0;var o=this,n=t.$node;n&&(n.is(".hiding")||(n.addClass("hiding"),n.removeClass("showing"),e?(this._renderViewportBlocked=!0,n.data("oldStyle",n.attr("style")),n.stop().slideUp({duration:250,start:o.startAnimationFunc,complete:function(){o.runningAnimationsFinishFunc(),n.detach(),t.attached=!1;var e=n.data("oldStyle");e&&(n.removeData("oldStyle"),n.attrOrRemove("style",e))}})):i||(n.detach(),t.attached=!1,o.invalidateLayoutTree())))}},t.Tree.prototype._nodesToIds=function(t){return t.map(function(t){return t.id})},t.Tree.prototype._nodesByIds=function(t){return t.map(function(t){return this.nodesMap[t]}.bind(this))},t.Tree.prototype._nodeById=function(t){return this.nodesMap[t]},t.Tree.prototype.hasNode=function(t){return!!this._nodeById(t.id)},t.Tree.prototype._onNodeDoubleClick=function(t){var i=e(t.currentTarget),o=i.data("node"),n=!i.hasClass("expanded");this.isBreadcrumbStyleActive()||(this.trigger("nodeAction",{node:o}),this.setNodeExpanded(o,n,{lazy:!1}))},t.Tree.prototype._onNodeControlMouseDown=function(t){if(this._doubleClickSupport.mousedown(t),this._doubleClickSupport.doubleClicked())return!1;var i=e(t.currentTarget).parent(),o=i.data("node"),n=!i.hasClass("expanded"),r={lazy:!1};if(i.hasClass("lazy")){if(!t.ctrlKey&&!t.shiftKey)return this.expandNode(o,r),!1;n=!1,r.collapseChildNodes=!0}return this._onNodeControlMouseDownDoFocus(),this.selectNodes(o),this.setNodeExpanded(o,n,r),e.suppressEvent(t),!0},t.Tree.prototype._onNodeControlMouseDownDoFocus=function(){this.session.focusManager.requestFocus(this.$container)},t.Tree.prototype._onNodeControlMouseUp=function(t){return!1},t.Tree.prototype._onNodeControlDoubleClick=function(t){return!1},t.Tree.prototype._onContextMenu=function(t){this._showContextMenu(t)},t.Tree.prototype.changeNode=function(t){this._applyFiltersForNode(t)&&(t.isFilterAccepted()?this._addToVisibleFlatList(t,!1):this._removeFromFlatList(t,!1)),this.rendered&&this._decorateNode(t),this.trigger("nodeChanged",{node:t})},t.Tree.collectSubtree=function(t,o){if(!t)return e();for(var n=parseFloat(t.attr("data-level")),r=t.next();r.length>0;){var s=parseFloat(r.attr("data-level"));if(isNaN(s)||s<=n)break;r=r.next()}var a=t.nextUntil(r);return(o===i||o)&&(a=a.add(t)),a},t.Tree.visitNodes=function(e,i,o){var n,r;if(e)for(n=0;n<e.length;n++){r=e[n];var s=i(r,o);!s&&r.childNodes.length>0&&t.Tree.visitNodes(r.childNodes,i,r)}},t.TreeAdapter=function(){t.TreeAdapter.parent.call(this),this._addAdapterProperties(["menus","keyStrokes"]),this._addRemoteProperties(["displayStyle"])},t.inherits(t.TreeAdapter,t.ModelAdapter),t.TreeAdapter.prototype._sendNodesSelected=function(t,e){var i={nodeIds:t};this._send("nodesSelected",i,{delay:e?250:0,coalesce:function(t){return this.id===t.id&&this.type===t.type}})},t.TreeAdapter.prototype._onWidgetNodeClicked=function(t){this._send("nodeClicked",{nodeId:t.node.id})},t.TreeAdapter.prototype._onWidgetNodeAction=function(t){this._send("nodeAction",{nodeId:t.node.id})},t.TreeAdapter.prototype._onWidgetNodesSelected=function(t){var e=this.widget._nodesToIds(this.widget.selectedNodes);this._sendNodesSelected(e,t.debounce)},t.TreeAdapter.prototype._onWidgetNodeExpanded=function(t){this._send("nodeExpanded",{nodeId:t.node.id,expanded:t.expanded,expandedLazy:t.expandedLazy})},t.TreeAdapter.prototype._onWidgetNodesChecked=function(t){this._sendNodesChecked(t.nodes)},t.TreeAdapter.prototype._sendNodesChecked=function(t){for(var e={nodes:[]},i=0;i<t.length;i++)e.nodes.push({nodeId:t[i].id,checked:t[i].checked});this._send("nodesChecked",e)},t.TreeAdapter.prototype._onWidgetEvent=function(e){"nodesSelected"===e.type?this._onWidgetNodesSelected(e):"nodeClicked"===e.type?this._onWidgetNodeClicked(e):"nodeAction"===e.type?this._onWidgetNodeAction(e):"nodeExpanded"===e.type?this._onWidgetNodeExpanded(e):"nodesChecked"===e.type?this._onWidgetNodesChecked(e):t.TreeAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.TreeAdapter.prototype.onModelAction=function(e){"nodesInserted"===e.type?this._onNodesInserted(e.nodes,e.commonParentNodeId):"nodesUpdated"===e.type?this._onNodesUpdated(e.nodes):"nodesDeleted"===e.type?this._onNodesDeleted(e.nodeIds,e.commonParentNodeId):"allChildNodesDeleted"===e.type?this._onAllChildNodesDeleted(e.commonParentNodeId):"nodesSelected"===e.type?this._onNodesSelected(e.nodeIds):"nodeExpanded"===e.type?this._onNodeExpanded(e.nodeId,e):"nodeChanged"===e.type?this._onNodeChanged(e.nodeId,e):"nodesChecked"===e.type?this._onNodesChecked(e.nodes):"childNodeOrderChanged"===e.type?this._onChildNodeOrderChanged(e.childNodeIds,e.parentNodeId):"requestFocus"===e.type?this._onRequestFocus():"scrollToSelection"===e.type?this._onScrollToSelection():t.TreeAdapter.parent.prototype.onModelAction.call(this,e)},t.TreeAdapter.prototype._onNodesInserted=function(t,e){var o;if(null!==e&&e!==i&&(o=this.widget.nodesMap[e],!o))throw new Error("Parent node could not be found. Id: "+e);this.widget.insertNodes(t,o)},t.TreeAdapter.prototype._onNodesUpdated=function(t){this.widget.updateNodes(t)},t.TreeAdapter.prototype._onNodesDeleted=function(t,e){var o;if(null!==e&&e!==i&&(o=this.widget.nodesMap[e],!o))throw new Error("Parent node could not be found. Id: "+e);var n=this.widget._nodesByIds(t);this.widget.deleteNodes(n,o)},t.TreeAdapter.prototype._onAllChildNodesDeleted=function(t){var e;if(null!==t&&t!==i&&(e=this.widget.nodesMap[t],!e))throw new Error("Parent node could not be found. Id: "+t);this.widget.deleteAllChildNodes(e)},t.TreeAdapter.prototype._onNodesSelected=function(e){this.addFilterForWidgetEvent(function(i){return"nodesSelected"===i.type&&t.arrays.equals(e,this.widget._nodesToIds(this.widget.selectedNodes))}.bind(this));var i=this.widget._nodesByIds(e);this.widget.selectNodes(i)},t.TreeAdapter.prototype._onNodeExpanded=function(t,e){var i=this.widget.nodesMap[t],o={lazy:e.expandedLazy};this.addFilterForWidgetEvent(function(i){return"nodeExpanded"===i.type&&t===i.node.id&&e.expanded===i.expanded&&e.expandedLazy===i.expandedLazy}.bind(this)),this.widget.setNodeExpanded(i,e.expanded,o),e.recursive&&this.widget.setNodeExpandedRecursive(i.childNodes,e.expanded,o)},t.TreeAdapter.prototype._onNodeChanged=function(e,i){var o=this.widget.nodesMap[e];t.defaultValues.applyTo(i,"TreeNode"),o.text=i.text,o.cssClass=i.cssClass,o.iconId=i.iconId,o.tooltipText=i.tooltipText,o.foregroundColor=i.foregroundColor,o.backgroundColor=i.backgroundColor,o.font=i.font,this.widget.changeNode(o)},t.TreeAdapter.prototype._onNodesChecked=function(t){var e=[],i=[];t.forEach(function(t){var o=this.widget._nodeById(t.id);t.checked?e.push(o):i.push(o)},this),this.addFilterForWidgetEventType("nodesChecked"),this.widget.checkNodes(e,{checked:!0,checkOnlyEnabled:!1,checkChildren:!1}),this.widget.uncheckNodes(i,{checkOnlyEnabled:!1,checkChildren:!1})},t.TreeAdapter.prototype._onChildNodeOrderChanged=function(t,e){var i=this.widget._nodeById([e]),o=this.widget._nodesByIds(t);this.widget.updateNodeOrder(o,i)},t.TreeAdapter.prototype._onRequestFocus=function(){this.widget.requestFocus()},t.TreeAdapter.prototype._onScrollToSelection=function(){this.widget.revealSelection()},t.TreeNode=function(){this.$node,this.attached=!1,this.checked=!1,this.childNodes=[],this.childrenLoaded=!1,this.enabled=!0,this.expanded=!1,this.expandedLazy=!1,this.filterAccepted=!0,this.filterDirty,this.id,this.initialized,this.lazyExpandingEnabled=!1,this.leaf=!1,this.level=0,this.parentNode,this.destroyed=!1,this.rendered=!1,this.text,this._loadChildrenPromise=!1},t.TreeNode.prototype.init=function(e){this._init(e),t.texts.resolveTextProperty(this,"text",this.parent.session)},t.TreeNode.prototype.destroy=function(){this.destroyed||(this._destroy(),this.destroyed=!0)},t.TreeNode.prototype._destroy=function(){},t.TreeNode.prototype.getTree=function(){return this.parent},t.TreeNode.prototype._init=function(i){t.assertParameter("parent",i.parent,t.Tree),this.session=i.session||i.parent.session,e.extend(this,i),t.defaultValues.applyTo(this),this.hasChildNodes()&&this.getTree()._ensureTreeNodes(this.childNodes)},t.TreeNode.prototype.hasChildNodes=function(){return this.childNodes.length>0},t.TreeNode.prototype.reset=function(){this.$node&&(this.$node.remove(),delete this.$node),this.rendered=!1,this.attached=!1},t.TreeNode.prototype.isChildOf=function(t){return t===this.parentNode||!!this.parentNode&&this.parentNode.isChildOf(t)},t.TreeNode.prototype.isFilterAccepted=function(t){return(this.filterDirty||t)&&this.getTree()._applyFiltersForNode(this),this.filterAccepted},t.TreeNode.prototype.loadChildren=function(){return e.resolvedDeferred()},t.TreeNode.prototype.ensureLoadChildren=function(){if(this.childrenLoaded)return e.resolvedPromise();if(this._loadChildrenPromise)return this._loadChildrenPromise;var t=this.loadChildren(),i=t.promise();return"resolved"===t.state()?(this._loadChildrenPromise=null,i):(this._loadChildrenPromise=i,i.done(this._onLoadChildrenDone.bind(this)),i)},t.TreeNode.prototype._onLoadChildrenDone=function(){this._loadChildrenPromise=null},t.TreeNode.prototype.setText=function(t){this.text=t},t.TreeLayout=function(e){t.TreeLayout.parent.call(this),this.tree=e},t.inherits(t.TreeLayout,t.AbstractLayout),t.TreeLayout.prototype.layout=function(e){var i=this.tree.htmlComp;i.isAttachedAndVisible()&&i.$comp.isEveryParentVisible()&&(this._layout(e),t.scrollbars.update(this.tree.$data))},t.TreeLayout.prototype._layout=function(e){var i,o,n,r=this.tree.menuBar,s=r.htmlComp,a=this.tree.htmlComp;o=a.getAvailableSize().subtract(a.getInsets()),this.tree.autoToggleBreadcrumbStyle&&this.tree.setBreadcrumbStyleActive(o.width<=this.tree.breadcrumbTogglingThreshold),n=0,r.$container.isVisible()&&(i=t.MenuBarLayout.size(s,o),s.setSize(i),n+=i.height),this._setDataHeight(n),a.size&&a.size.width!==a.getSize().width&&(this.tree.isHorizontalScrollingEnabled()?(this.tree.nodeWidthDirty=!0,this.tree.maxNodeWidth=0):(this.tree.updateNodeHeights(),this.tree._renderFiller())),this.tree.setViewRangeSize(this.tree.calculateViewRangeSize()),this.tree._renderScrollTop(),this.tree._renderViewport()},t.TreeLayout.prototype._setDataHeight=function(t){var e=this.tree.$data;t+=e.cssMarginTop()+e.cssMarginBottom(),e.css("height",0===t?"100%":"calc(100% - "+t+"px)")},t.TreeLayout.prototype.preferredLayoutSize=function(e){return this.tree._renderViewport(),t.graphics.prefSize(e)},t.LazyNodeFilter=function(t){this.tree=t},t.LazyNodeFilter.prototype.accept=function(t){if(!t.expanded&&t.parentNode&&t.parentNode.expandedLazy&&t.parentNode.lazyExpandingEnabled&&this.tree.lazyExpandingEnabled){for(var e=0;e<this.tree.selectedNodes.length;e++){var i=this.tree.selectedNodes[e];if("string"==typeof i)break;if(i===t||i.isChildOf(t))return!0}return!1}return!0},t.TreeBreadcrumbFilter=function(t){this.tree=t},t.TreeBreadcrumbFilter.prototype.accept=function(t){return 0===this.tree.selectedNodes.length?t.parentNode===i:this.tree.isNodeInBreadcrumbVisible(t)},t.AbstractTreeNavigationKeyStroke=function(e,i){t.AbstractTreeNavigationKeyStroke.parent.call(this),this.field=e,this.repeatable=!0,this.stopPropagation=!0,this.renderingHints.hAlign=t.hAlign.RIGHT,this.ctrl=t.keyStrokeModifier.isCtrl(i),this.shift=t.keyStrokeModifier.isShift(i),this.alt=t.keyStrokeModifier.isAlt(i),this.keyStrokeMode=t.KeyStrokeMode.DOWN},t.inherits(t.AbstractTreeNavigationKeyStroke,t.KeyStroke),t.AbstractTreeNavigationKeyStroke.prototype._accept=function(e){var i=t.AbstractTreeNavigationKeyStroke.parent.prototype._accept.call(this,e);return!!i&&(this.field.selectedNodes.length>0&&(e._treeCurrentNode=this.field.selectedNodes[0],e._$treeCurrentNode=e._treeCurrentNode.$node),!0)},t.AbstractTreeNavigationKeyStroke.prototype.handle=function(t){var e=this._computeNewSelection(t._treeCurrentNode);e&&this.selectNodesAndReveal(e,!0)},t.AbstractTreeNavigationKeyStroke.prototype._computeNewSelection=function(t){return[]},t.AbstractTreeNavigationKeyStroke.prototype.selectNodesAndReveal=function(t,e){this.field.selectNodes(t,e),this.field.revealSelection()},t.TreeSpaceKeyStroke=function(e){t.TreeSpaceKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.SPACE],this.renderingHints.render=!1},t.inherits(t.TreeSpaceKeyStroke,t.KeyStroke),t.TreeSpaceKeyStroke.prototype._accept=function(e){var i=t.TreeSpaceKeyStroke.parent.prototype._accept.call(this,e);return i&&this.field.checkable&&this.field.selectedNodes.length>0},t.TreeSpaceKeyStroke.prototype.handle=function(t){var e=this.field.selectedNodes,i=e[0].checked;e.forEach(function(t){this.field.checkNode(t,!i)},this)},t.TreeNavigationUpKeyStroke=function(e,i){t.TreeNavigationUpKeyStroke.parent.call(this,e,i),this.which=[t.keys.UP],this.renderingHints.text="↑",this.renderingHints.$drawingArea=function(t,e){var i=this._computeNewSelection(e._treeCurrentNode);if(i)return i.$node}.bind(this)},t.inherits(t.TreeNavigationUpKeyStroke,t.AbstractTreeNavigationKeyStroke),t.TreeNavigationUpKeyStroke.prototype._computeNewSelection=function(e){var i=this.field.visibleNodesFlat;if(0!==i.length)return e?i[i.indexOf(e)-1]:t.arrays.last(i)},t.TreeNavigationDownKeyStroke=function(e,i){t.TreeNavigationDownKeyStroke.parent.call(this,e,i),this.which=[t.keys.DOWN],this.renderingHints.text="↓",this.renderingHints.$drawingArea=function(t,e){var i=this._computeNewSelection(e._treeCurrentNode);if(i)return i.$node}.bind(this)},t.inherits(t.TreeNavigationDownKeyStroke,t.AbstractTreeNavigationKeyStroke),t.TreeNavigationDownKeyStroke.prototype._computeNewSelection=function(t){var e=this.field.visibleNodesFlat;if(0!==e.length)return t?e[e.indexOf(t)+1]:e[0]},t.TreeNavigationEndKeyStroke=function(e,i){t.TreeNavigationEndKeyStroke.parent.call(this,e,i),this.which=[t.keys.END],this.renderingHints.$drawingArea=function(t,e){var i=this._computeNewSelection(e._treeCurrentNode);if(i)return i.$node}.bind(this)},t.inherits(t.TreeNavigationEndKeyStroke,t.AbstractTreeNavigationKeyStroke),t.TreeNavigationEndKeyStroke.prototype.handle=function(t){var e=this._computeNewSelection(t._treeCurrentNode);e&&this.selectNodesAndReveal(e)},t.TreeNavigationEndKeyStroke.prototype._computeNewSelection=function(e){var i=this.field.visibleNodesFlat;if(0!==i.length)return t.arrays.last(i)},t.TreeCollapseAllKeyStroke=function(e,i){t.TreeCollapseAllKeyStroke.parent.call(this,e,i),this.which=[t.keys.HOME],this.renderingHints.hAlign=t.hAlign.RIGHT,this.renderingHints.$drawingArea=function(t,e){if(this.field.visibleNodesFlat.length>0)return this.field.visibleNodesFlat[0].$node}.bind(this)},t.inherits(t.TreeCollapseAllKeyStroke,t.AbstractTreeNavigationKeyStroke),t.TreeCollapseAllKeyStroke.prototype.handle=function(t){this.field.collapseAll(),this.field.visibleNodesFlat.length>0&&this.selectNodesAndReveal(this.field.visibleNodesFlat[0])},t.TreeCollapseOrDrillUpKeyStroke=function(e,i){t.TreeCollapseOrDrillUpKeyStroke.parent.call(this,e,i),this.which=[t.keys.SUBTRACT],this.renderingHints.text="-",this.renderingHints.$drawingArea=function(t,e){var i=e._treeCurrentNode;return i.expanded?i.$node:i.parentNode?i.parentNode.$node:void 0}.bind(this)},t.inherits(t.TreeCollapseOrDrillUpKeyStroke,t.AbstractTreeNavigationKeyStroke),t.TreeCollapseOrDrillUpKeyStroke.prototype._accept=function(e){var i=t.TreeCollapseOrDrillUpKeyStroke.parent.prototype._accept.call(this,e),o=e._treeCurrentNode;return i&&o&&(o.expanded||o.parentNode)},t.TreeCollapseOrDrillUpKeyStroke.prototype.handle=function(t){var e=t._treeCurrentNode;e.expanded?this.field.collapseNode(e):e.parentNode&&this.selectNodesAndReveal(e.parentNode,!0)},t.TreeExpandOrDrillDownKeyStroke=function(e,i){t.TreeExpandOrDrillDownKeyStroke.parent.call(this,e,i),this.which=[t.keys.ADD],this.renderingHints.text="+",this.renderingHints.$drawingArea=function(t,e){var i=e._treeCurrentNode;return this.isNodeExpandable(i)?i.$node:i.childNodes.length>0?i.childNodes[0].$node:void 0}.bind(this)},t.inherits(t.TreeExpandOrDrillDownKeyStroke,t.AbstractTreeNavigationKeyStroke),t.TreeExpandOrDrillDownKeyStroke.prototype._accept=function(e){var i=t.TreeExpandOrDrillDownKeyStroke.parent.prototype._accept.call(this,e),o=e._treeCurrentNode;return i&&o&&(this.isNodeExpandable(o)||o.childNodes.length>0)},t.TreeExpandOrDrillDownKeyStroke.prototype.isNodeExpandable=function(t){return!t.expanded&&!t.leaf},t.TreeExpandOrDrillDownKeyStroke.prototype.handle=function(t){var e=t._treeCurrentNode;this.isNodeExpandable(e)?this.field.expandNode(e,{lazy:!1}):e.childNodes.length>0&&this.selectNodesAndReveal(e.childNodes[0],!0)},t.CompactTree=function(){t.CompactTree.parent.call(this),this.$nodesContainer,this._scrolldirections="y"},t.inherits(t.CompactTree,t.Tree),t.CompactTree.prototype._initTreeKeyStrokeContext=function(){this.keyStrokeContext.registerKeyStroke([new t.CompactTreeUpKeyStroke(this),new t.CompactTreeDownKeyStroke(this),new t.CompactTreeLeftKeyStroke(this),new t.CompactTreeRightKeyStroke(this)])},t.CompactTree.prototype._render=function(e){this.$container=e.appendDiv("compact-tree");var i=new t.TreeLayout(this);this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(i),this.$data=this.$container.appendDiv("tree-data"),t.scrollbars.install(this.$data,{parent:this,borderless:!0}),this.menuBar=t.create("MenuBar",{parent:this,menuOrder:new t.MenuItemsOrder(this.session,"Tree")}),this.menuBar.render(this.$container),this.$nodesContainer=this.$data.appendDiv("nodes"),this._updateNodeDimensions(),this._renderViewport(),this.invalidateLayoutTree()},t.CompactTree.prototype._calculateCurrentViewRange=function(){return this.viewRangeSize=this.visibleNodesFlat.length,new t.Range(0,Math.max(this.visibleNodesFlat.length,0))},t.CompactTree.prototype.calculateViewRangeSize=function(){return this.visibleNodesFlat.length},t.CompactTree.prototype._remove=function(){t.scrollbars.uninstall(this.$data,this.session),t.CompactTree.parent.prototype._remove.call(this)},t.CompactTree.prototype._$buildNode=function(t){if(0===t.level){var e=this.$container.makeDiv("section expanded").data("node",t);e.appendDiv("title").text(t.text),t.$node=e}else{var i=t.parentNode.$node,o=i.makeDiv("section-node").data("node",t).on("mousedown",this._onNodeMouseDown.bind(this)).on("mouseup",this._onNodeMouseUp.bind(this));t.$node=o}return t.$node},t.CompactTree.prototype._insertNodeInDOMAtPlace=function(t,e){var i,o=this.visibleNodesFlat[e-1];if(o)if(o.level<t.level)t.$node.insertAfter(o.$node.children()[0]);else{i=o.$node;for(var n=0;n<o.level-t.level;n++)i=i.parent();t.$node.insertAfter(i)}else t.$node.prependTo(this.$nodesContainer)},t.CompactTree.prototype._decorateNode=function(e){var i,o=e.$node;o&&(o.hasClass("section")?(o=o.children("title"),i="title"):(i="section-node",o.isSelected()&&(i+=" selected")),o.removeClass(),o.addClass(i),o.addClass(e.cssClass),o.text(e.text),t.styles.legacyStyle(e,o),t.strings.hasText(e.tooltipText)&&o.attr("title",e.tooltipText))},t.CompactTree.prototype.selectNodes=function(e){var i=[];e=t.arrays.ensure(e),e.forEach(function(t){var e=t.$node;e.hasClass("section-node")||(t=e.children(".section-node").first().data("node")),t&&i.push(t)},this),t.CompactTree.parent.prototype.selectNodes.call(this,i)},t.CompactTree.prototype._renderExpansion=function(t){},t.CompactTree.prototype._updateItemPath=function(){},t.AbstractCompactTreeControlKeyStroke=function(e){t.AbstractCompactTreeControlKeyStroke.parent.call(this),this.repeatable=!0,this.field=e,this.keyStrokeMode=t.KeyStrokeMode.DOWN},t.inherits(t.AbstractCompactTreeControlKeyStroke,t.KeyStroke),t.AbstractCompactTreeControlKeyStroke.prototype._accept=function(e){var i=t.AbstractCompactTreeControlKeyStroke.parent.prototype._accept.call(this,e);if(!i)return!1;if(!this.field.nodes||!this.field.nodes.length)return!1;var o=this.field.$nodesContainer.find(".section-node.selected"),n=o.data("node"),r=this._findNextNode(o,n);return!!r&&(e._nextNode=r,!0)},t.AbstractCompactTreeControlKeyStroke.prototype.handle=function(t){this.field.selectNodes(t._nextNode),this.field.checkNode(t._nextNode,!0)},t.AbstractCompactTreeControlKeyStroke.prototype._findNextNode=function(t,e){throw new Error("method must be overwritten by subclass")},t.CompactTreeUpKeyStroke=function(e){t.CompactTreeUpKeyStroke.parent.call(this,e),this.which=[t.keys.UP],this.renderingHints.text="↑"},t.inherits(t.CompactTreeUpKeyStroke,t.AbstractCompactTreeControlKeyStroke),t.CompactTreeUpKeyStroke.prototype._findNextNode=function(e,i){return i?e.prev(".section-node").data("node")||e.parent().prev(".section").children(".section-node").last().data("node"):t.arrays.last(t.arrays.last(this.field.nodes).childNodes)},t.CompactTreeDownKeyStroke=function(e){t.CompactTreeDownKeyStroke.parent.call(this,e),this.which=[t.keys.DOWN],this.renderingHints.text="↓"},t.inherits(t.CompactTreeDownKeyStroke,t.AbstractCompactTreeControlKeyStroke),t.CompactTreeDownKeyStroke.prototype._findNextNode=function(e,i){return i?e.next(".section-node").data("node")||e.parent().next(".section").children(".section-node").first().data("node"):t.arrays.first(t.arrays.first(this.field.nodes).childNodes)},t.CompactTreeLeftKeyStroke=function(e){t.CompactTreeLeftKeyStroke.parent.call(this,e),this.renderingHints.text="←",this.which=[t.keys.LEFT]},t.inherits(t.CompactTreeLeftKeyStroke,t.AbstractCompactTreeControlKeyStroke),t.CompactTreeLeftKeyStroke.prototype._findNextNode=function(t,e){return t.parent().prev(".section").children(".section-node").first().data("node")||t.parent().children(".section-node").not(t).first().data("node")},t.CompactTreeRightKeyStroke=function(e){t.CompactTreeRightKeyStroke.parent.call(this,e),this.renderingHints.text="→",this.which=[t.keys.RIGHT]},t.inherits(t.CompactTreeRightKeyStroke,t.AbstractCompactTreeControlKeyStroke),t.CompactTreeRightKeyStroke.prototype._findNextNode=function(t,e){return t.parent().next(".section").children(".section-node").first().data("node")},t.Desktop=function(){t.Desktop.parent.call(this),this.desktopStyle=t.Desktop.DisplayStyle.DEFAULT,this.benchVisible=!0,this.headerVisible=!0,this.navigationVisible=!0,this.navigationHandleVisible=!0,this.menus=[],this.addOns=[],this.dialogs=[],this.views=[],this.viewButtons=[],this.messageBoxes=[],this.fileChoosers=[],this.navigation,this.header,this.bench,this.splitter,this.formController,this.messageBoxController,this.fileChooserController,this.initialFormRendering=!1,this.offline=!1,this.notifications=[],this.inBackground=!1,this.geolocationServiceAvailable=t.device.supportsGeolocation(),this._addAdapterProperties(["activeForm","viewButtons","menus","views","dialogs","outline","messageBoxes","fileChoosers","addOns","keyStrokes"]),this._benchActiveViewChangedHandler=this._onBenchActivateViewChanged.bind(this)},t.inherits(t.Desktop,t.Widget),t.Desktop.DisplayStyle={DEFAULT:"default",BENCH:"bench",COMPACT:"compact"},t.Desktop.prototype._init=function(e){t.Desktop.parent.prototype._init.call(this,e),this.formController=new t.DesktopFormController(this,this.session),this.messageBoxController=new t.MessageBoxController(this,this.session),this.fileChooserController=new t.FileChooserController(this,this.session),this._resizeHandler=this.onResize.bind(this),this._popstateHandler=this.onPopstate.bind(this),this.updateSplitterVisibility(),this.resolveTextKeys(["title"]),this._syncViewButtons(this.viewButtons),this._syncMenus(this.menus)},t.Desktop.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.Desktop.prototype._initKeyStrokeContext=function(){t.Desktop.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke(new t.DesktopKeyStroke(this.session)),this.keyStrokeContext.registerKeyStroke(new t.DisableBrowserTabSwitchingKeyStroke(this))},t.Desktop.prototype._onBenchActivateViewChanged=function(e){if(!this.initialFormRendering){var i=e.view;i instanceof t.Form&&this.bench.outlineContent!==i&&!i.detailForm&&this._setFormActivated(i)}},t.Desktop.prototype._render=function(e){this.$container=e,this.$container.addClass("desktop"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.$overlaySeparator=this.$container.appendDiv("overlay-separator").setVisible(!1),this._renderNavigationVisible(),this._renderHeaderVisible(),this._renderBenchVisible(),this._renderTitle(),this._renderLogoUrl(),this._renderSplitterVisible(),this._renderInBackground(),this._renderDisplayStyle(),this.addOns.forEach(function(t){t.render(this.$container)},this),this.$container.window().on("resize",this._resizeHandler).on("popstate",this._popstateHandler),this._setupDragAndDrop(),this._disableContextMenu()},t.Desktop.prototype._remove=function(){this.formController.remove(),this.messageBoxController.remove(),this.fileChooserController.remove(),this.$container.window().off("resize",this._resizeHandler).off("popstate",this._popstateHandler),t.Desktop.parent.prototype._remove.call(this)},t.Desktop.prototype._postRender=function(){t.Desktop.parent.prototype._postRender.call(this),this.initialFormRendering=!0,this.formController.render(),this.messageBoxController.render(),this.fileChooserController.render(),this._renderDisplayChildsOfOutline(),this.initialFormRendering=!1},t.Desktop.prototype._renderDisplayStyle=function(){var e=t.Desktop.DisplayStyle,i=this.displayStyle===e.COMPACT;this.header&&(this.header.setToolBoxVisible(!i),this.header.animateRemoval=i),this.navigation&&(this.navigation.setToolBoxVisible(i),this.navigation.htmlComp.layoutData.fullWidth=i),this.bench&&this.bench.setOutlineContentVisible(!i),this.outline&&(this.outline.setCompact(i),this.outline.setEmbedDetailContent(i)),this.invalidateLayoutTree()},t.Desktop.prototype._createLayout=function(){return new t.DesktopLayout(this)},t.Desktop.prototype._renderDisplayChildsOfOutline=function(){this.outline&&(this.outline.formController.render(),this.outline.messageBoxController.render(),this.outline.fileChooserController.render())},t.Desktop.prototype._removeDisplayChildsOfOutline=function(){this.outline&&(this.outline.formController.remove(),this.outline.messageBoxController.remove(),this.outline.fileChooserController.remove())},t.Desktop.prototype._renderTitle=function(){var t=this.title;if(t!==i&&null!==t){var o=e("div.scout");o.length<=1&&(o.document(!0).title=t)}},t.Desktop.prototype._renderActiveForm=function(){},t.Desktop.prototype._renderBench=function(){this.bench||(this.bench=t.create("DesktopBench",{parent:this,animateRemoval:!0,headerTabArea:this.header?this.header.tabArea:i,outlineContentVisible:this.displayStyle!==t.Desktop.DisplayStyle.COMPACT}),this.bench.on("viewActivated",this._benchActiveViewChangedHandler),this.bench.render(this.$container),this.bench.$container.insertBefore(this.$overlaySeparator),this.invalidateLayoutTree())},t.Desktop.prototype._removeBench=function(){this.bench&&(this.bench.off("viewActivated",this._benchActiveViewChangedHandler),this.bench.on("destroy",function(){this.bench=null,this.invalidateLayoutTree()}.bind(this)),this.bench.destroy());
},t.Desktop.prototype._renderBenchVisible=function(){this.animateLayoutChange=this.rendered,this.benchVisible?(this._renderBench(),this._renderInBackground()):this._removeBench()},t.Desktop.prototype._renderNavigation=function(){this.navigation||(this.navigation=t.create("DesktopNavigation",{parent:this,outline:this.outline,toolBoxVisible:this.displayStyle===t.Desktop.DisplayStyle.COMPACT,layoutData:{fullWidth:this.displayStyle===t.Desktop.DisplayStyle.COMPACT}}),this.navigation.render(this.$container),this.navigation.$container.prependTo(this.$container),this.invalidateLayoutTree())},t.Desktop.prototype._removeNavigation=function(){this.navigation&&(this.navigation.destroy(),this.navigation=null,this.invalidateLayoutTree())},t.Desktop.prototype._renderNavigationVisible=function(){this.animateLayoutChange=this.rendered,this.navigationVisible?this._renderNavigation():this.animateLayoutChange?this.invalidateLayoutTree():this._removeNavigation()},t.Desktop.prototype._renderHeader=function(){this.header||(this.header=t.create("DesktopHeader",{parent:this,animateRemoval:this.displayStyle===t.Desktop.DisplayStyle.COMPACT,toolBoxVisible:this.displayStyle!==t.Desktop.DisplayStyle.COMPACT}),this.header.render(this.$container),this.header.$container.insertBefore(this.$overlaySeparator),this.invalidateLayoutTree())},t.Desktop.prototype._removeHeader=function(){this.header&&(this.header.on("destroy",function(){this.invalidateLayoutTree(),this.header=null}.bind(this)),this.header.destroy())},t.Desktop.prototype._renderHeaderVisible=function(){this.headerVisible?this._renderHeader():this._removeHeader()},t.Desktop.prototype._renderLogoUrl=function(){this.header&&this.header.setLogoUrl(this.logoUrl)},t.Desktop.prototype._renderSplitterVisible=function(){this.splitterVisible?this._renderSplitter():this._removeSplitter()},t.Desktop.prototype._renderSplitter=function(){!this.splitter&&this.navigation&&(this.splitter=t.create("Splitter",{parent:this,$anchor:this.navigation.$container,$root:this.$container}),this.splitter.render(this.$container),this.splitter.$container.insertBefore(this.$overlaySeparator),this.splitter.on("move",this._onSplitterMove.bind(this)),this.splitter.on("moveEnd",this._onSplitterMoveEnd.bind(this)),this.splitter.on("positionChanged",this._onSplitterPositionChanged.bind(this)),this.updateSplitterPosition())},t.Desktop.prototype._removeSplitter=function(){this.splitter&&(this.splitter.destroy(),this.splitter=null)},t.Desktop.prototype._renderInBackground=function(){this.bench&&this.bench.$container.toggleClass("drop-shadow",this.inBackground)},t.Desktop.prototype._renderBrowserHistoryEntry=function(){if(t.device.supportsHistoryApi()){var e=this.$container.window(!0),i=this.browserHistoryEntry;e.history.pushState({deepLinkPath:i.deepLinkPath},i.title,i.path)}},t.Desktop.prototype._setupDragAndDrop=function(){var t=function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="none"};this.$container.on("dragenter",t),this.$container.on("dragover",t),this.$container.on("drop",function(t){t.stopPropagation(),t.preventDefault()})},t.Desktop.prototype.updateSplitterVisibility=function(){this.setSplitterVisible(this.navigationVisible&&this.benchVisible&&this.displayStyle!==t.Desktop.DisplayStyle.COMPACT)},t.Desktop.prototype.setSplitterVisible=function(t){this.setProperty("splitterVisible",t)},t.Desktop.prototype.updateSplitterPosition=function(){if(this.splitter){var t=this.cacheSplitterPosition&&sessionStorage.getItem("scout:desktopSplitterPosition");if(t){var e=parseInt(t,10);this.splitter.setPosition(e),this.invalidateLayoutTree()}else this.splitter.setPosition(),this.invalidateLayoutTree()}},t.Desktop.prototype._disableContextMenu=function(){this.$container.on("contextmenu",function(t){"INPUT"===t.target.nodeName||"TEXTAREA"===t.target.nodeName||t.target.isContentEditable||t.preventDefault()})},t.Desktop.prototype.setOutline=function(t){this.rendered&&this._removeDisplayChildsOfOutline(),this.outline=t,this._setOutlineActivated(),this.navigation&&this.navigation.setOutline(this.outline),this.trigger("outlineChanged"),this.rendered&&(this._renderDisplayChildsOfOutline(),this._renderDisplayStyle())},t.Desktop.prototype._syncViewButtons=function(t){this.updateKeyStrokes(t,this.viewButtons),this._setProperty("viewButtons",t)},t.Desktop.prototype._syncMenus=function(t){this.updateKeyStrokes(t,this.menus),this._setProperty("menus",t)},t.Desktop.prototype.setMenus=function(t){this.header&&this.header.setMenus(t)},t.Desktop.prototype.setNavigationHandleVisible=function(t){this.setProperty("navigationHandleVisible",t)},t.Desktop.prototype.setNavigationVisible=function(t){this.setProperty("navigationVisible",t),this.updateSplitterVisibility()},t.Desktop.prototype.setBenchVisible=function(t){this.setProperty("benchVisible",t),this.updateSplitterVisibility()},t.Desktop.prototype.setHeaderVisible=function(t){this.setProperty("headerVisible",t)},t.Desktop.prototype.outlineDisplayStyle=function(){if(this.outline)return this.outline.displayStyle},t.Desktop.prototype.shrinkNavigation=function(){this.navigationVisible&&this.outlineDisplayStyle()===t.Tree.DisplayStyle.DEFAULT?this.outline.setDisplayStyle(t.Tree.DisplayStyle.BREADCRUMB):this.setNavigationVisible(!1)},t.Desktop.prototype.enlargeNavigation=function(){this.navigationVisible&&this.outlineDisplayStyle()===t.Tree.DisplayStyle.BREADCRUMB?this.outline.setDisplayStyle(t.Tree.DisplayStyle.DEFAULT):(this.setNavigationVisible(!0),this.validateLayoutTree())},t.Desktop.prototype.switchToBench=function(){this.setHeaderVisible(!0),this.setBenchVisible(!0),this.setNavigationVisible(!1)},t.Desktop.prototype.switchToNavigation=function(){this.setNavigationVisible(!0),this.setHeaderVisible(!1),this.setBenchVisible(!1)},t.Desktop.prototype.revalidateHeaderLayout=function(){this.header&&this.header.revalidateLayout()},t.Desktop.prototype.goOffline=function(){this.offline||(this.offline=!0,this._removeOfflineNotification(),this._offlineNotification=t.create("DesktopNotification:Offline",{parent:this}),this._offlineNotification.show())},t.Desktop.prototype.goOnline=function(){this._removeOfflineNotification()},t.Desktop.prototype._removeOfflineNotification=function(){this._offlineNotification&&(setTimeout(this.removeNotification.bind(this,this._offlineNotification),3e3),this._offlineNotification=null)},t.Desktop.prototype.addNotification=function(t){return this.rendered?void(t&&(this.notifications.push(t),this.$notifications?this.$notifications.appendTo(this.$container):this.$notifications=this.$container.appendDiv("notifications"),t.fadeIn(this.$notifications))):void this._postRenderActions.push(this.addNotification.bind(this,t))},t.Desktop.prototype.removeNotification=function(e){if(!this.rendered)return void this._postRenderActions.push(this.removeNotification.bind(this,e));if("string"==typeof e){var i=e;e=t.arrays.find(this.notifications,function(t){return i===t.id})}e&&(this.$notifications?e.fadeOut(this._onNotificationRemoved.bind(this,e)):t.arrays.remove(this.notifications,e))},t.Desktop.prototype.destroyPopupsFor=function(i){this.$container.children(".popup").each(function(o,n){var r=e(n),s=t.Widget.getWidgetFor(r);i.has(s)&&s.destroy()})},t.Desktop.prototype.openUri=function(i,o){return this.rendered?(e.log.debug("(Desktop#openUri) uri="+i+" action="+o),void(i&&(o=o||"open","download"===o?t.device.isIos()?this._openUriAsNewWindow(i):this._openUriInIFrame(i):"open"===o?t.device.isIos()?this._openUriInSameWindow(i):this._openUriInIFrame(i):"newWindow"===o?this._openUriAsNewWindow(i):"sameWindow"===o&&this._openUriInSameWindow(i)))):void this._postRenderActions.push(this.openUri.bind(this,i,o))},t.Desktop.prototype._openUriInSameWindow=function(t){window.location.href=t},t.Desktop.prototype._openUriInIFrame=function(t){var e=this.session.$entryPoint.appendElement("<iframe>","download-frame").attr("tabindex",-1).attr("src",t);setTimeout(function(){e.remove()},1e4)},t.Desktop.prototype._openUriAsNewWindow=function(e){var i=new t.PopupBlockerHandler(this.session),o=i.openWindow(e);o||i.showNotification(e)},t.Desktop.prototype.bringOutlineToFront=function(){return this.rendered?void(this.inBackground&&this.displayStyle!==t.Desktop.DisplayStyle.BENCH&&(this.inBackground=!1,this._setOutlineActivated(),this.navigationVisible&&this.navigation.bringToFront(),this.benchVisible&&this.bench.bringToFront(),this.headerVisible&&this.header.bringToFront(),this._renderInBackground())):void this._postRenderActions.push(this.bringOutlineToFront.bind(this))},t.Desktop.prototype.sendOutlineToBack=function(){this.inBackground||(this.inBackground=!0,this.navigationVisible&&this.navigation.sendToBack(),this.benchVisible&&this.bench.sendToBack(),this.headerVisible&&this.header.sendToBack(),this._renderInBackground())},t.Desktop.prototype.inFront=function(){return!0},t.Desktop.prototype.glassPaneTargets=function(){var t=e.makeArray(this.$container.children().not(".splitter").not(".notifications").not(".overlay-separator"));return this._pushPopupWindowGlassPaneTargets(t),t},t.Desktop.prototype._deferredGlassPaneTarget=function(e){var i=new t.DeferredGlassPaneTarget;return e.one("init",function(){i.ready([e.$container])}),i},t.Desktop.prototype._pushPopupWindowGlassPaneTargets=function(t){this.formController._popupWindows.forEach(function(e){t.push(e.initialized?e.$container[0]:this._deferredGlassPaneTarget(e))},this)},t.Desktop.prototype.showForm=function(t,e,i){e=e||this,this._setFormActivated(t),e.formController.registerAndRender(t,i,!0)},t.Desktop.prototype.hideForm=function(e){if(this.displayStyle===t.Desktop.DisplayStyle.COMPACT&&e.isView()&&this.benchVisible){var i=this.bench.getViews().slice();t.arrays.remove(i,e),0===i.length&&this.switchToNavigation()}e.displayParent.formController.unregisterAndRemove(e)},t.Desktop.prototype.activateForm=function(t){t.displayParent.formController.activateForm(t),this._setFormActivated(t)},t.Desktop.prototype._setOutlineActivated=function(){this._setFormActivated(),this.outline&&this.outline.activateCurrentPage()},t.Desktop.prototype._setFormActivated=function(t){this.rendered&&!this.initialFormRendering&&this.activeForm!==t&&(this.activeForm=t,this.triggerFormActivated(t))},t.Desktop.prototype.triggerFormActivated=function(t){this.trigger("formActivated",{form:t})},t.Desktop.prototype.onLayoutAnimationComplete=function(){this.headerVisible||this._removeHeader(),this.navigationVisible||this._removeNavigation(),this.benchVisible||this._removeBench(),this.trigger("animationEnd"),this.animateLayoutChange=!1},t.Desktop.prototype.onResize=function(t){this.revalidateLayout()},t.Desktop.prototype.onPopstate=function(t){var e=t.originalEvent.state;e&&e.deepLinkPath&&this.trigger("historyEntryActivated",e)};t.Desktop.prototype._onSplitterMove=function(t){this.resizing=!0;var e=Math.floor(this.$container.outerWidth(!0)/2);t.position>e&&t.setPosition(e)};t.Desktop.prototype._onSplitterPositionChanged=function(t){this.revalidateLayout()},t.Desktop.prototype._onSplitterMoveEnd=function(i){function o(t){try{sessionStorage.setItem("scout:desktopSplitterPosition",t)}catch(t){e.log.error('Error while storing "scout:desktopSplitterPosition" in sessionStorage: '+t)}}var n=i.position;this.cacheSplitterPosition&&o(this.splitter.position),n<t.DesktopNavigation.BREADCRUMB_STYLE_WIDTH?this.navigation.$container.animate({width:t.DesktopNavigation.BREADCRUMB_STYLE_WIDTH},{progress:function(){this.resizing=!0,this.splitter.setPosition(),this.revalidateLayout(),this.resizing=!1}.bind(this),complete:function(){this.resizing=!0,this.splitter.setPosition(),o(this.splitter.position),this.revalidateLayout(),this.resizing=!1}.bind(this)}):this.resizing=!1},t.Desktop.prototype._onNotificationRemoved=function(e){t.arrays.remove(this.notifications,e),0===this.notifications.length&&(this.$notifications.remove(),this.$notifications=null)},t.Desktop.prototype.onReconnecting=function(){this.offline&&this._offlineNotification.reconnect()},t.Desktop.prototype.onReconnectingSucceeded=function(){this.offline&&(this.offline=!1,this._offlineNotification.reconnectSucceeded(),this._removeOfflineNotification())},t.Desktop.prototype.onReconnectingFailed=function(){this.offline&&this._offlineNotification.reconnectFailed()},t.Desktop.prototype.dataChange=function(t){this.events.trigger("dataChange",t)},t.DesktopAdapter=function(){t.DesktopAdapter.parent.call(this),this._addAdapterProperties(["activeForm","viewButtons","menus","views","dialogs","outline","messageBoxes","fileChoosers","addOns","keyStrokes"]),this._addRemoteProperties(["benchVisible","navigationVisible","headerVisible","geolocationServiceAvailable"])},t.inherits(t.DesktopAdapter,t.ModelAdapter),t.DesktopAdapter.prototype._goOffline=function(){this.widget.goOffline()},t.DesktopAdapter.prototype._goOnline=function(){this.widget.goOnline()},t.DesktopAdapter.prototype._onWidgetHistoryEntryActivated=function(t){this._send("historyEntryActivated",{deepLinkPath:t.deepLinkPath})},t.DesktopAdapter.prototype._onWidgetFormActivated=function(t){this._sendFormActivated(t.form)},t.DesktopAdapter.prototype._sendFormActivated=function(t){var e={formId:t?t.modelAdapter.id:null};this._send("formActivated",e,{coalesce:function(t){return this.type===t.type}})},t.DesktopAdapter.prototype._onWidgetEvent=function(e){"formActivated"===e.type?this._onWidgetFormActivated(e):"historyEntryActivated"===e.type?this._onWidgetHistoryEntryActivated(e):t.DesktopAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.DesktopAdapter.prototype._onFormShow=function(t){var e,i=this.session.getModelAdapter(t.displayParent);i&&(e=this.session.getOrCreateWidget(t.form,this.widget),this.addFilterForWidgetEvent(function(t){return"formActivated"===t.type&&t.form===e}),this.widget.showForm(e,i.widget,t.position))},t.DesktopAdapter.prototype._onFormHide=function(t){var e,i=this.session.getModelAdapter(t.displayParent);i&&(e=this.session.getModelAdapter(t.form),this.widget.hideForm(e.widget))},t.DesktopAdapter.prototype._onFormActivate=function(t){var e,i=this.session.getModelAdapter(t.displayParent);i&&(e=this.session.getOrCreateWidget(t.form,this.widget),this.widget.activateForm(e,!1))},t.DesktopAdapter.prototype._onMessageBoxShow=function(t){var e,i=this.session.getModelAdapter(t.displayParent);i&&(e=this.session.getOrCreateWidget(t.messageBox,this.widget),i.widget.messageBoxController.registerAndRender(e))},t.DesktopAdapter.prototype._onMessageBoxHide=function(t){var e,i=this.session.getModelAdapter(t.displayParent);i&&(e=this.session.getModelAdapter(t.messageBox),i.widget.messageBoxController.unregisterAndRemove(e.widget))},t.DesktopAdapter.prototype._onFileChooserShow=function(t){var e,i=this.session.getModelAdapter(t.displayParent);i&&(e=this.session.getOrCreateWidget(t.fileChooser,this.widget),i.widget.fileChooserController.registerAndRender(e))},t.DesktopAdapter.prototype._onFileChooserHide=function(t){var e,i=this.session.getModelAdapter(t.displayParent);i&&(e=this.session.getModelAdapter(t.fileChooser),i.widget.fileChooserController.unregisterAndRemove(e.widget))},t.DesktopAdapter.prototype._onOpenUri=function(t){this.widget.openUri(t.uri,t.action)},t.DesktopAdapter.prototype._onOutlineChanged=function(t){var e=this.session.getOrCreateWidget(t.outline,this.widget);this.widget.setOutline(e)},t.DesktopAdapter.prototype._onAddNotification=function(e){t.create("DesktopNotification",{parent:this.widget,id:e.id,duration:e.duration,status:e.status,closable:e.closable}).show()},t.DesktopAdapter.prototype._onRemoveNotification=function(t){this.widget.removeNotification(t.id)},t.DesktopAdapter.prototype._onOutlineContentActivate=function(t){this.widget.bringOutlineToFront()},t.DesktopAdapter.prototype._onRequestGeolocation=function(t){if(navigator.geolocation){var e=function(t){this._send("geolocationDetermined",{latitude:t.coords.latitude,longitude:t.coords.longitude})}.bind(this),i=function(t){this._send("geolocationDetermined",{errorCode:t.code,errorMessage:t.message})}.bind(this);navigator.geolocation.getCurrentPosition(e,i)}},t.DesktopAdapter.prototype.onModelAction=function(e){"formShow"===e.type?this._onFormShow(e):"formHide"===e.type?this._onFormHide(e):"formActivate"===e.type?this._onFormActivate(e):"messageBoxShow"===e.type?this._onMessageBoxShow(e):"messageBoxHide"===e.type?this._onMessageBoxHide(e):"fileChooserShow"===e.type?this._onFileChooserShow(e):"fileChooserHide"===e.type?this._onFileChooserHide(e):"openUri"===e.type?this._onOpenUri(e):"outlineChanged"===e.type?this._onOutlineChanged(e):"outlineContentActivate"===e.type?this._onOutlineContentActivate(e):"addNotification"===e.type?this._onAddNotification(e):"removeNotification"===e.type?this._onRemoveNotification(e):"requestGeolocation"===e.type?this._onRequestGeolocation(e):t.DesktopAdapter.parent.prototype.onModelAction.call(this,e)},t.DesktopLayout=function(e){t.DesktopLayout.parent.call(this),this.desktop=e},t.inherits(t.DesktopLayout,t.AbstractLayout),t.DesktopLayout.prototype.layout=function(e){function i(t,e,i){_?e.$comp.cssLeft(m.width):(t.width=i.width,e.setSize(i)),t.left=d}var o,n,r,s,a,l,h,d=0,p=0,u=this.desktop,c=u.navigation,f=u.header,y=u.bench,g=u.animateLayoutChange,m=this.containerSize(),_=c&&c.htmlComp.layoutData.fullWidth;c&&(d=this.calculateNavigationWidth(m),u.splitter&&u.splitter.setPosition(d,!0),u.navigationVisible&&(l=c.htmlComp,o=new t.Dimension(d,m.height).subtract(l.getMargins()),l.setSize(o))),f&&(r=f.htmlComp,p=r.$comp.outerHeight(!0),u.headerVisible&&(g||f.$container.cssLeft(d),n=new t.Dimension(m.width-d,p).subtract(r.getMargins()),g&&!_||r.setSize(n),g&&(h={left:m.width},i(h,r,n),this._animate(h,r,n)))),y&&(s=y.htmlComp,u.benchVisible&&(y.$container.cssTop(p),g||y.$container.cssLeft(d),a=new t.Dimension(m.width-d,m.height-p).subtract(s.getMargins()),g&&!_||s.setSize(a),g&&(h={left:m.width},i(h,s,a),this._animate(h,s,a))))},t.DesktopLayout.prototype._animate=function(t,e,i){e.$comp.is(":animated")?e.$comp.stop().animate(t,{complete:this.desktop.onLayoutAnimationComplete.bind(this.desktop)}):setTimeout(function(){e.$comp.stop().animate(t,{complete:this.desktop.onLayoutAnimationComplete.bind(this.desktop)})}.bind(this))},t.DesktopLayout.prototype.containerSize=function(){var t=this.desktop.htmlComp,e=t.getAvailableSize();return e.subtract(t.getInsets())},t.DesktopLayout.prototype.calculateNavigationWidth=function(e){if(!this.desktop.navigationVisible)return 0;var i=this.desktop.navigation.htmlComp.layoutData;if(i.fullWidth)return e.width;var o=0;this.desktop.splitter&&(o=this.desktop.splitter.position);var n=this.desktop.outline;return!this.desktop.resizing&&n&&n.autoToggleBreadcrumbStyle&&(n.displayStyle===t.Tree.DisplayStyle.BREADCRUMB?o=t.DesktopNavigation.BREADCRUMB_STYLE_WIDTH:o<=t.DesktopNavigation.BREADCRUMB_STYLE_WIDTH&&(o=t.DesktopNavigation.DEFAULT_STYLE_WIDTH)),Math.max(o,t.DesktopNavigation.MIN_WIDTH)},t.DesktopLogo=function(){t.DesktopLogo.parent.call(this)},t.inherits(t.DesktopLogo,t.Widget),t.DesktopLogo.prototype._init=function(e){t.DesktopLogo.parent.prototype._init.call(this,e),this.url=e.url},t.DesktopLogo.prototype._render=function(t){this.$container=t.appendDiv("desktop-logo"),this.$container.dblclick(function(t){t.altKey&&t.ctrlKey&&(e(t.target).css("background","none"),e(t.target).css("font-size","9px"),e(t.target).text("make software not war"))})},t.DesktopLogo.prototype._renderProperties=function(){t.DesktopLogo.parent.prototype._renderProperties.call(this),this._renderUrl()},t.DesktopLogo.prototype._renderUrl=function(){this.$container.css("backgroundImage","url("+this.url+")")},t.DesktopLogo.prototype.setUrl=function(t){this.setProperty("url",t)},t.DesktopKeyStroke=function(e){t.DesktopKeyStroke.parent.call(this);var i=t.keys;this.preventDefault=!1,this.session=e,this.whiteListCtrlKeys=[i.N,i.R,i.T,i.PAGE_UP,i.PAGE_DOWN],this.whiteListKeys=[i.F11,i.F12],this.blackListKeys=[i.F5]},t.inherits(t.DesktopKeyStroke,t.KeyStroke),t.DesktopKeyStroke.prototype._accept=function(e){if(t.isOneOf(e.which,this.blackListKeys))return this.preventDefault=!0,!0;if(this.session._busyIndicator){var i,o;return i=e.ctrlKey||e.metaKey?this.whiteListCtrlKeys:this.whiteListKeys,o=t.isOneOf(e.which,i),this.preventDefault=!o,!0}return!1},t.DesktopKeyStroke.prototype.handle=function(t){},t.PopupWindow=function(e,i){this.myWindow=e,this.form=i,this.session=i.session,this.events=new t.EventSupport,this.initialized=!1,this.$container,this.htmlComp,i.popupWindow=this,e.popupWindow=this,e.name="Scout popup-window "+i.modelClass},t.PopupWindow.prototype._onUnload=function(){e.log.debug("stored form ID "+this.form.id+" to session storage"),this.form.destroyed?e.log.debug("form ID "+this.form.id+" is already destroyed - don't trigger unload event"):this.events.trigger("popupWindowUnload",this)},t.PopupWindow.prototype._onReady=function(){var i=this.myWindow.document,o=e(this.myWindow),n=e(i);if(t.polyfills.install(this.myWindow),t.prepareDOM(i),this.$container=e(".scout",i),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.SingleLayout),this.$container.height(o.height()),this.form.render(this.$container),this.resizeToPrefSize){var r=this.htmlComp.getPreferredSize(),s=new t.Dimension(this.myWindow.outerWidth,this.myWindow.outerHeight),a=new t.Dimension(n.width(),n.height()),l=s.width-a.width,h=s.height-a.height;this.myWindow.resizeTo(r.width+l,r.height+h),this.resizeToPrefSize=!1}this.form.htmlComp.validateLayout(),this.session.keyStrokeManager.installTopLevelKeyStrokeHandlers(this.$container),this.session.focusManager.installTopLevelMouseHandlers(this.$container),t._installGlobalMouseDownInterceptor(i),e(this.myWindow).on("unload",this._onUnload.bind(this)).on("resize",this._onResize.bind(this)),this.myWindow.onerror=this.myWindow.opener.onerror,this.initialized=!0,this.events.trigger("init")},t.PopupWindow.prototype._onResize=function(){var i=e(this.myWindow),o=i.width(),n=i.height(),r=this.myWindow.screenX,s=this.myWindow.screenY;e.log.debug("popup-window resize: width="+o+" height="+n+" top="+s+" left="+r),this.form.cacheBounds&&t.PopupWindow.storeWindowBounds(this.form,new t.Rectangle(r,s,o,n));var a=new t.Dimension(i.width(),i.height());this.htmlComp.setSize(a)},t.PopupWindow.storeWindowBounds=function(t,i){var o="scout:formBounds:"+t.cacheBoundsKey;try{localStorage.setItem(o,JSON.stringify(i))}catch(t){e.log.error('Error while storing "'+o+'" in localStorage: '+t)}},t.PopupWindow.readWindowBounds=function(e){var i="scout:formBounds:"+e.cacheBoundsKey,o=localStorage.getItem(i);return o?(o=JSON.parse(o),new t.Rectangle(o.x,o.y,o.width,o.height)):null},t.PopupWindow.prototype.isClosed=function(){return this.myWindow.closed},t.PopupWindow.prototype.one=function(t,e){this.events.one(t,e)},t.PopupWindow.prototype.close=function(){this.myWindow.close()},t.PopupWindow.prototype.title=function(t){this.myWindow.document.title=t},t.SimpleTabBoxController=function(t,e){this.tabBox=t,this.tabArea=e,this._viewAddedHandler=this._onViewAdded.bind(this),this._viewRemovedHandler=this._onViewRemoved.bind(this),this._viewActivatedHandler=this._onViewActivated.bind(this),this._viewDeactivatedHandler=this._onViewDeactivated.bind(this),this._viewTabSelectedHandler=this._onViewTabSelected.bind(this),this._installListeners()},t.SimpleTabBoxController.prototype._installListeners=function(){this.tabBox.on("viewAdded",this._viewAddedHandler),this.tabBox.on("viewRemoved",this._viewRemovedHandler),this.tabBox.on("viewActivated",this._viewActivatedHandler),this.tabBox.on("viewDeactivated",this._viewDeactivatedHandler),this.tabArea.on("tabSelected",this._viewTabSelectedHandler)},t.SimpleTabBoxController.prototype._onViewAdded=function(e){var i,o,n=e.view,r=e.siblingView;t.SimpleTabBoxController.hasViewTab(n)&&(i=this._getTab(n),i||(o=this._getTab(r),i=t.create("DesktopTab",{parent:this.tabArea,view:n}),this.tabArea.addTab(i,o)))},t.SimpleTabBoxController.prototype._onViewRemoved=function(t){var e=t.view;if(e){var i=this._getTab(e);i&&this.tabArea.destroyTab(i)}},t.SimpleTabBoxController.prototype._onViewActivated=function(t){var e=this._getTab(t.view);this.tabArea.selectTab(e)},t.SimpleTabBoxController.prototype._onViewDeactivated=function(t){var e=this._getTab(t.view);this.tabArea.deselectTab(e)},t.SimpleTabBoxController.prototype._onViewTabSelected=function(t){if(t.viewTab){var e=t.viewTab.view;this.tabBox.activateView(e)}},t.SimpleTabBoxController.prototype._getTab=function(t){if(t){var e;return this.tabArea.getTabs().some(function(i){return i.view===t&&(e=i,!0)}),e}},t.SimpleTabBoxController.prototype.getTabs=function(){return this.tabArea.getTabs()},t.SimpleTabBoxController.hasViewTab=function(e){return t.objects.someProperties(e,["title","subTitle","iconId"])},t.SimpleTabBox=function(){t.SimpleTabBox.parent.call(this),this.$body,this.htmlComp,this.tabArea,this.viewStack=[],this.currentView,this._removeViewInProgress=0},t.inherits(t.SimpleTabBox,t.Widget),t.SimpleTabBox.prototype._init=function(e){t.SimpleTabBox.parent.prototype._init.call(this,e),this.tabArea=t.create("SimpleTabArea",{parent:this}),this.controller=new t.SimpleTabBoxController(this,this.tabArea),this._viewDestroyedHandler=this._onViewDestroyed.bind(this)},t.SimpleTabBox.prototype._keyStrokeBindTarget=function(){return this.$container},t.SimpleTabBox.prototype._render=function(e){this.$container=e.appendDiv("view-tab-box"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.SimpleTabBoxLayout(this)),this.$viewContent=this.$container.appendDiv("tab-content"),this.viewContent=t.HtmlComponent.install(this.$viewContent,this.session),this.viewContent.setLayout(new t.SimpleTabViewContentLayout(this))},t.SimpleTabBox.prototype._renderProperties=function(){t.SimpleTabBox.parent.prototype._renderProperties.call(this),this._renderTabArea(),this._renderView(this.currentView)},t.SimpleTabBox.prototype._renderTabArea=function(){this.tabArea.render(this.$container),this.$tabArea=this.tabArea.$container,this.tabArea.attached&&this.$tabArea.insertBefore(this.$viewContent)},t.SimpleTabBox.prototype._renderView=function(t){t&&(t.rendered||(t.render(this.$viewContent),t.$container.addClass("view"),t.validateRoot=!0))},t.SimpleTabBox.prototype.postRender=function(){this.viewStack.length>0&&!this.currentView&&this.activateView(this.viewStack[this.viewStack.length-1])},t.SimpleTabBox.prototype._remove=function(){t.SimpleTabBox.parent.prototype._remove.call(this),this.scrollable&&t.scrollbars.uninstall(this.$body)},t.SimpleTabBox.prototype.activateView=function(t){t!==this.currentView&&(this.currentView&&(this.currentView.detach(),this.trigger("viewDeactivated",{view:this.currentView}),this.currentView=null),this.rendered&&this._renderView(t),t.attached||t.attach(),this.currentView=t,this.trigger("viewActivated",{view:t}),this.revalidateLayout())},t.SimpleTabBox.prototype.revalidateLayout=function(){this.rendered&&(this.viewContent.invalidateLayoutTree(),this.viewContent.validateLayoutTree())},t.SimpleTabBox.prototype.addView=function(e,i){var o=t.nvl(i,!0);0===this.viewStack.length&&(o=!0);var n=this._addToViewStack(e);e.setParent(this),this.trigger("viewAdded",{view:e,siblingView:n}),o&&this.activateView(e)},t.SimpleTabBox.prototype._addToViewStack=function(e){var i,o=this.viewStack.indexOf(e);if(o>-1)return this.viewStack[o-1];if(!t.SimpleTabBoxController.hasViewTab(e))return this.viewStack.unshift(e),this._addDestroyListener(e),i;if(!this.currentView)return i=this.viewStack[this.viewStack.length-1],this.viewStack.push(e),void this._addDestroyListener(e);var n=this.viewStack.indexOf(this.currentView);return i=this.viewStack[n],this.viewStack.splice(n+1,0,e),i},t.SimpleTabBox.prototype._addDestroyListener=function(t){t.one("destroy",this._viewDestroyedHandler)},t.SimpleTabBox.prototype._removeDestroyListener=function(t){t.off("destroy",this._viewDestroyedHandler)},t.SimpleTabBox.prototype._onViewDestroyed=function(e){var i=e.source;t.arrays.remove(this.viewStack,i),this.currentView===i&&(this.rendered&&i.remove(),this.currentView=null)},t.SimpleTabBox.prototype.removeView=function(e,i){if(e){i=t.nvl(i,!0);var o,n=this.viewStack.indexOf(e);this.currentView===e&&(this.currentView=null),n>-1&&(i&&(n-1>=0?o=this.viewStack[n-1]:n+1<this.viewStack.length&&(o=this.viewStack[n+1])),this.viewStack.splice(n,1),e.rendered&&(this._removeViewInProgress++,e.remove(),this._removeViewInProgress--),this.trigger("viewRemoved",{view:e}),0===this._removeViewInProgress&&(o&&this.activateView(o),this.rendered&&(this.viewContent.invalidateLayoutTree(),this.viewContent.validateLayoutTree())))}},t.SimpleTabBox.prototype.getController=function(){return this.controller},t.SimpleTabBox.prototype.viewCount=function(){return this.viewStack.length},t.SimpleTabBox.prototype.hasViews=function(){return this.viewStack.length>0},t.SimpleTabBox.prototype.getViews=function(t){return this.viewStack.filter(function(e){return!t||t===e.displayViewId})},t.SimpleTabBoxLayout=function(e){t.SimpleTabBoxLayout.parent.call(this),this.tabBox=e},t.inherits(t.SimpleTabBoxLayout,t.AbstractLayout),t.SimpleTabBoxLayout.prototype.layout=function(e){var i,o,n,r=t.HtmlComponent.get(e),s=t.HtmlComponent.get(this.tabBox.$viewContent);i=r.getAvailableSize().subtract(r.getInsets()),n=this._layoutTabArea(i),o=i.subtract(s.getMargins()),o.height-=n.height,s.setSize(o)},t.SimpleTabBoxLayout.prototype._layoutTabArea=function(e){if(!this.tabBox.rendered)return new t.Dimension(0,0);var i=t.HtmlComponent.get(this.tabBox.$tabArea),o=i.getPreferredSize(),n=i.getMargins(),r=new t.Dimension(e.width,o.height+n.top+n.bottom);return i.setSize(r),r},t.SimpleTabBoxLayout.prototype.preferredLayoutSize=function(e){var i=t.HtmlComponent.get(e),o=t.HtmlComponent.get(this.tabBox.$viewContent),n=t.HtmlComponent.get(this.tabBox.$tabArea),r=new t.Dimension,s=new t.Dimension;return n.isVisible()&&(r=n.getPreferredSize().add(n.getMargins())),s=o.getPreferredSize().add(i.getInsets()).add(o.getMargins()),new t.Dimension(Math.max(r.width,s.width),s.height+r.height)},t.SimpleTabViewContentLayout=function(e){t.SimpleTabViewContentLayout.parent.call(this),this.tabBox=e},t.inherits(t.SimpleTabViewContentLayout,t.AbstractLayout),t.SimpleTabViewContentLayout.prototype.layout=function(e){var i=this.tabBox.currentView;if(i&&i.rendered&&i.htmlComp){var o=t.HtmlComponent.get(e),n=o.getAvailableSize().subtract(o.getInsets()).subtract(i.htmlComp.getMargins());i.htmlComp.setSize(n)}},t.SimpleTabViewContentLayout.prototype.preferredLayoutSize=function(e){var i=this.tabBox.currentView;if(!i||!i.rendered||!i.htmlComp)return new t.Dimension;var o=t.HtmlComponent.get(e),n=i.htmlComp.getPreferredSize().add(o.getInsets()).add(i.htmlComp.getMargins());return n},t.DesktopBench=function(){t.DesktopBench.parent.call(this),this.htmlComp,this.columns=[],this.components,this.tabBoxMap={},this._removeViewInProgress=0,this._desktopOutlineChangedHandler=this._onDesktopOutlineChanged.bind(this),this._desktopPropertyChangeHandler=this._onDesktopPropertyChange.bind(this),this._outlineNodesSelectedHandler=this._onOutlineNodesSelected.bind(this),this._outlinePageChangedHandler=this._onOutlinePageChanged.bind(this),this._outlinePropertyChangeHandler=this._onOutlinePropertyChange.bind(this),this._onOutlineContentDestroyedHandler=this._onOutlineContentDestroyed.bind(this),this._viewAddedHandler=this._onViewAdded.bind(this),this._viewRemovedHandler=this._onViewRemoved.bind(this),this._viewActivatedHandler=this._onViewActivated.bind(this),this._viewDeactivatedHandler=this._onViewDeactivated.bind(this),this._desktopAnimationEndHandler=this._onDesktopAnimationEnd.bind(this)},t.inherits(t.DesktopBench,t.Widget),t.DesktopBench.VIEW_MIN_HEIGHT,t.DesktopBench.VIEW_MIN_WIDTH,t.DesktopBench.VIEW_AREA_COLUMN_INDEX={LEFT:0,CENTER:1,RIGHT:2},t.DesktopBench.prototype._init=function(i){t.DesktopBench.parent.prototype._init.call(this,i),t.DesktopBench.VIEW_MIN_HEIGHT=e.pxToNumber(t.styles.get("view-tab-box","min-height").minHeight),
t.DesktopBench.VIEW_MIN_WIDTH=e.pxToNumber(t.styles.get("view-tab-box","min-width").minWidth),this._createColumns(),this.desktop=this.session.desktop,this.headerTabArea=i.headerTabArea,this.headerTabArea&&(this.headerTabAreaController=new t.HeaderTabBoxController(this,this.headerTabArea)),this.outlineContentVisible=t.nvl(i.outlineContentVisible,!0),this.setOutline(this.desktop.outline),this.updateNavigationHandleVisibility()},t.DesktopBench.prototype._createColumns=function(){for(var e=0;e<3;e++){var i=t.create("BenchColumn",{parent:this});i.on("viewAdded",this._viewAddedHandler),i.on("viewRemoved",this._viewRemovedHandler),i.on("viewActivated",this._viewActivatedHandler),i.on("viewDeactivated",this._viewDeactivatedHandler),this.columns.push(i)}},t.DesktopBench.prototype._initKeyStrokeContext=function(){t.DesktopBench.parent.prototype._initKeyStrokeContext.call(this),this.desktopKeyStrokeContext=new t.KeyStrokeContext,this.desktopKeyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.desktopKeyStrokeContext.$bindTarget=this.desktop.$container,this.desktopKeyStrokeContext.$scopeTarget=this.$container,this.desktopKeyStrokeContext.registerKeyStroke(this.desktop.keyStrokes),this.desktopKeyStrokeContext.registerKeyStroke(new t.DesktopTabSelectKeyStroke(this.desktop))},t.DesktopBench.prototype._render=function(e){this.$container=e.appendDiv("desktop-bench"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this._renderColumns(),this._revalidateSplitters(),this._renderNavigationHandleVisible(),this.session.keyStrokeManager.installKeyStrokeContext(this.desktopKeyStrokeContext),this.desktop.on("propertyChange",this._desktopPropertyChangeHandler),this.desktop.on("outlineChanged",this._desktopOutlineChangedHandler),this.desktop.on("animationEnd",this._desktopAnimationEndHandler)},t.DesktopBench.prototype._createLayout=function(){return new t.DesktopBenchLayout(this)},t.DesktopBench.prototype._renderColumns=function(){this.columns.forEach(function(t){t.viewCount()>0&&this._renderColumn(t)}.bind(this))},t.DesktopBench.prototype._renderColumn=function(t){t&&!t.rendered&&t.render(this.$container)},t.DesktopBench.prototype._remove=function(){this.desktop.off("propertyChange",this._desktopPropertyChangeHandler),this.desktop.off("outlineChanged",this._desktopOutlineChangedHandler),this.desktop.off("animationEnd",this._desktopAnimationEndHandler),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.desktopKeyStrokeContext),t.DesktopBench.parent.prototype._remove.call(this)},t.DesktopBench.prototype._renderOutlineContent=function(){this.outlineContent&&(delete this.outlineContent.title,delete this.outlineContent.subTitle,delete this.outlineContent.iconId,this.addView(this.outlineContent,!this.desktop.inBackground),this.desktop.rendered&&this.session.focusManager.validateFocus())},t.DesktopBench.prototype._removeOutlineContent=function(){this.outlineContent&&this.removeView(this.outlineContent,!1)},t.DesktopBench.prototype._renderNavigationHandle=function(){this.navigationHandle||(this.navigationHandle=t.create("DesktopNavigationHandle",{parent:this,leftVisible:!1}),this.navigationHandle.render(this.$container),this.navigationHandle.$container.addClass("navigation-closed"),this.navigationHandle.on("action",this._onNavigationHandleAction.bind(this)))},t.DesktopBench.prototype._removeNavigationHandle=function(){this.navigationHandle&&(this.navigationHandle.destroy(),this.navigationHandle=null)},t.DesktopBench.prototype._renderNavigationHandleVisible=function(){this.navigationHandleVisible?this._renderNavigationHandle():this._removeNavigationHandle()},t.DesktopBench.prototype.postRender=function(){this.columns.forEach(function(t){t.postRender()})},t.DesktopBench.prototype.setNavigationHandleVisible=function(t){this.setProperty("navigationHandleVisible",t)},t.DesktopBench.prototype.setOutline=function(t){this.outline&&(this.outline.off("nodesSelected",this._outlineNodesSelectedHandler),this.outline.off("pageChanged",this._outlinePageChangedHandler),this.outline.off("propertyChange",this._outlinePropertyChangeHandler)),this._setProperty("outline",t),this.outline&&(this.outline.on("nodesSelected",this._outlineNodesSelectedHandler),this.outline.on("pageChanged",this._outlinePageChangedHandler),this.outline.on("propertyChange",this._outlinePropertyChangeHandler)),this.updateOutlineContent()},t.DesktopBench.prototype.setOutlineContent=function(t){var e=this.outlineContent;this.outlineContent!==t&&(e&&e.off("destroy",this._onOutlineContentDestroyedHandler),this.rendered&&this._removeOutlineContent(),t&&t.one("destroy",this._onOutlineContentDestroyedHandler),this._setProperty("outlineContent",t),this.desktop.header&&this.desktop.header.onBenchOutlineContentChange(t,e),this._renderOutlineContent())},t.DesktopBench.prototype.setOutlineContentVisible=function(t){t!==this.outlineContentVisible&&(this._setProperty("outlineContentVisible",t),this.updateOutlineContent())},t.DesktopBench.prototype.bringToFront=function(){this.outlineContent&&this._renderOutlineContent()},t.DesktopBench.prototype.sendToBack=function(){},t.DesktopBench.prototype._computeDefaultDetailForm=function(){return this.outline.defaultDetailForm},t.DesktopBench.prototype._computeOutlineOverview=function(){return this.outline.outlineOverview},t.DesktopBench.prototype._computeDetailContentForPage=function(t){if(!t)throw new Error("called _showDetailContentForPage without node");var e;return t.detailForm&&t.detailFormVisible&&t.detailFormVisibleByUi?(e=t.detailForm,e.uiCssClass="detail-form"):t.detailTable&&t.detailTableVisible&&(e=t.detailTable,e.uiCssClass="detail-table"),e},t.DesktopBench.prototype.updateOutlineContent=function(){if(this.outlineContentVisible&&this.outline){var e,i=this.outline.selectedNode();i?e=this._computeDetailContentForPage(i):this.outline.defaultDetailForm?e=this._computeDefaultDetailForm():this.outline.outlineOverview&&(e=this._computeOutlineOverview()),e&&(e instanceof t.Table&&(e.menuBar.top(),e.menuBar.large()),e.displayViewId="C"),this.setOutlineContent(e)}},t.DesktopBench.prototype.updateOutlineContentDebounced=function(){clearTimeout(this._updateOutlineContentTimeout),this._updateOutlineContentTimeout=setTimeout(function(){this.updateOutlineContent()}.bind(this),300)},t.DesktopBench.prototype.updateNavigationHandleVisibility=function(){this.setNavigationHandleVisible(this.desktop.navigationHandleVisible&&!this.desktop.navigationVisible)},t.DesktopBench.prototype._onDesktopOutlineChanged=function(t){this.setOutline(this.desktop.outline),this.updateNavigationHandleVisibility()},t.DesktopBench.prototype._onOutlineContentDestroyed=function(t){this.setOutlineContent(null)},t.DesktopBench.prototype._onOutlineNodesSelected=function(t){t.debounce?this.updateOutlineContentDebounced():this.updateOutlineContent()},t.DesktopBench.prototype._onOutlinePageChanged=function(t){var e=this.outline.selectedNode();(t.page||e)&&t.page!==e||this.updateOutlineContent()},t.DesktopBench.prototype._onOutlinePropertyChange=function(e){t.arrays.containsAny(e.changedProperties,["defaultDetailForm","outlineOverview"])&&this.updateOutlineContent()},t.DesktopBench.prototype._onDesktopNavigationVisibleChange=function(t){this.desktop.navigationVisible&&this.updateNavigationHandleVisibility()},t.DesktopBench.prototype._onDesktopNavigationHandleVisibleChange=function(t){this.updateNavigationHandleVisibility()},t.DesktopBench.prototype._onDesktopAnimationEnd=function(t){this.desktop.navigationVisible||this.updateNavigationHandleVisibility()},t.DesktopBench.prototype._onDesktopPropertyChange=function(t){t.changedProperties.indexOf("navigationVisible")!==-1?this._onDesktopNavigationVisibleChange():t.changedProperties.indexOf("navigationHandleVisible")!==-1&&this._onDesktopNavigationHandleVisibleChange()},t.DesktopBench.prototype._onNavigationHandleAction=function(t){this.desktop.enlargeNavigation()},t.DesktopBench.prototype._revalidateSplitters=function(){this.components&&this.components.forEach(function(e){e instanceof t.Splitter&&e.destroy()});var e=this;this.components=this.columns.filter(function(t){return t.hasViews()}).reduce(function(i,o){if(i.length>0){var n=t.create("Splitter",{parent:e,$anchor:i[i.length-1].$container,$root:e.$container,maxRatio:1});n.render(e.$container),n.$container.addClass("line"),n.on("move",e._onSplitterMove.bind(e)),n.on("positionChanged",e._onSplitterPositionChanged.bind(e)),i.push(n)}return i.push(o),i},[]),this.components.filter(function(e){return e instanceof t.BenchColumn}).reduce(function(t,e,i){return i>0&&e.$container.insertAfter(t.$container),e},i)},t.DesktopBench.prototype._onSplitterMove=function(e){var i=this.components.indexOf(e.source);if(i>0){var o=this.components[i-1].$container,n=this.components[i+1].$container,r=e.position-e.source.position;o.width()+r<t.DesktopBench.VIEW_MIN_WIDTH&&e.setPosition(o.position().left+t.DesktopBench.VIEW_MIN_WIDTH),n.position().left+n.width()-e.position<t.DesktopBench.VIEW_MIN_WIDTH&&e.setPosition(n.position().left+n.width()-t.DesktopBench.VIEW_MIN_WIDTH)}},t.DesktopBench.prototype._onSplitterPositionChanged=function(t){this.revalidateLayout()},t.DesktopBench.prototype._onViewAdded=function(t){this.trigger("viewAdded",{view:t.view})},t.DesktopBench.prototype._onViewRemoved=function(t){this.trigger("viewRemoved",{view:t.view})},t.DesktopBench.prototype._onViewActivated=function(t){var e=t.view;this.outlineContent===e&&this.desktop.bringOutlineToFront(this.desktop.outline),this.trigger("viewActivated",{view:e})},t.DesktopBench.prototype._onViewDeactivated=function(t){this.outlineContent===t.view&&this.desktop.sendOutlineToBack(),this.trigger("viewDeactivated",{view:t.view})},t.DesktopBench.prototype.addView=function(t,e){switch(t.displayViewId){case"NW":case"W":case"SW":case"N":case"C":case"S":case"NE":case"E":case"SE":break;default:t.displayViewId="C"}var i=this._getColumn(t.displayViewId);this.tabBoxMap[t.id]=i,i.addView(t,e),this.rendered&&1===i.viewCount()&&(this._renderColumn(i),this._revalidateSplitters(),this.htmlComp.invalidateLayoutTree(),this.htmlComp.validateLayoutTree())},t.DesktopBench.prototype.activateView=function(t){var e=this._getColumn(t.displayViewId);e&&e.activateView(t)},t.DesktopBench.prototype._getColumn=function(e){var i;switch(e){case"NW":case"W":case"SW":i=this.columns[t.DesktopBench.VIEW_AREA_COLUMN_INDEX.LEFT];break;case"NE":case"E":case"SE":i=this.columns[t.DesktopBench.VIEW_AREA_COLUMN_INDEX.RIGHT];break;default:i=this.columns[t.DesktopBench.VIEW_AREA_COLUMN_INDEX.CENTER]}return i},t.DesktopBench.prototype.removeView=function(t,e){var i=this.tabBoxMap[t.id];i&&(this._removeViewInProgress++,i.removeView(t,e),this._removeViewInProgress--,delete this.tabBoxMap[t.id],this.rendered&&0===i.viewCount()&&0===this._removeViewInProgress&&(i.remove(),this._revalidateSplitters(!0),this.htmlComp.invalidateLayoutTree(),this.htmlComp.validateLayoutTree()))},t.DesktopBench.prototype.getComponents=function(){return this.components},t.DesktopBench.prototype.getTabBox=function(t){var e=this._getColumn(t);if(e)return e.getTabBox(t)},t.DesktopBench.prototype.getViews=function(e){return this.columns.reduce(function(i,o){return t.arrays.pushAll(i,o.getViews(e)),i},[])},t.DesktopBench.prototype.getViewTab=function(t){var e;return this.getTabs().some(function(i){return i.view===t&&(e=i,!0)}),e},t.DesktopBench.prototype.getTabs=function(){var t=[];return t=t.concat(this.getTabBox("NW").getController().getTabs()),t=t.concat(this.getTabBox("W").getController().getTabs()),t=t.concat(this.getTabBox("SW").getController().getTabs()),t=t.concat(this.getTabBox("N").getController().getTabs()),t=this.headerTabAreaController?t.concat(this.headerTabAreaController.getTabs()):t.concat(this.getTabBox("C").getController().getTabs()),t=t.concat(this.getTabBox("S").getController().getTabs()),t=t.concat(this.getTabBox("NE").getController().getTabs()),t=t.concat(this.getTabBox("E").getController().getTabs()),t=t.concat(this.getTabBox("SE").getController().getTabs())},t.DesktopBenchLayout=function(e){t.DesktopBenchLayout.parent.call(this),this.bench=e,this.containerSize},t.inherits(t.DesktopBenchLayout,t.AbstractLayout),t.DesktopBenchLayout.prototype.layout=function(i){var o,n=this.bench.htmlComp,r=n.getAvailableSize(),s=this.bench.getComponents();s&&(r=r.subtract(n.getInsets()),o=s.filter(function(e){return e instanceof t.Splitter}).map(function(t){return e.isNumeric(t.getPosition())&&e.isNumeric(t.getRatio())}).reduce(function(t,e,i){return 0===i?e:t&&e},!1),o?r.equals(this.containerSize)?this._layoutBySplitterPosition(s,r):this._layoutByRatio(s,r):this._layoutInitial(s,r),this.containerSize=r)},t.DesktopBenchLayout.prototype._layoutByRatio=function(e,i){e.forEach(function(e){e instanceof t.Splitter&&e.setPosition(Math.floor(e.getRatio()*i.width))}),this._layoutBySplitterPosition(e,i)},t.DesktopBenchLayout.prototype._layoutBySplitterPosition=function(e,i){var o=0;e.forEach(function(n,r){if(!(n instanceof t.Splitter)){var s=new t.Rectangle(o,0,0,i.height);e.length-1>r?(s.width=e[r+1].position-o,o+=s.width):s.width=i.width-o,n.htmlComp.setBounds(s)}})},t.DesktopBenchLayout.prototype._layoutInitial=function(e,i){var o=i.width,n=e.filter(function(e){return e instanceof t.BenchColumn}).length;n>0&&(o=i.width/n);var r=0;e.forEach(function(e,n){if(e instanceof t.Splitter)e.setPosition(r,!0);else{var s=new t.Rectangle(r,0,o,i.height);e.htmlComp.setBounds(s),r+=o}})},t.BenchColumn=function(){t.BenchColumn.parent.call(this),this.htmlComp,this.tabBoxs=[],this._widgetToTabBox={},this.components,this._removeViewInProgress=0,this._viewAddedHandler=this._onViewAdded.bind(this),this._viewRemovedHandler=this._onViewRemoved.bind(this),this._viewActivatedHandler=this._onViewActivated.bind(this),this._viewDeactivatedHandler=this._onViewDeactivated.bind(this)},t.inherits(t.BenchColumn,t.Widget),t.BenchColumn.TAB_BOX_INDEX={TOP:0,CENTER:1,BOTTOM:2},t.BenchColumn.prototype._init=function(e){t.BenchColumn.parent.prototype._init.call(this,e),this._createTabBoxes()},t.BenchColumn.prototype._keyStrokeBindTarget=function(){return this.$container},t.BenchColumn.prototype._render=function(e){this.$container=e.appendDiv("bench-column"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout())},t.BenchColumn.prototype._renderProperties=function(){t.BenchColumn.parent.prototype._renderProperties.call(this),this._renderTabBoxs(),this._revalidateSplitters()},t.BenchColumn.prototype._renderTabBoxs=function(){this.tabBoxs.forEach(function(t){t.viewCount()>0&&this._renderTabBox(t)}.bind(this))},t.BenchColumn.prototype._renderTabBox=function(t){t.rendered||t.render(this.$container)},t.BenchColumn.prototype._remove=function(){t.SimpleTabBox.parent.prototype._remove.call(this),this.scrollable&&t.scrollbars.uninstall(this.$body),this.htmlComp=null},t.BenchColumn.prototype.postRender=function(){this.tabBoxs.forEach(function(t){t.postRender()})},t.BenchColumn.prototype._createLayout=function(){return new t.BenchColumnLayout(this)},t.BenchColumn.prototype._onViewAdded=function(t){this.trigger("viewAdded",{view:t.view})},t.BenchColumn.prototype._onViewRemoved=function(t){this.trigger("viewRemoved",{view:t.view})},t.BenchColumn.prototype._onViewActivated=function(t){this.trigger("viewActivated",{view:t.view})},t.BenchColumn.prototype._onViewDeactivated=function(t){this.trigger("viewDeactivated",{view:t.view})},t.BenchColumn.prototype.activateView=function(t){var e=this.getTabBox(t.displayViewId);e.activateView(t)},t.BenchColumn.prototype._createTabBoxes=function(){for(var e=0;e<3;e++){var i=t.create("SimpleTabBox",{parent:this});i.on("viewAdded",this._viewAddedHandler),i.on("viewRemoved",this._viewRemovedHandler),i.on("viewActivated",this._viewActivatedHandler),i.on("viewDeactivated",this._viewDeactivatedHandler),this.tabBoxs.push(i)}},t.BenchColumn.prototype._revalidateSplitters=function(e){this.components&&this.components.forEach(function(e){e instanceof t.Splitter&&e.destroy()});var o=this;this.components=this.tabBoxs.filter(function(t){return t.hasViews()}).reduce(function(e,i){if(e.length>0){var n=t.create("Splitter",{parent:o,$anchor:e[e.length-1].$container,$root:o.$container,splitHorizontal:!1,maxRatio:1});n.render(o.$container),n.$container.addClass("line"),n.on("move",o._onSplitterMove.bind(o)),n.on("positionChanged",o._onSplitterPositionChanged.bind(o)),e.push(n)}return e.push(i),e},[]),this.components.filter(function(e){return e instanceof t.SimpleTabBox}).reduce(function(t,e,i){return i>0&&e.$container.insertAfter(t.$container),e},i)},t.BenchColumn.prototype._onSplitterMove=function(e){var i=this.components.indexOf(e.source);if(i>0){var o=this.components[i-1].$container,n=this.components[i+1].$container,r=e.position-e.source.position;o.outerHeight(!0)+r<t.DesktopBench.VIEW_MIN_HEIGHT&&e.setPosition(o.position().top+t.DesktopBench.VIEW_MIN_HEIGHT),n.position().top+n.outerHeight(!0)-e.position<t.DesktopBench.VIEW_MIN_HEIGHT&&e.setPosition(n.position().top+n.outerHeight(!0)-t.DesktopBench.VIEW_MIN_HEIGHT)}},t.BenchColumn.prototype._onSplitterPositionChanged=function(){this.revalidateLayout()},t.BenchColumn.prototype.addView=function(t,e){var i=this.getTabBox(t.displayViewId);this._widgetToTabBox[t.id]=i,i.addView(t,e),this.rendered&&1===i.viewCount()&&(i.rendered||i.render(this.$container),this._revalidateSplitters(!0),this.htmlComp.invalidateLayoutTree(),this.htmlComp.validateLayoutTree())},t.BenchColumn.prototype.getTabBox=function(e){var i;switch(e){case"NW":case"N":case"NE":i=this.tabBoxs[t.BenchColumn.TAB_BOX_INDEX.TOP];break;case"SW":case"S":case"SE":i=this.tabBoxs[t.BenchColumn.TAB_BOX_INDEX.BOTTOM];break;default:i=this.tabBoxs[t.BenchColumn.TAB_BOX_INDEX.CENTER]}return i},t.BenchColumn.prototype.removeView=function(t,e){var i=this._widgetToTabBox[t.id];i&&(this._removeViewInProgress++,i.removeView(t,e),this._removeViewInProgress--,delete this._widgetToTabBox[t.id],this.rendered&&0===i.viewCount()&&0===this._removeViewInProgress&&(i.remove(),this._revalidateSplitters(!0),this.htmlComp.invalidateLayoutTree(),this.htmlComp.validateLayoutTree()))},t.BenchColumn.prototype.viewCount=function(){return this.tabBoxs.map(function(t){return t.viewCount()}).reduce(function(t,e){return t+e},0)},t.BenchColumn.prototype.hasViews=function(){return this.viewCount()>0},t.BenchColumn.prototype.getViews=function(e){return this.tabBoxs.reduce(function(i,o){return t.arrays.pushAll(i,o.getViews(e)),i},[])},t.BenchColumn.prototype.getComponents=function(){return this.components},t.BenchColumnLayout=function(e){t.BenchColumnLayout.parent.call(this),this.benchColumn=e,this.containerSize},t.inherits(t.BenchColumnLayout,t.AbstractLayout),t.BenchColumnLayout.prototype.layout=function(i){var o,n=this.benchColumn.htmlComp,r=n.getAvailableSize(),s=this.benchColumn.getComponents();s&&(r=r.subtract(n.getInsets()),o=s.filter(function(e){return e instanceof t.Splitter}).map(function(t){return e.isNumeric(t.position)}).reduce(function(t,e,i){return 0===i?e:t&&e},!1),o?r.equals(this.containerSize)?this._layoutBySplitterPosition(s,r):this._layoutByRatio(s,r):this._layoutInitial(s,r),this.containerSize=r)},t.BenchColumnLayout.prototype._layoutByRatio=function(e,i){e.forEach(function(e){e instanceof t.Splitter&&e.setPosition(Math.floor(e.getRatio()*i.height))}),this._layoutBySplitterPosition(e,i)},t.BenchColumnLayout.prototype._layoutBySplitterPosition=function(e,i){var o=0;e.forEach(function(n,r){if(n instanceof t.SimpleTabBox){var s=new t.Rectangle(0,o,i.width,0);e.length-1>r?(s.height=e[r+1].position-o,o+=s.height):s.height=i.height-o,n.htmlComp.setBounds(s)}})},t.BenchColumnLayout.prototype._layoutInitial=function(e,i){var o=i.height,n=e.filter(function(e){return e instanceof t.SimpleTabBox}).length;n>0&&(o=i.height/n);var r=0;e.forEach(function(e,n){if(e instanceof t.Splitter)e.setPosition(r,!0);else{var s=new t.Rectangle(0,r,i.width,o);e.htmlComp.setBounds(s),r+=o}})},t.DesktopTabSelectKeyStroke=function(e){t.DesktopTabSelectKeyStroke.parent.call(this),this.field=e,this.parseAndSetKeyStroke(e.selectViewTabsKeyStrokeModifier),this.registerRange(t.keys[1],function(){return t.keys[Math.min(this._viewTabs().length,9)]}.bind(this)),this.renderingHints.hAlign=t.hAlign.RIGHT,this.renderingHints.$drawingArea=function(e,i){var o=i.which-t.keys[1];return this._viewTabs()[o].$container}.bind(this)},t.inherits(t.DesktopTabSelectKeyStroke,t.RangeKeyStroke),t.DesktopTabSelectKeyStroke.prototype._isEnabled=function(){var e=t.DesktopTabSelectKeyStroke.parent.prototype._isEnabled.call(this);return e&&this.field.selectViewTabsKeyStrokesEnabled&&this._viewTabs().length>0},t.DesktopTabSelectKeyStroke.prototype.handle=function(e){var i=e.which-t.keys[1];if(this._viewTabs().length&&i<this._viewTabs().length){var o=this._viewTabs()[i];this.field.bench&&this.field.bench.activateView(o.view)}},t.DesktopTabSelectKeyStroke.prototype._viewTabs=function(){return this.field.bench?this.field.bench.getTabs():[]},t.DisableBrowserTabSwitchingKeyStroke=function(e){t.DisableBrowserTabSwitchingKeyStroke.parent.call(this),this.field=e,this.parseAndSetKeyStroke(e.selectViewTabsKeyStrokeModifier),this.registerRange(t.keys[1],t.keys[9]),this.renderingHints.render=!1,this.preventDefault=!0};t.inherits(t.DisableBrowserTabSwitchingKeyStroke,t.RangeKeyStroke);t.DisableBrowserTabSwitchingKeyStroke.prototype._isEnabled=function(){var e=t.DisableBrowserTabSwitchingKeyStroke.parent.prototype._isEnabled.call(this);return e&&this.field.selectViewTabsKeyStrokesEnabled},t.DisableBrowserTabSwitchingKeyStroke.prototype.handle=function(t){},t.DesktopHeader=function(){t.DesktopHeader.parent.call(this),this.tabArea,this._desktopPropertyChangeHandler=this._onDesktopPropertyChange.bind(this),this._desktopAnimationEndHandler=this._onDesktopAnimationEnd.bind(this),this._outlineContentMenuBarPropertyChangeHandler=this._onOutlineContentMenuBarPropertyChange.bind(this)},t.inherits(t.DesktopHeader,t.Widget),t.DesktopHeader.prototype._init=function(e){t.DesktopHeader.parent.prototype._init.call(this,e),this.desktop=this.session.desktop,this.toolBoxVisible=t.nvl(e.toolBoxVisible,!0),this.viewButtonBoxVisible=t.nvl(e.viewButtonBoxVisible,!1),this.updateViewButtonBoxVisibility(),this.tabArea=t.create("SimpleTabArea",{parent:this})},t.DesktopHeader.prototype._render=function(e){this.$container=e.appendDiv("desktop-header"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.DesktopHeaderLayout(this)),this._renderViewButtonBoxVisible(),this._renderViewTabs(),this._renderToolBoxVisible(),this._renderLogoUrl(),this.desktop.on("propertyChange",this._desktopPropertyChangeHandler),this.desktop.on("animationEnd",this._desktopAnimationEndHandler),this.desktop.bench&&(this.outlineContent=this.desktop.bench.outlineContent),this._attachOutlineContentMenuBarHandler()},t.DesktopHeader.prototype._remove=function(){this.desktop.off("propertyChange",this._desktopPropertyChangeHandler),this.desktop.off("animationEnd",this._desktopAnimationEndHandler),this._detachOutlineContentMenuBarHandler(),this.outlineContent=null,t.DesktopHeader.parent.prototype._remove.call(this)},t.DesktopHeader.prototype._renderViewTabs=function(){this.tabArea.render(this.$container)},t.DesktopHeader.prototype._renderToolBox=function(){this.toolBox||(this.toolBox=t.create("DesktopToolBox",{parent:this,menus:this.desktop.menus}),this.toolBox.render(this.$container))},t.DesktopHeader.prototype._removeToolBox=function(){this.toolBox&&(this.toolBox.destroy(),this.toolBox=null)},t.DesktopHeader.prototype._renderToolBoxVisible=function(){this.toolBoxVisible?this._renderToolBox():this._removeToolBox(),this.invalidateLayoutTree()},t.DesktopHeader.prototype._renderLogoUrl=function(){this.logoUrl?this._renderLogo():this._removeLogo(),this.invalidateLayoutTree()},t.DesktopHeader.prototype._renderLogo=function(){this.logo?this.logo.setUrl(this.logoUrl):(this.logo=t.create("DesktopLogo",{parent:this,url:this.logoUrl}),this.logo.render(this.$container))},t.DesktopHeader.prototype._removeLogo=function(){this.logo&&(this.logo.destroy(),this.logo=null)},t.DesktopHeader.prototype._renderViewButtonBox=function(){this.viewButtonBox||(this.viewButtonBox=t.create("ViewButtonBox",{parent:this,viewButtons:this.desktop.viewButtons}),this.viewButtonBox.render(this.$container),this.viewButtonBox.$container.prependTo(this.$container),this.desktop.inBackground&&this.viewButtonBox.sendToBack(),this.updateViewButtonStyling())},t.DesktopHeader.prototype._removeViewButtonBox=function(){this.viewButtonBox&&(this.viewButtonBox.destroy(),this.viewButtonBox=null)},t.DesktopHeader.prototype._renderViewButtonBoxVisible=function(){this.viewButtonBoxVisible?this._renderViewButtonBox():this._removeViewButtonBox(),this.invalidateLayoutTree()},t.DesktopHeader.prototype.sendToBack=function(){this.viewButtonBox&&this.viewButtonBox.sendToBack()},t.DesktopHeader.prototype.bringToFront=function(){this.viewButtonBox&&this.viewButtonBox.bringToFront()},t.DesktopHeader.prototype.setLogoUrl=function(t){this.setProperty("logoUrl",t)},t.DesktopHeader.prototype.setToolBoxVisible=function(t){this.setProperty("toolBoxVisible",t)},t.DesktopHeader.prototype.setViewButtonBoxVisible=function(t){this.setProperty("viewButtonBoxVisible",t)},t.DesktopHeader.prototype.setMenus=function(t){this.toolBox&&this.toolBox.setMenus(t)},t.DesktopHeader.prototype.updateViewButtonBoxVisibility=function(){this.setViewButtonBoxVisible(this.desktop.viewButtons&&this.desktop.viewButtons.length>0&&!this.desktop.navigationVisible&&this.desktop.displayStyle!==t.Desktop.DisplayStyle.COMPACT)},t.DesktopHeader.prototype._attachOutlineContentMenuBarHandler=function(){if(this.outlineContent){var t=this._outlineContentMenuBar(this.outlineContent);t&&t.on("propertyChange",this._outlineContentMenuBarPropertyChangeHandler)}},t.DesktopHeader.prototype._detachOutlineContentMenuBarHandler=function(){if(this.outlineContent){var t=this._outlineContentMenuBar(this.outlineContent);t&&t.off("propertyChange",this._outlineContentMenuBarPropertyChangeHandler)}},t.DesktopHeader.prototype._outlineContentMenuBar=function(e){return e instanceof t.Form?e.rootGroupBox.menuBar:e.menuBar},t.DesktopHeader.prototype.updateViewButtonStyling=function(){if(this.viewButtonBoxVisible&&this.desktop.bench&&this.desktop.bench.outlineContentVisible){var e=this.desktop.bench.outlineContent;if(e){var i=!1;if(e instanceof t.Form){var o=e.rootGroupBox;i=o.menuBar&&o.menuBarVisible&&o.menuBar.visible}else i=e.menuBar&&e.menuBar.visible;this.viewButtonBox.viewTabs.forEach(function(t){t.$container.toggleClass("outline-content-has-menubar",!!i)},this),this.viewButtonBox.viewMenuTab.$container.toggleClass("outline-content-has-menubar",!!i)}}},t.DesktopHeader.prototype._onDesktopNavigationVisibleChange=function(t){this.desktop.navigationVisible&&this.updateViewButtonBoxVisibility()},t.DesktopHeader.prototype._onDesktopAnimationEnd=function(t){this.updateViewButtonBoxVisibility()},t.DesktopHeader.prototype.onBenchOutlineContentChange=function(t){this._detachOutlineContentMenuBarHandler(),this.outlineContent=t,this.updateViewButtonStyling(),this._attachOutlineContentMenuBarHandler()},t.DesktopHeader.prototype._onDesktopPropertyChange=function(t){t.changedProperties.indexOf("navigationVisible")!==-1&&this._onDesktopNavigationVisibleChange()},t.DesktopHeader.prototype._onOutlineContentMenuBarPropertyChange=function(t){t.changedProperties.indexOf("visible")!==-1&&this.updateViewButtonStyling()},t.HeaderTabBoxController=function(e,i){this.bench=e,this._tabBoxChangedHandler=this._onViewsChanged.bind(this),t.HeaderTabBoxController.parent.call(this,e.getTabBox("C"),i),this.tabAreaCenter=e.getTabBox("C").tabArea,this.tabAreaInHeader},t.inherits(t.HeaderTabBoxController,t.SimpleTabBoxController),t.HeaderTabBoxController.prototype._installListeners=function(){t.HeaderTabBoxController.parent.prototype._installListeners.call(this),this.bench.on("viewAdded",this._tabBoxChangedHandler),this.bench.on("viewRemoved",this._tabBoxChangedHandler)},t.HeaderTabBoxController.prototype._onViewsChanged=function(){this.bench.getViews().some(function(t){return"C"!==t.displayViewId})?this._setViewTabAreaInHeader(!1):this._setViewTabAreaInHeader(!0)},t.HeaderTabBoxController.prototype._setViewTabAreaInHeader=function(t){this.tabAreaInHeader!==t&&(this.tabAreaInHeader=t,this.tabAreaCenter.setVisible(!t),this.tabArea.setVisible(t))},t.HeaderTabBoxController.prototype.getTabs=function(){return this.tabAreaInHeader?this.tabArea.getTabs():this.tabAreaCenter.getTabs()},t.DesktopHeaderLayout=function(e){t.DesktopHeaderLayout.parent.call(this),this.header=e,this.desktop=e.desktop},t.inherits(t.DesktopHeaderLayout,t.AbstractLayout),t.DesktopHeaderLayout.prototype.layout=function(e){function i(){return h.width-_-g-m}function o(){u.htmlComp.setSize(new t.Dimension(y,f.height))}function n(){d.htmlComp.setSize(new t.Dimension(_,a.height).subtract(d.htmlComp.getMargins()))}function r(){var e=t.nvl(d.horizontalAlignment,1);1===e?d.htmlComp.$comp.cssLeft(h.width-_-g):d.htmlComp.$comp.cssLeft(0)}var s,a,l=this.header.htmlComp,h=l.getSize(),d=this.header.toolBox,p=this.header.viewButtonBox,u=this.header.tabArea,c=u.htmlComp.layout.smallPrefSize(),f=u.htmlComp.getPreferredSize(),y=0,g=0,m=0,_=0;return h=h.subtract(l.getInsets()),this.header.logo&&(g=t.graphics.getSize(this.header.logo.$container,!0).width),p&&(s=p.htmlComp.getPreferredSize(),m=s.width,p.htmlComp.setSize(s.subtract(p.htmlComp.getMargins()))),u.htmlComp.$comp.cssLeft(m),d&&(a=d.htmlComp.getPreferredSize(),_=a.width,n(),r()),y=i(),y>=c.width?(y=Math.min(f.width,y),void u.htmlComp.setSize(new t.Dimension(y,f.height))):(d&&(a=d.htmlComp.layout.compactPrefSize(),_=a.width,n(),r()),y=i(),y>=c.width?(u.htmlComp.setSize(c),void o()):(d&&(a=d.htmlComp.layout.shrinkPrefSize(),_=a.width,n(),r()),y=i(),y=Math.min(c.width,y),y=Math.max(y,u.tabs.length?t.SimpleTabAreaLayout.OVERFLOW_MENU_WIDTH:0),o(),void(d&&y<=t.SimpleTabAreaLayout.OVERFLOW_MENU_WIDTH&&(_=h.width-y-g-m,n(),_=d.htmlComp.layout.actualPrefSize().width,n(),r()))))},t.DesktopNavigation=function(){t.DesktopNavigation.parent.call(this),this.$container,this.$body,this.viewButtonBox,this._outlinePropertyChangeHandler=this._onOutlinePropertyChange.bind(this),this._desktopPropertyChangeHandler=this._onDesktopPropertyChange.bind(this)},t.inherits(t.DesktopNavigation,t.Widget),t.DesktopNavigation.DEFAULT_STYLE_WIDTH,t.DesktopNavigation.BREADCRUMB_STYLE_WIDTH,t.DesktopNavigation.MIN_WIDTH,t.DesktopNavigation.prototype._init=function(i){t.DesktopNavigation.parent.prototype._init.call(this,i),t.DesktopNavigation.MIN_WIDTH=e.pxToNumber(t.styles.get("desktop-navigation","min-width").minWidth),t.DesktopNavigation.DEFAULT_STYLE_WIDTH=e.pxToNumber(t.styles.get("desktop-navigation","width").width),t.DesktopNavigation.BREADCRUMB_STYLE_WIDTH=e.pxToNumber(t.styles.get("desktop-navigation-breadcrumb","width").width),this.desktop=this.parent,this.layoutData=i.layoutData||{},this.toolBoxVisible=t.nvl(i.toolBoxVisible,!1),this.updateHandleVisibility(),this._syncOutline(i.outline)},t.DesktopNavigation.prototype._render=function(e){this.$container=e.appendDiv("desktop-navigation"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.DesktopNavigationLayout(this)),this.htmlComp.layoutData=this.layoutData,this.$body=this.$container.appendDiv("navigation-body").on("mousedown",this._onNavigationBodyMousedown.bind(this)),this.htmlCompBody=t.HtmlComponent.install(this.$body,this.session),this.htmlCompBody.setLayout(new t.SingleLayout),this.desktop.on("propertyChange",this._desktopPropertyChangeHandler)},t.DesktopNavigation.prototype._remove=function(){this.desktop.off("propertyChange",this._desktopPropertyChangeHandler),t.DesktopNavigation.parent.prototype._remove.call(this)},t.DesktopNavigation.prototype._renderProperties=function(){t.DesktopNavigation.parent.prototype._renderProperties.call(this),
this._renderViewButtonBox(),this._renderToolBoxVisible(),this._renderOutline(),this._renderHandleVisible()},t.DesktopNavigation.prototype._renderViewButtonBox=function(){0!==this.desktop.viewButtons.length&&(this.viewButtonBox=t.create("ViewButtonBox",{parent:this,viewButtons:this.desktop.viewButtons}),this.viewButtonBox.render(this.$container))},t.DesktopNavigation.prototype._removeOutline=function(){this.outline&&this.outline.remove()},t.DesktopNavigation.prototype._renderOutline=function(){this.outline&&(this.outline.render(this.$body),this.outline.invalidateLayoutTree(),this.rendered&&(this.outline.validateLayoutTree(),this.outline.validateFocus()))},t.DesktopNavigation.prototype.setOutline=function(t){this.setProperty("outline",t)},t.DesktopNavigation.prototype._syncOutline=function(e){var i;this.outline&&(i=this.outline.displayStyle),this.rendered&&this._removeOutline(),this.outline=e,this.outline&&(this.outline.setParent(this),this.outline.setBreadcrumbTogglingThreshold(t.DesktopNavigation.BREADCRUMB_STYLE_WIDTH),i&&this.outline.autoToggleBreadcrumbStyle&&this.outline.setDisplayStyle(i),this.outline.inBackground=this.desktop.inBackground,this.outline.on("propertyChange",this._outlinePropertyChangeHandler),this._updateHandle())},t.DesktopNavigation.prototype.sendToBack=function(){this.viewButtonBox&&this.viewButtonBox.sendToBack(),this.outline&&this.outline.sendToBack()},t.DesktopNavigation.prototype.bringToFront=function(){this.viewButtonBox&&this.viewButtonBox.bringToFront(),this.outline&&this.outline.bringToFront()},t.DesktopNavigation.prototype.setToolBoxVisible=function(t){this.setProperty("toolBoxVisible",t)},t.DesktopNavigation.prototype.setHandleVisible=function(t){this.setProperty("handleVisible",t)},t.DesktopNavigation.prototype._updateHandle=function(){this.handle&&this.handle.setRightVisible(this.desktop.outlineDisplayStyle()===t.Tree.DisplayStyle.BREADCRUMB)},t.DesktopNavigation.prototype.updateHandleVisibility=function(){this.setHandleVisible(this.desktop.navigationHandleVisible)},t.DesktopNavigation.prototype._renderToolBoxVisible=function(){this.toolBoxVisible?this._renderToolBox():this._removeToolBox()},t.DesktopNavigation.prototype._renderToolBox=function(){this.toolBox||(this.toolBox=t.create("DesktopToolBox",{parent:this,menus:this.desktop.menus}),this.toolBox.render(this.$container))},t.DesktopNavigation.prototype._removeToolBox=function(){this.toolBox&&(this.toolBox.destroy(),this.toolBox=null)},t.DesktopNavigation.prototype._renderHandleVisible=function(){this.handleVisible?this._renderHandle():this._removeHandle()},t.DesktopNavigation.prototype._renderHandle=function(){this.handle||(this.handle=t.create("DesktopNavigationHandle",{parent:this}),this.handle.render(this.$container),this.handle.$container.addClass("navigation-open"),this.handle.on("action",this._onHandleAction.bind(this)),this._updateHandle())},t.DesktopNavigation.prototype._removeHandle=function(){this.handle&&(this.handle.destroy(),this.handle=null)},t.DesktopNavigation.prototype._onNavigationBodyMousedown=function(t){this.desktop.bringOutlineToFront()},t.DesktopNavigation.prototype._onOutlinePropertyChange=function(t){t.changedProperties.indexOf("displayStyle")!==-1&&this._updateHandle()},t.DesktopNavigation.prototype._onDesktopPropertyChange=function(t){t.changedProperties.indexOf("navigationHandleVisible")!==-1&&this.updateHandleVisibility()},t.DesktopNavigation.prototype._onHandleAction=function(t){t.left?this.desktop.shrinkNavigation():this.desktop.enlargeNavigation()},t.DesktopNavigationHandle=function(){t.DesktopNavigationHandle.parent.call(this)},t.inherits(t.DesktopNavigationHandle,t.CollapseHandle),t.DesktopNavigationHandle.prototype._initKeyStrokeContext=function(){t.DesktopNavigationHandle.parent.prototype._initKeyStrokeContext.call(this),this.desktopKeyStrokeContext=new t.KeyStrokeContext,this.desktopKeyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.desktopKeyStrokeContext.$bindTarget=this.session.desktop.$container,this.desktopKeyStrokeContext.$scopeTarget=this.$container,this.desktopKeyStrokeContext.registerKeyStroke([new t.ShrinkNavigationKeyStroke(this),new t.EnlargeNavigationKeyStroke(this)])},t.DesktopNavigationHandle.prototype._render=function(e){t.DesktopNavigationHandle.parent.prototype._render.call(this,e),this.$container.addClass("desktop-navigation-handle"),this.session.keyStrokeManager.installKeyStrokeContext(this.desktopKeyStrokeContext)},t.DesktopNavigationHandle.prototype._remove=function(){t.DesktopNavigationHandle.parent.prototype._remove.call(this),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.desktopKeyStrokeContext)},t.DesktopNavigationLayout=function(e){t.DesktopNavigationLayout.parent.call(this),this.navigation=e},t.inherits(t.DesktopNavigationLayout,t.AbstractLayout),t.DesktopNavigationLayout.prototype.layout=function(e){var i,o,n,r=this.navigation.htmlComp,s=r.getSize(),a=this.navigation.htmlCompBody,l=this.navigation.toolBox,h=this.navigation.viewButtonBox,d=0,p=0;s=s.subtract(r.getInsets()),h&&(n=h.htmlComp.getPreferredSize(),d=n.height,p=s.width,l&&(p=n.width),o=new t.Dimension(p,d).subtract(h.htmlComp.getMargins()),h.htmlComp.setSize(o)),l&&(l.$container.cssLeft(p),l.htmlComp.setSize(new t.Dimension(s.width-p,d))),i=new t.Dimension(s.width,s.height-d).subtract(a.getMargins()),a.setSize(i),a.$comp.cssTop(d)},t.DesktopNavigationLayout.prototype.preferredLayoutSize=function(e){var i=this.navigation.htmlComp,o=this.navigation.htmlCompBody,n=this.navigation.toolBox,r=this.navigation.viewButtonBox,s=o.getPreferredSize(),a=new t.Dimension(0,0);if(r){var l=r.htmlComp.getPreferredSize();a.width+=l.width,a.height=Math.max(a.height,l.height)}if(n){var h=n.htmlComp.getPreferredSize();a.width+=h.width,a.height=Math.max(a.height,h.height)}return s.height+=a.height,s.width=Math.max(s.width,a.width),s=s.add(i.getInsets())},t.ShrinkNavigationKeyStroke=function(e){t.ShrinkNavigationKeyStroke.parent.call(this),this.field=e,this.desktop=e.session.desktop,this.ctrl=!0,this.which=[t.keys.ANGULAR_BRACKET],this.renderingHints.$drawingArea=function(t,e){return this.desktop.$container}.bind(this)},t.inherits(t.ShrinkNavigationKeyStroke,t.KeyStroke),t.ShrinkNavigationKeyStroke.prototype._isEnabled=function(){var e=t.ShrinkNavigationKeyStroke.parent.prototype._isEnabled.call(this);return e&&this.field.leftVisible},t.ShrinkNavigationKeyStroke.prototype.handle=function(t){this.desktop.shrinkNavigation()},t.ShrinkNavigationKeyStroke.prototype._postRenderKeyBox=function(t,e){var i,o,n,r=this.field;e.addClass("navigation-handle-key-box left"),i=r.$left.offsetTo(this.desktop.$container),o=i.left-e.outerWidth(!0),n=i.top,e.cssLeft(o).cssTop(n)},t.EnlargeNavigationKeyStroke=function(e){t.EnlargeNavigationKeyStroke.parent.call(this),this.field=e,this.desktop=e.session.desktop,this.ctrl=!0,this.shift=!0,this.which=[t.keys.ANGULAR_BRACKET],this.renderingHints.$drawingArea=function(t,e){return this.desktop.$container}.bind(this)},t.inherits(t.EnlargeNavigationKeyStroke,t.KeyStroke),t.EnlargeNavigationKeyStroke.prototype._isEnabled=function(){var e=t.EnlargeNavigationKeyStroke.parent.prototype._isEnabled.call(this);return e&&this.field.rightVisible},t.EnlargeNavigationKeyStroke.prototype.handle=function(t){this.desktop.enlargeNavigation()},t.EnlargeNavigationKeyStroke.prototype._postRenderKeyBox=function(t,e){var i,o,n,r=this.field;e.addClass("navigation-handle-key-box right"),i=r.$right.offsetTo(this.desktop.$container),o=i.left+r.$right.outerWidth(),n=i.top,e.cssLeft(o).cssTop(n)},t.DesktopNotification=function(){t.DesktopNotification.parent.call(this),this.closable=!0,this.status=t.Status.info(),this.duration,this._removeTimeout,this._removing=!1},t.inherits(t.DesktopNotification,t.Widget),t.DesktopNotification.INFINITE=-1,t.DesktopNotification.prototype._init=function(e){t.DesktopNotification.parent.prototype._init.call(this,e),this.desktop=e.desktop||this.session.desktop},t.DesktopNotification.prototype._render=function(e){this.$container=e.prependDiv("notification"),this.$content=this.$container.appendDiv("notification-content"),this.$messageText=this.$content.appendDiv("notification-message"),this.$loader=this.$content.appendDiv("notification-loader"),t.device.supportsCssAnimation()&&this.$loader.addClass("animated")},t.DesktopNotification.prototype._remove=function(){t.DesktopNotification.parent.prototype._remove.call(this),this._removeCloser()},t.DesktopNotification.prototype._renderProperties=function(){t.DesktopNotification.parent.prototype._renderProperties.call(this),this._renderStatus(),this._renderClosable()},t.DesktopNotification.prototype.setStatus=function(t){this.setProperty("status",t)},t.DesktopNotification.prototype._syncStatus=function(t){this.rendered&&this._removeStatus(),this._setProperty("status",t)},t.DesktopNotification.prototype._removeStatus=function(){this.$container.removeClass(t.DesktopNotification.cssClassForSeverity(this.status))},t.DesktopNotification.prototype._renderStatus=function(){this.$container.addClass(t.DesktopNotification.cssClassForSeverity(this.status)),this._renderMessage()},t.DesktopNotification.prototype._renderMessage=function(){var e=t.nvl(t.strings.nl2br(this.status.message),"");this.$messageText.html(e)},t.DesktopNotification.prototype._renderLoading=function(){this.$container.toggleClass("loading",this.loading),this.$loader.setVisible(this.loading)},t.DesktopNotification.prototype.setClosable=function(t){this.setProperty("closable",t)},t.DesktopNotification.prototype._renderClosable=function(){this.$content.toggleClass("closable",this.closable),this.closable?this._renderCloser():this._removeCloser()},t.DesktopNotification.prototype._removeCloser=function(){this.$closer&&(this.$closer.remove(),this.$closer=null)},t.DesktopNotification.prototype._renderCloser=function(){this.$closer||(this.$closer=this.$content.appendDiv("closer").on("click",this._onCloseIconClick.bind(this)))},t.DesktopNotification.prototype._onCloseIconClick=function(){this.hide()},t.DesktopNotification.prototype.show=function(){var t=this.desktop;t.addNotification(this),this.duration>0&&(this._removeTimeout=setTimeout(t.removeNotification.bind(t,this),this.duration))},t.DesktopNotification.prototype.hide=function(){clearTimeout(this._removeTimeout),this.desktop.removeNotification(this)},t.DesktopNotification.prototype.fadeIn=function(t){this.render(t);var e=this.$container,i="notification-slide-in";e.addClass(i),setTimeout(function(){e.removeClass(i)},300)},t.DesktopNotification.prototype.fadeOut=function(t){if(!this._removing){this._removing=!0;var e=this.$container;e.addClass("notification-fade-out"),setTimeout(function(){e.remove(),t&&t()},300)}},t.DesktopNotification.cssClassForSeverity=function(e){var i,o=t.Status.Severity;switch(e.severity){case o.OK:i="ok";break;case o.INFO:i="info";break;case o.WARNING:i="warning";break;case o.ERROR:i="error"}return i},t.OfflineDesktopNotification=function(){t.OfflineDesktopNotification.parent.call(this)},t.inherits(t.OfflineDesktopNotification,t.DesktopNotification),t.OfflineDesktopNotification.prototype._init=function(e){t.OfflineDesktopNotification.parent.prototype._init.call(this,e),this.closable=!1,this.duration=t.DesktopNotification.INFINITE,this.status=new t.Status({message:this.session.text("ui.ConnectionInterrupted"),severity:t.Status.Severity.ERROR})},t.OfflineDesktopNotification.prototype._render=function(e){t.OfflineDesktopNotification.parent.prototype._render.call(this,e),this.$content.addClass("offline-message"),this.$messageText.addClass("offline-message-text"),this.$loader.text(this.session.text("ui.Reconnecting_"))},t.OfflineDesktopNotification.prototype.reconnect=function(){this.setLoading(!0),this.$messageText.hide()},t.OfflineDesktopNotification.prototype.reconnectFailed=function(){this.setLoading(!1),this.$messageText.show()},t.OfflineDesktopNotification.prototype.reconnectSucceeded=function(){this.setLoading(!1),this.setStatus({message:this.session.text("ui.ConnectionReestablished"),severity:t.Status.Severity.OK}),this.$messageText.show()},t.PopupBlockerHandler=function(t){this.session=t},t.PopupBlockerHandler.prototype.openWindow=function(e,i,o){var n;return o=o||"location=no,toolbar=no,menubar=no,resizable=yes,scrollbars=yes",i=i||"scout_"+(new Date).getTime(),t.device.browser===t.Device.Browser.INTERNET_EXPLORER?(n=window.open("",i,o),n&&(n.window.location.href=e)):n=window.open(e,i,o),n},t.PopupBlockerHandler.prototype.showNotification=function(i){var o,n,r=this.session.desktop;"string"==typeof i&&(n=i),o=t.create("DesktopNotification:PopupBlocker",{parent:r,linkUrl:n}),!n&&e.isFunction(i)&&o.on("linkClick",i),o.show()},t.PopupBlockerDesktopNotification=function(){t.PopupBlockerDesktopNotification.parent.call(this),this.linkUrl},t.inherits(t.PopupBlockerDesktopNotification,t.DesktopNotification),t.PopupBlockerDesktopNotification.prototype._init=function(e){t.PopupBlockerDesktopNotification.parent.prototype._init.call(this,e),this.linkText=this.session.text("ui.OpenManually"),this.closable=!0,this.duration=t.DesktopNotification.INFINITE,this.status={message:this.session.text("ui.PopupBlockerDetected"),severity:t.Status.Severity.WARN}},t.PopupBlockerDesktopNotification.prototype._render=function(e){t.PopupBlockerDesktopNotification.parent.prototype._render.call(this,e),this.$messageText.addClass("popup-blocked-title"),this.$link=this.$content.appendElement("<a>","popup-blocked-link").text(this.linkText).on("click",this._onLinkClick.bind(this))},t.PopupBlockerDesktopNotification.prototype._renderProperties=function(){t.PopupBlockerDesktopNotification.parent.prototype._renderProperties.call(this),this._renderLinkUrl()},t.PopupBlockerDesktopNotification.prototype._renderLinkUrl=function(){this.linkUrl?this.$link.attr("href",this.linkUrl).attr("target","_blank"):this.$link.removeAttr("href").removeAttr("target")},t.PopupBlockerDesktopNotification.prototype._onLinkClick=function(){this.trigger("linkClick"),this.hide()},t.DesktopToolBox=function(e){t.DesktopToolBox.parent.call(this)},t.inherits(t.DesktopToolBox,t.MenuBox),t.DesktopToolBox.prototype._init=function(e){e.uiMenuCssClass=t.strings.join(" ",e.uiMenuCssClass,"desktop-tool-box-item"),t.DesktopToolBox.parent.prototype._init.call(this,e)},t.DesktopToolBox.prototype._initMenu=function(e){t.DesktopToolBox.parent.prototype._initMenu.call(this,e),e.popupOpeningDirectionX="left"},t.DesktopToolBox.prototype._render=function(e){t.DesktopToolBox.parent.prototype._render.call(this,e),this.$container.addClass("desktop-tool-box")},t.ViewButton=function(){t.ViewButton.parent.call(this),this.inBackground=!1},t.inherits(t.ViewButton,t.Action),t.ViewButton.prototype._render=function(t){this._isMenu()?this._renderAsMenuItem(t):this._renderAsTab(t)},t.ViewButton.prototype._renderProperties=function(){t.ViewButton.parent.prototype._renderProperties.call(this),this._renderInBackground()},t.ViewButton.prototype._isMenu=function(){return"MENU"===this.displayStyle},t.ViewButton.prototype._isTab=function(){return"TAB"===this.displayStyle},t.ViewButton.prototype._renderAsMenuItem=function(t){this.$container=t.appendDiv("view-menu-item").on("click",this._onMouseEvent.bind(this))},t.ViewButton.prototype._renderAsTab=function(t){this.$container=t.appendDiv("view-button-tab").on("mousedown",this._onMouseEvent.bind(this))},t.ViewButton.prototype._renderText=function(){this._isMenu()&&t.ViewButton.parent.prototype._renderText.call(this)},t.ViewButton.prototype._renderIconId=function(){this._isTab()&&this.$container.icon(this.iconId)},t.ViewButton.prototype._renderInBackground=function(){this.$container.toggleClass("in-background",this.inBackground)},t.ViewButton.prototype.last=function(){this.$container.addClass("last")},t.ViewButton.prototype.sendToBack=function(){this.inBackground=!0,this.rendered&&this._renderInBackground()},t.ViewButton.prototype.bringToFront=function(){this.inBackground=!1,this.rendered&&this._renderInBackground()},t.ViewButton.prototype._onMouseEvent=function(t){this.doAction()},t.ViewButton.prototype._createActionKeyStroke=function(){return new t.ViewButtonActionKeyStroke(this)},t.ViewButtonActionKeyStroke=function(e){t.ViewButtonActionKeyStroke.parent.call(this,e)},t.inherits(t.ViewButtonActionKeyStroke,t.ActionKeyStroke),t.ViewButtonActionKeyStroke.prototype._postRenderKeyBox=function(t){if(this.field.iconId&&this.field._isTab()){var e=t.outerWidth(),i=t.find(".key-box").outerWidth(),o=e/2-i/2;t.find(".key-box").css("left",o+"px")}},t.ViewButtonActionKeyStroke.prototype.renderKeyBox=function(e,i){return this.field._isMenu()&&(this.renderingHints.hAlign=t.hAlign.RIGHT),t.ViewButtonActionKeyStroke.parent.prototype.renderKeyBox.call(this,e,i)},t.ViewButtonAdapter=function(){t.ViewButtonAdapter.parent.call(this)},t.inherits(t.ViewButtonAdapter,t.ActionAdapter),t.ViewButtonBox=function(){t.ViewButtonBox.parent.call(this),this.viewMenuTab,this.viewTabs,this.viewButtons=[],this._desktopOutlineChangedHandler=this._onDesktopOutlineChanged.bind(this),this._viewButtonPropertyChangeHandler=this._onViewButtonPropertyChange.bind(this),this._addAdapterProperties(["viewButtons"])},t.inherits(t.ViewButtonBox,t.Widget),t.ViewButtonBox.prototype._init=function(e){t.ViewButtonBox.parent.prototype._init.call(this,e),this.desktop=this.session.desktop},t.ViewButtonBox.prototype._render=function(e){this.$container=e.appendDiv("view-button-box"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.ViewButtonBoxLayout(this)),this.viewMenuTab=t.create("ViewMenuTab",{parent:this,viewMenus:this._viewButtons("MENU")}),this.viewMenuTab.render(this.$container),this.viewTabs=this._viewButtons("TAB"),this.viewTabs.forEach(function(t,e){t.render(this.$container),e===this.viewTabs.length-1&&t.last()},this),this._onDesktopOutlineChanged(),this.viewButtons.forEach(function(t){t.on("propertyChange",this._viewButtonPropertyChangeHandler)},this),this.desktop.on("outlineChanged",this._desktopOutlineChangedHandler)},t.ViewButtonBox.prototype._remove=function(){this.desktop.off("outlineChanged",this._desktopOutlineChangedHandler),this.viewButtons.forEach(function(t){t.off("selected",this._viewButtonPropertyChangeHandler)},this),t.ViewButtonBox.parent.prototype._remove.call(this)},t.ViewButtonBox.prototype._viewButtons=function(t){var e=[];return this.viewButtons.forEach(function(o){t!==i&&t!==o.displayStyle||e.push(o)}),e},t.ViewButtonBox.prototype.sendToBack=function(){this.viewMenuTab.sendToBack(),this.viewTabs.forEach(function(t){t.sendToBack()},this)},t.ViewButtonBox.prototype.bringToFront=function(){this.viewMenuTab.bringToFront(),this.viewTabs.forEach(function(t){t.bringToFront()},this)},t.ViewButtonBox.prototype._onDesktopOutlineChanged=function(e){var i=this.desktop.outline;this._viewButtons().forEach(function(e){e instanceof t.OutlineViewButton&&e.onOutlineChanged(i)})},t.ViewButtonBox.prototype._onViewButtonSelected=function(t){this.viewButtons.forEach(function(e){e!==t.source&&e.isToggleAction()&&e.setSelected(!1)},this),this.viewMenuTab.onViewButtonSelected()},t.ViewButtonBox.prototype._onViewButtonPropertyChange=function(t){t.changedProperties.indexOf("selected")!==-1&&this._onViewButtonSelected(t)},t.ViewButtonBoxLayout=function(e){t.ViewButtonBoxLayout.parent.call(this),this.viewButtonBox=e},t.inherits(t.ViewButtonBoxLayout,t.AbstractLayout),t.ViewButtonBoxLayout.prototype.layout=function(t){var i=this.viewButtonBox.htmlComp,o=i.getBounds(),n=t.children(":visible"),r=n.length,s=o.width/r;n.each(function(){var t=e(this);t.cssWidth(s)})},t.ViewButtonBoxLayout.prototype.preferredLayoutSize=function(e){return t.graphics.prefSize(e,{useCssSize:!0})},t.ViewMenuOpenKeyStroke=function(e){t.ViewMenuOpenKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.F2],this.stopPropagation=!0,this.renderingHints.$drawingArea=function(t,e){return this.field.$container}.bind(this)},t.inherits(t.ViewMenuOpenKeyStroke,t.KeyStroke),t.ViewMenuOpenKeyStroke.prototype.handle=function(t){this.field.togglePopup()},t.ViewMenuOpenKeyStroke.prototype._postRenderKeyBox=function(t){var e=t.outerWidth(),i=t.find(".key-box").outerWidth(),o=e/2-i/2;t.find(".key-box").css("left",o+"px")},t.ViewMenuPopup=function(){t.ViewMenuPopup.parent.call(this),this.$tab,this.$headBlueprint,this.viewMenus,this.viewButtonBoxBounds,this._tooltip,this._addAdapterProperties("viewMenus"),this._viewMenuDoActionHandler=this._onViewMenuDoAction.bind(this)},t.inherits(t.ViewMenuPopup,t.PopupWithHead),t.ViewMenuPopup.MAX_MENU_WIDTH=300,t.ViewMenuPopup.prototype._init=function(e){e.focusableContainer=!0,t.ViewMenuPopup.parent.prototype._init.call(this,e),this.$tab=e.$tab,this.$headBlueprint=this.$tab,this.viewButtonBoxBounds=e.naviBounds},t.ViewMenuPopup.prototype._createLayout=function(){return new t.ViewMenuPopupLayout(this)},t.ViewMenuPopup.prototype._initKeyStrokeContext=function(){t.ViewMenuPopup.parent.prototype._initKeyStrokeContext.call(this),t.menuNavigationKeyStrokes.registerKeyStrokes(this.keyStrokeContext,this,"view-menu-item")},t.ViewMenuPopup.prototype._render=function(e){t.ViewMenuPopup.parent.prototype._render.call(this,e),this.viewMenus.forEach(function(t){t.render(this.$body),t.on("doAction",this._viewMenuDoActionHandler)},this);var i=t.arrays.findFromPrev(this.viewMenus,this.viewMenus.length-1,function(t){return t.visible},this);i.$container.addClass("last"),t.scrollbars.install(this.$body,{parent:this,axis:"y"})},t.ViewMenuPopup.prototype._remove=function(){this.viewMenus.forEach(function(t){t.off("doAction",this._viewMenuDoActionHandler)},this),t.ViewMenuPopup.parent.prototype._remove.call(this)},t.ViewMenuPopup.prototype._renderHead=function(){t.ViewMenuPopup.parent.prototype._renderHead.call(this),this._copyCssClassToHead("view-button-tab"),this._copyCssClassToHead("unfocusable"),this.$head.removeClass("popup-head menu-item"),this.$head.addClass("view-menu-popup-head")},t.ViewMenuPopup.prototype._modifyBody=function(){this.$body.removeClass("popup-body"),this.$body.addClass("view-menu-popup-body")},t.ViewMenuPopup.prototype._modifyHeadChildren=function(){this.$head.find(".arrow-icon").addClass("menu-open")},t.ViewMenuPopup.prototype.position=function(){var e=this.$tab.offset(),i=t.graphics.getSize(this.$tab,!0),o=i.height;t.graphics.setBounds(this.$head,e.left,e.top,i.width,i.height),this.$deco.cssLeft(e.left),this.$deco.cssTop(0),this.$deco.cssWidth(i.width-1),this.$head.cssTop(-o),this.$body.cssTop(0),this.$container.cssMarginTop(i.height),this.setLocation(new t.Point(0,0))},t.ViewMenuPopup.prototype._onViewMenuDoAction=function(t){this.close()},t.ViewMenuPopupLayout=function(e){t.ViewMenuPopupLayout.parent.call(this,e)},t.inherits(t.ViewMenuPopupLayout,t.PopupWithHeadLayout),t.ViewMenuPopupLayout.prototype.preferredLayoutSize=function(e){var i=t.ViewMenuPopupLayout.parent.prototype.preferredLayoutSize.call(this,e);return i.width>=this.popup.viewButtonBoxBounds.width?i:(i.width=Math.min(t.ViewMenuPopup.MAX_MENU_WIDTH,this.popup.viewButtonBoxBounds.width),i)},t.ViewMenuTab=function(){t.ViewMenuTab.parent.call(this),this.$container,this.$arrowIcon,this.viewButton=null,this.viewMenus=[],this.selected=!1,this.iconId,this.inBackground=!1,this.visible=!0,this.defaultIconId=t.icons.OUTLINE,this._viewMenuPropertyChangeHandler=this._onViewMenuPropertyChange.bind(this),this._addAdapterProperties("viewMenus")},t.inherits(t.ViewMenuTab,t.Widget),t.ViewMenuTab.prototype._init=function(e){t.ViewMenuTab.parent.prototype._init.call(this,e),this.viewMenus.forEach(function(t){t.on("propertyChange",this._viewMenuPropertyChangeHandler)},this),this._update(),this.updateVisibility()},t.ViewMenuTab.prototype._initKeyStrokeContext=function(){t.ViewMenuTab.parent.prototype._initKeyStrokeContext.call(this),this.desktopKeyStrokeContext=new t.KeyStrokeContext,this.desktopKeyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.desktopKeyStrokeContext.$bindTarget=this.session.desktop.$container,this.desktopKeyStrokeContext.$scopeTarget=this.$container,this.desktopKeyStrokeContext.registerKeyStroke([new t.ViewMenuOpenKeyStroke(this)])},t.ViewMenuTab.prototype._update=function(){var t=this._findSelectedViewButton();t?this.selected=!0:(t=this.viewMenus[0],this.selected=!1),this.viewButton=t,this.iconId=this.outlineViewButton&&this.outlineViewButton.iconId||this.defaultIconId},t.ViewMenuTab.prototype._render=function(e){this.$container=e.appendDiv("view-button-tab").unfocusable().on("mousedown",this.togglePopup.bind(this)),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.$arrowIcon=this.$container.appendSpan("arrow-icon").on("mousedown",this.togglePopup.bind(this)),this.session.keyStrokeManager.installKeyStrokeContext(this.desktopKeyStrokeContext)},t.ViewMenuTab.prototype._remove=function(){this.session.keyStrokeManager.uninstallKeyStrokeContext(this.desktopKeyStrokeContext),t.ViewMenuTab.parent.prototype._remove.call(this)};t.ViewMenuTab.prototype._renderProperties=function(){t.ViewMenuTab.parent.prototype._renderProperties.call(this),this._renderIconId(),this._renderSelected(),this._renderInBackground()};t.ViewMenuTab.prototype._renderVisible=function(){this.$container.setVisible(this.visible),this.invalidateLayoutTree()},t.ViewMenuTab.prototype._renderSelected=function(){this.$container.select(this.selected),this._updateArrowIconVisibility()},t.ViewMenuTab.prototype._renderIconId=function(){this.$container.icon(this.iconId)},t.ViewMenuTab.prototype._renderInBackground=function(){this.$container.toggleClass("in-background",this.inBackground)},t.ViewMenuTab.prototype._updateArrowIconVisibility=function(){this.$arrowIcon.toggleClass("hidden",!this.selected||this.inBackground)},t.ViewMenuTab.prototype._findSelectedViewButton=function(){for(var t,e=0;e<this.viewMenus.length;e++)if(t=this.viewMenus[e],t.selected)return t;return null},t.ViewMenuTab.prototype.togglePopup=function(){if(this.selected){if(!this.inBackground)return this.popup?this._closePopup():this._openPopup(),!1;this.session.desktop.bringOutlineToFront(this.viewButton.outline)}else this.viewButton.doAction()},t.ViewMenuTab.prototype._openPopup=function(){if(!this.popup){var e=t.graphics.bounds(this.$container.parent(),!0);this.popup=t.create("ViewMenuPopup",{parent:this,$tab:this.$container,viewMenus:this.viewMenus,naviBounds:e}),this.$container.addClass("popup-open"),this.popup.headText=this.text,this.popup.open(),this.popup.on("remove",function(t){this.$container.removeClass("popup-open"),this.popup=null}.bind(this))}},t.ViewMenuTab.prototype._closePopup=function(){this.popup&&this.popup.close()},t.ViewMenuTab.prototype.setSelected=function(t){this.setProperty("selected",t)},t.ViewMenuTab.prototype.setIconId=function(t){this.setProperty("iconId",t)},t.ViewMenuTab.prototype.updateVisibility=function(){this.setVisible(this.viewMenus.some(function(t){return t.visible}))},t.ViewMenuTab.prototype.sendToBack=function(){this.inBackground=!0,this._renderInBackground(),this._renderSelected(),this._closePopup()},t.ViewMenuTab.prototype.bringToFront=function(){this.inBackground=!1,this._renderInBackground(),this._renderSelected()},t.ViewMenuTab.prototype._onViewMenuPropertyChange=function(t){t.changedProperties.indexOf("visible")!==-1&&this.updateVisibility()},t.ViewMenuTab.prototype.onViewButtonSelected=function(){var t=this._findSelectedViewButton();t?(this.viewButton=t,this.setIconId(this.viewButton.iconId||this.defaultIconId),this.setSelected(!0)):this.setSelected(!1),this._closePopup()},t.Page=function(){t.Page.parent.call(this),this.nodeType,this.detailTable,this.detailTableVisible=!0,this.detailForm,this.detailFormVisible=!0,this.detailFormVisibleByUi=!0,this.detailFormType=null,this.tableStatusVisible=!0},t.inherits(t.Page,t.TreeNode),t.Page.NodeType={NODES:"nodes",TABLE:"table"},t.Page.prototype.createDetailForm=function(){return null},t.Page.prototype._init=function(e){t.Page.parent.prototype._init.call(this,e),this._internalInitTable(),this._internalInitDetailForm()},t.Page.prototype._internalInitTable=function(){var t=this.detailTable;t=t?this.getOutline()._createChild(t):this._createTable(),t&&(this._initTable(t),t.setTableStatusVisible(this.tableStatusVisible)),this.detailTable=t},t.Page.prototype._internalInitDetailForm=function(){var t=this.detailForm;t&&(t=this.getOutline()._createChild(t)),this.detailForm=t},t.Page.prototype._createTable=function(){return null},t.Page.prototype._initTable=function(t){t.on("rowsFiltered",this._onTableRowsFiltered.bind(this))},t.Page.prototype._onTableRowsFiltered=function(t){this.getOutline().mediator.onTableRowsFiltered(t,this)},t.Page.prototype._ensureDetailForm=function(){this.detailForm||(this.detailForm=this.createDetailForm())},t.Page.prototype.activate=function(){this._ensureDetailForm()},t.Page.prototype.deactivate=function(){},t.Page.prototype.getOutline=function(){return this.parent},t.Page.prototype.pagesForTableRows=function(t){return t.map(this.pageForTableRow)},t.Page.prototype.pageForTableRow=function(t){if(!t.page)throw new Error("Table-row is not linked to a page");return t.page},t.Page.prototype._pageParam=function(t){var i={parent:this.getOutline()};return e.extend(i,t),i},t.Page.prototype.reloadPage=function(){var t=this.getOutline();t&&this.loadChildren()},t.Page.linkRowWithPage=function(t,e){t.page=e,e.row=t},t.Page.unlinkRowWithPage=function(t,e){delete t.page,delete e.row},t.PageWithNodes=function(){t.PageWithNodes.parent.call(this),this.nodeType=t.Page.NodeType.NODES},t.inherits(t.PageWithNodes,t.Page),t.PageWithNodes.prototype._createTable=function(){var e=t.create("Column",{index:0,id:"NodeColumn",session:this.session}),i=t.create("Table",{parent:this.parent,id:"PageWithNodesTable",autoResizeColumns:!0,headerVisible:!1,columns:[e]});return i.on("rowAction",this._onDetailTableRowAction.bind(this)),i},t.PageWithNodes.prototype._onDetailTableRowAction=function(t){var e=t.source.rowsMap[t.row.id],i=e.node;this.getOutline().selectNode(i)},t.PageWithNodes.prototype._rebuildDetailTable=function(t){var e=this.detailTable;this._unlinkAllTableRows(e.rows),e.deleteAllRows();var i=this._createTableRowsForChildPages(t);e.insertRows(i)},t.PageWithNodes.prototype._unlinkAllTableRows=function(e){e.forEach(function(e){t.Page.unlinkRowWithPage(e)})},t.PageWithNodes.prototype._createTableRowsForChildPages=function(e){return e.map(function(e){var i=t.create("TableRow",{parent:this.detailTable,cells:[e.text]});return t.Page.linkRowWithPage(i,e),i},this)},t.PageWithNodes.prototype.loadChildren=function(){return this.childrenLoaded=!1,this._createChildPages().done(function(t){this._rebuildDetailTable(t),t.length>0&&this.getOutline().insertNodes(t,this),this.childrenLoaded=!0}.bind(this))},t.PageWithNodes.prototype._createChildPages=function(){return e.resolvedDeferred()},t.PageWithTable=function(){t.PageWithTable.parent.call(this),this.nodeType=t.Page.NodeType.TABLE,this.alwaysCreateChildPage=!1},t.inherits(t.PageWithTable,t.Page),t.PageWithTable.prototype._initTable=function(e){t.PageWithTable.parent.prototype._initTable.call(this,e),e.on("rowsDeleted allRowsDeleted",this._onTableRowsDeleted.bind(this)),e.on("rowsInserted",this._onTableRowsInserted.bind(this)),e.on("rowAction",this._onTableRowAction.bind(this)),e.on("rowOrderChanged",this._onTableRowOrderChanged.bind(this))},t.PageWithTable.prototype._onTableRowsDeleted=function(e){if(!this.leaf){var i=t.arrays.ensure(e.rows),o=i.map(function(e){var i=e.page;return t.Page.unlinkRowWithPage(e,i),i},this);this.getOutline().mediator.onTableRowsDeleted(i,o,this)}},t.PageWithTable.prototype._onTableRowsInserted=function(e){if(!this.leaf){var i=t.arrays.ensure(e.rows),o=i.map(function(t){return this._createChildPageInternal(t)},this);this.getOutline().mediator.onTableRowsInserted(i,o,this)}},t.PageWithTable.prototype._onTableRowAction=function(t){this.getOutline().mediator.onTableRowAction(t,this)},t.PageWithTable.prototype._onTableRowOrderChanged=function(t){t.animating||this.getOutline().mediator.onTableRowOrderChanged(t,this);
},t.PageWithTable.prototype._createChildPageInternal=function(e){var i=this.createChildPage(e);return null===i&&this.alwaysCreateChildPage&&(i=this.createDefaultChildPage(e)),t.Page.linkRowWithPage(e,i),i},t.PageWithTable.prototype.createChildPage=function(t){return null},t.PageWithTable.prototype.createDefaultChildPage=function(e){return t.create("AutoLeafPageWithNodes",{parent:this.getOutline(),row:e})},t.PageWithTable.prototype.loadChildren=function(){return this.detailTable?this.loadTableData():e.resolvedDeferred()},t.PageWithTable.prototype.loadTableData=function(){return this.detailTable.deleteAllRows(),this._loadTableData().done(this._onLoadTableDataDone.bind(this)).fail(this._onLoadTableDataFail.bind(this)).always(this._onLoadTableDataAlways.bind(this))},t.PageWithTable.prototype._loadTableData=function(){return e.resolvedDeferred()},t.PageWithTable.prototype._onLoadTableDataDone=function(t){var e=this._transformTableDataToTableRows(t);e&&e.length>0&&this.detailTable.insertRows(e)},t.PageWithTable.prototype._onLoadTableDataFail=function(t){e.log.error("Failed to load tableData. error=",t)},t.PageWithTable.prototype._onLoadTableDataAlways=function(){this.childrenLoaded=!0},t.PageWithTable.prototype._transformTableDataToTableRows=function(t){return t},t.AutoLeafPageWithNodes=function(){t.AutoLeafPageWithNodes.parent.call(this),this.leaf=!0},t.inherits(t.AutoLeafPageWithNodes,t.Page),t.AutoLeafPageWithNodes.prototype._init=function(e){t.assertParameter("row",e.row,t.TableRow),t.AutoLeafPageWithNodes.parent.prototype._init.call(this,e),this.text=this.row.cells[0]},t.SimpleTab=function(){t.SimpleTab.parent.call(this),this.title,this.subTitle,this.iconId,this._mouseListener,this.$container},t.inherits(t.SimpleTab,t.Widget),t.SimpleTab.prototype._init=function(e){t.SimpleTab.parent.prototype._init.call(this,e),this.title=e.title,this.subTitle=e.subTitle,this.iconId=e.iconId,this.selected=!1},t.SimpleTab.prototype.renderAfter=function(t,e){this.render(t),e&&this.$container.insertAfter(e.$container)},t.SimpleTab.prototype._render=function(t){this.$container=t.prependDiv("desktop-view-tab"),this._mouseListener=this._onMouseDown.bind(this),this.$container.on("mousedown",this._mouseListener),this._$title=this.$container.appendDiv("title"),this._$subTitle=this.$container.appendDiv("sub-title"),this._titlesUpdated(),this._renderSelection(),this._cssClassUpdated(this.view.cssClass,null)},t.SimpleTab.prototype._renderSelection=function(){if(this.$container){if(this.$container.select()===this.selected)return;this.$container.select(this.selected)}},t.SimpleTab.prototype.select=function(){this.selected=!0,this._renderSelection()},t.SimpleTab.prototype.deselect=function(){this.selected=!1,this._renderSelection()},t.SimpleTab.prototype._onMouseDown=function(t){this.trigger("tabClicked")},t.SimpleTab.prototype.setTitle=function(t){this.title!==t&&(this._setProperty("title",t),this._titlesUpdated())},t.SimpleTab.prototype.setSubTitle=function(t){this.subTitle!==t&&(this.subTitle=t,this._setProperty("subTitle",t),this._titlesUpdated())},t.SimpleTab.prototype.setIconId=function(t){this.iconId!==t&&(this._setProperty("iconId",t),this._titlesUpdated())},t.SimpleTab.prototype._titlesUpdated=function(){function t(t,e){t.textOrNbsp(e)}this.$container&&(t(this._$title,this.title),t(this._$subTitle,this.subTitle),this.$container.icon(this.view.iconId))},t.SimpleTab.prototype.getMenuText=function(){var t=this.title;return this.subTitle&&(t+=" ("+this.subTitle+")"),t},t.DesktopTab=function(){t.DesktopTab.parent.call(this),this.view,this._propertyChangeListener=function(e){t.arrays.containsAny(e.changedProperties,["title"])?this.setTitle(this.view.title):t.arrays.containsAny(e.changedProperties,["subTitle"])?this.setSubTitle(this.view.subTitle):t.arrays.containsAny(e.changedProperties,["iconId"])?this.setIconId(this.view.iconId):t.arrays.containsAny(e.changedProperties,["cssClass"])&&this._cssClassUpdated(e.newProperties.cssClass,e.oldProperties.cssClass)}.bind(this),this._removeListener=this._onViewRemoved.bind(this)},t.inherits(t.DesktopTab,t.SimpleTab),t.DesktopTab.prototype._init=function(e){this.view=e.view,e.title=this.view.title,e.subTitle=this.view.subTitle,e.iconId=this.view.iconId,t.DesktopTab.parent.prototype._init.call(this,e),this._installListeners()},t.DesktopTab.prototype._installListeners=function(){this.view.on("propertyChange",this._propertyChangeListener),this.view.on("remove",this._removeListener)},t.DesktopTab.prototype._uninstallListeners=function(){this.view.off("propertyChange",this._propertyChangeListener),this.view.off("remove",this._removeListener)},t.DesktopTab.prototype._cssClassUpdated=function(t,e){this.$container&&(this.$container.removeClass(e),this.$container.addClass(t))},t.DesktopTab.prototype._onViewRemoved=function(){this._uninstallListeners(),this.rendered?this.remove():this.trigger("remove")},t.SimpleTabArea=function(){t.SimpleTabArea.parent.call(this),this.tabs=[]},t.inherits(t.SimpleTabArea,t.Widget),t.SimpleTabArea.prototype._init=function(e){t.SimpleTabArea.parent.prototype._init.call(this,e),this._selectedViewTab,this._viewTabSelectionHandler=this._onTabSelection.bind(this)},t.SimpleTabArea.prototype._render=function(e){this.$container=e.appendDiv("simple-tab-area"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.SimpleTabAreaLayout(this))},t.SimpleTabArea.prototype._renderProperties=function(){t.SimpleTabArea.parent.prototype._renderProperties.call(this),this._renderTabs()},t.SimpleTabArea.prototype._renderTabs=function(){this.tabs.reverse().forEach(function(t){this._renderTab(t)}.bind(this))},t.SimpleTabArea.prototype._renderTab=function(t){t.renderAfter(this.$container)},t.SimpleTabArea.prototype._renderVisible=function(){this.visible&&this.tabs.length>0?this.attach():this.detach(),this.invalidateLayoutTree()},t.SimpleTabArea.prototype._attach=function(){this.$parent.prepend(this.$container),this.session.detachHelper.afterAttach(this.$container),this.invalidateLayoutTree(!1),t.SimpleTabArea.parent.prototype._attach.call(this)},t.SimpleTabArea.prototype._detach=function(){this.session.detachHelper.beforeDetach(this.$container),this.$container.detach(),t.SimpleTabArea.parent.prototype._detach.call(this),this.invalidateLayoutTree(!1)},t.SimpleTabArea.prototype._onTabSelection=function(t){this.selectTab(t.source)},t.SimpleTabArea.prototype.getTabs=function(){return this.tabs},t.SimpleTabArea.prototype.selectTab=function(t){this._selectedViewTab!==t&&(this.deselectTab(this._selectedViewTab),this._selectedViewTab=t,t&&t.select(),this.trigger("tabSelected",{viewTab:t}))},t.SimpleTabArea.prototype.deselectTab=function(t){t&&this._selectedViewTab===t&&this._selectedViewTab.deselect()},t.SimpleTabArea.prototype.getSelectedTab=function(){return this._selectedViewTab},t.SimpleTabArea.prototype.addTab=function(t,e){var i=-1;e&&(i=this.tabs.indexOf(e)),this.tabs.splice(i+1,0,t),t.on("tabClicked",this._viewTabSelectionHandler),this.rendered&&(this._renderVisible(),t.renderAfter(this.$container,e),this.invalidateLayoutTree())},t.SimpleTabArea.prototype.destroyTab=function(t){var e=this.tabs.indexOf(t);e>-1&&(this.tabs.splice(e,1),t.destroy(),t.off("tabClicked",this._viewTabSelectionHandler),this._renderVisible(),this.invalidateLayoutTree())},t.SimpleTabAreaLayout=function(e){t.SimpleTabAreaLayout.parent.call(this),this.tabArea=e,this._$overflowTab,this._overflowTabsIndizes=[]},t.inherits(t.SimpleTabAreaLayout,t.AbstractLayout),t.SimpleTabAreaLayout.TAB_WIDTH_LARGE=220,t.SimpleTabAreaLayout.TAB_WIDTH_SMALL=130,t.SimpleTabAreaLayout.OVERFLOW_MENU_WIDTH=30,t.SimpleTabAreaLayout.prototype.layout=function(i){var o,n=this.tabArea.htmlComp,r=n.getSize(),s=n.$comp.find(".desktop-view-tab"),a=this.tabArea.getTabs().length,l=this.smallPrefSize();if(r=r.subtract(n.getInsets()),this._$overflowTab&&this._$overflowTab.remove(),s.setVisible(!0),this._overflowTabsIndizes=[],l.width<=r.width)return o=Math.min(t.SimpleTabAreaLayout.TAB_WIDTH_LARGE,Math.floor(r.width/a)),void s.each(function(){e(this).outerWidth(o)});r.width-=t.SimpleTabAreaLayout.OVERFLOW_MENU_WIDTH;var h=Math.floor(r.width/t.SimpleTabAreaLayout.TAB_WIDTH_SMALL),d=a-h,p=0,u=0;s.each(function(){e(this).hasClass("selected")&&(u=p),p++});var c,f=u-Math.floor(h/2);f<0?(f=0,c=h-1):(c=f+h-1,c>a-1&&(c=a-1,f=c-h+1)),this._$overflowTab=n.$comp.appendDiv("overflow-tab-item").on("mousedown",this._onMouseDownOverflow.bind(this)),d>1&&this._$overflowTab.appendDiv("num-tabs").text(d);var y=this;o=t.SimpleTabAreaLayout.TAB_WIDTH_SMALL,p=0,s.each(function(){p>=f&&p<=c?e(this).outerWidth(o):(e(this).setVisible(!1),y._overflowTabsIndizes.push(p)),p++})},t.SimpleTabAreaLayout.prototype.smallPrefSize=function(){var e=this.tabArea.getTabs().length;return new t.Dimension(e*t.SimpleTabAreaLayout.TAB_WIDTH_SMALL,this.tabArea.htmlComp.$comp.outerHeight(!0))},t.SimpleTabAreaLayout.prototype.preferredLayoutSize=function(e){var i=this.tabArea.getTabs().length;return new t.Dimension(i*t.SimpleTabAreaLayout.TAB_WIDTH_LARGE,t.graphics.prefSize(this.tabArea.htmlComp.$comp,{includeMargin:!0,useCssSize:!0}).height)},t.SimpleTabAreaLayout.prototype._onMouseDownOverflow=function(i){var o,n,r,s=this.tabArea,a=[];this._overflowTabsIndizes.forEach(function(i){n=this.tabArea.getTabs()[i],o=t.create("Menu",{parent:this.tabArea,text:n.getMenuText(),tab:n}),o.on("doAction",function(){e.log.debug("(SimpleTabAreaLayout#_onMouseDownOverflow) tab="+this),s.selectTab(this)}.bind(n)),a.push(o)},this),r=t.create("ContextMenuPopup",{parent:this.tabArea,menuItems:a,cloneMenuItems:!1,location:{x:i.pageX,y:i.pageY}}),r.open()},t.DetailTableTreeFilter=function(){},t.DetailTableTreeFilter.prototype.accept=function(t){return!t.parentNode||!!t.parentNode.filterAccepted&&(!t.parentNode.detailTable||(!t.row||t.row.filterAccepted))},t.Outline=function(){t.Outline.parent.call(this),this._addAdapterProperties(["defaultDetailForm","views","dialogs","messageBoxes","fileChoosers"]),this.autoToggleBreadcrumbStyle=!0,this.navigateButtonsVisible=!0,this.dialogs=[],this.views=[],this.messageBoxes=[],this.fileChoosers=[],this.navigateUpInProgress=!1,this._additionalContainerClasses+=" outline",this._treeItemPaddingLeft=37,this._treeItemPaddingLevel=20,this.inBackground=!1,this.embedDetailContent=!1,this.compact=!1,this.formController,this.messageBoxController,this.fileChooserController,this._scrolldirections="y",this.titleVisible=!0,this.mediator},t.inherits(t.Outline,t.Tree),t.Outline.prototype._init=function(e){this.addFilter(new t.DetailTableTreeFilter,!0),t.Outline.parent.prototype._init.call(this,e),this.mediator=this._createMediator(),this.formController=new t.FormController(this,this.session),this.messageBoxController=new t.MessageBoxController(this,this.session),this.fileChooserController=new t.FileChooserController(this,this.session),this.resolveTextKeys(["title"]),this._syncDefaultDetailForm(this.defaultDetailForm),this._detailContentDestroyHandler=this._onDetailContentDestroy.bind(this),this.titleMenuBar=t.create("MenuBar",{parent:this,menuOrder:new t.GroupBoxMenuItemsOrder}),this.nodeMenuBar=t.create("MenuBar",{parent:this,menuOrder:new t.GroupBoxMenuItemsOrder}),this.nodeMenuBar.bottom(),this.detailMenuBar=t.create("MenuBar",{parent:this,menuOrder:new t.GroupBoxMenuItemsOrder}),this.detailMenuBar.bottom(),this._syncDefaultDetailForm(this.defaultDetailForm),this._syncOutlineOverviewVisible(this.outlineOverviewVisible),this._syncMenus(this.menus),this.updateDetailContent()},t.Outline.prototype._createMediator=function(){return t.create("OutlineMediator")},t.Outline.prototype._createTreeNode=function(e){return e.parent=this,t.create("Page",e)},t.Outline.prototype._applyNodeDefaultValues=function(e){t.defaultValues.applyTo(e,"Page")},t.Outline.prototype._createKeyStrokeContext=function(){return new t.OutlineKeyStrokeContext(this)},t.Outline.prototype._filterMenus=function(t,e,i,o){return[]},t.Outline.prototype._initTreeKeyStrokeContext=function(){var e=t.keyStrokeModifier.CTRL|t.keyStrokeModifier.SHIFT;this.keyStrokeContext.registerKeyStroke([new t.TreeNavigationUpKeyStroke(this,e),new t.TreeNavigationDownKeyStroke(this,e),new t.OutlineNavigateToTopKeyStroke(this,e),new t.TreeNavigationEndKeyStroke(this,e),new t.TreeCollapseOrDrillUpKeyStroke(this,e),new t.TreeExpandOrDrillDownKeyStroke(this,e)]),this.keyStrokeContext.$bindTarget=function(){return this.session.$entryPoint}.bind(this)},t.Outline.prototype._render=function(e){t.Outline.parent.prototype._render.call(this,e),this.htmlComp.setLayout(new t.OutlineLayout(this)),this._renderCompact(),this._renderEmbedDetailContent(),this._renderDetailContent(),this._renderDetailMenuBarVisible(),this._renderNodeMenuBarVisible()},t.Outline.prototype._renderProperties=function(){t.Outline.parent.prototype._renderProperties.call(this),this._renderTitle(),this._renderTitleMenuBar()},t.Outline.prototype._remove=function(){t.Outline.parent.prototype._remove.call(this),this._removeTitle()},t.Outline.prototype._renderTitle=function(){this.titleVisible&&(this.$title||(this.$title=this.$container.prependDiv("outline-title"),this.$titleText=this.$title.prependDiv("outline-title-text").on("click",this._onTitleClick.bind(this))),this.$titleText.text(this.title))},t.Outline.prototype._removeTitle=function(){this.titleVisible&&(this.$title.remove(),this.$title=null)},t.Outline.prototype._renderTitleMenuBar=function(){this.titleVisible&&(this.titleMenuBar.render(this.$title),this.titleMenuBar.$container.addClass("prevent-initial-focus"))},t.Outline.prototype._renderEnabled=function(){t.Outline.parent.prototype._renderEnabled.call(this),this.$container.setTabbable(!1)},t.Outline.prototype._initTreeNodeInternal=function(e,i){t.Outline.parent.prototype._initTreeNodeInternal.call(this,e,i),this._initDetailTableAndForm(e),this.trigger("initPage",{page:e})},t.Outline.prototype._initDetailTableAndForm=function(t){t.detailTable&&this._initDetailTable(t),t.detailForm&&this._initDetailForm(t)},t.Outline.prototype._initDetailTable=function(t){this.navigateButtonsVisible&&this._appendNavigateButtonsForDetailTable(t)},t.Outline.prototype._initDetailForm=function(t){this.navigateButtonsVisible&&this._appendNavigateButtonsForDetailForm(t),t.detailForm.detailForm=!0,t.detailForm.one("destroy",function(){t.detailForm=null,this._triggerPageChanged(t)}.bind(this))},t.Outline.prototype._decorateNode=function(e){t.Outline.parent.prototype._decorateNode.call(this,e),this.session.inspector&&t.inspector.applyInfo(e,e.$node)},t.Outline.prototype._createNavigateButtons=function(e,i){var o=t.arrays.ensure(i);if(!this._hasMenu(o,t.NavigateUpButton)){var n=t.create("NavigateUpButton",{parent:this,outline:this,node:e});o.push(n)}if(!this._hasMenu(o,t.NavigateDownButton)){var r=t.create("NavigateDownButton",{parent:this,outline:this,node:e});o.push(r)}return o},t.Outline.prototype._getMenu=function(t,e){for(var i=0;i<t.length;i++)if(t[i]instanceof e)return t[i];return null},t.Outline.prototype._hasMenu=function(t,e){return null!==this._getMenu(t,e)},t.Outline.prototype._onTitleClick=function(t){this.navigateToTop()},t.Outline.prototype.navigateToTop=function(){this.deselectAll(),this.collapseAll(),this.handleInitialExpanded()},t.Outline.prototype.handleInitialExpanded=function(){this._visitNodes(this.nodes,function(t){t.initialExpanded&&this.expandNode(t,{renderExpansion:!0})}.bind(this))},t.Outline.prototype._onNodeDeleted=function(t){t.detailTable&&(t.detailTable.off("rowInitialized",this._detailTableRowHandler),t.detailTable.destroy(),t.detailTable=null),0===this.nodes.length&&this.navigateToTop()},t.Outline.prototype.selectNodes=function(e,i){e=t.arrays.ensure(e),e.length>0&&this.isNodeSelected(e[0])||0===e.length&&0===this.selectedNodes.length||(this.navigateUpInProgress?this.navigateUpInProgress=!1:1===e.length&&this.setDetailFormVisibleByUi(e[0],!0),t.Outline.parent.prototype.selectNodes.call(this,e,i),this.updateDetailContent())},t.Outline.prototype._syncDefaultDetailForm=function(t){this._setProperty("defaultDetailForm",t),this._updateDetailForm()},t.Outline.prototype._syncOutlineOverviewVisible=function(t){this._setProperty("outlineOverviewVisible",t),this._updateDetailForm()},t.Outline.prototype._updateDetailForm=function(){this.defaultDetailForm?this.outlineOverview&&(this.outlineOverview.destroy(),this._setProperty("outlineOverview",null)):this.outlineOverviewVisible?this.outlineOverview||this._setProperty("outlineOverview",t.create("OutlineOverview",{parent:this,outline:this})):this.outlineOverview&&(this.outlineOverview.destroy(),this._setProperty("outlineOverview",null))},t.Outline.prototype._syncNavigateButtonsVisible=function(t){this._setProperty("navigateButtonsVisible",t),this._visitNodes(this.nodes,this._syncNavigateButtonsVisibleForNode.bind(this))},t.Outline.prototype._syncNavigateButtonsVisibleForNode=function(t,e){this.navigateButtonsVisible?(t.detailForm&&this._appendNavigateButtonsForDetailForm(t),t.detailTable&&this._appendNavigateButtonsForDetailTable(t)):(t.detailForm&&this._removeNavigateButtonsForDetailForm(t),t.detailTable&&this._removeNavigateButtonsForDetailTable(t))},t.Outline.prototype._appendNavigateButtonsForDetailForm=function(t){var e=this._createNavigateButtons(t,t.detailForm.staticMenus);t.detailForm.rootGroupBox.setStaticMenus(e)},t.Outline.prototype._appendNavigateButtonsForDetailTable=function(t){var e=this._createNavigateButtons(t,t.detailTable.staticMenus);t.detailTable.setStaticMenus(e)},t.Outline.prototype._removeNavigateButtonsForDetailForm=function(e){var i=[];e.detailForm.rootGroupBox.staticMenus.forEach(function(e){e instanceof t.NavigateUpButton||e instanceof t.NavigateDownButton?e.destroy():i.push(e)}),e.detailForm.rootGroupBox.setStaticMenus(i)},t.Outline.prototype._removeNavigateButtonsForDetailTable=function(e){var i=[];e.detailTable.staticMenus.forEach(function(e){e instanceof t.NavigateUpButton||e instanceof t.NavigateDownButton?e.destroy():i.push(e)}),e.detailTable.setStaticMenus(i)},t.Outline.prototype.selectedRow=function(){var t=this.selectedNode();return t&&t.detailTable?t.detailTable.selectedRow():null},t.Outline.prototype._applyUpdatedNodeProperties=function(e,i){var o=t.Outline.parent.prototype._applyUpdatedNodeProperties.call(this,e,i);return e.modelClass!==i.modelClass&&(e.modelClass=i.modelClass,o=!0),e.classId!==i.classId&&(e.classId=i.classId,o=!0),e.nodeType!==i.nodeType&&(e.nodeType=i.nodeType,o=!0),o},t.Outline.prototype._isGroupingEnd=function(e){return e.nodeType===t.Page.NodeType.TABLE},t.Outline.prototype._isTruncatedNodeTooltipEnabled=function(){return!1},t.Outline.prototype.setDetailFormVisibleByUi=function(t,e){t.detailFormVisibleByUi=e,this._triggerPageChanged(t)},t.Outline.prototype.validateFocus=function(){this.session.focusManager.validateFocus()},t.Outline.prototype.sendToBack=function(){this.inBackground=!0,this._renderInBackground(),this.formController.detachDialogs(),this.messageBoxController.detach(),this.fileChooserController.detach()},t.Outline.prototype.bringToFront=function(){this.inBackground=!1,this._renderInBackground(),this.formController.attachDialogs(),this.messageBoxController.attach(),this.fileChooserController.attach()},t.Outline.prototype._renderInBackground=function(){this.$container.toggleClass("in-background",this.inBackground)},t.Outline.prototype._renderCompact=function(){this.$container.toggleClass("compact",this.compact),this.invalidateLayoutTree()},t.Outline.prototype._renderEmbedDetailContent=function(){this.$data.toggleClass("has-detail-content",this.embedDetailContent),this.invalidateLayoutTree()},t.Outline.prototype._renderDetailContent=function(){if(this.detailContent&&!this.detailContent.rendered){var t=this.selectedNode();t.rendered&&(this.detailContent.render(t.$node),this.detailContent.htmlComp&&(this.detailContent.htmlComp.validateRoot=!1,this.detailContent.htmlComp.pixelBasedSizing=!0),this._ensurePageLayout(t),this.$data.addClass("detail-content-visible"))}},t.Outline.prototype._ensurePageLayout=function(e){e.htmlComp=t.HtmlComponent.install(e.$node,this.session),e.htmlComp.setLayout(new t.PageLayout(this,e))},t.Outline.prototype._removeDetailContent=function(){this.detailContent&&(this.detailContent.remove(),this.$data.removeClass("detail-content-visible"))},t.Outline.prototype._postRenderViewRange=function(){t.Outline.parent.prototype._postRenderViewRange.call(this),this._renderDetailContent(),this._renderDetailMenuBarVisible(),this._renderNodeMenuBarVisible()},t.Outline.prototype.setCompact=function(t){this.setProperty("compact",t)},t.Outline.prototype.setEmbedDetailContent=function(t){this.setProperty("embedDetailContent",t),this.updateDetailContent()},t.Outline.prototype._onDetailContentDestroy=function(t){this.setDetailContent(null),this.updateDetailMenus()},t.Outline.prototype.setDetailContent=function(t){this.detailContent!==t&&(this.rendered&&this._removeDetailContent(),this.detailContent&&this.detailContent.off("destroy",this._detailContentDestroyHandler),this._setProperty("detailContent",t),t&&t.on("destroy",this._detailContentDestroyHandler),this.rendered&&this._renderDetailContent(),this.invalidateLayoutTree())},t.Outline.prototype.updateDetailContent=function(){return this.embedDetailContent?(this.setDetailMenuBarVisible(!1),this.setNodeMenuBarVisible(!1),this.setDetailContent(this._computeDetailContent()),this.updateDetailMenus(),void(this.rendered&&this.validateLayoutTree())):(this.setDetailContent(null),void this.setDetailMenus([]))},t.Outline.prototype._computeDetailContent=function(){var e=this.selectedNode();return e?e.detailForm&&e.detailFormVisible&&e.detailFormVisibleByUi?e.detailForm:e.row&&e.parentNode.nodeType===t.Page.NodeType.TABLE?t.create("TableRowDetail",{parent:this,table:e.parentNode.detailTable,row:e.row}):null:null},t.Outline.prototype.updateDetailMenus=function(){if(this.embedDetailContent){var e,i=this.selectedNodes,o=i[0],n=[],r=[],s=[],a=[];if(this.detailContent&&this.detailContent instanceof t.Form){var l=this.detailContent.rootGroupBox;n=l.processMenus.concat(l.menus),l.setMenuBarVisible(!1)}else if(o){o.detailTable&&(e=o.detailTable,n=t.menus.filter(e.menus,["Table.EmptySpace"],!1,!0),r=e.tableControls,this._attachDetailMenusListener(e));var h=o.parentNode;h&&h.detailTable&&(e=h.detailTable,n=n.concat(t.menus.filter(e.menus,["Table.SingleSelection"],!1,!0)),this._attachDetailMenusListener(e))}r.forEach(function(e){var i=t.create("TableControlAdapterMenu",t.TableControlAdapterMenu.adaptTableControlProperties(e,{parent:this,tableControl:e,horizontalAlignment:1}));s.push(i)},this),n.forEach(function(t){1===t.horizontalAlignment?s.push(t):a.push(t)},this),this.setNodeMenus(s),this.setDetailMenus(a)}},t.Outline.prototype._attachDetailMenusListener=function(e){this._detailMenusChangeHandler||(this._detailMenusChangeHandler=function(e){t.arrays.containsAny(e.changedProperties,["menus","tableControls"])&&this.updateDetailMenus()}.bind(this)),this._detailMenusDestroyHandler||(this._detailMenusDestroyHandler=function(){e.off("propertyChange",this._detailMenusChangeHandler)}.bind(this)),e.off("propertyChange",this._detailMenusChangeHandler),e.on("propertyChange",this._detailMenusChangeHandler),e.off("destroy",this._detailMenusDestroyHandler),e.one("destroy",this._detailMenusDestroyHandler),this._detailMenusNodesSelectedHandler||(this._detailMenusNodesSelectedHandler={outline:this,menuContainers:[],addMenuContainer:function(t){this.menuContainers.indexOf(t)>-1||this.menuContainers.push(t)},func:function(t){"nodesSelected"===t.type&&(this.menuContainers.forEach(function(t){t.off("propertyChange",this.outline._detailMenusChangeHandler),t.off("destroy",this.outline._detailMenusDestroyHandler)},this),this.menuContainers=[])}},this.events.addListener(this._detailMenusNodesSelectedHandler)),this._detailMenusNodesSelectedHandler.addMenuContainer(e)},t.Outline.prototype.setDetailMenus=function(t){this.detailMenuBar.setMenuItems(t),this.setDetailMenuBarVisible(this.detailMenuBar.menuItems.length>0)},t.Outline.prototype._renderDetailMenuBarVisible=function(){this.detailMenuBarVisible?this._renderDetailMenuBar():this._removeDetailMenuBar()},t.Outline.prototype._renderDetailMenuBar=function(){if(!this.detailMenuBar.rendered){var t=this.selectedNode();t&&t.rendered&&(this.detailMenuBar.render(t.$node),this.detailMenuBar.$container.addClass("detail-menubar"),this.detailContent&&this.detailContent.rendered&&this.detailMenuBar.$container.insertBefore(this.detailContent.$container),this._ensurePageLayout(t),this.invalidateLayoutTree())}},t.Outline.prototype._removeDetailMenuBar=function(){this.detailMenuBar.rendered&&(this.detailMenuBar.remove(),this.invalidateLayoutTree())},t.Outline.prototype.setDetailMenuBarVisible=function(t){this.setProperty("detailMenuBarVisible",t)},t.Outline.prototype.setNodeMenus=function(t){this.nodeMenuBar.setMenuItems(t),this.setNodeMenuBarVisible(this.nodeMenuBar.menuItems.length>0)},t.Outline.prototype._renderNodeMenuBarVisible=function(){this.nodeMenuBarVisible?this._renderNodeMenuBar():this._removeNodeMenuBar()},t.Outline.prototype._renderNodeMenuBar=function(){if(!this.nodeMenuBar.rendered){var t=this.selectedNode();if(t&&t.rendered){var e=t.$node.children(".text");this.nodeMenuBar.render(t.$node),this.nodeMenuBar.$container.addClass("node-menubar"),this.nodeMenuBar.$container.insertAfter(e),this.invalidateLayoutTree()}}},t.Outline.prototype._removeNodeMenuBar=function(){this.nodeMenuBar.rendered&&(this.nodeMenuBar.remove(),this.invalidateLayoutTree())},t.Outline.prototype.setNodeMenuBarVisible=function(t){this.setProperty("nodeMenuBarVisible",t)},t.Outline.prototype._glassPaneTargets=function(){var e=this.session.desktop,i=[];return e.navigation&&i.push(e.navigation.$body),e.bench&&e.bench.outlineContent&&t.arrays.pushAll(i,e.bench.outlineContent.glassPaneTargets()),i},t.Outline.prototype.inFront=function(){return this.session.desktop.outline===this&&!this.inBackground},t.Outline.prototype.acceptDialog=function(t){return this.session.desktop.outline===this},t.Outline.prototype.acceptView=function(t){return this.session.desktop.outline===this},t.Outline.prototype.activateCurrentPage=function(){var t=this.activePage();t&&t.activate()},t.Outline.prototype.activePage=function(){return this.selectedNode()},t.Outline.prototype._syncMenus=function(e){var i=this.menus;if(this.updateKeyStrokes(e,i),this._setProperty("menus",e),this.titleMenuBar){var o=t.menus.filter(this.menus,["Tree.Header"]);this.titleMenuBar.setMenuItems(o)}},t.Outline.prototype._triggerPageChanged=function(t){this.trigger("pageChanged",{page:t})},t.Outline.prototype._nodesSelectedInternal=function(){var t=this.activePage();t&&(t.activate(),t.ensureLoadChildren().done(this._onLoadChildrenDone.bind(this,t)))},t.Outline.prototype._onLoadChildrenDone=function(t){t&&this._initDetailTableAndForm(t)},t.Outline.prototype.pageChanged=function(t){t&&this._initDetailTableAndForm(t);var e=this.selectedNode();(t||e)&&t!==e||this.updateDetailContent(),this._triggerPageChanged(t)},t.OutlineAdapter=function(){t.OutlineAdapter.parent.call(this),this._addAdapterProperties(["defaultDetailForm","views","dialogs","messageBoxes","fileChoosers"]),this._nodeIdToRowMap={},this._detailTableRowHandler=this._onDetailTableRowInitialized.bind(this)},t.inherits(t.OutlineAdapter,t.TreeAdapter),t.OutlineAdapter.prototype._init=function(e){t.OutlineAdapter.parent.prototype._init.call(this,e)},t.OutlineAdapter.prototype._postCreateWidget=function(){var t=this.widget;t._visitNodes(t.nodes,this._onWidgetInitPage.bind(this))};t.OutlineAdapter.prototype._onPageChanged=function(t){var e;t.nodeId?(e=this.widget._nodeById(t.nodeId),e.detailFormVisible=t.detailFormVisible,e.detailForm=this.session.getOrCreateWidget(t.detailForm,this.widget),e.detailTableVisible=t.detailTableVisible,e.detailTable=this.session.getOrCreateWidget(t.detailTable,this.widget)):this.widget.defaultDetailForm=this.session.getOrCreateWidget(t.detailForm,this.widget),this.widget.pageChanged(e)};t.OutlineAdapter.prototype._onWidgetEvent=function(e){"initPage"===e.type?this._onWidgetInitPage(e.page):t.OutlineAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.OutlineAdapter.prototype.onModelAction=function(e){"pageChanged"===e.type?this._onPageChanged(e):t.OutlineAdapter.parent.prototype.onModelAction.call(this,e)},t.OutlineAdapter.prototype._onWidgetInitPage=function(t){t.detailTable&&this._initDetailTable(t),this._linkNodeWithRowLater(t)},t.OutlineAdapter.prototype._initDetailTable=function(t){t.detailTable.rows.forEach(this._linkNodeWithRow.bind(this)),t.detailTable.on("rowInitialized",this._detailTableRowHandler)},t.OutlineAdapter.prototype._linkNodeWithRow=function(e){t.assertParameter("row",e);var i=e.nodeId,o=this.widget.nodesMap[i];o?t.Page.linkRowWithPage(e,o):this._nodeIdToRowMap[i]=e},t.OutlineAdapter.prototype._onDetailTableRowInitialized=function(t){var e,i=this.widget,o=t.row.nodeId;this._linkNodeWithRow(t.row),e=this.widget.nodesMap[o],i.rendered&&e&&i._applyFiltersForNode(e)&&(e.isFilterAccepted()?i._addToVisibleFlatList(e,!1):i._removeFromFlatList(e,!1))},t.OutlineAdapter.prototype._linkNodeWithRowLater=function(e){if(e.parentNode&&e.parentNode.detailTable&&this._nodeIdToRowMap.hasOwnProperty(e.id)){var i=this._nodeIdToRowMap[e.id];t.Page.linkRowWithPage(i,e),delete this._nodeIdToRowMap[e.id]}},t.OutlineMediator=function(){},t.OutlineMediator.prototype.init=function(t){},t.OutlineMediator.prototype._skipEvent=function(t){return null===t||null===t.getOutline()||t.leaf},t.OutlineMediator.prototype.onTableRowsInserted=function(t,e,i){this._skipEvent(i)||i.getTree().insertNodes(e,i)},t.OutlineMediator.prototype.onTableRowsDeleted=function(t,e,i){this._skipEvent(i)||i.getTree().deleteNodes(e,i)},t.OutlineMediator.prototype.onTableRowAction=function(t,e){var i=t.row.page;if(i){var o=i.getOutline();o&&(o.selectNode(i),o.setNodeExpanded(i,!0))}},t.OutlineMediator.prototype.onTableRowOrderChanged=function(t,e){if(!this._skipEvent(e)){var i=t.source,o=e.pagesForTableRows(i.rows);e.getOutline().updateNodeOrder(o,e)}},t.OutlineMediator.prototype.onTableRowsFiltered=function(t,e){e.getOutline().filter()},t.OutlineOverview=function(){t.OutlineOverview.parent.call(this),this.outline},t.inherits(t.OutlineOverview,t.Widget),t.OutlineOverview.prototype._init=function(e){t.OutlineOverview.parent.prototype._init.call(this,e),this.outline=e.outline,this.id=e.id},t.OutlineOverview.prototype._render=function(e){this.$container=e.appendDiv("outline-overview"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.$content=this.$container.appendDiv("outline-overview-content"),this.$content.appendDiv("outline-overview-icon").icon(this.outline.iconId),this.$content.appendDiv("outline-overview-title").text(this.outline.title)},t.OutlineOverview.prototype._attach=function(){this.$parent.append(this.$container);var e=this.htmlComp.getParent();this.htmlComp.setSize(e.getSize()),this.session.detachHelper.afterAttach(this.$container),t.OutlineOverview.parent.prototype._attach.call(this)},t.OutlineOverview.prototype._detach=function(){this.session.detachHelper.beforeDetach(this.$container),this.$container.detach(),t.OutlineOverview.parent.prototype._detach.call(this)},t.OutlineLayout=function(e){t.OutlineLayout.parent.call(this,e),this.outline=e},t.inherits(t.OutlineLayout,t.TreeLayout),t.OutlineLayout.prototype._layout=function(e){var i,o=this.outline.htmlComp;if(t.OutlineLayout.parent.prototype._layout.call(this,e),i=o.getAvailableSize().subtract(o.getInsets()),this.outline.embedDetailContent){var n=this.outline.selectedNodes[0];if(n&&n.rendered){var r=n.htmlComp;if(r){r.$comp.cssWidth(i.width);var s=r.getPreferredSize();r.setSize(new t.Dimension(i.width,s.height)),n.height=s.height+r.getMargins().vertical()}}this.outline.visibleNodesFlat.forEach(function(t){var e=t.$node;e&&!e.isSelected()&&e[0].style.height&&"auto"!==e[0].style.height&&(e.css("height","auto").css("width","auto"),
t.height=e.outerHeight(!0))})}},t.OutlineLayout.prototype._setDataHeight=function(e){var i=null;this.outline.titleVisible&&(i=t.graphics.getSize(this.outline.$title,!0)),t.OutlineLayout.parent.prototype._setDataHeight.call(this,e+(null===i?0:i.height))},t.OutlineViewButton=function(){t.OutlineViewButton.parent.call(this),this._addAdapterProperties("outline")},t.inherits(t.OutlineViewButton,t.ViewButton),t.OutlineViewButton.prototype._doAction=function(){t.OutlineViewButton.parent.prototype._doAction.call(this),this.outline&&this.session.desktop.bringOutlineToFront(this.outline)},t.OutlineViewButton.prototype.onOutlineChanged=function(t){var e=!!t&&this.outline===t;this.setSelected(e)},t.OutlineViewButtonAdapter=function(){t.OutlineViewButtonAdapter.parent.call(this),this._addAdapterProperties("outline")},t.inherits(t.OutlineViewButtonAdapter,t.ViewButtonAdapter),t.OutlineViewButtonAdapter.prototype._goOffline=function(){this.widget.outline||(this._enabledBeforeOffline=this.widget.enabled,this.widget.setEnabled(!1))},t.OutlineViewButtonAdapter.prototype._goOnline=function(){this.widget.setEnabled(this._enabledBeforeOffline)},t.PageLayout=function(e,i){t.PageLayout.parent.call(this),this.outline=e,this.page=i},t.inherits(t.PageLayout,t.AbstractLayout),t.PageLayout.prototype.layout=function(e){var i,o,n=this.page.htmlComp,r=this.page.$node.children(".text"),s=0,a=this.outline.nodeMenuBar,l=0,h=this.outline.detailMenuBar,d=0;i=n.getAvailableSize().subtract(n.getInsets()),a.visible&&(l=a.htmlComp.getPreferredSize().width,r.cssWidth(i.width-l)),h.visible&&(d=h.htmlComp.getPreferredSize().height,o=new t.Dimension(i.width,d).subtract(h.htmlComp.getMargins()),h.htmlComp.setSize(o)),this.outline.detailContent&&(s=r.outerHeight(!0),this.outline.detailContent.htmlComp.setSize(new t.Dimension(i.width,i.height-s-d)))},t.PageLayout.prototype.preferredLayoutSize=function(e){var i,o,n=this.page.htmlComp,r=new t.Dimension,s=this.page.$node.children(".text"),a=0,l=this.outline.detailMenuBar,h=new t.Dimension,d=this.outline.nodeMenuBar,p=0;return o=n.getSize().subtract(n.getInsets()),d.visible&&(p=d.htmlComp.getPreferredSize().width),a=t.graphics.prefSize(s,{includeMargin:!0,widthHint:o.width-p}).height,l.visible&&(h=l.htmlComp.getPreferredSize()),this.outline.detailContent&&(r=this.outline.detailContent.htmlComp.getPreferredSize()),i=new t.Dimension(Math.max(r.width,h.width),a+h.height+r.height),i=i.add(n.getInsets())},t.SearchOutline=function(){t.SearchOutline.parent.call(this),this.$searchPanel,this.$searchStatus,this.$queryField},t.inherits(t.SearchOutline,t.Outline),t.SearchOutline.prototype._initKeyStrokeContext=function(){t.SearchOutline.parent.prototype._initKeyStrokeContext.call(this),this.searchFieldKeyStrokeContext=this._createKeyStrokeContextForSearchField()},t.SearchOutline.prototype._createKeyStrokeContextForSearchField=function(){var e=new t.InputFieldKeyStrokeContext;return e.$scopeTarget=function(){return this.$searchPanel}.bind(this),e.$bindTarget=function(){return this.$queryField}.bind(this),e.registerStopPropagationKeys(t.keyStrokeModifier.NONE,[t.keys.ENTER,t.keys.BACKSPACE]),e},t.SearchOutline.prototype._render=function(i){t.SearchOutline.parent.prototype._render.call(this,i),this.htmlComp.setLayout(new t.SearchOutlineLayout(this)),this.$container.addClass("search-outline"),this.$searchPanel=this.$container.prependDiv("search-outline-panel"),this.$queryField=this.$searchPanel.appendElement("<input>","search-outline-field").on("input",e.debounce(this._onQueryFieldInput.bind(this))).on("keypress",this._onQueryFieldKeyPress.bind(this)),this.$searchStatus=this.$searchPanel.appendDiv("search-outline-status").on("click",this._onTitleClick.bind(this)),this.session.keyStrokeManager.installKeyStrokeContext(this.searchFieldKeyStrokeContext)},t.SearchOutline.prototype._remove=function(){this.session.keyStrokeManager.uninstallKeyStrokeContext(this.searchFieldKeyStrokeContext),this.$searchPanel.remove(),t.SearchOutline.parent.prototype._remove.call(this)},t.SearchOutline.prototype._renderProperties=function(){t.SearchOutline.parent.prototype._renderProperties.call(this),this._renderSearchQuery(this.searchQuery),this._renderSearchStatus(this.searchStatus),this._renderRequestFocusQueryField()},t.SearchOutline.prototype._renderTitle=function(){t.SearchOutline.parent.prototype._renderTitle.call(this),this.titleVisible&&this.$title.insertBefore(this.$searchPanel)},t.SearchOutline.prototype._renderSearchQuery=function(t){this.$queryField.val(t)},t.SearchOutline.prototype._renderSearchStatus=function(t){var e=this.rendered;t&&!this.$searchStatus.isVisible()?e?this.$searchStatus.slideDown({duration:200,progress:this.revalidateLayout.bind(this)}):this.$searchStatus.show():!t&&this.$searchStatus.isVisible()&&(e?this.$searchStatus.slideUp({duration:200,progress:this.revalidateLayout.bind(this)}):this.$searchStatus.hide()),this.$searchStatus.textOrNbsp(t)},t.SearchOutline.prototype._renderRequestFocusQueryField=function(){this.validateFocus()},t.SearchOutline.prototype._triggerSearch=function(){this.trigger("search",{query:t.nvl(this.searchQuery,"")})},t.SearchOutline.prototype._onQueryFieldInput=function(t){var e=this.$queryField.val();this.searchQuery!==e&&(this._setSearchQuery(e),this._triggerSearch())},t.SearchOutline.prototype._onQueryFieldKeyPress=function(e){e.which===t.keys.ENTER&&(this._setSearchQuery(this.$queryField.val()),this._triggerSearch())},t.SearchOutline.prototype._setSearchQuery=function(t){this.searchQuery=t},t.SearchOutline.prototype.validateFocus=function(){var t=this.$queryField[0];this.session.focusManager.requestFocus(t)&&t.select()},t.SearchOutlineAdapter=function(){t.SearchOutlineAdapter.parent.call(this)},t.inherits(t.SearchOutlineAdapter,t.OutlineAdapter),t.SearchOutlineAdapter.prototype._onWidgetSearch=function(t){this._send("search",{query:t.query},{showBusyIndicator:!1})},t.SearchOutlineAdapter.prototype._onWidgetEvent=function(e){"search"===e.type?this._onWidgetSearch(e):t.SearchOutlineAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.SearchOutlineLayout=function(e){t.SearchOutlineLayout.parent.call(this,e),this.outline=e},t.inherits(t.SearchOutlineLayout,t.OutlineLayout),t.SearchOutlineLayout.prototype._setDataHeight=function(e){var i=t.graphics.getSize(this.outline.$searchPanel,!0);e+=i.height,t.SearchOutlineLayout.parent.prototype._setDataHeight.call(this,e)},t.NavigateButton=function(){t.NavigateButton.parent.call(this),this.node,this.outline,this._onClickFunc,this.selected=!1,this.visible=!0,this.enabled=!0,this.mandatory=!1,this.actionStyle=t.Action.ActionStyle.BUTTON,this._additionalCssClass=""},t.inherits(t.NavigateButton,t.Menu),t.NavigateButton.prototype._init=function(e){t.NavigateButton.parent.prototype._init.call(this,e),this.node=e.node,this.outline=e.outline},t.NavigateButton.prototype._render=function(e){this._isDetail()?this._onClickFunc=this._setDetailVisible.bind(this):this._onClickFunc=this._drill.bind(this),this.overflow?(this.text=this.session.text(this._defaultText),this.iconId=null):(this.text=null,this.iconId=this._defaultIconId),this.enabled=this._buttonEnabled(),t.NavigateButton.parent.prototype._render.call(this,e),this.$container.addClass("navigate-button small"),this.$container.addClass(this._additionalCssClass),this.outline.keyStrokeContext.registerKeyStroke(this)},t.NavigateButton.prototype._remove=function(){t.NavigateButton.parent.prototype._remove.call(this),this.outline.keyStrokeContext.unregisterKeyStroke(this)},t.NavigateButton.prototype._setDetailVisible=function(){var t=this._toggleDetail();e.log.debug("form"),this.outline.setDetailFormVisibleByUi(this.node,t)},t.NavigateButton.prototype.doAction=function(){return!!this.prepareDoAction()&&(this._onClickFunc(),!0)},t.NavigateButton.prototype.updateEnabled=function(){this.enabled=this._buttonEnabled(),this.rendered&&this._renderEnabled()},t.NavigateDownButton=function(){t.NavigateDownButton.parent.call(this),this._defaultIconId=t.icons.ANGLE_DOWN,this._defaultText="ui.Continue",this.iconId=this._defaultIconId,this.keyStroke="enter",this._detailTableRowsSelectedHandler=this._onDetailTableRowsSelected.bind(this)},t.inherits(t.NavigateDownButton,t.NavigateButton),t.NavigateDownButton.prototype._init=function(e){t.NavigateDownButton.parent.prototype._init.call(this,e),this.node.detailTable&&this.node.detailTable.on("rowsSelected",this._detailTableRowsSelectedHandler)},t.NavigateDownButton.prototype.destroy=function(){this.node.detailTable&&this.node.detailTable.off("rowsSelected",this._detailTableRowsSelectedHandler),t.NavigateDownButton.parent.prototype.destroy.call(this)},t.NavigateDownButton.prototype._render=function(e){t.NavigateDownButton.parent.prototype._render.call(this,e),this.$container.addClass("down")},t.NavigateDownButton.prototype._isDetail=function(){return!!(this.node.detailFormVisible&&this.node.detailForm&&this.node.detailTableVisible&&this.node.detailTable&&this.node.detailFormVisibleByUi)},t.NavigateDownButton.prototype._toggleDetail=function(){return!1},t.NavigateDownButton.prototype._buttonEnabled=function(){if(this._isDetail())return!0;if(this.node.leaf)return!1;var t=this.node.detailTable;return!t||1===t.selectedRows.length},t.NavigateDownButton.prototype._drill=function(){var i;if(this.node.detailTable){var o=this.node.detailTable.selectedRow();i=this.node.pageForTableRow(o)}else i=this.node.childNodes[0];if(i){e.log.debug("drill down to node "+i);var n=i.parentNode;n&&n.childNodes.forEach(function(t){t.expanded&&t!==i&&this.outline.collapseNode(t,{animateExpansion:!1})}.bind(this)),this.outline.selectNodes(i),n&&n.nodeType===t.Page.NodeType.TABLE&&this.outline.expandNode(i)}},t.NavigateDownButton.prototype._onDetailTableRowsSelected=function(t){this.updateEnabled()},t.NavigateUpButton=function(){t.NavigateUpButton.parent.call(this),this._defaultIconId=t.icons.ANGLE_UP,this._defaultText="ui.Up",this._additionalCssClass="small-gap",this.iconId=this._defaultIconId,this.keyStroke="backspace"},t.inherits(t.NavigateUpButton,t.NavigateButton),t.NavigateUpButton.prototype._render=function(e){t.NavigateUpButton.parent.prototype._render.call(this,e),this.$container.addClass("up")},t.NavigateUpButton.prototype._isDetail=function(){return!(!(this.node.detailFormVisible&&this.node.detailForm&&this.node.detailTableVisible&&this.node.detailTable)||this.node.detailFormVisibleByUi)},t.NavigateUpButton.prototype._toggleDetail=function(){return!0},t.NavigateUpButton.prototype._buttonEnabled=function(){var t=this.node.parentNode;return!!t||!!this.outline.defaultDetailForm||!!this.outline.outlineOverview},t.NavigateUpButton.prototype._drill=function(){var t=this.node.parentNode;t?(e.log.debug("drill up to node "+t),this.outline.navigateUpInProgress=!0,this.outline.selectNodes(t),this.outline.collapseNode(t,{collapseChildNodes:!0})):(e.log.debug("drill up to top"),this.outline.navigateToTop())},t.OutlineKeyStrokeContext=function(e){t.OutlineKeyStrokeContext.parent.call(this),this._outline=e},t.inherits(t.OutlineKeyStrokeContext,t.KeyStrokeContext),t.OutlineKeyStrokeContext.prototype.accept=function(e){return!this._outline.inBackground&&!this.isFormMenuOpen()&&t.OutlineKeyStrokeContext.parent.prototype.accept.call(this,e)},t.OutlineKeyStrokeContext.prototype.isFormMenuOpen=function(){var t=this._outline.session.desktop.menus;return t.some(function(t){return t.popup&&t.popup.$container&&t.popup.$container.isAttached()},this)},t.OutlineNavigateToTopKeyStroke=function(e,i){t.OutlineNavigateToTopKeyStroke.parent.call(this,e,i),this.which=[t.keys.HOME],this.renderingHints.hAlign=t.hAlign.RIGHT,this.renderingHints.$drawingArea=function(t,e){return this.field.$title||this.field.$data}.bind(this)},t.inherits(t.OutlineNavigateToTopKeyStroke,t.AbstractTreeNavigationKeyStroke),t.OutlineNavigateToTopKeyStroke.prototype.handle=function(t){this.field.navigateToTop()},t.fields={makeTextField:function(t,e){return t.makeElement("<input>",e).attr("type","text").attr("autocomplete","false").disableSpellcheck()},appendIcon:function(t,e){var i=t.appendSpan("icon");return e&&i.addClass(e),i},initTouch:function(e,i){e.embedded=t.nvl(i.embedded,!1),e.touch=t.nvl(i.touch,t.device.supportsTouch())},valOrText:function(t,e,i){return 3!==arguments.length?t.touch?e.text():e.val():void(t.touch?e.text(i):e.val(i))},makeInputOrDiv:function(e,i){return e.touch?e.$container.makeDiv(t.strings.join(" ","input-field",i)):t.fields.makeTextField(e.$container,i)},handleOnClick:function(t){return t.enabledComputed&&!t.embedded&&!t.popup}},t.AppLinkKeyStroke=function(e,i){t.AppLinkKeyStroke.parent.call(this),this.field=e,this.appLinkTriggerFunction=i,this.which=[t.keys.SPACE],this.renderingHints.render=!1},t.inherits(t.AppLinkKeyStroke,t.KeyStroke),t.AppLinkKeyStroke.prototype._accept=function(i){var o=t.AppLinkKeyStroke.parent.prototype._accept.call(this,i);return o&&e(i.target).hasClass("app-link")},t.AppLinkKeyStroke.prototype.handle=function(t){this.appLinkTriggerFunction.call(this.field,t)},t.FormField=function(){t.FormField.parent.call(this),this.keyStrokes=[],this.labelVisible=!0,this.labelPosition=t.FormField.LABEL_POSITION_DEFAULT,this.labelWidthInPixel=0,this.mandatory=!1,this.statusVisible=!0,this.statusPosition=t.FormField.STATUS_POSITION_DEFAULT,this.menus=[],this.menusVisible=!1,this.gridData,this.$label,this.$field,this.$fieldContainer,this.enabledComputed=!0,this.$status,this._addAdapterProperties(["keyStrokes","menus"]),this._addCloneProperties(["displayText"]),this.mode=t.FormField.MODE_DEFAULT,this.touched=!1,this.requiresSave=!1,this.empty=!0,this.preventInitialFocus=!1,this.disabledCopyOverlay=!1,this.$disabledCopyOverlay},t.inherits(t.FormField,t.Widget),t.FormField.LABEL_POSITION_DEFAULT=0,t.FormField.LABEL_POSITION_LEFT=1,t.FormField.LABEL_POSITION_ON_FIELD=2,t.FormField.LABEL_POSITION_RIGHT=3,t.FormField.LABEL_POSITION_TOP=4,t.FormField.STATUS_POSITION_DEFAULT="default",t.FormField.STATUS_POSITION_TOP="top",t.FormField.FULL_WIDTH=0,t.FormField.MODE_DEFAULT="default",t.FormField.MODE_CELLEDITOR="celleditor",t.FormField.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.FormField.prototype._createLoadingSupport=function(){return new t.LoadingSupport({widget:this})},t.FormField.prototype._init=function(e){t.FormField.parent.prototype._init.call(this,e),this.resolveTextKeys(["label"]),this._syncKeyStrokes(this.keyStrokes),this._syncMenus(this.menus),this._syncErrorStatus(this.errorStatus),this._syncGridData(this.gridData),this._syncEnabled(this.enabled),this._updateEmpty()},t.FormField.prototype._render=function(t){throw new Error("sub-classes of scout.FormField must implement a _render method")},t.FormField.prototype._renderProperties=function(){t.FormField.parent.prototype._renderProperties.call(this),this._renderMandatory(),this._renderTooltipText(),this._renderErrorStatus(),this._renderMenus(),this._renderLabel(),this._renderLabelVisible(),this._renderStatusVisible(),this._renderStatusPosition(),this._renderFont(),this._renderForegroundColor(),this._renderBackgroundColor(),this._renderLabelFont(),this._renderLabelForegroundColor(),this._renderLabelBackgroundColor(),this._renderGridData(),this._renderPreventInitialFocus()},t.FormField.prototype._remove=function(){t.FormField.parent.prototype._remove.call(this),this._removeField(),this._removeStatus(),this._removeLabel(),this._removeDisabledCopyOverlay(),this._uninstallDragAndDropHandler()},t.FormField.prototype._renderMandatory=function(){this.$container.toggleClass("mandatory",this.mandatory)},t.FormField.prototype._renderErrorStatus=function(){var e=!!this.errorStatus,i=e?this.errorStatus.cssClass():"";this.$container.removeClass(t.Status.cssClasses),this.$container.addClass(i,e),this.$field&&(this.$field.removeClass(t.Status.cssClasses),this.$field.addClass(i,e)),this._updateStatusVisible(),e?this._showStatusMessage():this._hideStatusMessage()},t.FormField.prototype._renderTooltipText=function(){var e=this.tooltipText,i=t.strings.hasText(e);this.$container.toggleClass("has-tooltip",i),this.$field&&this.$field.toggleClass("has-tooltip",i),this._updateStatusVisible()},t.FormField.prototype._renderVisible=function(){if(this.$container.setVisible(this.visible),this.rendered){var t=this.htmlComp.getParent();t&&t.invalidateLayoutTree()}},t.FormField.prototype._renderLabel=function(){var e=this.label;this.labelPosition===t.FormField.LABEL_POSITION_ON_FIELD?(this._renderPlaceholder(),this.$label&&this.$label.text("")):this.$label&&(this._removePlaceholder(),this.$label.textOrNbsp(e,"empty"),this.labelUseUiWidth&&this.invalidateLayoutTree())},t.FormField.prototype._renderPlaceholder=function(e){e=t.nvl(e,this.$field),e&&e.placeholder(this.label)},t.FormField.prototype._removePlaceholder=function(e){e=t.nvl(e,this.$field),e&&e.placeholder("")},t.FormField.prototype._renderLabelVisible=function(){var t=this.labelVisible;this._renderChildVisible(this.$label,t),this.$container.toggleClass("label-hidden",!t)},t.FormField.prototype._renderStatusVisible=function(){var t=this.statusVisible;this._renderChildVisible(this.$status,this._computeStatusVisible()),this._renderChildVisible(this.$pseudoStatus,t),this.$status&&!this.$status.isVisible()&&this.tooltip&&this.tooltip.destroy()},t.FormField.prototype._renderStatusPosition=function(){this.invalidateLayoutTree()},t.FormField.prototype._updateStatusVisible=function(){this.statusVisible||this._renderStatusVisible()},t.FormField.prototype._computeStatusVisible=function(){var t=this.statusVisible,e=!!this.errorStatus,i=!!this.tooltipText;return!this.suppressStatus&&(t||e||i||this._hasMenus()&&this.menusVisible)},t.FormField.prototype._renderChildVisible=function(t,e){if(t)return t.isVisible()!==e?(t.setVisible(e),this.invalidateLayoutTree(),!0):void 0},t.FormField.prototype._renderLabelPosition=function(t){this._renderLabel()},t.FormField.prototype._syncEnabled=function(t){this._setProperty("enabled",t);var e=t;this.parent.initialized&&this.parent.enabledComputed!==i&&(e=this.parent.enabledComputed),this.recomputeEnabled(e)},t.FormField.prototype._renderEnabled=function(){t.FormField.parent.prototype._renderEnabled.call(this),this._updateDisabledCopyOverlay(),this.$field&&this.$field.setEnabled(this.enabledComputed)},t.FormField.prototype._renderDisabledStyle=function(){this._renderDisabledStyleInternal(this.$field),this._renderDisabledStyleInternal(this.$mandatory)},t.FormField.prototype._renderFont=function(){t.styles.legacyStyle(this,this.$field)},t.FormField.prototype._renderForegroundColor=function(){t.styles.legacyStyle(this,this.$field)},t.FormField.prototype._renderBackgroundColor=function(){t.styles.legacyStyle(this,this.$field)},t.FormField.prototype._renderLabelFont=function(){t.styles.legacyStyle(this,this.$label,"label")},t.FormField.prototype._renderLabelForegroundColor=function(){t.styles.legacyStyle(this,this.$label,"label")},t.FormField.prototype._renderLabelBackgroundColor=function(){t.styles.legacyStyle(this,this.$label,"label")},t.FormField.prototype._renderGridData=function(){this.invalidateLayoutTree()},t.FormField.prototype._renderMenus=function(){this._updateMenus()},t.FormField.prototype._renderMenusVisible=function(){this._updateMenus()},t.FormField.prototype._renderPreventInitialFocus=function(){this.$container.toggleClass("prevent-initial-focus",!!this.preventInitialFocus)},t.FormField.prototype._getCurrentMenus=function(){var e;return this.currentMenuTypes&&(e=[],this.currentMenuTypes.forEach(function(t){e.push("ValueField."+t)},this)),e?t.menus.filter(this.menus,e):this.menus.filter(function(t){return t.visible})},t.FormField.prototype._hasMenus=function(){return!!(this.menus&&this._getCurrentMenus().length>0)},t.FormField.prototype._updateMenus=function(){this._updateStatusVisible(),this.$container.toggleClass("has-menus",this._hasMenus()&&this.menusVisible)},t.FormField.prototype._syncGridData=function(e){this._setProperty("gridData",new t.GridData(e))},t.FormField.prototype._syncKeyStrokes=function(t){this.updateKeyStrokes(t,this.keyStrokes),this._setProperty("keyStrokes",t)},t.FormField.prototype._syncMenus=function(t){this.updateKeyStrokes(t,this.menus),this._setProperty("menus",t)},t.FormField.prototype._syncErrorStatus=function(e){e=t.Status.ensure(e),this._setProperty("errorStatus",e)},t.FormField.prototype.setLabel=function(t){this.setProperty("label",t)},t.FormField.prototype.setTooltipText=function(t){this.setProperty("tooltipText",t)},t.FormField.prototype.setEnabled=function(e,i,o){t.FormField.parent.prototype.setEnabled.call(this,e),e&&i&&this.visitParents(function(t){t.setEnabled(!0)}),o&&this.visit(function(t){t.setEnabled(e)})},t.FormField.prototype.setErrorStatus=function(t){this.setProperty("errorStatus",t)},t.FormField.prototype.setMenus=function(t){this.setProperty("menus",t)},t.FormField.prototype.setMenusVisible=function(t){this.setProperty("menusVisible",t)},t.FormField.prototype.setMandatory=function(t){this.setProperty("mandatory",t)},t.FormField.prototype.focus=function(){if(this.rendered)if(this.$field)this.session.focusManager.requestFocus(this.$field[0]);else{var t=this.session.focusManager.findFirstFocusableElement(this.$container);this.session.focusManager.requestFocus(t)}},t.FormField.prototype.recomputeEnabled=function(t){this.enabledComputed=this.enabled&&t,this.rendered&&this._renderEnabled()},t.FormField.prototype._onStatusMousedown=function(e){if(this.menusVisible&&this._hasMenus()){var i=function(e){var i=this._getCurrentMenus();if(this.contextPopup&&this.contextPopup.rendered)this.contextPopup.close(),this.contextPopup=null;else{if(!i.some(function(t){return t.visible}))return;this.contextPopup=t.create("ContextMenuPopup",{parent:this,$anchor:this.$status,menuItems:i,cloneMenuItems:!1,closeOnAnchorMousedown:!1}),this.contextPopup.open()}}.bind(this);t.menus.showContextMenuWithWait(this.session,i,e)}else this.tooltip?this._hideStatusMessage():this._showStatusMessage()},t.FormField.prototype._showStatusMessage=function(){if(this.$status&&this.$status.isVisible()){var e,i=this.tooltipText,o=t.Status.OK,n=!0;this.errorStatus&&(i=this.errorStatus.message,o=this.errorStatus.severity,n=!(this.errorStatus&&this.errorStatus.isError()),this.tooltip&&this.tooltip.autoRemove!==n&&this.tooltip.destroy(),this.mode===t.FormField.MODE_CELLEDITOR)||t.strings.empty(i)||(this.tooltip?(this.tooltip.setText(i),this.tooltip.setSeverity(o)):(e={parent:this,text:i,severity:o,autoRemove:n,$anchor:this.$status},this.tooltip=t.create("Tooltip",e),this.tooltip.one("destroy",function(){this.tooltip=null}.bind(this)),this.tooltip.render()))}},t.FormField.prototype._hideStatusMessage=function(){this.tooltip&&this.tooltip.destroy()},t.FormField.prototype.getFocusableElement=function(){return this.rendered?this.$field[0]:null},t.FormField.prototype.getForm=function(){for(var e=this.parent;e&&!(e instanceof t.Form);)e=e.parent;return e},t.FormField.prototype.getParentGroupBox=function(){for(var e=this.parent;e&&!(e instanceof t.GroupBox);)e=e.parent;return e},t.FormField.prototype.getParentField=function(){return this.parent},t.FormField.prototype.addLabel=function(){this.$label=this.$container.appendElement("<label>"),t.tooltips.installForEllipsis(this.$label,{parent:this})},t.FormField.prototype._removeLabel=function(){this.$label&&(this.$label.remove(),this.$label=null)},t.FormField.prototype.addField=function(t){this.$fieldContainer||this.addFieldContainer(t),this.$field=t},t.FormField.prototype.addFieldContainer=function(t){this.$fieldContainer=t.addClass("field").appendTo(this.$container)},t.FormField.prototype._removeField=function(){this.$field&&(this.$field.remove(),this.$field=null),this.$fieldContainer&&(this.$fieldContainer.remove(),this.$fieldContainer=null)},t.FormField.prototype.addStatus=function(){this.$status||(this.$status=this.$container.appendSpan("status").on("mousedown",this._onStatusMousedown.bind(this)))},t.FormField.prototype._removeStatus=function(){this._hideStatusMessage(),this.$status&&(this.$status.remove(),this.$status=null)},t.FormField.prototype.addPseudoStatus=function(){this.$pseudoStatus=this.$container.appendSpan("status")},t.FormField.prototype.addMandatoryIndicator=function(){this.$mandatory=this.$container.appendSpan("mandatory-indicator")},t.FormField.prototype.removeMandatoryIndicator=function(){this.$mandatory.remove(),this.$mandatory=null},t.FormField.prototype.addIcon=function(e){e||(e=this.$container),this.$icon=t.fields.appendIcon(e).click(this._onIconClick.bind(this))},t.FormField.prototype._onIconClick=function(t){this.$field.focus()},t.FormField.prototype.addContainer=function(e,i,o){this.$container=e.appendDiv("form-field"),i&&this.$container.addClass(i);var n=t.HtmlComponent.install(this.$container,this.session);n.setLayout(o||new t.FormFieldLayout(this)),this.htmlComp=n},t.FormField.prototype.updateInnerAlignment=function(e){e=e||{};var i=t.nvl(e.useHorizontalAlignment,!0),o=t.nvl(e.useVerticalAlignment,!0),n=e.$fieldContainer||this.$fieldContainer;if(n&&(n.removeClass("has-inner-alignment halign-left halign-center halign-right valign-top valign-middle valign-bottom"),i||o)){if(n.addClass("has-inner-alignment"),i){var r=this.gridData.horizontalAlignment;n.addClass(r<0?"halign-left":r>0?"halign-right":"halign-center")}if(o){var s=this.gridData.verticalAlignment;n.addClass(s<0?"valign-top":s>0?"valign-bottom":"valign-middle")}}},t.FormField.prototype.prepareForCellEdit=function(t){t=t||{},this.$mandatory&&this.removeMandatoryIndicator(),this.$status&&(this.$status.remove(),this.$status=null),this.$container&&this.$container.addClass("cell-editor-form-field"),this.$field&&(this.$field.addClass("cell-editor-field"),t.firstCell&&this.$field.addClass("first"))},t.FormField.prototype._renderDropType=function(){this.dropType?this._installDragAndDropHandler():this._uninstallDragAndDropHandler()},t.FormField.prototype._createDragAndDropHandler=function(){return t.dragAndDrop.handler(this,{supportedScoutTypes:t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER,dropType:function(){return this.dropType}.bind(this),dropMaximumSize:function(){return this.dropMaximumSize}.bind(this)})},t.FormField.prototype._installDragAndDropHandler=function(t){this.dragAndDropHandler||(this.dragAndDropHandler=this._createDragAndDropHandler(),this.dragAndDropHandler.install(this.$field))},t.FormField.prototype._uninstallDragAndDropHandler=function(t){this.dragAndDropHandler&&(this.dragAndDropHandler.uninstall(),this.dragAndDropHandler=null)},t.FormField.prototype._updateDisabledCopyOverlay=function(){this.disabledCopyOverlay&&!t.device.supportsCopyFromDisabledInputFields()&&(this.enabledComputed?this._removeDisabledCopyOverlay():(this._renderDisabledCopyOverlay(),this.revalidateLayout()))},t.FormField.prototype._renderDisabledCopyOverlay=function(){this.$disabledCopyOverlay||(this.$disabledCopyOverlay=this.$container.appendDiv("disabled-overlay").on("contextmenu",this._createCopyContextMenu.bind(this)))},t.FormField.prototype._removeDisabledCopyOverlay=function(){this.$disabledCopyOverlay&&(this.$disabledCopyOverlay.remove(),this.$disabledCopyOverlay=null)},t.FormField.prototype._createCopyContextMenu=function(e){if(this.visible&&!t.strings.empty(this.displayText)){var i=this,o=t.create("Menu",{parent:this,text:this.session.text("ui.Copy")});o.on("doAction",function(e){i instanceof t.ValueField&&i.trigger("exportToClipboard")});var n=t.create("ContextMenuPopup",{parent:this,menuItems:[o],cloneMenuItems:!1,location:{x:e.pageX,y:e.pageY},$anchor:this._$disabledOverlay});n.open()}},t.FormField.prototype.visit=function(t){t(this)},t.FormField.prototype.visitParents=function(e){for(var i=this.parent;i instanceof t.FormField;)e(i),i=i.parent},t.FormField.prototype.markAsSaved=function(){this.touched=!1,this.updateRequiresSave()},t.FormField.prototype.updateRequiresSave=function(){this.initialized&&(this.requiresSave=this.touched||this.computeRequiresSave())},t.FormField.prototype.computeRequiresSave=function(){return!1},t.FormField.prototype.validate=function(){var t=!this.errorStatus,e=!this.mandatory||!this.empty,i=t&&e;return{valid:i,validByErrorStatus:t,validByMandatory:e}},t.FormField.prototype._updateEmpty=function(){},t.FormFieldAdapter=function(){t.FormFieldAdapter.parent.call(this),this.enabledWhenOffline=!1,this._addAdapterProperties(["keyStrokes","menus"])},t.inherits(t.FormFieldAdapter,t.ModelAdapter),t.FormFieldAdapter.prototype._goOffline=function(){this.enabledWhenOffline||(this._enabledBeforeOffline=this.widget.enabled,this.widget.setEnabled(!1))},t.FormFieldAdapter.prototype._goOnline=function(){this.enabledWhenOffline||this.widget.setEnabled(this._enabledBeforeOffline)},t.FormFieldAdapter.prototype._onWidgetExportToClipboard=function(t){this._send("exportToClipboard")};t.FormFieldAdapter.prototype._onWidgetEvent=function(e){"exportToClipboard"===e.type?this._onWidgetExportToClipboard(e):t.FormFieldAdapter.parent.prototype._onWidgetEvent.call(this,e)};t.FormFieldLayout=function(e){t.FormFieldLayout.parent.call(this),this.formField=e,this.mandatoryIndicatorWidth=t.HtmlEnvironment.fieldMandatoryIndicatorWidth,this.statusWidth=t.HtmlEnvironment.fieldStatusWidth,this.rowHeight=t.HtmlEnvironment.formRowHeight,t.FormFieldLayout.LABEL_WIDTH_DEFAULT===e.labelWidthInPixel?this.labelWidth=t.HtmlEnvironment.fieldLabelWidth:this.labelWidth=e.labelWidthInPixel},t.inherits(t.FormFieldLayout,t.AbstractLayout),t.FormFieldLayout.MIN_FIELD_WIDTH=50,t.FormFieldLayout.LABEL_WIDTH_DEFAULT=0,t.FormFieldLayout.prototype.layout=function(e){var i,o,n,r,s,a,l,h,d,p,u=t.HtmlComponent.get(e),c=this.formField,f=this.labelWidth,y=this.statusWidth;if(i=u.getInsets({includeBorder:!1}),l=i.top,p=i.right,h=i.bottom,d=i.left,this._isLabelVisible()&&(c.labelUseUiWidth&&(f=c.$label.hasClass("empty")?0:t.graphics.prefSize(c.$label,{includeMargin:!0}).width),t.isOneOf(c.labelPosition,t.FormField.LABEL_POSITION_DEFAULT,t.FormField.LABEL_POSITION_LEFT)?(t.graphics.setBounds(c.$label,l,d,f,this.rowHeight),d+=f):c.labelPosition===t.FormField.LABEL_POSITION_TOP&&(c.$label.cssHeight(this.rowHeight),l+=c.$label.outerHeight(!0),a=!0)),c.$mandatory&&(c.$mandatory.cssTop(l).cssLeft(d).cssWidth(this.mandatoryIndicatorWidth),d+=c.$mandatory.outerWidth(!0)),this._isStatusVisible())if(c.$status.cssWidth(y),c.statusPosition===t.FormField.STATUS_POSITION_TOP&&a){var g=t.graphics.prefSize(c.$status).height,m=i.top+c.$label.cssPaddingTop()+c.$label.height()/2-g/2;c.$status.cssTop(m).cssRight(p+c.$label.cssMarginRight()).cssHeight(g);var _=t.graphics.getSize(c.$status,!0).width;c.$label.css("padding-right",_+"px")}else c.$status.cssTop(l).cssRight(p).cssHeight(this.rowHeight).cssLineHeight(this.rowHeight),p+=y+c.$status.cssMarginX();if(c.$fieldContainer){o=new t.Insets(l-i.top,p-i.right,h-i.bottom,d-i.left);var b=t.graphics.getMargins(c.$fieldContainer);n=u.getAvailableSize().subtract(u.getInsets()).subtract(o).subtract(b),r=new t.Rectangle(d,l,n.width,n.height),"absolute"!==c.$fieldContainer.css("position")&&(r.x=0,r.y=0),s=t.HtmlComponent.optGet(c.$fieldContainer),s?s.setBounds(r):t.graphics.setBounds(c.$fieldContainer,r),c.$field.toggleClass("compact",r.width<t.FormFieldLayout.MIN_FIELD_WIDTH),a&&c.$label.cssWidth(n.add(b).width-c.$label.cssMarginX())}c.$icon&&c.$field&&this._layoutIcon(c,r,p,l),c.tooltip&&c.tooltip.rendered&&c.tooltip.position(),c.$field&&t.scrollbars.update(c.$field),this._layoutDisabledCopyOverlay()},t.FormFieldLayout.prototype._layoutDisabledCopyOverlay=function(){if(this.formField.$field&&this.formField.$disabledCopyOverlay){var e=this.formField.$disabledCopyOverlay,i=this.formField.$field,o=i.position(),n=t.graphics.getInsets(i,{includePadding:!0}),r=i[0],s=r.scrollWidth-r.clientWidth>0,a=r.scrollHeight-r.clientHeight>0,l=t.device.scrollbarWidth;e.css("top",o.top).css("left",o.left).width(i.width()+n.horizontal()-(a?l:0)).height(i.height()+n.vertical()-(s?l:0))}},t.FormFieldLayout.prototype._isLabelVisible=function(){return this.formField.$label&&this.formField.labelVisible;
},t.FormFieldLayout.prototype._isStatusVisible=function(){return this.formField.$status&&(this.formField.statusVisible||this.formField.$status.isVisible())},t.FormFieldLayout.prototype.preferredLayoutSize=function(e){var i,o,n,r=0,s=t.HtmlComponent.get(e),a=t.HtmlEnvironment.formRowHeight,l=this.labelWidth,h=0,d=this.statusWidth,p=this.formField;return this._isLabelVisible()&&(p.labelUseUiWidth&&(l=p.$label.hasClass("empty")?0:t.graphics.prefSize(p.$label,{includeMargin:!0}).width),n=p.labelPosition===t.FormField.LABEL_POSITION_DEFAULT||p.labelPosition===t.FormField.LABEL_POSITION_LEFT,n?r+=l:p.labelPosition===t.FormField.LABEL_POSITION_TOP&&(h=p.$label.outerHeight(!0),a+=h)),p.$mandatory&&(r+=p.$mandatory.outerWidth(!0)),this._isStatusVisible()&&(r+=d+p.$status.cssMarginX()),p.$fieldContainer?(o=t.HtmlComponent.optGet(p.$fieldContainer),o?(i=o.getPreferredSize().add(s.getInsets()).add(o.getMargins()),i.height+=h):i=this.naturalSize(p)):i=new t.Dimension(0,0),r+=i.width,a=Math.max(a,i.height),new t.Dimension(r,a)},t.FormFieldLayout.prototype._layoutIcon=function(t,e,i,o){var n=this.rowHeight;e&&(n=e.height),t.$icon.cssRight(t.$field.cssBorderRightWidth()+i).cssTop(o).cssHeight(n).cssLineHeight(n)},t.FormFieldLayout.prototype.naturalSize=function(e){return t.graphics.prefSize(e.$fieldContainer,{includeMargin:!0})},t.GridData=function(t){t=t||{},this.x=-1,this.y=-1,this.w=1,this.h=1,this.weightX=-1,this.weightY=-1,this.useUiWidth=!1,this.useUiHeight=!1,this.horizontalAlignment=-1,this.verticalAlignment=-1,this.fillHorizontal=!0,this.fillVertical=!0,this.widthInPixel=0,this.heightInPixel=0,e.extend(this,t)},t.GridData.createFromHints=function(e,i){var o=new t.GridData(e.gridDataHints);return o.w===t.FormField.FULL_WIDTH&&(o.w=i),o},t.CompositeField=function(){t.CompositeField.parent.call(this)},t.inherits(t.CompositeField,t.FormField),t.CompositeField.prototype.getFields=function(){throw new Error("Not implemented")},t.CompositeField.prototype.visit=function(e){t.CompositeField.parent.prototype.visit.call(this,e),this.getFields().forEach(function(t){t.visit(e)})},t.CompositeField.prototype.setDisabledStyle=function(e){this.getFields().forEach(function(t){t.setDisabledStyle(e)}),t.CompositeField.parent.prototype.setDisabledStyle.call(this,e)},t.CompositeField.prototype.recomputeEnabled=function(e){t.CompositeField.parent.prototype.recomputeEnabled.call(this,e),this.getFields().forEach(function(t){t.recomputeEnabled(this.enabledComputed)},this)},t.CompositeFieldAdapter=function(){t.FormFieldAdapter.parent.call(this)},t.inherits(t.CompositeFieldAdapter,t.FormFieldAdapter),t.ValueField=function(){t.ValueField.parent.call(this),this._initialValue=null,this.displayText=""},t.inherits(t.ValueField,t.FormField),t.ValueField.prototype._renderProperties=function(){t.ValueField.parent.prototype._renderProperties.call(this),this._renderDisplayText()},t.ValueField.prototype._renderDisplayText=function(){this.$field.val(this.displayText)},t.ValueField.prototype._readDisplayText=function(){return this.$field.val()},t.ValueField.prototype._onFieldBlur=function(){this.acceptInput(!1)},t.ValueField.prototype.acceptInput=function(e){e=!!e;var i=t.nvl(this._readDisplayText(),"");this._checkDisplayTextChanged(i,e)&&(e?this._callSetProperty("displayText",i):this._parseAndSetValue(i),this._triggerDisplayTextChanged(i,e))},t.ValueField.prototype._parseAndSetValue=function(t){this.setValue(this._parseValue(t))},t.ValueField.prototype._parseValue=function(t){return t},t.ValueField.prototype._checkDisplayTextChanged=function(e,i){var o=t.nvl(this.displayText,"");return e!==o},t.ValueField.prototype.aboutToBlurByMouseDown=function(t){var e=this.$field.isOrHas(t);e||this.acceptInput()},t.ValueField.prototype._triggerDisplayTextChanged=function(t,e){var i={displayText:t,whileTyping:!!e};this.trigger("displayTextChanged",i)},t.ValueField.prototype.setDisplayText=function(t){this.setProperty("displayText",t)},t.ValueField.prototype.setValue=function(t){this.setProperty("value",t)},t.ValueField.prototype._syncValue=function(t){var e=this.value;this.value=this._validateValue(t),this._updateTouched(),this._updateEmpty(),this.triggerPropertyChange("value",e,t),this._updateDisplayText()},t.ValueField.prototype._updateDisplayText=function(){var t=this._formatValue(this.value);t&&e.isFunction(t.promise)?t.done(this.setDisplayText.bind(this)).fail(function(){this.setDisplayText(""),e.log.error("Could not resolve display text.")}.bind(this)):this.setDisplayText(t)},t.ValueField.prototype._validateValue=function(t){return t},t.ValueField.prototype._formatValue=function(e){return t.nvl(e,"")},t.ValueField.prototype._updateTouched=function(){this.touched=!t.objects.equals(this.value,this._initialValue)},t.ValueField.prototype.addField=function(e){t.ValueField.parent.prototype.addField.call(this,e),this.$field.data("valuefield",this)},t.ValueField.prototype._onStatusMousedown=function(e){if(this.menus&&this.menus.length>0){var i=this.$container.activeElement();i.data("valuefield")!==this&&i.parent().data("valuefield")!==this||this.acceptInput()}t.ValueField.parent.prototype._onStatusMousedown.call(this,e)},t.ValueField.invokeValueFieldAboutToBlurByMouseDown=function(t){var e=this._getActiveValueField(t);e&&e.aboutToBlurByMouseDown(t)},t.ValueField.invokeValueFieldAcceptInput=function(t){var e=this._getActiveValueField(t);e&&e.acceptInput()},t.ValueField._getActiveValueField=function(t){var i=e(t.ownerDocument.activeElement),o=i.data("valuefield")||i.parent().data("valuefield");return!o||o.$field&&o.$field.hasClass("disabled")?null:o},t.ValueField.prototype.markAsSaved=function(){t.ValueField.parent.prototype.markAsSaved.call(this),this._initialValue=this.value},t.ValueField.prototype._updateEmpty=function(){this.empty=null===this.value||this.value===i},t.ValueFieldAdapter=function(){t.ValueFieldAdapter.parent.call(this)},t.inherits(t.ValueFieldAdapter,t.FormFieldAdapter),t.ValueFieldAdapter.prototype._onWidgetDisplayTextChanged=function(t){this._send("displayTextChanged",{displayText:t.displayText,whileTyping:t.whileTyping},{showBusyIndicator:!t.whileTyping})},t.ValueFieldAdapter.prototype._onWidgetEvent=function(e){"displayTextChanged"===e.type?this._onWidgetDisplayTextChanged(e):t.ValueFieldAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.ValueFieldAdapter.prototype.exportAdapterData=function(e){return e=t.ValueFieldAdapter.parent.prototype.exportAdapterData.call(this,e),delete e.displayText,e},t.BasicField=function(){t.BasicField.parent.call(this),this._onDisplayTextModifiedHandler=this._onDisplayTextModified.bind(this),this.disabledCopyOverlay=!0,this._displayTextModifiedTimeoutId=null},t.inherits(t.BasicField,t.ValueField),t.BasicField.prototype._renderProperties=function(){t.BasicField.parent.prototype._renderProperties.call(this),this._renderUpdateDisplayTextOnModify()},t.BasicField.prototype.setUpdateDisplayTextOnModify=function(t){this.setProperty("updateDisplayTextOnModify",t)},t.BasicField.prototype._renderUpdateDisplayTextOnModify=function(){this.updateDisplayTextOnModify?this.$field.on("input",this._onDisplayTextModifiedHandler):(clearTimeout(this._displayTextModifiedTimeoutId),this.$field.off("input",this._onDisplayTextModifiedHandler))},t.BasicField.prototype._onDisplayTextModified=function(){clearTimeout(this._displayTextModifiedTimeoutId),this._displayTextModifiedTimeoutId=setTimeout(function(){return this.rendered?void this.acceptInput(!0):void(this._displayTextModifiedTimeoutId=null)}.bind(this),250)},t.BasicField.prototype.acceptInput=function(e){e||null===this._displayTextModifiedTimeoutId||(clearTimeout(this._displayTextModifiedTimeoutId),this.acceptInput(!0)),this._displayTextModifiedTimeoutId=null,t.BasicField.parent.prototype.acceptInput.call(this,e)},t.BasicField.prototype._checkDisplayTextChanged=function(e,i){var o=t.BasicField.parent.prototype._checkDisplayTextChanged.call(this,e,i);if(o||(this.updateDisplayTextOnModify||this._displayTextChangedWhileTyping)&&!i){if(this.updateDisplayTextOnModify)if(i)this._displayTextChangedWhileTyping=!0;else{if(!this._displayTextChangedWhileTyping)return!1;this._displayTextChangedWhileTyping=!1}return!0}return!1},t.BasicFieldAdapter=function(){t.BasicFieldAdapter.parent.call(this),this.enabledWhenOffline=!0},t.inherits(t.BasicFieldAdapter,t.ValueFieldAdapter),t.FormController=function(t,e){this.displayParent=t,this.session=e},t.FormController.prototype.registerAndRender=function(t,e,i){t._setProperty("displayParent",this.displayParent),t.isPopupWindow()?this._renderPopupWindow(t):t.isView()?this._renderView(t,!0,e,i):this._renderDialog(t,!0)},t.FormController.prototype._renderPopupWindow=function(t,e){throw new Error("popup window only supported by DesktopFormController")},t.FormController.prototype.unregisterAndRemove=function(t){t&&(t.isPopupWindow()?this._removePopupWindow(t):t.isView()?this._removeView(t):this._removeDialog(t))},t.FormController.prototype._removePopupWindow=function(t){throw new Error("popup window only supported by DesktopFormController")},t.FormController.prototype.render=function(){this.displayParent.dialogs.forEach(function(t){t._setProperty("displayParent",this.displayParent),this._renderDialog(t,!1)}.bind(this)),this.displayParent.views.forEach(function(t,e){t._setProperty("displayParent",this.displayParent),this._renderView(t,!1,e,!1)}.bind(this))},t.FormController.prototype.remove=function(){this.displayParent.dialogs.forEach(function(t){this._removeDialog(t,!1)}.bind(this)),this.displayParent.views.forEach(function(t,e){this._removeView(t,!1)}.bind(this))},t.FormController.prototype.activateForm=function(e){e.rendered&&(e.displayHint===t.Form.DisplayHint.VIEW?this._activateView(e):this._activateDialog(e))},t.FormController.prototype.acceptView=function(t,e,i,o){return!!this.displayParent.rendered},t.FormController.prototype._renderView=function(e,o,n,r){if(o&&(n!==i?t.arrays.insert(this.displayParent.views,e,n):this.displayParent.views.push(e)),this.displayParent.acceptView){if(!this.displayParent.acceptView(e))return}else if(!this.acceptView(e))return;return!e.rendered&&(this.session.desktop.displayStyle!==t.Desktop.DisplayStyle.COMPACT||this.session.desktop.bench||(this.session.desktop.sendOutlineToBack(),this.session.desktop.switchToBench()),void this.session.desktop.bench.addView(e,r))},t.FormController.prototype.acceptDialog=function(t){return!!this.displayParent.rendered},t.FormController.prototype._renderDialog=function(e,i){var o=this.session.desktop;if(i&&this.displayParent.dialogs.push(e),this.displayParent.acceptDialog){if(!this.displayParent.acceptDialog(e))return}else if(!this.acceptDialog(e))return;return!e.rendered&&(e.on("remove",function(){this.displayParent.dialogs.length>0?o._setFormActivated(this.displayParent.dialogs[this.displayParent.dialogs.length-1]):this.displayParent instanceof t.Form&&!this.displayParent.detailForm?o._setFormActivated(this.displayParent):o._setOutlineActivated()}.bind(this)),void(e.isPopupWindow()?this._renderPopupWindow(e):(e.render(o.$container),this._layoutDialog(e),o._setFormActivated(e),this.displayParent.inFront()||e.detach())))},t.FormController.prototype._removeView=function(e,i){i=t.nvl(i,!0),i&&t.arrays.remove(this.displayParent.views,e),this.session.desktop.bench&&this.session.desktop.bench.removeView(e)},t.FormController.prototype._removeDialog=function(e,i){i=t.nvl(i,!0),i&&t.arrays.remove(this.displayParent.dialogs,e),e.rendered&&e.remove()},t.FormController.prototype._activateView=function(t){this.session.desktop.bench.activateView(t)},t.FormController.prototype._activateDialog=function(t){this.displayParent.inFront()&&!t.attached&&t.attach()},t.FormController.prototype.attachDialogs=function(){this.displayParent.dialogs.forEach(function(t){t.attach()},this)},t.FormController.prototype.detachDialogs=function(){this.displayParent.dialogs.forEach(function(t){t.detach()},this)},t.FormController.prototype._layoutDialog=function(e){var i,o,n,r,s=e.$container.window(),a=new t.Dimension(s.width(),s.height());e.htmlComp.pixelBasedSizing=!0,e.htmlComp.validateLayout(),r=e.htmlComp.getSize(!0),i=(a.width-r.width)/2,o=(a.height-r.height)/2,n=Math.min(o/5,10),o-=n,e.$container.cssLeft(i).cssTop(o),e.trigger("move",{top:o,left:i}),this.session.focusManager.validateFocus()},t.MessageBox=function(){t.MessageBox.parent.call(this),this.$container,this.$content,this.$header,this.$body,this.$buttons,this.$yesButton,this.$noButton,this.$cancelButton,this._$closeButton,this.focusListener},t.inherits(t.MessageBox,t.Widget),t.MessageBox.SEVERITY={OK:1,INFO:256,WARNING:65536,ERROR:16777216},t.MessageBox.prototype._createKeyStrokeContext=function(){return new t.KeyStrokeContext},t.MessageBox.prototype._initKeyStrokeContext=function(){t.MessageBox.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke([new t.FocusAdjacentElementKeyStroke(this.session,this),new t.ClickActiveElementKeyStroke(this,[t.keys.SPACE,t.keys.ENTER]),new t.CloseKeyStroke(this,function(){return this._$closeButton}.bind(this))])},t.MessageBox.prototype._render=function(e){if(!e)throw new Error("Missing argument $parent");this._glassPaneRenderer=new t.GlassPaneRenderer(this.session,this,(!0)),this._glassPaneRenderer.renderGlassPanes(),this.$container=e.appendDiv("messagebox");var i=this.$container.appendDiv("drag-handle");this.$container.makeDraggable(i),this.$content=this.$container.appendDiv("messagebox-content"),this.$header=this.$content.appendDiv("messagebox-label messagebox-header"),this.$body=this.$content.appendDiv("messagebox-label messagebox-body"),this.$html=this.$content.appendDiv("messagebox-label messagebox-html prevent-initial-focus"),this.$buttons=this.$container.appendDiv("messagebox-buttons");var o=new t.BoxButtons(this.$buttons,this._onButtonClick.bind(this));this._$closeButton=null,this.yesButtonText&&(this.$yesButton=o.addButton({text:this.yesButtonText,option:"yes"}),this._$closeButton=this.$yesButton),this.noButtonText&&(this.$noButton=o.addButton({text:this.noButtonText,option:"no"}),this._$closeButton=this.$noButton),this.cancelButtonText&&(this.$cancelButton=o.addButton({text:this.cancelButtonText,option:"cancel"}),this._$closeButton=this.$cancelButton),this._renderIconId(this.iconId),this._renderSeverity(this.severity),this._renderHeader(this.header),this._renderBody(this.body),this._renderHtml(this.html),this._renderHiddenText(this.hiddenText),this.$container.addClass("calc-helper");var n=this.$container.width();this.$container.removeClass("calc-helper"),this.$container.css("min-width",Math.max(n,100*o.buttonCount())),o.updateButtonWidths(this.$container.width()),this._position(),this.$container.addClassForAnimation("animate-open")},t.MessageBox.prototype._postRender=function(){t.MessageBox.parent.prototype._postRender.call(this),this.session.focusManager.installFocusContext(this.$container,t.focusRule.AUTO)},t.MessageBox.prototype._remove=function(){this._glassPaneRenderer.removeGlassPanes(),this.session.focusManager.uninstallFocusContext(this.$container),t.MessageBox.parent.prototype._remove.call(this)},t.MessageBox.prototype._position=function(){this.$container.cssMarginLeft(-this.$container.outerWidth()/2)},t.MessageBox.prototype._renderIconId=function(t){},t.MessageBox.prototype._renderSeverity=function(e){this.$container.removeClass("severity-error"),e===t.MessageBox.SEVERITY.ERROR&&this.$container.addClass("severity-error")},t.MessageBox.prototype._renderHeader=function(e){this.$header.html(t.strings.nl2br(e)),this.$header.setVisible(e)},t.MessageBox.prototype._renderBody=function(e){this.$body.html(t.strings.nl2br(e)),this.$body.setVisible(e)},t.MessageBox.prototype._renderHtml=function(t){this.$html.html(t),this.$html.setVisible(t),this.$html.find("a, .app-link").attr("tabindex","0").unfocusable()},t.MessageBox.prototype._renderHiddenText=function(t){this.$hiddenText&&this.$hiddenText.remove(),t&&(this.$hiddenText=this.$content.appendElement("<!-- \n"+t.replace(/<!--|-->/g,"")+"\n -->"))},t.MessageBox.prototype._onButtonClick=function(t,e){this.trigger("action",{option:e})},t.MessageBox.prototype.close=function(){this._$closeButton&&this.session.focusManager.requestFocus(this._$closeButton)&&this._$closeButton.click()},t.MessageBox.prototype._attach=function(){this.$parent.append(this.$container),this.session.detachHelper.afterAttach(this.$container),t.MessageBox.parent.prototype._attach.call(this)},t.MessageBox.prototype._detach=function(){this.session.detachHelper.beforeDetach(this.$container),this.$container.detach(),t.MessageBox.parent.prototype._detach.call(this)},t.MessageBoxAdapter=function(){t.MessageBoxAdapter.parent.call(this)},t.inherits(t.MessageBoxAdapter,t.ModelAdapter),t.MessageBoxAdapter.prototype._onWidgetAction=function(t){this._send("action",{option:t.option})},t.MessageBoxAdapter.prototype._onWidgetEvent=function(e){"action"===e.type?this._onWidgetAction(e):t.MessageBoxAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.MessageBoxController=function(t,e){this.displayParent=t,this.session=e},t.MessageBoxController.prototype.registerAndRender=function(t){t._setProperty("displayParent",this.displayParent),this.displayParent.messageBoxes.push(t),this._render(t)},t.MessageBoxController.prototype.unregisterAndRemove=function(e){e&&(t.arrays.remove(this.displayParent.messageBoxes,e),this._remove(e))},t.MessageBoxController.prototype.remove=function(){this.displayParent.messageBoxes.forEach(this._remove.bind(this))},t.MessageBoxController.prototype.render=function(){this.displayParent.messageBoxes.forEach(this._render.bind(this))},t.MessageBoxController.prototype._render=function(e){if(this.displayParent.rendered&&!e.rendered){var i;i=this.displayParent instanceof t.Form&&this.displayParent.isPopupWindow()?this.displayParent.popupWindow.$container:this.session.desktop.$container,e.render(i),this.displayParent.inFront()||e.detach()}},t.MessageBoxController.prototype._remove=function(t){t.remove()},t.MessageBoxController.prototype.attach=function(){this.displayParent.messageBoxes.forEach(function(t){t.attach()},this)},t.MessageBoxController.prototype.detach=function(){this.displayParent.messageBoxes.forEach(function(t){t.detach()},this)},t.BeanField=function(){t.BeanField.parent.call(this),this.preventInitialFocus=!0},t.inherits(t.BeanField,t.ValueField),t.BeanField.prototype._render=function(t){this.addContainer(t,"bean-field"),this.addLabel(),this.addField(t.makeDiv()),this.addStatus()},t.BeanField.prototype._renderProperties=function(){t.BeanField.parent.prototype._renderProperties.call(this),this._renderValue()},t.BeanField.prototype._initKeyStrokeContext=function(){t.BeanField.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke(new t.AppLinkKeyStroke(this,this._onAppLinkAction))},t.BeanField.prototype._renderDisplayText=function(){},t.BeanField.prototype._renderValue=function(){},t.BeanField.prototype.triggerAppLinkAction=function(t){this.trigger("appLinkAction",{ref:t})},t.BeanField.prototype._onAppLinkAction=function(t){var i=e(t.target),o=i.data("ref");this.triggerAppLinkAction(o)},t.BeanFieldAdapter=function(){t.BeanFieldAdapter.parent.call(this)},t.inherits(t.BeanFieldAdapter,t.ValueFieldAdapter),t.BeanFieldAdapter.prototype._onWidgetAppLinkAction=function(t){this._send("appLinkAction",{ref:t.ref})},t.BeanFieldAdapter.prototype._onWidgetEvent=function(e){"appLinkAction"===e.type?this._onWidgetAppLinkAction(e):t.BeanFieldAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.BrowserField=function(){t.BrowserField.parent.call(this),this._messageListener,this._popupWindow,this._externalWindowTextField,this._externalWindowButton},t.inherits(t.BrowserField,t.ValueField),t.BrowserField.windowStates={WINDOW_OPEN:"true",WINDOW_CLOSED:"false"},t.BrowserField.prototype._render=function(t){this.addContainer(t,"browser-field"),this.addLabel(),this.addStatus(),this.showInExternalWindow?(this.addField(t.makeDiv()),this._externalWindowTextField=this.$field.appendDiv().addClass("alt"),this._externalWindowButton=this.$field.appendDiv().addClass("button").on("click",this._openPopupWindow.bind(this))):this.addField(t.makeElement("<iframe>")),this.myWindow=t.window(!0),this._messageListener=this._onMessage.bind(this),this.myWindow.addEventListener("message",this._messageListener),this.enabledComputed&&setTimeout(this._openPopupWindow.bind(this,!0),20)},t.BrowserField.prototype._renderProperties=function(){t.BrowserField.parent.prototype._renderProperties.call(this),this._renderIframeProperties(),this._renderExternalWindowButtonText(),this._renderExternalWindowFieldText()},t.BrowserField.prototype._renderIframeProperties=function(){this._renderLocation(),this._renderScrollBarEnabled(),this._renderSandboxEnabled()},t.BrowserField.prototype._renderLocation=function(){var t=this.location||"about:blank";this.showInExternalWindow?this._popupWindow&&!this._popupWindow.closed&&(this._popupWindow.location=t):this.$field.attr("src",t)},t.BrowserField.prototype._renderScrollBarEnabled=function(){this.showInExternalWindow||(this.$field.toggleClass("no-scrolling",!this.scrollBarEnabled),this.scrollBarEnabled?this.$field.removeAttr("scrolling"):this.$field.attr("scrolling","no"))},t.BrowserField.prototype._renderSandboxEnabled=function(){this.showInExternalWindow||(this.sandboxEnabled?this._renderSandboxPermissions():(this.$field.removeAttr("sandbox"),this.$field.removeAttr("security")))},t.BrowserField.prototype._renderSandboxPermissions=function(){!this.showInExternalWindow&&this.sandboxEnabled&&(this.$field.attr("sandbox",t.nvl(this.sandboxPermissions,"")),t.device.requiresIframeSecurityAttribute()&&this.$field.attr("security","restricted"))},t.BrowserField.prototype._renderExternalWindowButtonText=function(){this.showInExternalWindow&&this._externalWindowButton.text(this.externalWindowButtonText)},t.BrowserField.prototype._renderExternalWindowFieldText=function(){this.showInExternalWindow&&this._externalWindowTextField.text(this.externalWindowFieldText)},t.BrowserField.prototype._openPopupWindow=function(o){if(o=t.nvl(o,!0),this.showInExternalWindow)if(!this._popupWindow||o&&this._popupWindow.closed){var n=new t.PopupBlockerHandler(this.session),r=Math.min(t.nvl(window.screenLeft,window.screenX)+this.$field.offset().left,window.screen.availWidth-400),s=Math.min(t.nvl(window.screenTop,window.screenY+50)+this.$field.offset().top,window.screen.availHeight-400),a=this.$field.width()+r>window.screen.availWidth?window.screen.availWidth-r:this.$field.width(),l=this.$field.height()+s>window.screen.availHeight?window.screen.availHeight-s:this.$field.height(),h=t.strings.join(",","directories=no","location=no","menubar=no","resizable=yes,","status=no","scrollbars="+(this.scrollBarEnabled?"yes":"no"),"toolbar=no","dependent=yes","left="+r,"top="+s,"width="+a,"height="+l),d=this.location||"about:blank";this._popupWindow=n.openWindow(d,i,h),this._popupWindow?this._popupWindowOpen():(e.log.warn("Popup-blocker detected! Show link to open window manually"),n.showNotification(function(){this._popupWindow=window.open(d,i,h),this._popupWindowOpen()}.bind(this)))}else o&&this._popupWindow.focus()},t.BrowserField.prototype._popupWindowOpen=function(){if(this._popupWindow&&!this._popupWindow.closed){this.trigger("externalWindowStateChange",{windowState:t.BrowserField.windowStates.WINDOW_OPEN});var e=window.setInterval(function(){(null===this._popupWindow||this._popupWindow.closed)&&(window.clearInterval(e),this.trigger("externalWindowStateChange",{windowState:t.BrowserField.windowStates.WINDOW_CLOSED}))}.bind(this),500)}},t.BrowserField.prototype._onMessage=function(t){e.log.debug("received post-message data="+t.data+" origin="+t.origin),this.trigger("message",{data:t.data,origin:t.origin})},t.BrowserField.prototype._remove=function(){t.BrowserField.parent.prototype._remove.call(this),this.myWindow.removeEventListener("message",this._messageListener),this._messageListener=null,this.showInExternalWindow&&this.autoCloseExternalWindow&&this._popupWindow&&!this._popupWindow.closed&&this._popupWindow.close()},t.BrowserField.prototype._afterAttach=function(e){!this.showInExternalWindow&&t.device.requiresIframeSecurityAttribute()&&(this.$field.remove(),this._removeField(),this.addField(e.$container.makeElement("<iframe>")),this._renderIframeProperties(),this.htmlComp.revalidateLayout())},t.BrowserFieldAdapter=function(){t.BrowserFieldAdapter.parent.call(this)},t.inherits(t.BrowserFieldAdapter,t.ValueFieldAdapter),t.BrowserFieldAdapter.prototype._onWidgetMessage=function(t){this._send("postMessage",{data:t.data,origin:t.origin})},t.BrowserFieldAdapter.prototype._onWidgetExternalWindowStateChange=function(t){this._send("externalWindowStateChange",{windowState:t.windowState})},t.BrowserFieldAdapter.prototype._onWidgetEvent=function(e){"message"===e.type?this._onWidgetMessage(e):"externalWindowStateChange"===e.type?this._onWidgetExternalWindowStateChange(e):t.BrowserFieldAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.Button=function(){t.Button.parent.call(this),this._addAdapterProperties(["menus"]),this.systemType=t.Button.SystemType.NONE,this.defaultButton=!1,this.processButton=!0,this.selected=!1,this.displayStyle=t.Button.DisplayStyle.DEFAULT,this.keyStroke,this.statusVisible=!1,this.$buttonLabel,this.buttonKeyStroke=new t.ButtonKeyStroke(this,null)},t.inherits(t.Button,t.FormField),t.Button.SystemType={NONE:0,CANCEL:1,CLOSE:2,OK:3,RESET:4,SAVE:5,SAVE_WITHOUT_MARKER_CHANGE:6},t.Button.DisplayStyle={DEFAULT:0,TOGGLE:1,RADIO:2,LINK:3},t.Button.prototype._init=function(e){t.Button.parent.prototype._init.call(this,e),this._syncKeyStroke(this.keyStroke)},t.Button.prototype._initKeyStrokeContext=function(){t.Button.parent.prototype._initKeyStrokeContext.call(this),this._initDefaultKeyStrokes(),this.formKeyStrokeContext=new t.KeyStrokeContext,this.formKeyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.formKeyStrokeContext.registerKeyStroke(this.buttonKeyStroke),this.formKeyStrokeContext.$bindTarget=function(){return this.keyStrokeScope?this.keyStrokeScope.$container:this.getForm().$container}.bind(this)},t.Button.prototype.recomputeEnabled=function(e){this._isIgnoreAccessibilityFlags()&&(e=!0),t.Button.parent.prototype.recomputeEnabled.call(this,e)},t.Button.prototype._isIgnoreAccessibilityFlags=function(){return this.systemType===t.Button.SystemType.CANCEL||this.systemType===t.Button.SystemType.CLOSE},t.Button.prototype._initDefaultKeyStrokes=function(){this.keyStrokeContext.registerKeyStroke([new t.ButtonKeyStroke(this,"ENTER"),new t.ButtonKeyStroke(this,"SPACE")])},t.Button.prototype._createLoadingSupport=function(){return new t.LoadingSupport({widget:this,$container:function(){return this.$field}.bind(this)})},t.Button.prototype._render=function(e){var i;this.displayStyle===t.Button.DisplayStyle.LINK?(i=e.makeDiv("link-button"),this.$link=i.appendDiv("menu-item link"),this.$buttonLabel=this.$link.appendSpan("button-label text")):(i=e.makeElement("<button>").addClass("button"),this.$buttonLabel=i.appendSpan("button-label"),t.device.supportsTouch()&&i.setTabbable(!1)),this.addContainer(e,"button-field",new t.ButtonLayout(this)),this.addField(i),this.addStatus(),i.on("click",this._onClick.bind(this)).unfocusable(),this.menus&&this.menus.length>0&&(this.menus.forEach(function(t){this.keyStrokeContext.registerKeyStroke(t)},this),!this.label&&this.iconId||(this.$submenuIcon=(this.$link||i).appendSpan("submenu-icon"))),this.session.keyStrokeManager.installKeyStrokeContext(this.formKeyStrokeContext)},t.Button.prototype._remove=function(){t.Button.parent.prototype._remove.call(this),this.session.keyStrokeManager.uninstallKeyStrokeContext(this.formKeyStrokeContext),this.$submenuIcon=null},t.Button.prototype._renderProperties=function(){t.Button.parent.prototype._renderProperties.call(this),this._renderIconId(),this._renderSelected(),this._renderDefaultButton()},t.Button.prototype._renderForegroundColor=function(){t.Button.parent.prototype._renderForegroundColor.call(this),this.$buttonLabel.css("color",t.styles.modelToCssColor(this.foregroundColor))},t.Button.prototype.doAction=function(){return!(!this.enabledComputed||!this.visible)&&(this.displayStyle===t.Button.DisplayStyle.TOGGLE?this.setSelected(!this.selected):this.menus.length>0?this.togglePopup():this.trigger("click"),!0)},t.Button.prototype.togglePopup=function(){this.popup?this.popup.close():(this.popup=this._openPopup(),this.popup.one("destroy",function(t){this.popup=null}.bind(this)))},t.Button.prototype._openPopup=function(){var e=t.create("ContextMenuPopup",{parent:this,menuItems:this.menus,cloneMenuItems:!1,closeOnAnchorMousedown:!1,$anchor:this.$field});return e.open(),e},t.Button.prototype._doActionTogglesSubMenu=function(){return!1},t.Button.prototype.setDefaultButton=function(t){this.setProperty("defaultButton",t)},t.Button.prototype._renderDefaultButton=function(){this.$field.toggleClass("default",this.defaultButton)},t.Button.prototype._renderEnabled=function(){t.Button.parent.prototype._renderEnabled.call(this),this.displayStyle===t.Button.DisplayStyle.LINK&&(this.$link.setEnabled(this.enabledComputed),this.$field.setTabbable(this.enabledComputed&&!t.device.supportsTouch()))},t.Button.prototype.setSelected=function(t){this.setProperty("selected",t)},t.Button.prototype._renderSelected=function(){this.displayStyle===t.Button.DisplayStyle.TOGGLE&&this.$field.toggleClass("selected",this.selected)},t.Button.prototype._renderLabel=function(){this.iconId?this.$buttonLabel.text(this.label):this.$buttonLabel.textOrNbsp(this.label),this.htmlComp.invalidateLayoutTree()},t.Button.prototype.setIconId=function(t){this.setProperty("iconId",t)},t.Button.prototype._renderIconId=function(){function t(t){i.removeClass("loading"),i.toggleClass("broken",!t),this.htmlComp.invalidateLayoutTree()}var e=this.$link||this.$field;e.icon(this.iconId);var i=e.data("$icon");i&&(i.toggleClass("with-label",!!this.label),i.removeClass("loading broken"),i.is("img")&&(i.addClass("loading"),i.off("load error").on("load",t.bind(this,!0)).on("error",t.bind(this,!1)))),this.htmlComp.invalidateLayoutTree()},t.Button.prototype._syncKeyStroke=function(t){this._setProperty("keyStroke",t),this.buttonKeyStroke.parseAndSetKeyStroke(this.keyStroke)},t.Button.prototype._onClick=function(t){this.enabledComputed&&this.doAction()},t.Button.prototype.getFocusableElement=function(){return this.adaptedBy?this.adaptedBy.getFocusableElement(this):t.Button.parent.prototype.focus.getFocusableElement(this)},t.Button.prototype.getFocusableElement=function(){return this.adaptedBy?this.adaptedBy.getFocusableElement(this):t.Button.parent.prototype.focus.getFocusableElement(this)},t.ButtonAdapter=function(){t.ButtonAdapter.parent.call(this),this._addRemoteProperties(["selected"])},t.inherits(t.ButtonAdapter,t.FormFieldAdapter),t.ButtonAdapter.prototype._postCreateWidget=function(){if(this.widget.keyStrokeScope){var t=this.widget.getForm().modelAdapter;return t.attached?void this._resolveKeyStrokeScope():void t.events.one("attach",this._resolveKeyStrokeScope.bind(this))}},t.ButtonAdapter.prototype._resolveKeyStrokeScope=function(){if(this.widget.keyStrokeScope=this.session.getWidget(this.widget.keyStrokeScope),!this.widget.keyStrokeScope)throw new Error("Could not resolve keyStrokeScope: "+this.widget.keyStrokeScope)},t.ButtonAdapter.prototype._onWidgetClick=function(t){this._send("clicked")},t.ButtonAdapter.prototype._onWidgetEvent=function(e){"click"===e.type?this._onWidgetClick(e):t.ButtonAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.ButtonAdapter.prototype.exportAdapterData=function(e){return e=t.ButtonAdapter.parent.prototype.exportAdapterData.call(this,e),delete e.keyStrokeScope,e},t.ButtonLayout=function(e){t.ButtonLayout.parent.call(this,e),this.button=e},t.inherits(t.ButtonLayout,t.FormFieldLayout),t.ButtonLayout.prototype.naturalSize=function(){return t.graphics.prefSize(this.button.$field,{includeMargin:!0})},t.ButtonKeyStroke=function(e,i){
t.ButtonKeyStroke.parent.call(this),this.field=e,this.parseAndSetKeyStroke(i),this.stopPropagation=!0,this.renderingHints.offset=4,this.renderingHints.hAlign=t.hAlign.RIGHT,this.renderingHints.$drawingArea=function(t,e){return this.field.$container}.bind(this)},t.inherits(t.ButtonKeyStroke,t.KeyStroke),t.ButtonKeyStroke.prototype._accept=function(e){var i=t.ButtonKeyStroke.parent.prototype._accept.call(this,e);return i&&this.field.$field.isAttached()},t.ButtonKeyStroke.prototype.handle=function(t){this.field.doAction()},t.CalendarField=function(){t.CalendarField.parent.call(this),this._addAdapterProperties(["calendar"])},t.inherits(t.CalendarField,t.FormField),t.CalendarField.prototype._render=function(t){this.addContainer(t,"calendar-field"),this.addLabel(),this.addStatus(),this.calendar&&(this.calendar.render(this.$container),this.addField(this.calendar.$container))},t.CalendarFieldAdapter=function(){t.CalendarFieldAdapter.parent.call(this),this._addAdapterProperties(["calendar"])},t.inherits(t.CalendarFieldAdapter,t.FormFieldAdapter),t.CheckBoxField=function(){t.CheckBoxField.parent.call(this),this.triStateEnabled=!1,this.$checkBox,this.$checkBoxLabel},t.inherits(t.CheckBoxField,t.ValueField),t.CheckBoxField.prototype._initKeyStrokeContext=function(){t.CheckBoxField.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke(new t.CheckBoxToggleKeyStroke(this))};t.CheckBoxField.prototype._render=function(e){this.addContainer(e,"check-box-field"),this.addLabel(),this.addMandatoryIndicator(),this.addFieldContainer(e.makeDiv()),this.$checkBox=this.$fieldContainer.appendDiv("check-box").on("mousedown",this._onMouseDown.bind(this)).data("valuefield",this),this.addField(this.$checkBox),this.$checkBoxLabel=this.$fieldContainer.appendDiv("label").on("mousedown",this._onMouseDown.bind(this)),t.tooltips.installForEllipsis(this.$checkBoxLabel,{parent:this}),this.addStatus()};t.CheckBoxField.prototype._remove=function(){t.tooltips.uninstall(this.$checkBoxLabel),t.CheckBoxField.parent.prototype._remove.call(this)},t.CheckBoxField.prototype.acceptInput=function(t,e){},t.CheckBoxField.prototype._renderDisplayText=function(){},t.CheckBoxField.prototype._onMouseDown=function(t){this.toggleChecked(),t.currentTarget===this.$checkBoxLabel[0]&&this.session.focusManager.requestFocus(this.$checkBox)},t.CheckBoxField.prototype.toggleChecked=function(){this.enabledComputed&&(this.triStateEnabled?this.value===!1?this.setValue(!0):this.value===!0?this.setValue(null):this.setValue(!1):this.setValue(!this.value))},t.CheckBoxField.prototype.setValue=function(t){this.setProperty("value",t)},t.CheckBoxField.prototype._renderEnabled=function(){t.CheckBoxField.parent.prototype._renderEnabled.call(this),this.$checkBox.setTabbable(this.enabledComputed&&!t.device.supportsTouch()).setEnabled(this.enabledComputed)},t.CheckBoxField.prototype._renderProperties=function(){t.CheckBoxField.parent.prototype._renderProperties.call(this),this._renderValue()},t.CheckBoxField.prototype._renderValue=function(){this.$checkBox.toggleClass("checked",this.value===!0),this.$checkBox.toggleClass("undefined",this.triStateEnabled&&this.value!==!0&&this.value!==!1)},t.CheckBoxField.prototype._renderLabel=function(){this.$checkBoxLabel.textOrNbsp(this.label,"empty"),this.$label.html("&nbsp;")},t.CheckBoxField.prototype._renderFont=function(){t.styles.legacyStyle(this,this.$fieldContainer)},t.CheckBoxField.prototype._renderForegroundColor=function(){t.styles.legacyStyle(this,this.$fieldContainer)},t.CheckBoxField.prototype._renderBackgroundColor=function(){t.styles.legacyStyle(this,this.$fieldContainer)},t.CheckBoxField.prototype._renderGridData=function(){t.CheckBoxField.parent.prototype._renderGridData.call(this),this.updateInnerAlignment({useHorizontalAlignment:!0})},t.CheckBoxField.prototype.prepareForCellEdit=function(e){t.CheckBoxField.parent.prototype.prepareForCellEdit.call(this,e),this.$checkBoxLabel.hide()},t.CheckBoxFieldAdapter=function(){t.CheckBoxFieldAdapter.parent.call(this),this._addRemoteProperties(["value"])},t.inherits(t.CheckBoxFieldAdapter,t.ValueFieldAdapter),t.CheckBoxToggleKeyStroke=function(e){t.CheckBoxToggleKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.SPACE],this.field.owner instanceof t.Table||this.which.push(t.keys.ENTER),this.renderingHints.render=!1,this.stopPropagation=!0},t.inherits(t.CheckBoxToggleKeyStroke,t.KeyStroke),t.CheckBoxToggleKeyStroke.prototype.handle=function(t){this.field.toggleChecked()},t.ClipboardField=function(){t.ClipboardField.parent.call(this),this._fileUploadWaitRetryCountTimeout=99,this._fullSelectionLength=0},t.inherits(t.ClipboardField,t.ValueField),t.ClipboardField.prototype._createKeyStrokeContext=function(){return new t.InputFieldKeyStrokeContext},t.ClipboardField.prototype._render=function(t){this.addContainer(t,"clipboard-field"),this.addLabel(),this.addField(t.makeElement("<div>")),this.addStatus(),this.$field.disableSpellcheck().attr("contenteditable",!0).attr("tabindex","0").on("keydown",this._onInput.bind(this)).on("input",this._onInput.bind(this)).on("paste",this._onPaste.bind(this)).on("copy",this._onCopy.bind(this)).on("cut",this._onCopy.bind(this)),t.on("click",function(t){this.session.focusManager.requestFocus(this.$field)}.bind(this)),this.rendered&&this.session.focusManager.requestFocus(this.$field)},t.ClipboardField.prototype._renderProperties=function(){t.ClipboardField.parent.prototype._renderProperties.call(this),this._renderDropType()},t.ClipboardField.prototype._createDragAndDropHandler=function(){return t.dragAndDrop.handler(this,{supportedScoutTypes:t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER,dropType:function(){return this.dropType}.bind(this),dropMaximumSize:function(){return this.maximumSize}.bind(this),allowedTypes:function(){return this.allowedMimeTypes}.bind(this)})},t.ClipboardField.prototype._renderDisplayText=function(){var e,i=this.displayText;if(this.$field.children().each(function(t,i){e||"IMG"!==i.nodeName||(e=i)}),t.strings.hasText(i)){this.$field.html(t.strings.nl2br(i,!0)),t.scrollbars.install(this.$field,{parent:this}),this.$field.selectAllText();var o=this._getSelection();this._fullSelectionLength=o?o.toString().length:0}else this.$field.empty();e&&this.$field.prepend(e)},t.ClipboardField.prototype._readDisplayText=function(){return this.displayText},t.ClipboardField.prototype._getSelection=function(){var t,e=this.$container.window(!0);return e.getSelection?t=e.getSelection():document.getSelection&&(t=document.getSelection()),t&&0!==t.toString().length?t:null},t.ClipboardField.prototype._onInput=function(e){return"input"===e.type?(this._renderDisplayText(),!1):e.char&&""!==e.char&&(!e.ctrlKey||"c"!==e.key&&"x"!==e.key)?!this.readOnly&&e.ctrlKey&&"v"===e.key?void 0:e.keyCode===t.keys.ESC||e.keyCode===t.keys.ENTER?void 0:(this._renderDisplayText(),!1):void 0},t.ClipboardField.prototype._onCopy=function(e){var i,o,n,r=this.$container.window(!0);if(e.originalEvent.clipboardData)n=e.originalEvent.clipboardData;else{if(!r.clipboardData)throw new Error("Unable to access clipboard data.");n=r.clipboardData}if(t.scrollbars.uninstall(this.$field,this.session),i=this._getSelection()){o=i.toString().length===this._fullSelectionLength?this.displayText:t.strings.plainText(i.toString());try{n.setData("text/plain",o)}catch(t){n.setData("Text",o)}return t.scrollbars.install(this.$field,{parent:this}),!1}},t.ClipboardField.prototype._onPaste=function(i){if(this.readOnly)return void this._renderDisplayText();var o,n=this.$container.window(!0);if(this.$field.selectAllText(),i.originalEvent.clipboardData)o=i.originalEvent.clipboardData;else{if(!n.clipboardData)throw new Error("Unable to access clipboard data.");o=n.clipboardData}var r=[],s={},a=0,l=0,h=o.getData("Text");h&&(window.Blob?(r.push(new Blob([h],{type:t.mimeTypes.TEXT_PLAIN})),l++):(s["textTransferObject"+a++]=h,l++)),o.items&&Array.prototype.forEach.call(o.items,function(e){e.type===t.mimeTypes.TEXT_PLAIN?e.getAsString(function(e){r.push(new Blob([e],{type:t.mimeTypes.TEXT_PLAIN})),l++}):t.isOneOf(e.type,[t.mimeTypes.IMAGE_PNG,t.mimeTypes.IMAGE_JPG,t.mimeTypes.IMAGE_JPEG,t.mimeTypes.IMAGE_GIF])&&(r.push(e.getAsFile()),l++)});var d=0;o.files&&Array.prototype.forEach.call(o.files,function(t){var i=new FileReader;i.onload=function(e){var i=new Blob([e.target.result],{type:t.type});i.name=t.name,r.push(i),d--},i.onerror=function(i){d--,e.log.error("Error during file upload "+t.name+" / "+i.target.error.code)},d++,l++,i.readAsArrayBuffer(t)});var p=0,u=function(){if(0!==d&&p++!==this._fileUploadWaitRetryCountTimeout)return void setTimeout(u,150);if(p>=this._fileUploadWaitRetryCountTimeout){var t={entryPoint:this.$container.entryPoint(),header:this.session.text("ui.ClipboardTimeoutTitle"),body:this.session.text("ui.ClipboardTimeout"),yesButtonText:this.session.text("Ok")};return void this.session.showFatalMessage(t)}(r.length>0||Object.keys(s).length>0)&&this.session.uploadFiles(this,r,s,this.maximumSize,this.allowedMimeTypes)}.bind(this),c=function(){t.scrollbars.uninstall(this.$field,this.session);var i=this.$field.html();this.$field.html("");var o=function(){this.$field.html(i),t.scrollbars.install(this.$field,{parent:this})}.bind(this);setTimeout(function(){var i=!1;if(this.$field.children().each(function(o,n){if("IMG"===n.nodeName){var s=e(n).attr("src"),a=/^data:(.*);base64,(.*)/.exec(s),l=a&&a[1];if(t.isOneOf(l,t.mimeTypes.IMAGE_PNG,t.mimeTypes.IMAGE_JPG,t.mimeTypes.IMAGE_JPEG,t.mimeTypes.IMAGE_GIF)){for(var h=window.atob(a[2]),d=[],p=0;p<h.length;p++)d[p]=h.charCodeAt(p);var u=new Uint8Array(d),c=new Blob([u],{type:l});c.name="",r.push(c),i=!0}}}),i)o();else{var n=this.$field.text();t.strings.hasText(n)?(this.setDisplayText(n),r.push(new Blob([n],{type:t.mimeTypes.TEXT_PLAIN}))):o()}u()}.bind(this),0)}.bind(this);return l>0?(u(),!1):(c(),!0)},t.ClipboardFieldAdapter=function(){t.ClipboardFieldAdapter.parent.call(this)},t.inherits(t.ClipboardFieldAdapter,t.ValueFieldAdapter),t.ColorField=function(){t.ColorField.parent.call(this)},t.inherits(t.ColorField,t.ValueField),t.ColorField.prototype._render=function(t){this.addContainer(t,"color-field"),this.addLabel(),this.addField(t.makeDiv("not-implemented").text("not implemented yet")),this.addMandatoryIndicator(),this.addStatus()},t.ColorFieldAdapter=function(){t.ColorFieldAdapter.parent.call(this)},t.inherits(t.ColorFieldAdapter,t.ValueFieldAdapter),t.DateField=function(){t.DateField.parent.call(this),this.hasDate=!0,this.hasTime=!1,this.disabledCopyOverlay=!0,this.$dateField,this.$timeField,this.$dateFieldIcon,this.$timeFieldIcon,this._$predictDateField,this._$predictTimeField,this._tempTimeDate,this._modelErrorStatus=null,this.popup,this.oldDisplayText="",this.timestamp=null,this._addCloneProperties(["timestamp","timestampAsDate","hasDate","hasTime","dateFormatPattern","timeFormatPattern"])},t.inherits(t.DateField,t.ValueField),t.DateField.prototype._createKeyStrokeContext=function(){return new t.InputFieldKeyStrokeContext},t.DateField.prototype._init=function(e){t.DateField.parent.prototype._init.call(this,e),t.fields.initTouch(this,e),this.popup=e.popup,this._syncDateFormatPattern(this.dateFormatPattern),this._syncTimeFormatPattern(this.timeFormatPattern),this._syncTimestamp(this.timestamp),this._syncAutoTimestamp(this.autoTimestamp),this._syncDisplayText(this.displayText),this._syncAllowedDates(this.allowedDates)},t.DateField.prototype.createPopup=function(){var e=this.touch?"DatePickerTouchPopup":"DatePickerPopup";return t.create(e,{parent:this,$anchor:this.$field,boundToAnchor:!this.touch,closeOnAnchorMousedown:!1,field:this,allowedDates:this.allowedDates,dateFormat:this.isolatedDateFormat})},t.DateField.prototype._render=function(e){this.addContainer(e,"date-field"),this.addLabel(),this.addField(e.makeDiv("date-time-composite")),this.addStatus(this.$field),this.embedded||this.addMandatoryIndicator(),this.htmlDateTimeComposite=t.HtmlComponent.install(this.$field,this.session),this.htmlDateTimeComposite.setLayout(new t.DateTimeCompositeLayout(this))},t.DateField.prototype._renderProperties=function(){this._renderHasDate(),this._renderHasTime(),this._renderDateFormatPattern(),t.DateField.parent.prototype._renderProperties.call(this)},t.DateField.prototype._remove=function(){t.DateField.parent.prototype._remove.call(this),this.$dateField=null,this.$timeField=null,this.$dateFieldIcon=null,this.$timeFieldIcon=null,this._$predictDateField=null,this._$predictTimeField=null,this.popup=null},t.DateField.prototype._renderHasDate=function(){this.hasDate&&!this.$dateField?(this.$dateField=t.fields.makeInputOrDiv(this,"date").on("mousedown",this._onDateFieldClick.bind(this)).appendTo(this.$field),this.touch||this.$dateField.on("keydown",this._onDateFieldKeydown.bind(this)).on("input",this._onDateFieldInput.bind(this)).on("blur",this._onDateFieldBlur.bind(this)),t.HtmlComponent.install(this.$dateField,this.session),this.$dateFieldIcon=t.fields.appendIcon(this.$field,"date").on("mousedown",this._onDateIconClick.bind(this)),this.invalidateLayout()):!this.hasDate&&this.$dateField&&(this.$dateField.remove(),this.$dateField=null,this.$dateFieldIcon.remove(),this.$dateFieldIcon=null,this.invalidateLayout())},t.DateField.prototype._renderHasTime=function(){this.hasTime&&!this.$timeField?(this.$timeField=t.fields.makeInputOrDiv(this,"time").on("mousedown",this._onTimeFieldClick.bind(this)).appendTo(this.$field),this.touch||this.$timeField.on("keydown",this._onTimeFieldKeydown.bind(this)).on("input",this._onTimeFieldInput.bind(this)).on("blur",this._onTimeFieldBlur.bind(this)),this.$timeFieldIcon=t.fields.appendIcon(this.$field,"time").on("mousedown",this._onTimeIconClick.bind(this)),t.HtmlComponent.install(this.$timeField,this.session),this.invalidateLayout()):!this.hasTime&&this.$timeField&&(this.$timeField.remove(),this.$timeField=null,this.$timeFieldIcon.remove(),this.$timeFieldIcon=null,this.invalidateLayout())},t.DateField.prototype._renderPlaceholder=function(){t.DateField.parent.prototype._renderPlaceholder.call(this,this._fieldForPlaceholder())},t.DateField.prototype._removePlaceholder=function(){t.DateField.parent.prototype._removePlaceholder.call(this,this._fieldForPlaceholder())},t.DateField.prototype._fieldForPlaceholder=function(){return this.hasDate?this.$dateField:this.hasTime?this.$timeField:null},t.DateField.prototype._syncDateFormatPattern=function(e){this._setProperty("dateFormatPattern",e),this.isolatedDateFormat=new t.DateFormat(this.session.locale,this.dateFormatPattern)},t.DateField.prototype._renderDateFormatPattern=function(){this.popup&&(this.getDatePicker().dateFormat=this.isolatedDateFormat)},t.DateField.prototype._syncTimeFormatPattern=function(e){this._setProperty("timeFormatPattern",e),this.isolatedTimeFormat=new t.DateFormat(this.session.locale,this.timeFormatPattern)},t.DateField.prototype._renderEnabled=function(){t.DateField.parent.prototype._renderEnabled.call(this),this.$container.setEnabled(this.enabledComputed),this.$dateField&&this.$dateField.setEnabled(this.enabledComputed),this.$timeField&&this.$timeField.setEnabled(this.enabledComputed)},t.DateField.prototype._renderDisplayText=function(){this.hasDate&&this._renderDateDisplayText(),this.hasTime&&this._renderTimeDisplayText(),this._removePredictionFields()},t.DateField.prototype._renderDateDisplayText=function(){t.fields.valOrText(this,this.$dateField,this.dateDisplayText)},t.DateField.prototype._renderTimeDisplayText=function(){t.fields.valOrText(this,this.$timeField,this.timeDisplayText)},t.DateField.prototype._syncDisplayText=function(e){var i,o="",n="";this.oldDisplayText=this.displayText,this._setProperty("displayText",e),t.strings.hasText(this.displayText)&&(i=this.displayText.split("\n"),o=i[0],n=i[1]),this.dateDisplayText=o,this.timeDisplayText=n},t.DateField.prototype._syncTimestamp=function(e){e=t.dates.ensure(e),this.timestampAsDate=e},t.DateField.prototype._syncAutoTimestamp=function(e){e=t.dates.ensure(e),this.autoTimestampAsDate=e},t.DateField.prototype._syncAllowedDates=function(e){if(Array.isArray(e)){var i=[];e.forEach(function(e){i.push(t.dates.parseJsonDate(e))}),this._setProperty("allowedDates",i)}else this._setProperty("allowedDates",null)},t.DateField.prototype._renderAllowedDates=function(){this.popup&&(this.getDatePicker().allowedDates=this.allowedDates)},t.DateField.prototype._renderErrorStatus=function(){t.DateField.parent.prototype._renderErrorStatus.call(this);var e=!!this.errorStatus,i=e?this.errorStatus.cssClass():"";this.$dateField&&(this.$dateField.removeClass(t.Status.cssClasses),this.$dateField.toggleClass(i,e),this._$predictDateField&&(this._$predictDateField.removeClass(t.Status.cssClasses),this._$predictDateField.toggleClass(i,e))),this.$timeField&&(this.$timeField.removeClass(t.Status.cssClasses),this.$timeField.toggleClass(i,e),this._$predictTimeField&&(this._$predictTimeField.removeClass(t.Status.cssClasses),this._$predictTimeField.toggleClass(i,e))),this.hasDate&&this.popup&&(this.popup.$container.removeClass(t.Status.cssClasses),this.popup.$container.toggleClass(i,e))},t.DateField.prototype._renderFont=function(){this.$dateField&&t.styles.legacyStyle(this,this.$dateField),this.$timeField&&t.styles.legacyStyle(this,this.$timeField)},t.DateField.prototype._renderForegroundColor=function(){this.$dateField&&t.styles.legacyStyle(this,this.$dateField),this.$timeField&&t.styles.legacyStyle(this,this.$timeField)},t.DateField.prototype._renderBackgroundColor=function(){this.$dateField&&t.styles.legacyStyle(this,this.$dateField),this.$timeField&&t.styles.legacyStyle(this,this.$timeField)},t.DateField.prototype._onDateFieldClick=function(){t.fields.handleOnClick(this)&&this.openPopupAndSelect(this.timestampAsDate)},t.DateField.prototype._onDateIconClick=function(e){t.fields.handleOnClick(this)&&(this.$dateField.focus(),this.openPopupAndSelect(this.timestampAsDate))},t.DateField.prototype._onTimeFieldClick=function(e){t.fields.handleOnClick(this)&&this.touch&&this.openPopupAndSelect(this.timestampAsDate)},t.DateField.prototype._onTimeIconClick=function(e){t.fields.handleOnClick(this)&&(this.$timeField.focus(),this.touch&&this.openPopupAndSelect(this.timestampAsDate))},t.DateField.prototype._onDateFieldBlur=function(){this.embedded||this.closePopup(),this._acceptDateTimePrediction(!0,!1)},t.DateField.prototype._onTimeFieldBlur=function(){this._tempTimeDate=null,this._acceptDateTimePrediction(!1,!0)},t.DateField.prototype._onDateFieldKeydown=function(i){var o=0,n=0,r=0,s=0,a=this.$dateField[0].selectionStart,l=this.$dateField.val(),h=this._$predictDateField&&this._$predictDateField.val(),d=(i.ctrlKey?1:0)+(i.shiftKey?1:0)+(i.altKey?1:0)+(i.metaKey?1:0),p=this.timestampAsDate||this._referenceDate(),u=!0;if(this.hasTime&&this.mode===t.FormField.MODE_CELLEDITOR&&i.which===t.keys.TAB&&0===d)return void i.stopPropagation();if(i.which!==t.keys.TAB&&i.which!==t.keys.SHIFT&&i.which!==t.keys.HOME&&i.which!==t.keys.END&&i.which!==t.keys.CTRL&&i.which!==t.keys.ALT){if(i.which===t.keys.ENTER)return void((this.popup||this._$predictDateField)&&(this._acceptDateTimePrediction(!0,!1),this.closePopup(),e.suppressEvent(i)));if(i.which===t.keys.ESC)return void(this.popup&&(this.closePopup(),e.suppressEvent(i)));if(i.which===t.keys.RIGHT&&a===l.length)return void(h&&this._setDateDisplayText(h.substring(0,l.length+1)));if(i.which===t.keys.PAGE_UP||i.which===t.keys.PAGE_DOWN)return l&&this._isDateValid()?this.popup||this.openPopupAndSelect(p):(p=this._referenceDate(),this.hasTime&&(p=t.dates.combineDateTime(p,this.timestampAsDate)),this.openPopupAndSelect(p),this.renderDate(p),u=!1),u&&(r=i.which===t.keys.PAGE_UP?-1:1,this.shiftSelectedDate(0,r,0)),void e.suppressEvent(i);if(i.which===t.keys.UP||i.which===t.keys.DOWN){if(o=i.which===t.keys.UP?-1:1,(i.ctrlKey||i.metaKey)&&1===d)n=o;else if(i.shiftKey&&1===d)r=o;else{if(0!==d)return void e.suppressEvent(i);s=o}return l&&this._isDateValid()?this.popup||this.openPopupAndSelect(p):(p=this._referenceDate(),this.hasTime&&(p=t.dates.combineDateTime(p,this.timestampAsDate)),this.openPopupAndSelect(p),this.renderDate(p),u=!1),u&&this.shiftSelectedDate(n,r,s),void e.suppressEvent(i)}}},t.DateField.prototype._onDateFieldInput=function(t){var e=this.$dateField.val();if(this.$dateField[0]===this.$dateField.activeElement(!0)){this._$predictDateField||(this._$predictDateField=this._createPredictionField(this.$dateField));var i=this._predictDate(e);i?(this._$predictDateField.val(i.text),this.openPopupAndSelect(i.date)):this._removePredictionFields()}},t.DateField.prototype._onTimeFieldKeydown=function(i){var o=0,n=0,r=0,s=0,a=this.$timeField[0].selectionStart,l=this.$timeField.val(),h=this._$predictTimeField&&this._$predictTimeField.val(),d=(i.ctrlKey?1:0)+(i.shiftKey?1:0)+(i.altKey?1:0)+(i.metaKey?1:0),p=!0;if(this.hasDate&&this.mode===t.FormField.MODE_CELLEDITOR&&i.which===t.keys.TAB&&i.shiftKey&&1===d)return void i.stopPropagation();if(i.which!==t.keys.TAB&&i.which!==t.keys.SHIFT&&i.which!==t.keys.HOME&&i.which!==t.keys.END&&i.which!==t.keys.CTRL&&i.which!==t.keys.ALT&&i.which!==t.keys.ESC){if(i.which===t.keys.ENTER)return void((this.popup||this._$predictDateField)&&(this._tempTimeDate=null,this._acceptDateTimePrediction(!1,!0),this.closePopup(),e.suppressEvent(i)));if(i.which===t.keys.RIGHT&&a===l.length)return void(h&&this._setTimeDisplayText(h.substring(0,l.length+1)));if(i.which===t.keys.UP||i.which===t.keys.DOWN){if(o=i.which===t.keys.UP?-1:1,i.ctrlKey&&1===d)s=o;else if(i.shiftKey&&1===d)n=o;else{if(0!==d)return void e.suppressEvent(i);r=o}if(!this._tempTimeDate){var u=this._predictTime(l);u&&u.date?this._tempTimeDate=u.date:(this._tempTimeDate=this._referenceDate(),p=!1)}return p&&(this._tempTimeDate=t.dates.shiftTime(this._tempTimeDate,n,r,s)),this.hasDate&&(this._tempTimeDate=t.dates.combineDateTime(this.timestampAsDate||this._referenceDate(),this._tempTimeDate)),this.renderDate(this._tempTimeDate),void e.suppressEvent(i)}}},t.DateField.prototype._onTimeFieldInput=function(t){var e=this.$timeField.val();if(this.$timeField[0]===this.$timeField.activeElement(!0)){this._$predictTimeField||(this._$predictTimeField=this._createPredictionField(this.$timeField));var i=this._predictTime(e);i?this._$predictTimeField.val(i.text):(this._tempTimeDate=null,this._removePredictionFields())}},t.DateField.prototype._onDatePickerDateSelect=function(e){this._setDateValid(!0),this._setTimeValid(!0),this.renderDate(e.date),e.shifting||(this._triggerDisplayTextIfChanged(),this.updateTimestamp(this._newTimestampAsDate(e.date,this.timestampAsDate)),t.nvl(e.closeDatePicker,!0)&&this.closePopup())},t.DateField.prototype._createPredictionField=function(t){var e=t.clone().addClass("predict").attr("tabIndex","-1").insertBefore(t);return t.hasClass("has-error")&&e.addClass("has-error"),e},t.DateField.prototype._removePredictionFields=function(){this._$predictDateField&&(this._$predictDateField.remove(),this._$predictDateField=null),this._$predictTimeField&&(this._$predictTimeField.remove(),this._$predictTimeField=null)},t.DateField.prototype.renderDate=function(t){t=t||this.timestampAsDate;var e;this.hasDate&&this._isDateValid()&&(e=this.$dateField.backupSelection(),this._setDateDisplayText(this.isolatedDateFormat.format(t)),this.$dateField.restoreSelection(e)),this.hasTime&&this._isTimeValid()&&(e=this.$timeField.backupSelection(),this._setTimeDisplayText(this.isolatedTimeFormat.format(t)),this.$timeField.restoreSelection(e)),this._removePredictionFields()},t.DateField.prototype._setDateDisplayText=function(t){this.dateDisplayText=t,this._updateDisplayTextProperty(),this.rendered&&this._renderDateDisplayText()},t.DateField.prototype._setTimeDisplayText=function(t){this.timeDisplayText=t,this._updateDisplayTextProperty(),this.rendered&&this._renderTimeDisplayText()},t.DateField.prototype._updateDisplayTextProperty=function(){var e=this.dateDisplayText||"",i=this.timeDisplayText||"";this.displayText=t.strings.join("\n",e,i)},t.DateField.prototype.acceptInput=function(t){this._acceptDateTimePrediction(this.hasDate,this.hasTime)},t.DateField.prototype.aboutToBlurByMouseDown=function(e){var i,o,n,r=!!this.$dateField&&this.$dateField.isOrHas(e),s=!!this.$timeField&&this.$timeField.isOrHas(e),a=this.popup&&this.popup.$container.isOrHas(e);return r||s||a?void(this.embedded&&(n=this.getDatePicker().$container.isOrHas(e),o=t.focusUtils.isActiveElement(this.$timeField),n&&o&&this._acceptDateTimePrediction(!1,!0))):(i=t.focusUtils.isActiveElement(this.$dateField),o=t.focusUtils.isActiveElement(this.$timeField),void this._acceptDateTimePrediction(i,o))},t.DateField.prototype._newTimestampAsDate=function(e,i){var o=null;return(e||i)&&(o=this._referenceDate(),e&&(o=t.dates.combineDateTime(e,o)),i&&(o=t.dates.combineDateTime(o,i))),o},t.DateField.prototype._referenceDate=function(){var e=this.autoTimestampAsDate||t.dates.trunc(new Date);return this.allowedDates&&(e=this._findAllowedReferenceDate(e)),e},t.DateField.prototype._findAllowedReferenceDate=function(e){var i,o;for(i=0;i<this.allowedDates.length;i++)if(o=this.allowedDates[i],t.dates.compare(o,e)>=0)return o;for(i=this.allowedDates.length-1;i>=0;i--)if(o=this.allowedDates[i],t.dates.compare(o,e)<=0)return o;return e},t.DateField.prototype.updateTimestamp=function(e,i){var o=t.dates.toJsonDate(e,!1,this.hasDate,this.hasTime);(o!==this.timestamp||this.errorStatus)&&(this.timestamp=o,this.timestampAsDate=e,this._hasUiErrorStatus()||(this.trigger("timestampChanged",{timestamp:this.timestamp}),t.nvl(i,!0)&&this._send("timestampChanged",{timestamp:this.timestamp})))},t.DateField.prototype._sendParsingError=function(){this._send("parsingError")},t.DateField.prototype._triggerDisplayTextIfChanged=function(){this.oldDisplayText!==this.displayText&&(this._triggerDisplayTextChanged(this.displayText),this.oldDisplayText=this.displayText)},t.DateField.prototype.openPopup=function(t){this.popup||(this.popup=this.createPopup(),this.popup.open(),this.popup.on("remove",function(){this.popup=null}.bind(this)),this.getDatePicker().on("dateSelect",this._onDatePickerDateSelect.bind(this)))},t.DateField.prototype.closePopup=function(){this.popup&&this.popup.close()},t.DateField.prototype._acceptDateTimePrediction=function(t,e){var i,o,n="",r="",s=!0;if(t&&(n=this._$predictDateField?this._$predictDateField.val():this.$dateField.val(),i=this._predictDate(n),i||(s=!1),this._setDateDisplayText(n)),e&&(r=this._$predictTimeField?this._$predictTimeField.val():this.$timeField.val(),o=this._predictTime(r),o||(s=!1),this._setTimeDisplayText(r)),this._removePredictionFields(),this._triggerDisplayTextIfChanged(),s){var a=null;(t&&i.date||e&&o.date)&&(a=this._newTimestampAsDate(t?i.date:this.timestampAsDate,e?o.date:this.timestampAsDate)),this.updateTimestamp(a),this.renderDate(this.timestampAsDate)}else this._sendParsingError()},t.DateField.prototype._predictDate=function(e){e=e||"";var i=e.match(/^([+-])(\d*)$/);if(i){var o=new Date,n=Number(i[1]+(i[2]||"0"));return o.setDate(o.getDate()+n),this._setDateValid(!0),{date:o,text:e}}var r=this.isolatedDateFormat.analyze(e,this._referenceDate());if(r.error)return this._setDateValid(!1),null;if(!r.predictedDate)return this._setDateValid(!0),{date:null,text:""};var s=r.predictedDate,a=new t.DateFormat(this.isolatedDateFormat.locale,r.parsedPattern),l=a.format(s,!0);return i=l.match(new RegExp("^"+t.strings.quote(e)+"(.*)$","i")),i&&(l=e+i[1]),this._setDateValid(!0),{date:s,text:l}},t.DateField.prototype._predictTime=function(e){e=e||"";var i=this.isolatedTimeFormat.analyze(e,this._referenceDate());if(i.error)return this._setTimeValid(!1),null;if(!i.predictedDate)return this._setTimeValid(!0),{date:null,text:""};var o=i.predictedDate,n=new t.DateFormat(this.isolatedTimeFormat.locale,i.parsedPattern),r=n.format(o,!0),s=r.match(new RegExp("^"+t.strings.quote(e)+"(.*)$","i"));return s&&(r=e+s[1]),this._setTimeValid(!0),{date:o,text:r}},t.DateField.prototype._errorStatus=function(e){var i=this.errorStatus;return e?i&&(this._hasUiErrorStatus()||(i=this._modelErrorStatus)):this._hasUiErrorStatus()||(i=new t.Status({message:this.session.text("ui.InvalidDateFormat"),severity:t.Status.Severity.ERROR})),i},t.DateField.prototype._setErrorStatusPart=function(e,i){var o=this._errorStatus(i);o&&(o[e]=!i,o.invalidDate||o.invalidTime||(o=this._modelErrorStatus)),this.setErrorStatus(t.Status.clone(o))},t.DateField.prototype._setDateValid=function(t){this._setErrorStatusPart("invalidDate",t)},t.DateField.prototype._setTimeValid=function(t){this._setErrorStatusPart("invalidTime",t)},t.DateField.prototype._isErrorStatusPartValid=function(t){return!this.errorStatus||!this.errorStatus[t]},t.DateField.prototype._isDateValid=function(){return this._isErrorStatusPartValid("invalidDate")},t.DateField.prototype._isTimeValid=function(){return this._isErrorStatusPartValid("invalidTime")},t.DateField.prototype._hasUiErrorStatus=function(){return!(!this.errorStatus||!this.errorStatus.invalidDate&&!this.errorStatus.invalidTime)},t.DateField.prototype.onCellEditorRendered=function(t){t.openFieldPopup&&this.hasDate&&this.openPopupAndSelect(this.timestampAsDate)},t.DateField.prototype.prepareForCellEdit=function(e){e=e||{},t.DateField.parent.prototype.prepareForCellEdit.call(this,e),this.$field.removeClass("cell-editor-field first"),this.$dateField&&(this.$dateField.addClass("cell-editor-field"),e.firstCell&&this.$dateField.addClass("first")),this.$timeField&&(this.$timeField.addClass("cell-editor-field"),e.firstCell&&!this.$dateField&&this.$timeField.addClass("first"))},t.DateField.prototype.getDatePicker=function(){return this.popup.getDatePicker()},t.DateField.prototype.openPopupAndSelect=function(t){t?this.selectDate(t):this.preselectDate(this._referenceDate())},t.DateField.prototype.preselectDate=function(t,e){this.openPopup(),this.getDatePicker().preselectDate(t,e)},t.DateField.prototype.selectDate=function(t,e){this.openPopup(),this.getDatePicker().selectDate(t,e)},t.DateField.prototype.shiftSelectedDate=function(t,e,i){this.openPopup(),this.getDatePicker().shiftSelectedDate(t,e,i)},t.DateField.prototype.setTimestamp=function(e){this.timestamp!==e&&(this._setProperty("timestamp",e),this.timestampAsDate=t.dates.parseJsonDate(e),this.formatTimestamp(this.timestampAsDate),this.rendered&&this._renderDisplayText())},t.DateField.prototype.formatTimestamp=function(t){var e="",i="";t&&(this.hasDate&&(e=this.isolatedDateFormat.format(t)),this.hasTime&&(i=this.isolatedTimeFormat.format(t))),this.dateDisplayText=e,this.timeDisplayText=i,this._updateDisplayTextProperty()},t.DateField.prototype._renderDisabledStyle=function(){this._renderDisabledStyleInternal(this.$dateField),this._renderDisabledStyleInternal(this.$timeField),this._renderDisabledStyleInternal(this.$mandatory)},t.DateField.prototype._updateEmpty=function(){this.empty=null===this.timestamp||this.timestamp===i},t.DateFieldAdapter=function(){t.DateFieldAdapter.parent.call(this),this.enabledWhenOffline=!0},t.inherits(t.DateFieldAdapter,t.ValueFieldAdapter),t.DateFieldAdapter.prototype._initProperties=function(e){e.errorStatus?e._modelErrorStatus=new t.Status(e.errorStatus):e._modelErrorStatus=null},t.DateFieldAdapter.prototype._syncErrorStatus=function(e){e?this.widget._modelErrorStatus=new t.Status(e):this.widget._modelErrorStatus=null,this.widget._hasUiErrorStatus()||this.widget.setErrorStatus(e)},t.DateTimeCompositeLayout=function(e){t.DateTimeCompositeLayout.parent.call(this),this._dateField=e,this.MIN_DATE_FIELD_WIDTH=90,this.MIN_TIME_FIELD_WIDTH=60},t.inherits(t.DateTimeCompositeLayout,t.AbstractLayout),t.DateTimeCompositeLayout.prototype.layout=function(e){var i,o,n=t.HtmlComponent.get(e),r=this._dateField.$dateField,s=this._dateField.$timeField,a=this._dateField.$dateFieldIcon,l=this._dateField.$timeFieldIcon,h=this._dateField._$predictDateField,d=this._dateField._$predictTimeField,p=r?t.HtmlComponent.get(r):null,u=s?t.HtmlComponent.get(s):null,c=n.getAvailableSize().subtract(n.getInsets());if(p&&u){var f=p.getMargins(),y=u.getMargins(),g=new t.Insets(Math.max(f.top,y.top),Math.max(f.right,y.right),Math.max(f.bottom,y.bottom),Math.max(f.left,y.left)),m=c.subtract(g),_=this._hgap(),b=m.width-_,v=.6*b,C=b-v;
i=new t.Dimension(v,m.height),o=new t.Dimension(C,m.height),p.setSize(i),u.setSize(o),s.cssRight(0),a.cssRight(C+_).cssHeight(i.height).cssLineHeight(i.height),l.cssRight(0).cssHeight(o.height).cssLineHeight(o.height),r.toggleClass("compact",i.width<this.MIN_DATE_FIELD_WIDTH),s.toggleClass("compact",o.width<this.MIN_TIME_FIELD_WIDTH),h&&t.graphics.setSize(h,i),d&&(t.graphics.setSize(d,o),d.cssRight(0))}else p?(i=c.subtract(p.getMargins()),p.setSize(i),a.cssRight(0).cssHeight(i.height).cssLineHeight(i.height),r.toggleClass("compact",i.width<this.MIN_DATE_FIELD_WIDTH),h&&t.graphics.setSize(h,i)):u&&(o=c.subtract(u.getMargins()),u.setSize(o),l.cssRight(0).cssHeight(o.height).cssLineHeight(o.height),s.toggleClass("compact",o.width<this.MIN_TIME_FIELD_WIDTH),d&&t.graphics.setSize(d,o));var w=this._dateField.popup;w&&w.rendered&&w.position()},t.DateTimeCompositeLayout.prototype._hgap=function(){return this._dateField.cellEditor?0:t.HtmlEnvironment.smallColumnGap},t.DateTimeCompositeLayout.prototype.preferredLayoutSize=function(e){var i=t.graphics.prefSize(e);return this._dateField.hasDate&&this._dateField.hasTime?i.width=this.MIN_DATE_FIELD_WIDTH+this._hgap()+this.MIN_TIME_FIELD_WIDTH:this._dateField.hasDate?i.width=this.MIN_DATE_FIELD_WIDTH:this._dateField.hasTime&&(i.width=this.MIN_TIME_FIELD_WIDTH),i},t.FileChooserField=function(){t.FileChooserField.parent.call(this)},t.inherits(t.FileChooserField,t.ValueField),t.FileChooserField.prototype._createKeyStrokeContext=function(){return new t.InputFieldKeyStrokeContext},t.FileChooserField.prototype._render=function(e){this.addContainer(e,"file-chooser-field"),this.addLabel(),this.addMandatoryIndicator(),this.addField(t.fields.makeTextField(e).on("blur",this._onFieldBlur.bind(this)).on("dragenter",this._onDragEnterOrOver.bind(this)).on("dragover",this._onDragEnterOrOver.bind(this)).on("drop",this._onDrop.bind(this)).on("keydown",this._onKeydown.bind(this))),this.addIcon(),this.addStatus()},t.FileChooserField.prototype._remove=function(){t.FileChooserField.parent.prototype._remove.call(this),this.$fileInputField&&(this.$fileInputField.remove(),this.$fileInputField=null)},t.FileChooserField.prototype._onDragEnterOrOver=function(e){t.dragAndDrop.verifyDataTransferTypesScoutTypes(e,t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)},t.FileChooserField.prototype._onDrop=function(e){if(t.dragAndDrop.dataTransferTypesContainsScoutTypes(e.originalEvent.dataTransfer,t.dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)){e.stopPropagation(),e.preventDefault();var o=e.originalEvent.dataTransfer.files;o.length>=1&&this.session.uploadFiles(this,[o[0]],i,this.maximumUploadSize)}},t.FileChooserField.prototype._onKeydown=function(e){return e.which!==t.keys.DOWN||(this.openFileChooser(),!1)},t.FileChooserField.prototype._onClick=function(t){},t.FileChooserField.prototype._onIconClick=function(e){t.FileChooserField.parent.prototype._onIconClick.call(this,e),this.openFileChooser()},t.FileChooserField.prototype.openFileChooser=function(){this.trigger("chooseFile")},t.FileChooserFieldAdapter=function(){t.FileChooserFieldAdapter.parent.call(this)},t.inherits(t.FileChooserFieldAdapter,t.ValueFieldAdapter),t.FileChooserFieldAdapter.prototype._onWidgetChooseFile=function(t){this._send("chooseFile")},t.FileChooserFieldAdapter.prototype._onWidgetEvent=function(e){"chooseFile"===e.type?this._onWidgetChooseFile(e):t.FileChooserFieldAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.GroupBox=function(){t.GroupBox.parent.call(this),this._addAdapterProperties(["fields","menus"]),this.fields=[],this.menus=[],this.menuBarVisible=!0,this.borderDecoration="auto",this.borderVisible=!0,this.mainBox=!1,this.scrollable=!1,this.expandable=!1,this.expanded=!0,this.gridColumnCount=2,this.controls=[],this.systemButtons=[],this.customButtons=[],this.processButtons=[],this.processMenus=[],this.staticMenus=[],this.$body,this.$title},t.inherits(t.GroupBox,t.CompositeField),t.GroupBox.prototype._init=function(e){t.GroupBox.parent.prototype._init.call(this,e),this._syncFields(this.fields),this.menuBar=t.create("MenuBar",{parent:this,menuOrder:new t.GroupBoxMenuItemsOrder}),this.mainBox&&this.menuBar.large(),this._updateMenuBar()},t.GroupBox.prototype._syncFields=function(t){this._setProperty("fields",t),this._prepareFields()},t.GroupBox.prototype._initKeyStrokeContext=function(){t.GroupBox.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.invokeAcceptInputOnActiveValueField=!0,this.keyStrokeContext.$bindTarget=this._keyStrokeBindTarget.bind(this)},t.GroupBox.prototype._syncKeyStrokes=function(i){i=t.arrays.ensure(i);var o={render:function(){return!0},offset:0,hAlign:t.hAlign.RIGHT,$drawingArea:function(t,e){return this.labelVisible?this.$title:this.$body}.bind(this)};i.forEach(function(t){t.actionKeyStroke.renderingHints=e.extend({},t.actionKeyStroke.renderingHints,o)},this),t.GroupBox.parent.prototype._syncKeyStrokes.call(this,i)},t.GroupBox.prototype._keyStrokeBindTarget=function(){var t=this.getForm();return t?t.$container:this.$container},t.GroupBox.prototype._render=function(e){var i,o=t.HtmlEnvironment;this.addContainer(e,this.mainBox?"root-group-box":"group-box",this._createLayout()),this.$title=this.$container.appendDiv("group-box-title"),this.addLabel(),this.addStatus(),this.$body=this.$container.appendDiv("group-box-body"),i=t.HtmlComponent.install(this.$body,this.session),i.setLayout(new t.LogicalGridLayout(o.formColumnGap,o.formRowGap)),this.scrollable&&t.scrollbars.install(this.$body,{parent:this,axis:"y"}),this.controls.forEach(function(e){e.render(this.$body),e.setLayoutData(new t.LogicalGridData(e))},this)},t.GroupBox.prototype._remove=function(){t.GroupBox.parent.prototype._remove.call(this),this.scrollable&&t.scrollbars.uninstall(this.$body)},t.GroupBox.prototype._renderProperties=function(){t.GroupBox.parent.prototype._renderProperties.call(this),this._renderBorderVisible(),this._renderExpandable(),this._renderExpanded(),this._renderMenuBarVisible()},t.GroupBox.prototype._createLayout=function(){return new t.GroupBoxLayout(this)},t.GroupBox.prototype.addLabel=function(){this.$label||(this.$label=this.$title.appendSpan("label"))},t.GroupBox.prototype._renderLabel=function(){this.$label.textOrNbsp(this.label)},t.GroupBox.prototype._renderStatusPosition=function(){this.statusPosition===t.FormField.STATUS_POSITION_TOP?this.$status.appendTo(this.$title):this.$status.appendTo(this.$container),this.invalidateLayoutTree()},t.GroupBox.prototype._prepareFields=function(){this.unregisterKeyStrokes(this.processButtons),this.controls=[],this.systemButtons=[],this.customButtons=[],this.processButtons=[],this.processMenus=[];var e,i;for(e=0;e<this.fields.length;e++)if(i=this.fields[e],i instanceof t.Button)i.processButton?(this.processButtons.push(i),i.systemType!==t.Button.SystemType.NONE?this.systemButtons.push(i):this.customButtons.push(i)):(this.controls.push(i),this._registerButtonKeyStrokes(i));else if(i instanceof t.TabBox){this.controls.push(i);for(var o=0;o<i.tabItems.length;o++)i.tabItems[o].selectionKeystroke&&this.keyStrokeContext.registerKeyStroke(new t.TabItemKeyStroke(i.tabItems[o].selectionKeystroke,i.tabItems[o]))}else this.controls.push(i);this.processButtons.forEach(function(e){var i=t.create("ButtonAdapterMenu",t.ButtonAdapterMenu.adaptButtonProperties(e,{parent:this,button:e}));this.processMenus.push(i)},this),this.registerKeyStrokes(this.processMenus)},t.GroupBox.prototype._registerButtonKeyStrokes=function(t){t.keyStrokes&&t.keyStrokes.forEach(function(t){this.keyStrokeContext.registerKeyStroke(t)},this)},t.GroupBox.prototype.getFields=function(){return this.fields},t.GroupBox.prototype._renderBorderVisible=function(){var t=this.borderVisible;"auto"===this.borderDecoration&&(t=this._computeBorderVisible(t)),t||this.$body.addClass("y-padding-invisible")},t.GroupBox.prototype._renderBorderDecoration=function(){this._renderBorderVisible()},t.GroupBox.prototype.setMenuBarVisible=function(t){this.setProperty("menuBarVisible",t)},t.GroupBox.prototype._renderMenuBarVisible=function(){this.menuBarVisible?this._renderMenuBar():this.menuBar.remove(),this.invalidateLayoutTree()},t.GroupBox.prototype._renderMenuBar=function(){this.menuBar.render(this.$container),"top"===this.menuBar.position&&this.menuBar.$container.insertAfter(this.$title)},t.GroupBox.prototype._computeBorderVisible=function(e){return this.mainBox?e=!1:this.parent instanceof t.GroupBox&&this.parent.parent instanceof t.Form&&this.parent.parent.parent instanceof t.WrappedFormField&&this.parent.parent.parent.parent instanceof t.SplitBox&&1===this.parent.getFields().length&&(e=!1),e},t.GroupBox.prototype._renderExpandable=function(){var t=this.expandable,e=this.$title.children(".group-box-control");t?(0===e.length&&(e=this.$container.makeDiv("group-box-control").on("click",this._onControlClick.bind(this)).prependTo(this.$title)),this.$title.addClass("expandable").on("click.group-box-control",this._onControlClick.bind(this))):(e.remove(),this.$title.removeClass("expandable").off(".group-box-control"))},t.GroupBox.prototype._renderExpanded=function(){var t=this.expanded;this.$container.toggleClass("collapsed",!t),"line"===this.borderDecoration&&this.$container.toggleClass("with-line",!t),this.expanded?(this._collapsedWeightY!==i&&(this.gridData.weightY=this._collapsedWeightY,delete this._collapsedWeightY),this.invalidateLayout()):0!==this.gridData.weightY&&(this._collapsedWeightY=this.gridData.weightY,this.gridData.weightY=0),this.invalidateLayoutTree()},t.GroupBox.prototype._renderLabelVisible=function(t){this.$title.setVisible(this._computeTitleVisible(t)),this._updateStatusVisible()},t.GroupBox.prototype._computeTitleVisible=function(e){return e=t.nvl(e,this.labelVisible),!(!e||!this.label||this.mainBox)},t.GroupBox.prototype._updateStatusVisible=function(){this._renderStatusVisible()},t.GroupBox.prototype._computeStatusVisible=function(){return t.GroupBox.parent.prototype._computeStatusVisible.call(this)&&this._computeTitleVisible()},t.GroupBox.prototype._syncMenus=function(e){t.GroupBox.parent.prototype._syncMenus.call(this,e),this.menuBar&&this._updateMenuBar()},t.GroupBox.prototype._updateMenuBar=function(){var t=this.staticMenus.concat(this.processMenus).concat(this.menus);this.menuBar.setMenuItems(t)},t.GroupBox.prototype._removeMenus=function(){},t.GroupBox.prototype.setStaticMenus=function(t){this._setProperty("staticMenus",t),this._updateMenuBar()},t.GroupBox.prototype._onControlClick=function(t){this.expandable&&this.setExpanded(!this.expanded),e.suppressEvent(t)},t.GroupBox.prototype.setExpanded=function(t){this.setProperty("expanded",t)},t.GroupBoxAdapter=function(){t.GroupBoxAdapter.parent.call(this),this._addAdapterProperties(["fields","menus"]),this._addRemoteProperties(["expanded"])},t.inherits(t.GroupBoxAdapter,t.FormFieldAdapter),t.GroupBoxLayout=function(e){t.GroupBoxLayout.parent.call(this),this._groupBox=e,this._statusWidth=t.HtmlEnvironment.fieldStatusWidth,this.maxContentWidth=null},t.inherits(t.GroupBoxLayout,t.AbstractLayout),t.GroupBoxLayout.prototype.layout=function(i){var o,n,r,s=0,a=this._groupBox.statusPosition,l=0,h=this._groupBox.htmlComp,d=this._htmlGbBody(),p=this._htmlMenuBar(),u=this._groupBox.$title,c=this._groupBox.$label,f=this._groupBox.$status,y=h.getAvailableSize().subtract(h.getInsets());if(f&&f.isVisible()&&(this._layoutStatus(),s=f.outerWidth(!0)),p?(n=this._menuBarSize(p,y,s),p.setSize(n)):n=new t.Dimension(0,0),r=y.subtract(d.getMargins()),r.height-=this._titleHeight(),r.height-=n.height,s>0&&(a===t.FormField.STATUS_POSITION_TOP?(l=c.cssMarginX()+s,c.css("width","calc(100% - "+l+"px")):(o=u.cssMarginX()+s,u.css("width","calc(100% - "+o+"px"))),this.maxContentWidth>0){d.$comp.css("padding-right","");var g=d.$comp.cssPxValue("padding-right"),m=r.width,_=Math.min(r.width,this.maxContentWidth),b=m-_;b>g&&d.$comp.css("padding-right",b)}e.log.trace("(GroupBoxLayout#layout) gbBodySize="+r),d.setSize(r),d.scrollable&&t.scrollbars.update(d.$comp)},t.GroupBoxLayout.prototype._layoutStatus=function(){var e=this._groupBox.htmlComp,i=e.getInsets({includeBorder:!1}),o=i.top,n=i.right,r=this._groupBox.$title,s=r.innerHeight(),a=this._groupBox.$status,l=t.graphics.getMargins(a),h=this._groupBox.statusPosition;a.cssWidth(this._statusWidth),h===t.FormField.STATUS_POSITION_DEFAULT&&a.cssTop(o+r.cssMarginTop()).cssRight(n).cssHeight(s-l.vertical()).cssLineHeight(s-l.vertical())},t.GroupBoxLayout.prototype.preferredLayoutSize=function(e){var i,o,n=this._groupBox.htmlComp,r=this._htmlGbBody();return this._groupBox.expanded?(o=r.getPreferredSize().add(r.getMargins()),i=this._htmlMenuBar(),i&&(o.height+=i.getPreferredSize().height)):o=new t.Dimension(0,0),o=o.add(n.getInsets()),o.height+=this._titleHeight(),this._groupBox.gridData&&this._groupBox.gridData.widthInPixel&&(o.width=this._groupBox.gridData.widthInPixel),this._groupBox.gridData&&this._groupBox.gridData.heightInPixel&&(o.height=this._groupBox.gridData.heightInPixel),o},t.GroupBoxLayout.prototype._titleHeight=function(){return t.graphics.prefSize(this._groupBox.$title,{includeMargin:!0}).height},t.GroupBoxLayout.prototype._menuBarSize=function(e,i,o){var n=t.MenuBarLayout.size(e,i);return this._groupBox.mainBox||(n.width-=o),n},t.GroupBoxLayout.prototype._htmlMenuBar=function(){if(this._groupBox.menuBar&&this._groupBox.menuBarVisible){var e=t.HtmlComponent.get(this._groupBox.menuBar.$container);if(e.isVisible())return e}return null},t.GroupBoxLayout.prototype._htmlGbBody=function(){return t.HtmlComponent.get(this._groupBox.$body)},t.GroupBoxMenuItemsOrder=function(){},t.GroupBoxMenuItemsOrder.prototype.order=function(t){var e=[],o=[],n=[],r=[];return t.forEach(function(t){if(t.isButton()){var s=t.horizontalAlignment;s===i&&(s=t.gridData&&t.gridData.horizontalAlignment),1===s?n.push(t):e.push(t)}else 1===t.horizontalAlignment?r.push(t):o.push(t)}),{left:e.concat(o),right:n.concat(r)}},t.AbstractGroupBoxBodyGrid=function(){this.gridRows=0,this.gridColumns=0},t.AbstractGroupBoxBodyGrid.prototype.init=function(){},t.AbstractGroupBoxBodyGrid.prototype.validate=function(e,i){this.gridRows=0,this.gridColumns=this._computeGridColumnCount(e);var o=0,n=0,r=[];e.fields.forEach(function(e){if(e.visible){if(!e.processButton){r.push(e);var i=e.gridDataHints;i&&i.x>=0&&i.y>=0?o++:n++}}else{var s=t.GridData.createFromHints(e,1);e.gridData=s}}.bind(this)),o>0&&0===n?this.layoutAllStatic(r):this.layoutAllDynamic(r),i&&i===!0&&e.fields.filter(function(t){return"GroupBox"===t.objectType}).forEach(function(t){this.validate(t,!0)}.bind(this))},t.AbstractGroupBoxBodyGrid.prototype.layoutAllStatic=function(e){var i=[];e.forEach(function(e){i.push(t.GridData.createFromHints(e,1))});var o=i.reduce(function(t,e){var i=e.x+e.w;return i>t?i:t},1),n=i.reduce(function(t,e){var i=e.y+e.h;return i>t?i:t},0);e.forEach(function(e){e.gridData=t.GridData.createFromHints(e,o)}),this.gridRows=n,this.gridColumns=o},t.AbstractGroupBoxBodyGrid.prototype.layoutAllDynamic=function(t){},t.AbstractGroupBoxBodyGrid.prototype.getGridColumnCount=function(){return this.gridColumns},t.AbstractGroupBoxBodyGrid.prototype.getGridRowCount=function(){return this.gridRows},t.AbstractGroupBoxBodyGrid.prototype._computeGridColumnCount=function(e){var i=-1,o=e;do i=t.nvl(o.gridColumnCount,i);while(i<0&&o.getParentGroupBox&&(o=o.getParentGroupBox()));return i<0?2:i},t.AbstractGroupBoxBodyGrid.getGridDataFromHints=function(e,i){var o=t.GridData.createFromHints(e,i);return o.w=Math.min(i,o.w),o},t.HorizontalGroupBoxBodyGrid=function(){t.HorizontalGroupBoxBodyGrid.parent.call(this)},t.inherits(t.HorizontalGroupBoxBodyGrid,t.AbstractGroupBoxBodyGrid);t.AbstractGroupBoxBodyGrid.prototype.layoutAllDynamic=function(e){var i=new t.HorizontalGridMatrixGroupBox(this.getGridColumnCount());i.computeGridData(e),this.gridRows=i.getRowCount()};t.VerticalSmartGroupBoxBodyGrid=function(){t.VerticalSmartGroupBoxBodyGrid.parent.call(this)},t.inherits(t.VerticalSmartGroupBoxBodyGrid,t.AbstractGroupBoxBodyGrid),t.VerticalSmartGroupBoxBodyGrid.prototype.layoutAllDynamic=function(e){var i=0;e.forEach(function(e){var o=t.AbstractGroupBoxBodyGrid.getGridDataFromHints(e,this.getGridColumnCount());i+=o.w*o.h}.bind(this));for(var o=Math.floor((i+this.getGridColumnCount()-1)/this.getGridColumnCount()),n=new t.VerticalGridMatrixGroupBox(this.getGridColumnCount(),o);!n.computeGridData(e);)n.resetAll(this.getGridColumnCount(),++o);e.forEach(function(t){t.gridData=n.getGridData(t)}),this.gridRows=n.getRowCount()},t.AbstractGridMatrixGroupBox=function(t){this._cursor=t,this._assignedCells=[]},t.AbstractGridMatrixGroupBox.prototype.getColumnCount=function(){return this._cursor.columnCount},t.AbstractGridMatrixGroupBox.prototype.getRowCount=function(){return this._cursor.rowCount},t.AbstractGridMatrixGroupBox.prototype._setAssignedCell=function(t,e){this._assignedCells[t.x]||(this._assignedCells[t.x]=[]),this._assignedCells[t.x][t.y]=e},t.AbstractGridMatrixGroupBox.prototype._getAssignedCell=function(t){return this._assignedCells[t.x]?this._assignedCells[t.x][t.y]:null},t.AbstractGridMatrixGroupBox.prototype._nextFree=function(e,i){if(!this._cursor.increment())return!1;var o=this._cursor.currentIndex();return!!this._isAllCellFree(o.x,o.y,e,i)||(this._getAssignedCell(o)||this._setAssignedCell(o,new t.GroupBoxGridCell),this._nextFree(e,i))},t.AbstractGridMatrixGroupBox.prototype._isAllCellFree=function(t,e,i,o){return!(t+i>this._cursor.startX+this._cursor.columnCount||e+o>this._cursor.startY+this._cursor.rowCount)&&this._assignedCells.slice(t,t+i).every(function(t){return(t||[]).slice(e,e+o).every(function(t){return!t}.bind(this))}.bind(this))},t.AbstractGridMatrixGroupBox.prototype.toString=function(){for(var e="----Group Box Grid Matrix [orientation="+this._cursor.orientation+", columnCount="+this.getColumnCount()+", rowCount="+this.getRowCount()+"]--------------\n",i=new t.GroupBoxGridMatrixCursor(0,0,this.getColumnCount(),this.getRowCount(),this._cursor.orientation);i.increment();){var o=this._getAssignedCell(i.currentIndex());e+="cell["+i.currentIndex().x+", "+i.currentIndex().y+"] ",e+=o?o.field?o.field+(o.field?", ["+o.field.label+"]":""):"Placeholder":"NULL",e+="\n"}return e},t.GroupBoxGridCell=function(t,e){this.field=t,this.data=e},t.GroupBoxGridCell.prototype.isEmpty=function(){return!this.field},t.GroupBoxGridMatrixCursor=function(t,e,i,o,n){this.startX=t,this.startY=e,this.columnCount=i,this.rowCount=o,this.orientation=n,this.reset()},t.GroupBoxGridMatrixCursor.HORIZONTAL=0,t.GroupBoxGridMatrixCursor.VERTICAL=1,t.GroupBoxGridMatrixCursor.prototype.reset=function(){this._currentIndex={x:-1,y:-1}},t.GroupBoxGridMatrixCursor.prototype.currentIndex=function(){return{x:this._currentIndex.x,y:this._currentIndex.y}},t.GroupBoxGridMatrixCursor.prototype.increment=function(){return this._currentIndex.x<0||this._currentIndex.y<0?(this._currentIndex.x=this.startX,this._currentIndex.y=this.startY):this.orientation===t.GroupBoxGridMatrixCursor.HORIZONTAL?(this._currentIndex.x++,this._currentIndex.x>=this.startX+this.columnCount&&(this._currentIndex.x=this.startX,this._currentIndex.y++)):(this._currentIndex.y++,this._currentIndex.y>=this.startY+this.rowCount&&(this._currentIndex.y=this.startY,this._currentIndex.x++)),!(this._currentIndex.x>=this.startX+this.columnCount||this._currentIndex.y>=this.startY+this.rowCount)},t.GroupBoxGridMatrixCursor.prototype.decrement=function(){return!(this._currentIndex.x<0||this._currentIndex.y<0)&&(this._currentIndex.x>=this.startX+this.columnCount||this._currentIndex.y>=this.startY+this.rowCount?(this._currentIndex.x=this.startX+this.columnCount-1,this._currentIndex.y=this.startY+this.rowCount-1):this.orientation===t.GroupBoxGridMatrixCursor.HORIZONTAL?(this._currentIndex.x--,this._currentIndex.x<this.startX&&(this._currentIndex.x=this.startX+this.columnCount-1,this._currentIndex.y--)):(this._currentIndex.y--,this._currentIndex.y<this.startY&&(this._currentIndex.y=this.startY+this.rowCount-1,this._currentIndex.x--)),!(this._currentIndex.x<this.startX||this._currentIndex.y<this.startY))},t.GroupBoxGridMatrixCursor.prototype.toString=function(){var t=[];return t.push("MatrixCursor ["),t.push("orientation="+this.orientation),t.push(", startX="+this.startX),t.push(", startY="+this.startY),t.push(", columnCount="+this.columnCount),t.push(", currentIndex="+this._currentIndex.x+", "+this._currentIndex.y),t.push("]"),t.join("")},t.HorizontalGridMatrixGroupBox=function(e){t.HorizontalGridMatrixGroupBox.parent.call(this,new t.GroupBoxGridMatrixCursor(0,0,e,Number.MAX_SAFE_INTEGER,t.GroupBoxGridMatrixCursor.HORIZONTAL)),this.rowCount=0},t.inherits(t.HorizontalGridMatrixGroupBox,t.AbstractGridMatrixGroupBox),t.HorizontalGridMatrixGroupBox.prototype.computeGridData=function(e){return e.forEach(function(e){var i=t.GridData.createFromHints(e,this.getColumnCount()),o=new t.GridData(i);o.w=Math.min(i.w,this.getColumnCount()),this._add(e,i,o),e.gridData=o}.bind(this)),this._cursor.rowCount=this.rowCount,!0},t.HorizontalGridMatrixGroupBox.prototype._add=function(e,i,o){this._nextFree(o.w,o.h);var n=this._cursor.currentIndex();if(o.w<=this.getColumnCount()-n.x){o.x=n.x,o.y=n.y;for(var r=n.x;r<n.x+o.w;r++)for(var s=n.y;s<n.y+o.h;s++)this._setAssignedCell({x:r,y:s},new t.GroupBoxGridCell(e,o));this.rowCount=n.y+o.h}else this._setAssignedCell(this._cursor.currentIndex(),new t.GroupBoxGridCell),this._add(e,i,o)},t.VerticalGridMatrixGroupBox=function(e,i,o,n){t.VerticalGridMatrixGroupBox.parent.call(this,new t.GroupBoxGridMatrixCursor(o||0,n||0,e,i,t.GroupBoxGridMatrixCursor.VERTICAL)),this._fields=[],this._fieldGridDatas=[]},t.inherits(t.VerticalGridMatrixGroupBox,t.AbstractGridMatrixGroupBox),t.VerticalGridMatrixGroupBox.prototype.resetAll=function(e,i){this._fieldGridDatas=[],this._assignedCells=[],this._fieldIndexes=[],this._cursor=new t.GroupBoxGridMatrixCursor(this._cursor.startX,this._cursor.startY,e,i,t.GroupBoxGridMatrixCursor.VERTICAL)},t.VerticalGridMatrixGroupBox.prototype.computeGridData=function(e){return this._fields=e,e.every(function(e,i){return this._fieldGridDatas[i]=t.AbstractGroupBoxBodyGrid.getGridDataFromHints(e,this._cursor.columnCount),this._add(e,this._fieldGridDatas[i])}.bind(this))},t.VerticalGridMatrixGroupBox.prototype.getGridData=function(t){return this._fieldGridDatas[this._fields.indexOf(t)]},t.VerticalGridMatrixGroupBox.prototype._addAssignedCells=function(t){t.forEach(function(t,e){t&&t.forEach(function(t,i){t&&this._setAssignedCell({x:e,y:i},t)}.bind(this))}.bind(this))},t.VerticalGridMatrixGroupBox.prototype._getAssignedCells=function(){return this._assignedCells},t.VerticalGridMatrixGroupBox.prototype._add=function(e,i){var o=this._cursor.currentIndex();if(i.w>1){for(var n=o.x,r=o.y;n+i.w>this._cursor.startX+this._cursor.columnCount;)n--,r=this._cursor.rowCount-1;this._reorganizeGridAbove(n,r,i.w)}if(!this._nextFree(i.w,i.h))return!1;o=this._cursor.currentIndex(),i.x=o.x,i.y=o.y;for(var s=o.x;s<o.x+i.w;s++)for(var a=o.y;a<o.y+i.h;a++)this._setAssignedCell({x:s,y:a},new t.GroupBoxGridCell(e,i));return!0},t.VerticalGridMatrixGroupBox.prototype._reorganizeGridAbove=function(e,i,o){for(var n=[],r=function(t){n.indexOf(t)===-1&&n.push(t)},s=[],a=function(t,e,i){s[t]||(s[t]=[]),s[t][e]=i},l={x:e,y:0,w:o,h:i+1},h=i,d=0,p=!0,u=i;u>=0&&p;u--)for(var c=e;c<e+o&&p;c++){var f={x:c,y:u},y=this._getAssignedCell(f);if(y&&!y.isEmpty()){var g=y.data;this._horizontalMatchesOrOverlaps(l,g)?p=!1:this._horizontalOverlapsOnSide(l,g)?(a(f.x,f.y,y),d++,h=Math.min(f.y,h)):(this._setAssignedCell(f,null),r(y.field),d++,h=Math.min(f.y,h))}}if(0!==n.length){n.sort(function(t,e){return this._fields.indexOf(t)<this._fields.indexOf(e)?-1:1}.bind(this)),l.y=h;var m=new t.VerticalGridMatrixGroupBox(l.w,Math.floor((d+l.w-1)/l.w),l.x,l.y);for(m._addAssignedCells(s);!m.computeGridData(n);)m.resetAll(m.getColumnCount(),m.getRowCount()+1);this._cursor.reset(),this._addAssignedCells(m._getAssignedCells()),m._fieldGridDatas.forEach(function(t,e){this._fieldGridDatas[this._fields.indexOf(m._fields[e])]=t}.bind(this))}},t.VerticalGridMatrixGroupBox.prototype._horizontalMatchesOrOverlaps=function(t,e){return t.x>=e.x&&t.x+t.w<=e.x+e.w},t.VerticalGridMatrixGroupBox.prototype._horizontalOverlapsOnSide=function(t,e){return t.x>e.x||t.x+t.w<e.x+e.w},t.HtmlField=function(){t.HtmlField.parent.call(this),this.scrollBarEnabled=!1,this.preventInitialFocus=!0},t.inherits(t.HtmlField,t.ValueField),t.HtmlField.prototype._initKeyStrokeContext=function(){t.HtmlField.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke(new t.AppLinkKeyStroke(this,this._onAppLinkAction))},t.HtmlField.prototype._render=function(t){this.addContainer(t,"html-field"),this.addLabel(),this.addField(t.makeDiv()),this.addStatus()},t.HtmlField.prototype._renderProperties=function(){t.HtmlField.parent.prototype._renderProperties.call(this),this._renderScrollBarEnabled(),this._renderScrollToAnchor(this.scrollToAnchor)},t.HtmlField.prototype._renderDisplayText=function(){return this.displayText?(this.$field.html(this.displayText),this.$field.find(".app-link").on("click",this._onAppLinkAction.bind(this)),this.$field.find("a, .app-link").attr("tabindex","0").unfocusable(),this.$field.find("img").on("load",this._onImageLoad.bind(this)).on("error",this._onImageError.bind(this)),this.rendered&&this._renderScrollBarEnabled(),void this.invalidateLayoutTree()):void this.$field.empty()},t.HtmlField.prototype._remove=function(){t.scrollbars.uninstall(this.$field,this.session),t.HtmlField.parent.prototype._remove.call(this)},t.HtmlField.prototype._renderScrollBarEnabled=function(){this.scrollBarEnabled?t.scrollbars.install(this.$field,{parent:this}):t.scrollbars.uninstall(this.$field,this.session)},t.HtmlField.prototype._renderScrollToEnd=function(){this.scrollBarEnabled&&t.scrollbars.scrollToBottom(this.$fieldContainer)},t.HtmlField.prototype._renderScrollToAnchor=function(e){if(this.scrollBarEnabled&&e&&this.$field.find(e)){var i=this.$field.find("#".concat(e));i&&i.length>0&&t.scrollbars.scrollTo(this.$fieldContainer,i)}},t.HtmlField.prototype._onAppLinkAction=function(t){var i=e(t.target),o=i.data("ref");this.triggerAppLinkAction(o)},t.HtmlField.prototype.triggerAppLinkAction=function(t){this.trigger("appLinkAction",{ref:t})},t.HtmlField.prototype._onImageLoad=function(t){this.invalidateLayoutTree()},t.HtmlField.prototype._onImageError=function(t){this.invalidateLayoutTree()},t.HtmlFieldAdapter=function(){t.HtmlFieldAdapter.parent.call(this)},t.inherits(t.HtmlFieldAdapter,t.ValueFieldAdapter),t.HtmlFieldAdapter.prototype._onWidgetAppLinkAction=function(t){this._send("appLinkAction",{ref:t.ref})},t.HtmlFieldAdapter.prototype._onWidgetEvent=function(e){"appLinkAction"===e.type?this._onWidgetAppLinkAction(e):t.HtmlFieldAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.ImageField=function(){t.ImageField.parent.call(this),this.scrollBarEnabled=!1},t.inherits(t.ImageField,t.FormField),t.ImageField.prototype._render=function(e){this.addContainer(e,"image-field",new t.ImageFieldLayout(this)),this.addFieldContainer(e.makeDiv());var i=this.$fieldContainer.appendElement("<img>","image").on("load",this._onImageLoad.bind(this)).on("error",this._onImageError.bind(this));this.addLabel(),this.addField(i),this.addStatus()},t.ImageField.prototype._renderProperties=function(){t.ImageField.parent.prototype._renderProperties.call(this),this._renderImageUrl(),this._renderAutoFit(),this._renderScrollBarEnabled(),this._renderDropType()},t.ImageField.prototype._remove=function(){t.scrollbars.uninstall(this.$fieldContainer,this.session),t.ImageField.parent.prototype._remove.call(this)},t.ImageField.prototype._installDragAndDropHandler=function(t){this.dragAndDropHandler||(this.dragAndDropHandler=this._createDragAndDropHandler(),this.dragAndDropHandler.install(this.$fieldContainer))},t.ImageField.prototype._renderImageUrl=function(){this.$field.attr("src",this.imageUrl),this.$field.toggleClass("empty",!this.imageUrl)},t.ImageField.prototype._renderAutoFit=function(){this.$field.toggleClass("autofit",this.autoFit),t.scrollbars.update(this.$fieldContainer)},t.ImageField.prototype._renderScrollBarEnabled=function(){this._updateInnerAlignment(),this.scrollBarEnabled?t.scrollbars.install(this.$fieldContainer,{parent:this}):t.scrollbars.uninstall(this.$fieldContainer,this.session)},t.ImageField.prototype._renderGridData=function(){t.ImageField.parent.prototype._renderGridData.call(this),this._updateInnerAlignment()},t.ImageField.prototype._updateInnerAlignment=function(){this.updateInnerAlignment({useHorizontalAlignment:!this.scrollBarEnabled,useVerticalAlignment:!this.scrollBarEnabled})},t.ImageField.prototype._onImageLoad=function(e){this.$field.removeClass("broken"),t.scrollbars.update(this.$fieldContainer),this.invalidateLayoutTree()},t.ImageField.prototype._onImageError=function(e){this.$field.addClass("empty broken"),t.scrollbars.update(this.$fieldContainer),this.invalidateLayoutTree()},t.ImageField.prototype.setImageUrl=function(t){this.setProperty("imageUrl",t)},t.ImageFieldAdapter=function(){t.ImageFieldAdapter.parent.call(this)},t.inherits(t.ImageFieldAdapter,t.FormFieldAdapter),t.ImageFieldLayout=function(e){t.ImageFieldLayout.parent.call(this,e)},t.inherits(t.ImageFieldLayout,t.FormFieldLayout),t.ImageFieldLayout.prototype.layout=function(e){t.ImageFieldLayout.parent.prototype.layout.call(this,e),t.scrollbars.update(this.formField.$fieldContainer)},t.ImageFieldLayout.prototype.naturalSize=function(e){var i=e.$field[0];return i&&i.complete&&i.naturalWidth>0&&i.naturalHeight>0?new t.Dimension(i.naturalWidth,i.naturalHeight):t.ImageFieldLayout.parent.prototype.naturalSize.call(this,e)},t.LabelField=function(){t.LabelField.parent.call(this)},t.inherits(t.LabelField,t.ValueField),t.LabelField.prototype._render=function(t){this.addContainer(t,"label-field"),this.addLabel(),this.addField(t.makeDiv()),this.addStatus()},t.LabelField.prototype._renderProperties=function(){t.LabelField.parent.prototype._renderProperties.call(this),this._renderWrapText(this.wrapText)},t.LabelField.prototype._renderDisplayText=function(){var e=this.displayText||"";this.htmlEnabled?this.$field.html(e):this.$field.html(t.strings.nl2br(e))},t.LabelField.prototype._renderWrapText=function(){this.$field.toggleClass("white-space-nowrap",!this.wrapText)},t.LabelField.prototype._renderGridData=function(){t.LabelField.parent.prototype._renderGridData.call(this),this.updateInnerAlignment({useHorizontalAlignment:!0})},t.LabelFieldAdapter=function(){t.LabelFieldAdapter.parent.call(this)},t.inherits(t.LabelFieldAdapter,t.ValueFieldAdapter),t.ListBox=function(){t.ListBox.parent.call(this),this._addAdapterProperties(["table","filterBox"])},t.inherits(t.ListBox,t.ValueField),t.ListBox.prototype._init=function(e){t.ListBox.parent.prototype._init.call(this,e),this.filterBox&&(this.filterBox.enabledComputed=!0,this.filterBox.recomputeEnabled(!0))},t.ListBox.prototype._render=function(e){this.addContainer(e,"list-box"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this.addFieldContainer(e.makeDiv());var i=t.HtmlComponent.install(this.$fieldContainer,this.session);i.setLayout(new t.ListBoxLayout(this,this.table,this.filterBox)),this.table&&this._renderTable(),this.filterBox&&(this._renderFilterBox(),this.table.htmlComp.pixelBasedSizing=!0)},t.ListBox.prototype._renderTable=function(){this.table.render(this.$fieldContainer),this.addField(this.table.$container)},t.ListBox.prototype._renderFilterBox=function(){this.filterBox.render(this.$fieldContainer)},t.ListBoxAdapter=function(){t.ListBoxAdapter.parent.call(this),this._addAdapterProperties(["table","filterBox"])},t.inherits(t.ListBoxAdapter,t.ValueFieldAdapter),t.ListBoxLayout=function(e,i,o){t.ListBoxLayout.parent.call(this),this.table=i,this.filterBox=o,this.listBox=e},t.inherits(t.ListBoxLayout,t.AbstractLayout),t.ListBoxLayout.prototype.layout=function(e){var i,o=t.HtmlComponent.get(e),n=o.getSize(),r=n.height;this.filterBox&&this.filterBox.rendered&&this.filterBox.$container.isVisible()&&(i=t.HtmlComponent.get(this.filterBox.$container).getPreferredSize().height,
r-=i),r=Math.max(r,20);var s=t.HtmlComponent.get(this.table.$container);if(s.setSize(new t.Dimension(n.width,r)),this.filterBox&&this.filterBox.rendered&&this.filterBox.$container.isVisible()){var a=t.HtmlComponent.get(this.filterBox.$container);a.setSize(new t.Dimension(n.width,i))}},t.ListBoxLayout.prototype.preferredLayoutSize=function(e){var i,o,n,r,s=0,a=t.HtmlComponent.get(e),l=t.HtmlEnvironment.formRowHeight,h=this.listBox;return h.$label&&h.labelVisible&&(s+=t.HtmlEnvironment.fieldLabelWidth),h.$mandatory&&(s+=h.$mandatory.outerWidth(!0)),h.$status&&h.statusVisible&&(s+=h.$status.outerWidth(!0)),n=t.HtmlComponent.optGet(this.table.$container),i=n?n.getPreferredSize().add(a.getInsets()).add(n.getMargins()):this.naturalSize(h),r=t.HtmlComponent.optGet(this.filterBox.$container),r?o=r.getPreferredSize().add(a.getInsets()).add(r.getMargins()):i=this.naturalSize(h),s+=Math.max(i.width,o.width),l=Math.max(l,i.height+o.height),new t.Dimension(s,l)},t.ListBoxLayout.prototype.naturalSize=function(e){return new t.Dimension(e.$fieldContainer.width(),e.$fieldContainer.height())},t.NumberField=function(){t.NumberField.parent.call(this)},t.inherits(t.NumberField,t.BasicField),t.NumberField.prototype._init=function(e){t.NumberField.parent.prototype._init.call(this,e),this.decimalFormat instanceof t.DecimalFormat||(this.decimalFormat=new t.DecimalFormat(this.session.locale,this.decimalFormat)),this.calc=new t.Calculator},t.NumberField.prototype._createKeyStrokeContext=function(){return new t.InputFieldKeyStrokeContext},t.NumberField.prototype._render=function(e){this.addContainer(e,"number-field"),this.addLabel(),this.addMandatoryIndicator();var i=t.fields.makeTextField(e).on("blur",this._onFieldBlur.bind(this));this.addField(i),this.addStatus()},t.NumberField.prototype._renderGridData=function(){t.NumberField.parent.prototype._renderGridData.call(this),this.updateInnerAlignment({useHorizontalAlignment:!0})},t.NumberField.prototype._syncDecimalFormat=function(e){e=t.DecimalFormat.ensure(this.session.locale,e),this._setProperty("decimalFormat",e)},t.NumberField.prototype._renderDecimalFormat=function(){this._parse()},t.NumberField.prototype.acceptInput=function(e){e||this._parse(),t.NumberField.parent.prototype.acceptInput.call(this,e)},t.NumberField.prototype.parse=function(){var t=null;try{t=this.decimalFormat.parse(this.displayText)}catch(t){}return t},t.NumberField.prototype._parse=function(){var t=this.$field.val();if(t&&(t=t.replace(new RegExp("["+this.decimalFormat.groupingChar+"]","g"),"").replace(new RegExp("["+this.decimalFormat.decimalSeparatorChar+"]","g"),".").replace(/\s/g,""),this.calc.isFormula(t)))try{t=this.calc.evalFormula(t),t=this.decimalFormat.format(t,!1),this.$field.val(t)}catch(t){}},t.NumberFieldAdapter=function(){t.NumberFieldAdapter.parent.call(this)},t.inherits(t.NumberFieldAdapter,t.BasicFieldAdapter),t.Calculator=function(){},t.Calculator.prototype.isFormula=function(t){return t.match(/^[\d\(\)\+\-\*\/\.]+$/)},t.Calculator.prototype.evalFormula=function(t){return this._tokens=t.split(/([\d.]+|\(|\)|[\+\-\*\/])/).filter(function(t){return 0!==t.length}),this._expr()},t.Calculator.prototype._next=function(){return 0===this._tokens.length?i:this._tokens[0]},t.Calculator.prototype._consumeNext=function(){var t=this._tokens[0];return this._tokens=this._tokens.slice(1,this._tokens.length),t},t.Calculator.prototype._expr=function(){return this._sum()},t.Calculator.prototype._sum=function(){for(var t=this._prod();"+"===this._next()||"-"===this._next();)switch(this._consumeNext()){case"+":t+=this._prod();break;case"-":t-=this._prod()}return t},t.Calculator.prototype._prod=function(){for(var t=this._unary();"*"===this._next()||"/"===this._next();)switch(this._consumeNext()){case"*":t*=this._unary();break;case"/":t/=this._unary()}return t},t.Calculator.prototype._unary=function(){var t=1;"+"===this._next()?this._consumeNext():"-"===this._next()&&(this._consumeNext(),t=-1);var e;return(e=this._group())!==i?t*e:(e=this._consumeNext(),t*e)},t.Calculator.prototype._group=function(){if("("===this._next()){this._consumeNext();var t=this._expr();if(")"!==this._next())throw"missing closing bracket";return this._consumeNext(),t}return i},t.PlaceholderField=function(){t.PlaceholderField.parent.call(this)},t.inherits(t.PlaceholderField,t.FormField),t.PlaceholderField.prototype._render=function(t){this.addContainer(t,"placeholder-field")},t.PlaceholderFieldAdapter=function(){t.PlaceholderFieldAdapter.parent.call(this)},t.inherits(t.PlaceholderFieldAdapter,t.FormFieldAdapter),t.PlannerField=function(){t.PlannerField.parent.call(this),this._addAdapterProperties(["planner"]),this.splitterPosition=168},t.inherits(t.PlannerField,t.FormField),t.PlannerField.prototype._render=function(t){this.addContainer(t,"planner-field"),this.addLabel(),this.addStatus(),this.planner&&this._renderPlanner()},t.PlannerField.prototype._renderPlanner=function(){this.planner.render(this.$container),this.addField(this.planner.$container)},t.PlannerField.prototype._removePlanner=function(){this.planner.remove(),this._removeField()},t.PlannerField.prototype._renderSplitterPosition=function(){},t.PlannerFieldAdapter=function(){t.PlannerFieldAdapter.parent.call(this),this._addAdapterProperties(["planner"])},t.inherits(t.PlannerFieldAdapter,t.FormFieldAdapter),t.RadioButton=function(){t.RadioButton.parent.call(this),this.focusWhenSelected},t.inherits(t.RadioButton,t.Button),t.RadioButton.prototype._initDefaultKeyStrokes=function(){this.keyStrokeContext.registerKeyStroke([new t.RadioButtonKeyStroke(this,"ENTER"),new t.RadioButtonKeyStroke(this,"SPACE")])},t.RadioButton.prototype._init=function(e){t.RadioButton.parent.prototype._init.call(this,e),this.focusWhenSelected=t.nvl(e.focusWhenSelected,!t.device.supportsFocusEmptyBeforeDiv())},t.RadioButton.prototype._render=function(e){this.addContainer(e,"radio-button",new t.ButtonLayout(this)),this.addField(e.makeDiv().on("mousedown",this._mouseDown.bind(this))),this.$field.data("radiobutton",this),this.addStatus(),t.tooltips.installForEllipsis(this.$field,{parent:this})},t.RadioButton.prototype._remove=function(){t.tooltips.uninstall(this.$field),t.RadioButton.parent.prototype._remove.call(this)},t.RadioButton.prototype._mouseDown=function(t){this.select(),this.focusWhenSelected&&(this.session.focusManager.requestFocus(this.$field),t.preventDefault())},t.RadioButton.prototype.select=function(){this.enabledComputed&&(this.parent instanceof t.RadioButtonGroup?this.parent.selectButton(this):this.setSelected(!0))},t.RadioButton.prototype.setSelected=function(t){this.setProperty("selected",t)},t.RadioButton.prototype.doAction=function(t){return this.select(),!0},t.RadioButton.prototype.setTabbable=function(e){this.$field.setTabbable(e&&!t.device.supportsTouch())},t.RadioButton.prototype._renderProperties=function(){t.RadioButton.parent.prototype._renderProperties.call(this),this._renderSelected()},t.RadioButton.prototype._renderLabel=function(){this.$field.textOrNbsp(this.label)},t.RadioButton.prototype._renderSelected=function(){this.$field.toggleClass("checked",this.selected)},t.RadioButton.prototype._renderForegroundColor=function(){t.FormField.prototype._renderForegroundColor.call(this)},t.RadioButtonAdapter=function(){t.RadioButtonAdapter.parent.call(this),this._addRemoteProperties(["selected"])},t.inherits(t.RadioButtonAdapter,t.ButtonAdapter),t.RadioButtonGroup=function(){t.RadioButtonGroup.parent.call(this),this._addAdapterProperties("formFields"),this.formFields=[],this.radioButtons=[],this.selectedButton=null,this.$body},t.inherits(t.RadioButtonGroup,t.ValueField),t.RadioButtonGroup.prototype._initKeyStrokeContext=function(){t.RadioButtonGroup.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke([new t.RadioButtonGroupLeftKeyStroke(this),new t.RadioButtonGroupRightKeyStroke(this)])},t.RadioButtonGroup.prototype.getFields=function(){return this.formFields},t.RadioButtonGroup.prototype.visit=function(e){t.RadioButtonGroup.parent.prototype.visit.call(this,e),this.formFields.forEach(function(t){t.visit(e)})},t.RadioButtonGroup.prototype._init=function(e){t.RadioButtonGroup.parent.prototype._init.call(this,e),this.formFields.forEach(function(e){e instanceof t.RadioButton&&(this.radioButtons.push(e),e.selected&&(this.selectedButton=e))},this)},t.RadioButtonGroup.prototype._render=function(e){var i,o=t.HtmlEnvironment;this.addContainer(e,"radiobutton-group"),this.$body=this.$container.appendDiv("radiobutton-group-body"),i=t.HtmlComponent.install(this.$body,this.session),i.setLayout(new t.LogicalGridLayout(o.smallColumnGap,o.formRowGap)),this.formFields.forEach(function(e){e.render(this.$body),e.setLayoutData(new t.LogicalGridData(e))},this),this.addLabel(),this.addMandatoryIndicator(),this.addField(this.$body),this.addStatus()},t.RadioButtonGroup.prototype._renderEnabled=function(){t.RadioButtonGroup.parent.prototype._renderEnabled.call(this),this._provideTabIndex()},t.RadioButtonGroup.prototype.recomputeEnabled=function(e){t.RadioButtonGroup.parent.prototype.recomputeEnabled.call(this,e),this.getFields().forEach(function(t){t.recomputeEnabled(this.enabledComputed)},this)},t.RadioButtonGroup.prototype._provideTabIndex=function(){var t;this.radioButtons.forEach(function(e){e.enabledComputed&&this.enabledComputed&&!t?(e.setTabbable(!0),t=e):t&&this.enabledComputed&&e.enabledComputed&&e.selected?(t.setTabbable(!1),e.setTabbable(!0),t=e):e.setTabbable(!1)},this)},t.RadioButtonGroup.prototype.selectButton=function(t){this.selectedButton=null,this.radioButtons.forEach(function(e){if(e===t){if(!e.enabledComputed)return;e.setSelected(!0),e.setTabbable(!0),this.selectedButton=e}else e.setSelected(!1),e.setTabbable(!1)},this)},t.RadioButtonGroup.prototype.addButton=function(t){this.formFields.push(t),this.radioButtons.push(t)},t.RadioButtonGroupAdapter=function(){t.RadioButtonGroupAdapter.parent.call(this),this._addAdapterProperties("formFields")},t.inherits(t.RadioButtonGroupAdapter,t.ValueFieldAdapter),t.RadioButtonGroupLeftKeyStroke=function(e){t.RadioButtonGroupLeftKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.LEFT],this.renderingHints.render=!1},t.inherits(t.RadioButtonGroupLeftKeyStroke,t.KeyStroke),t.RadioButtonGroupLeftKeyStroke.prototype.handle=function(t){var i,o=e(t.target).data("radiobutton");this.field.radioButtons.some(function(t){return i&&t===o?(i.select(),this.field.session.focusManager.requestFocus(i.$field),!0):void(t.enabledComputed&&t.visible&&(i=t))},this)},t.RadioButtonGroupRightKeyStroke=function(e){t.RadioButtonGroupRightKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.RIGHT],this.renderingHints.render=!1},t.inherits(t.RadioButtonGroupRightKeyStroke,t.KeyStroke),t.RadioButtonGroupRightKeyStroke.prototype.handle=function(t){var i,o=e(t.target).data("radiobutton");this.field.radioButtons.some(function(t){return i&&t.enabledComputed&&t.visible?(t.select(),this.field.session.focusManager.requestFocus(t.$field),!0):void(t===o&&t.enabledComputed&&t.visible&&(i=t))},this)},t.RadioButtonKeyStroke=function(e,i){t.RadioButtonKeyStroke.parent.call(this,e,i)},t.inherits(t.RadioButtonKeyStroke,t.ButtonKeyStroke),t.RadioButtonKeyStroke.prototype._accept=function(e){var i=t.RadioButtonKeyStroke.parent.prototype._accept.call(this,e);return i&&!this.field.selected},t.SequenceBox=function(){t.SequenceBox.parent.call(this),this._addAdapterProperties("fields"),this.fields=[]},t.inherits(t.SequenceBox,t.CompositeField),t.SequenceBox.prototype._render=function(e){var i,o;this.addContainer(e,"sequence-box"),this.addLabel(),this.addField(e.makeDiv()),this.addStatus(),this._handleStatus();var n=t.HtmlComponent.install(this.$field,this.session);for(n.setLayout(new t.LogicalGridLayout(t.HtmlEnvironment.smallColumnGap,0)),o=0;o<this.fields.length;o++)i=this.fields[o],i.labelUseUiWidth=!0,i.on("propertyChange",this._onFieldPropertyChange.bind(this)),i.render(this.$field),this._modifyLabel(i),i.setLayoutData(new t.LogicalGridData(i))},t.SequenceBox.prototype._onFieldPropertyChange=function(e){var i=e.changedProperties.indexOf("visible")!==-1;t.arrays.containsAny(e.changedProperties,["errorStatus","tooltipText","visible","menus","menusVisible"])&&this._handleStatus(i)},t.SequenceBox.prototype._handleStatus=function(t){t&&this._lastVisibleField&&(this._lastVisibleField.suppressStatus=!1,this._lastVisibleField._renderErrorStatus(),this._lastVisibleField._renderTooltipText(),this._lastVisibleField._renderMenus()),this._lastVisibleField=this._getLastVisibleField(),this._lastVisibleField&&(this.setErrorStatus(this._lastVisibleField.errorStatus),this.setTooltipText(this._lastVisibleField.tooltipText),this.setMenus(this._lastVisibleField.menus),this.setMenusVisible(this._lastVisibleField.menusVisible),this._lastVisibleField.suppressStatus=!0,t&&(this._lastVisibleField._renderErrorStatus(),this._lastVisibleField._renderTooltipText(),this._lastVisibleField._renderMenus()))},t.SequenceBox.prototype._getLastVisibleField=function(){var t=this.fields.filter(function(t){return t.visible});if(0!==t.length)return t[t.length-1]},t.SequenceBox.prototype._updateStatusVisible=function(){this._renderStatusVisible()},t.SequenceBox.prototype._modifyLabel=function(e){e instanceof t.CheckBoxField&&(e.labelVisible=!1)},t.SequenceBox.prototype.getFields=function(){return this.fields},t.SequenceBoxAdapter=function(){t.SequenceBoxAdapter.parent.call(this),this._addAdapterProperties("fields")},t.inherits(t.SequenceBoxAdapter,t.CompositeFieldAdapter),t.SliderField=function(){t.SliderField.parent.call(this),this.slider},t.inherits(t.SliderField,t.ValueField),t.SliderField.prototype._init=function(i){t.SliderField.parent.prototype._init.call(this,i);var o=e.extend({parent:this},i);this.slider=t.create("Slider",o)},t.SliderField.prototype._render=function(t){this.addContainer(t,"slider-field"),this.addLabel(),this.addMandatoryIndicator(),this._renderSlider()},t.SliderField.prototype._renderSlider=function(){this.slider.render(this.$container),this.addField(this.slider.$container)},t.SliderField.prototype.setValue=function(t){this.slider.setValue(t)},t.SliderField.prototype.getValue=function(){return this.slider.value},t.SmartField=function(){t.SmartField.parent.call(this),this.DEBOUNCE_DELAY=200,this._addAdapterProperties(["proposalChooser"]),this.options,this._oldDisplayText,this.popup,this._requestedProposal=!1,this._tabPrevented=null,this._pendingProposalTyped=null,this._navigating=!1,this.lookupCall,this.codeType},t.inherits(t.SmartField,t.ValueField),t.SmartField.prototype._createKeyStrokeContext=function(){return new t.InputFieldKeyStrokeContext},t.SmartField.prototype._init=function(e){t.SmartField.parent.prototype._init.call(this,e),t.fields.initTouch(this,e),this.popup=e.popup,this._syncLookupCall(this.lookupCall),this._syncCodeType(this.codeType)},t.SmartField.prototype.createPopup=function(){var e=this.touch?"SmartFieldTouchPopup":"SmartFieldPopup";return t.create(e,{parent:this,$anchor:this.$field,boundToAnchor:!this.touch,closeOnAnchorMousedown:!1,field:this})},t.SmartField.prototype._render=function(e){var i=this.proposal?"proposal-field":"smart-field";this.addContainer(e,i,new t.SmartFieldLayout(this)),this.addLabel();var o=t.fields.makeInputOrDiv(this).click(this._onClick.bind(this));this.touch||o.blur(this._onFieldBlur.bind(this)).focus(this._onFocus.bind(this)).keyup(this._onKeyUp.bind(this)).keydown(this._onKeyDown.bind(this)),this.addField(o),this.embedded||this.addMandatoryIndicator(),this.addIcon(),this.addStatus()},t.SmartField.prototype._remove=function(){t.SmartField.parent.prototype._remove.call(this),this.popup=null},t.SmartField.prototype._renderProperties=function(){t.SmartField.parent.prototype._renderProperties.call(this),this._renderProposalChooser()},t.SmartField.prototype._syncLookupCall=function(e){"string"==typeof e&&(e=t.create(e)),this._setProperty("lookupCall",e)},t.SmartField.prototype._syncCodeType=function(e){if(this._setProperty("codeType",e),e){var i=t.create("CodeLookupCall",{session:this.session,codeType:e});this.setProperty("lookupCall",i)}};t.SmartField.prototype._formatValue=function(t){return this.lookupCall?null===t||t===i?"":this.lookupCall.textById(t):""};t.SmartField.prototype._syncDisplayText=function(t){this._oldDisplayText=t,this._setProperty("displayText",t)},t.SmartField.prototype._renderDisplayText=function(){t.fields.valOrText(this,this.$field,this.displayText)},t.SmartField.prototype._readDisplayText=function(){return t.fields.valOrText(this,this.$field)},t.SmartField.prototype._readSearchText=function(){return this._readDisplayText()},t.SmartField.prototype._syncProposalChooser=function(t){return!this.embedded&&void this._setProperty("proposalChooser",t)},t.SmartField.prototype._renderProposalChooser=function(){e.log.debug("(SmartField#_renderProposalChooser) proposalChooser="+this.proposalChooser+" touch="+this.touch),this.proposalChooser&&(this.openPopup(),this.popup.setProposalChooser(this.proposalChooser))},t.SmartField.prototype._removeProposalChooser=function(){e.log.trace("(SmartField#_removeProposalChooser) proposalChooser="+this.proposalChooser),this._closeProposal(!1)},t.SmartField.prototype._isNavigationKey=function(e){return e.which===t.keys.PAGE_UP||e.which===t.keys.PAGE_DOWN||e.which===t.keys.UP||e.which===t.keys.DOWN},t.SmartField.prototype._isFunctionKey=function(e){return e.which>=t.keys.F1&&e.which<t.keys.F12},t.SmartField.prototype._onClick=function(e){t.fields.handleOnClick(this)&&this._openProposal(!0)},t.SmartField.prototype._onIconClick=function(e){t.fields.handleOnClick(this)&&(t.SmartField.parent.prototype._onIconClick.call(this,e),this._openProposal(!0))},t.SmartField.prototype._isPreventDefaultTabHandling=function(){var t=!!this.proposalChooser;return e.log.trace("(SmartField#_isPreventDefaultTabHandling) must prevent default when TAB was pressed = "+t),t},t.SmartField.prototype._onKeyDown=function(e){return e.which===t.keys.ESCAPE?(this.popup&&e.stopPropagation(),this._closeProposal(),void(this._navigating=!1)):e.which===t.keys.TAB&&this.mode!==t.FormField.MODE_CELLEDITOR&&this._isPreventDefaultTabHandling()?(e.preventDefault(),this._tabPrevented={directionBack:e.shiftKey},this._acceptProposal(),void(this._navigating=!1)):e.which===t.keys.ENTER?(this.popup&&e.stopPropagation(),this._acceptProposal(),void(this._navigating=!1)):void(this._isNavigationKey(e)?(this._navigating=!0,this.proposalChooser?this._delegateToProposalChooser(e):this._openProposal(!0)):this._navigating=!1)},t.SmartField.prototype._delegateToProposalChooser=function(t){this._pendingProposalTyped&&(this._pendingProposalTyped.func(),this._clearPendingProposalTyped()),this.proposalChooser&&this.proposalChooser.delegateEvent(t)},t.SmartField.prototype._onKeyUp=function(e){return e.which===t.keys.ESCAPE?void e.stopPropagation():e.which===t.keys.ENTER?void e.stopPropagation():void(e.which===t.keys.TAB||e.which===t.keys.SHIFT||e.which===t.keys.HOME||e.which===t.keys.END||e.which===t.keys.LEFT||e.which===t.keys.RIGHT||this._isNavigationKey(e)||this._isFunctionKey(e)||(this.popup?this._proposalTyped():this._openProposal(!1)))},t.SmartField.prototype._onFocus=function(t){this._oldDisplayText=this._readDisplayText()},t.SmartField.prototype._proposalTyped=function(){var t=this._readSearchText();if(e.log.trace("(SmartField#_proposalTyped) displayText="+t+" currentDisplayText="+this.displayText),t!==this.displayText){this.displayText=t;var i,o;this._clearPendingProposalTyped(),o=function(){e.log.debug("(SmartField#_proposalTyped) send displayText="+t),this.trigger("proposalTyped",{displayText:t})}.bind(this),i=setTimeout(o,this.DEBOUNCE_DELAY),this._pendingProposalTyped={func:o,id:i}}},t.SmartField.prototype._fieldBounds=function(){return t.graphics.offsetBounds(this.$field)},t.SmartField.prototype._onFieldBlur=function(){e.log.debug("true"),this._requestedProposal=!1,this.embedded||(this._tabPrevented?this._tabPrevented=null:this.acceptInput())},t.SmartField.prototype._clearPendingProposalTyped=function(){this._pendingProposalTyped&&clearTimeout(this._pendingProposalTyped.id),this._pendingProposalTyped=null},t.SmartField.prototype.proposalSelected=function(){this.proposalSelectedInProgress=!0,this._oldDisplayText=this._readDisplayText()},t.SmartField.prototype._abortAcceptProposal=function(t){var i=this.proposalSelectedInProgress&&t===this._oldDisplayText;return i&&(e.log.debug("(SmartField#_abortAcceptProposal) aborted _acceptProposal because displayText has not changed since proposal has been selected"),this.proposalSelectedInProgress=!1),i},t.SmartField.prototype._acceptProposal=function(i){this._clearPendingProposalTyped(),i=t.nvl(i,!1);var o=!!this.proposalChooser||this.embedded,n=this._readSearchText();if(e.log.debug("(SmartField#_acceptProposal) displayText="+n+" proposalChooserOpen="+o+" forceClose="+i),!this._abortAcceptProposal(n)){if(o){var r=t.strings.empty(n)&&t.strings.hasText(this._oldDisplayText);r&&!this._navigating?(this._sendDeleteProposal(n),this._triggerDeleteProposal(n)):(this._sendAcceptProposal(n,!0,i),this._triggerAcceptProposal(n)),this.embedded&&this._closeProposal()}else{if(n===this._oldDisplayText)return;this._sendAcceptProposal(n,!1,i),this._triggerAcceptProposal(n)}this.session.listen().done(this._onSessionDone.bind(this))}},t.SmartField.prototype._onSessionDone=function(t){e.log.debug("(SmartField#_onSessionDone) request done proposalChooser="+this.proposalChooser),this.proposalSelectedInProgress=!1,this._tabPrevented&&!this.proposalChooser&&this._focusNextTabbable()},t.SmartField.prototype._triggerDeleteProposal=function(t){this.trigger("deleteProposal",{displayText:t})},t.SmartField.prototype._sendDeleteProposal=function(t){this._syncDisplayText(t),this._send("deleteProposal")},t.SmartField.prototype._triggerAcceptProposal=function(t){this.trigger("acceptProposal",{displayText:t})},t.SmartField.prototype._sendAcceptProposal=function(t,e,i){this._syncDisplayText(t),this._send("acceptProposal",{displayText:t,chooser:e,forceClose:i,showBusyIndicator:!1,coalesce:function(t){return this.type===t.type}})},t.SmartField.prototype._focusNextTabbable=function(){var t=this.entryPoint().find(":tabbable"),i=this._tabPrevented.directionBack?-1:1,o=t.index(this.$field),n=o+i;n<0?n=t.length-1:n>=t.length&&(n=0),e.log.debug("SmartField tab-index="+o+" next tab-index="+n),t.eq(n).focus()},t.SmartField.prototype._closeProposal=function(e){this.popup&&(t.nvl(e,!0)&&this._sendCancelProposal(),this.popup.close())},t.SmartField.prototype._sendCancelProposal=function(){this._send("cancelProposal")},t.SmartField.prototype._openProposal=function(t){var i=this._readSearchText(),o=t;this.displayText=i,this.errorStatus&&(o=!1),this._requestedProposal?e.log.trace("(SmartField#_openProposal) already requested proposal -> do nothing"):(this._requestedProposal=!0,e.log.debug("(SmartField#_openProposal) send openProposal. displayText="+i+" selectCurrentValue="+o),this._send("openProposal",{displayText:i,selectCurrentValue:o,browseAll:t}))},t.SmartField.prototype.openPopup=function(){this.popup||(this.popup=this.createPopup(),this.popup.open(),this.popup.on("remove",function(){this.popup=null}.bind(this)),this.touch&&this._hideStatusMessage())},t.SmartField.prototype.virtual=function(){return this.browseMaxRowCount>100},t.SmartField.prototype.acceptInput=function(t){this._acceptProposal(!0)},t.SmartField.prototype.aboutToBlurByMouseDown=function(t){var e=this.$field.isOrHas(t),i=this.popup&&this.popup.$container.isOrHas(t);e||i||this.acceptInput()},t.SmartField.prototype.onCellEditorRendered=function(t){t.openFieldPopup&&this._onClick()},t.SmartFieldAdapter=function(){t.SmartFieldAdapter.parent.call(this),this._addAdapterProperties(["proposalChooser"])},t.inherits(t.SmartFieldAdapter,t.ValueFieldAdapter),t.SmartFieldAdapter.prototype._onWidgetProposalTyped=function(t){this._send("proposalTyped",{displayText:t.displayText},{showBusyIndicator:!1})},t.SmartFieldAdapter.prototype._onWidgetEvent=function(e){"proposalTyped"===e.type?this._onWidgetProposalTyped(e):t.SmartFieldAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.SmartFieldAdapter.prototype._syncProposalChooser=function(t){e.log.debug("(SmartFieldAdapter#_syncProposalChooser) set _requestedProposal to false"),this.widget._requestedProposal=!1,this.widget.callSetter("proposalChooser",t)},t.SmartFieldTouchPopup=function(){t.SmartFieldTouchPopup.parent.call(this),this._addAdapterProperties("proposalChooser")},t.inherits(t.SmartFieldTouchPopup,t.TouchPopup),t.SmartFieldTouchPopup.prototype._init=function(e){t.SmartFieldTouchPopup.parent.prototype._init.call(this,e),this._delegateEvents(["acceptProposal","proposalTyped","cancelProposal"]),this._delegateDisplayTextChanges(["acceptProposal","proposalTyped","deleteProposal"])},t.SmartFieldTouchPopup.prototype._fieldOverrides=function(){var e=t.SmartFieldTouchPopup.parent.prototype._fieldOverrides.call(this);return e.proposalChooser=null,e},t.SmartFieldTouchPopup.prototype.setProposalChooser=function(t){this.setProperty("proposalChooser",t)},t.SmartFieldTouchPopup.prototype._renderProposalChooser=function(){this.proposalChooser.render(this._$widgetContainer),this.proposalChooser.$container.addClass("touch"),this._widgetContainerHtmlComp.invalidateLayoutTree()},t.SmartFieldTouchPopup.prototype._onMouseDownOutside=function(t){this._delegateDisplayText(),this._touchField.acceptInput(),this.close()},t.SmartFieldTouchPopup.prototype._delegateDisplayText=function(){this._touchField.setDisplayText(this._field.displayText)},t.SmartFieldTouchPopup.prototype._delegateEvents=function(t){var e=this;t.forEach(function(t){e._field.on(t,function(t){e._touchField.events.trigger(t.type,t)})})},t.SmartFieldTouchPopup.prototype._delegateDisplayTextChanges=function(t){t.forEach(function(t){this._field.on(t,this._delegateDisplayText.bind(this))},this)},t.SmartFieldLayout=function(e){t.SmartFieldLayout.parent.call(this,e),this._smartField=e},t.inherits(t.SmartFieldLayout,t.FormFieldLayout),t.SmartFieldLayout.prototype.layout=function(e){if(t.SmartFieldLayout.parent.prototype.layout.call(this,e),!this._smartField.embedded){var i=this._smartField.popup;i&&i.rendered&&(i.position(),i.validateLayout())}},t.SmartFieldLayout.prototype._layoutIcon=function(e,i,o,n){var r=e instanceof t.SmartFieldMultiline,s=this._smartField.$field.outerHeight();e.$icon.cssRight(e.$field.cssBorderRightWidth()+(r?0:o)).cssTop(n).cssHeight(s).cssLineHeight(s)},t.SmartFieldPopup=function(){t.SmartFieldPopup.parent.call(this),this._addAdapterProperties("proposalChooser")},t.inherits(t.SmartFieldPopup,t.Popup),t.SmartFieldPopup.prototype._init=function(e){e.scrollType=e.scrollType||"layoutAndPosition",e.installFocusContext=!1,t.SmartFieldPopup.parent.prototype._init.call(this,e),this._field=e.field},t.SmartFieldPopup.prototype._createLayout=function(){return new t.SmartFieldPopupLayout(this)},t.SmartFieldPopup.prototype._render=function(e){this.$container=e.appendDiv("smart-field-popup").on("mousedown",this._onContainerMouseDown.bind(this)),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(this._createLayout()),this.htmlComp.validateRoot=!0},t.SmartFieldPopup.prototype.setProposalChooser=function(t){this.setProperty("proposalChooser",t)},t.SmartFieldPopup.prototype._renderProposalChooser=function(){this.proposalChooser.setVirtual(this._field.virtual()),this.proposalChooser.render(this.$container),this.revalidateLayout()},t.SmartFieldPopup.prototype._onContainerMouseDown=function(t){return!1},t.SmartFieldPopupLayout=function(e){t.SmartFieldPopupLayout.parent.call(this,e)},t.inherits(t.SmartFieldPopupLayout,t.PopupLayout),t.SmartFieldPopupLayout.prototype.layout=function(e){var i,o,n=this._htmlProposalChooser(e);t.SmartFieldPopupLayout.parent.prototype.layout.call(this,e),o=this.popup.htmlComp.getSize(),n&&(i=o.subtract(this.popup.htmlComp.getInsets()),n.setSize(i)),this.popup.htmlComp.layouted&&this.popup.position()},t.SmartFieldPopupLayout.prototype.preferredLayoutSize=function(e){var i,o=this._htmlProposalChooser(e),n=this.popup._field._fieldBounds();return o?(i=o.getPreferredSize(),i=i.add(this.popup.htmlComp.getInsets())):i=new t.Dimension(t.HtmlEnvironment.formColumnWidth,2*t.HtmlEnvironment.formRowHeight),i.width=Math.max(n.width,i.width),i.height=Math.max(15,Math.min(350,i.height)),i.width>this._maxWindowSize()&&(i.width=this._maxWindowSize()),i},t.SmartFieldPopupLayout.prototype._htmlProposalChooser=function(e){return t.HtmlComponent.optGet(e.children(".proposal-chooser"))},t.SmartFieldPopupLayout.prototype._maxWindowSize=function(){return this.popup.$container.window().width()-2*this.popup.windowPaddingX},t.ProposalChooser=function(){t.ProposalChooser.parent.call(this),this._addAdapterProperties(["model"]),this.$container,this.$status,this.activeFilter,this.htmlComp,this._updateStatusTimeout},t.inherits(t.ProposalChooser,t.Widget),t.ProposalChooser.ACTIVE_FILTER_VALUES=["UNDEFINED","FALSE","TRUE"],t.ProposalChooser.prototype._render=function(e){this.$container=e.appendDiv("proposal-chooser"),this.htmlComp=t.HtmlComponent.install(this.$container,this.session),this.htmlComp.setLayout(new t.ProposalChooserLayout(this)),this.model.render(this.$container),this.model instanceof t.Tree&&(this.model._onNodeControlMouseDownDoFocus=function(){}),this.$status=this.$container.appendDiv("status").setVisible(!1),this.activeFilter&&(this.activeFilterGroup=t.create("RadioButtonGroup",{parent:this,labelVisible:!1,statusVisible:!1}),t.ProposalChooser.ACTIVE_FILTER_VALUES.forEach(function(t,e){this._renderButton(t,e)},this),this.activeFilterGroup.render(this.$container),this.activeFilterGroup.$container.addClass("active-filter"),this.activeFilterGroup.removeMandatoryIndicator())},t.ProposalChooser.prototype._renderProperties=function(){t.ProposalChooser.parent.prototype._renderProperties.call(this),this._updateStatus(),this.htmlComp.revalidateLayout()},t.ProposalChooser.prototype.delegateEvent=function(t){t.originalEvent.smartFieldEvent=!0,this.model.$container.trigger(t)},t.ProposalChooser.prototype._renderStatus=function(){this._updateStatus()},t.ProposalChooser.prototype._renderStatusVisible=function(){this._updateStatus()},t.ProposalChooser.prototype._computeStatusVisible=function(){return!(!this.statusVisible||!this.status)},t.ProposalChooser.prototype._updateStatus=function(){clearTimeout(this._updateStatusTimeout),t.objects.optProperty(this.status,"severity")===t.Status.Severity.OK?this._updateStatusTimeout=setTimeout(this._updateStatusImpl.bind(this),250):this._updateStatusImpl()},t.ProposalChooser.prototype._updateStatusImpl=function(){var i=this.$status.isVisible(),o=this.$status.text(),n=this._computeStatusVisible();i===n&&o===t.objects.optProperty(this.status,"message")||(e.log.debug("_updateStatus statusVisible="+n),this.$status.setVisible(n),this.status?this._setStatusMessage(this.status.message):this.$status.text(""),this.htmlComp.invalidateLayoutTree())},t.ProposalChooser.prototype._setStatusMessage=function(e){t.Status.animateStatusMessage(this.$status,e)},t.ProposalChooser.prototype._renderButton=function(e,i){var o=t.create("RadioButton",{parent:this.activeFilterGroup,label:this.activeFilterLabels[i],radioValue:t.ProposalChooser.ACTIVE_FILTER_VALUES[i],selected:this.activeFilter===e,focusWhenSelected:!1,gridData:{x:i,y:1,useUiWidth:!0}});o.on("propertyChange",function(t){t.changedProperties.indexOf("selected")!==-1&&t.newProperties.selected===!0&&this._onActiveFilterChanged(t.source.radioValue)}.bind(this)),this.activeFilterGroup.addButton(o)},t.ProposalChooser.prototype._onActiveFilterChanged=function(t){this._send("activeFilterChanged",{state:t})},t.ProposalChooser.prototype.setVirtual=function(e){this.model instanceof t.Table&&this.model.setVirtual(e)},t.ProposalChooserAdapter=function(){t.ProposalChooserAdapter.parent.call(this),this._addAdapterProperties(["model"])},t.inherits(t.ProposalChooserAdapter,t.ModelAdapter),
t.ProposalChooserAdapter.prototype._postCreateWidget=function(){this._injectSendFunction(),this.widget.model.on("rowClicked",this._onModelProposalSelected.bind(this))},t.ProposalChooserAdapter.prototype._modelAdapter=function(){return this.widget&&this.widget.model?this.widget.model.modelAdapter:null},t.ProposalChooserAdapter.prototype._onModelProposalSelected=function(t){this.widget.owner.proposalSelected()},t.ProposalChooserAdapter.prototype._injectSendFunction=function(){var i=this._modelAdapter();if(i){var o=t.objects.mandatoryFunction(i,"_send"),n=function(t,n,r){var s=e.extend({},r);s.showBusyIndicator=!1,o.call(i,t,n,s)};i._send=n}},t.ProposalChooserAdapter.prototype._syncModel=function(t){this._injectSendFunction()},t.ProposalChooserLayout=function(e){t.ProposalChooserLayout.parent.call(this),this._proposalChooser=e,this._typeHandler=this._createTypeHandler(e)},t.inherits(t.ProposalChooserLayout,t.AbstractLayout),t.ProposalChooserLayout.TYPE_HANDLER={TABLE:{_table:null,_fillerWidth:null,cssSelector:".table",prepare:function(t,e){this._table=e._proposalChooser.model},cssBackup:function(t,e){var i=t.css(e);t.css(e,"").data("backup"+e,i)},cssRestore:function(t,e){var i="backup"+e,o=t.data(i);t.css(e,o).removeData(i)},modifyTableData:function(t){var i=this;this._table.$rows().each(function(){var o=e(this);t(o,"width"),i._table.$cellsForRow(o).each(function(){var i=e(this);t(i,"min-width"),t(i,"max-width")})})},modifyDom:function(t){this._table.$container.css("display","inline-block").css("width","auto").css("height","auto"),this._table.$data.css("display","inline-block"),this.modifyFiller(this._table.$fillBefore),this.modifyFiller(this._table.$fillAfter),this.modifyTableData(this.cssBackup)},modifyFiller:function(t){t&&(this._fillerWidth=t.css("width"),t.css("width",""))},restoreDom:function(t){this._table.$container.css("display","block").css("width","100%").css("height","100%"),this._table.$data.css("display","block"),this.restoreFiller(this._table.$fillBefore),this.restoreFiller(this._table.$fillAfter),this.modifyTableData(this.cssRestore)},restoreFiller:function(t){t&&t.css("width",this._fillerWidth)}},TREE:{_tree:null,cssSelector:".tree",prepare:function(t,e){this._tree=e._proposalChooser.model;var i=this._tree.$data.children(".tree-node").removeClass("first last");i.first().addClass("first"),i.last().addClass("last")},modifyDom:function(t){this._tree.$container.css("display","inline-block").css("width","auto").css("height","auto"),this._tree.$data.css("display","inline-block")},restoreDom:function(t){this._tree.$container.css("display","block").css("width","100%").css("height","100%"),this._tree.$data.css("display","block")}}},t.ProposalChooserLayout.prototype._createTypeHandler=function(e){var i=e.model.objectType.toUpperCase(),o=t.ProposalChooserLayout.TYPE_HANDLER[i];if(!o)throw new Error("No type handler defined for type="+i);return o},t.ProposalChooserLayout.prototype.layout=function(e){var i,o=t.HtmlComponent.get(e),n=t.HtmlComponent.get(e.children(this._typeHandler.cssSelector)),r=o.getSize().subtract(o.getInsets()),s=this._proposalChooser.$status,a=s&&s.isVisible(),l=this._proposalChooser.activeFilterGroup;a&&(r.height-=t.graphics.getSize(s).height),l&&(i=l.htmlComp.getPreferredSize(),r.height-=i.height),(a||l)&&(n.pixelBasedSizing=!0),n.setSize(r),l&&l.htmlComp.setSize(new t.Dimension(r.width,i.height))},t.ProposalChooserLayout.prototype.preferredLayoutSize=function(e){var i,o,n,r,s,a,l,h=this._proposalChooser.htmlComp,d=this._proposalChooser.$status,p=this._proposalChooser.activeFilterGroup,u=this._proposalChooser.session.detachHelper;return this._typeHandler.prepare(e,this),n=this._proposalChooser.model.htmlComp.getPreferredSize(),o=n,u._storeScrollPositions(e),a=e.css("width"),l=e.css("height"),this._typeHandler.modifyDom(e),e.css("display","inline-block").css("width","auto").css("height","auto"),n.width=t.graphics.prefSize(e,{restoreScrollPositions:!1}).width,this._typeHandler.restoreDom(e),e.css("display","block").css("width",a).css("height",l),u._restoreScrollPositions(e),d&&d.isVisible()&&(i=d.css("display"),d.css("display","inline-block"),r=t.graphics.prefSize(d,{includeMargin:!0,useCssSize:!0}),d.css("display",i),o=new t.Dimension(Math.max(o.width,r.width),o.height+r.height)),p&&(s=p.htmlComp.getPreferredSize(),o=new t.Dimension(Math.max(o.width,s.width),o.height+s.height)),e.toggleClass("empty",0===n.height),o.add(h.getInsets())},t.SmartFieldMultiline=function(){t.SmartFieldMultiline.parent.call(this),this.options,this._$multilineField},t.inherits(t.SmartFieldMultiline,t.SmartField),t.SmartFieldMultiline.prototype._render=function(e){var i,o;this.addContainer(e,"smart-field",new t.SmartFieldLayout(this)),this.addLabel(),this.addFieldContainer(e.makeDiv()),o=t.HtmlComponent.install(this.$fieldContainer,this.session),o.setLayout(new t.SmartFieldMultilineLayout),i=t.fields.makeInputOrDiv(this,"multiline").click(this._onClick.bind(this)).appendTo(this.$fieldContainer),this.touch||i.blur(this._onFieldBlur.bind(this)).focus(this._onFocus.bind(this)).keyup(this._onKeyUp.bind(this)).keydown(this._onKeyDown.bind(this)),this.addField(i),this._$multilineField=this.$fieldContainer.appendDiv("multiline-field"),this.embedded||this.addMandatoryIndicator(),this.addIcon(this.$fieldContainer),this.addStatus()},t.SmartFieldMultiline.prototype._renderDisplayText=function(){var e=this.displayText.split("\n"),i=e.shift(),o=t.arrays.formatEncoded(e,"<br/>");t.fields.valOrText(this,this.$field,i),this._$multilineField.html(o)},t.SmartFieldMultiline.prototype._getInputBounds=function(){var e=t.graphics.offsetBounds(this.$fieldContainer),i=t.graphics.offsetBounds(this.$field);return e.height=i.height,e},t.SmartFieldMultiline.prototype._readDisplayText=function(){var e,i=t.fields.valOrText(this,this.$field),o=[i],n=this.displayText.split("\n");for(e=1;e<n.length;e++)o.push(n[e]);return o.join("\n")},t.SmartFieldMultiline.prototype._readSearchText=function(){return t.fields.valOrText(this,this.$field)},t.SmartFieldMultilineAdapter=function(){t.SmartFieldMultilineAdapter.parent.call(this)},t.inherits(t.SmartFieldMultilineAdapter,t.SmartFieldAdapter),t.SmartFieldMultilineLayout=function(){t.SmartFieldMultilineLayout.parent.call(this)},t.inherits(t.SmartFieldMultilineLayout,t.AbstractLayout),t.SmartFieldMultilineLayout.prototype.layout=function(e){var i=t.HtmlComponent.get(e),o=e.children(".multiline"),n=e.children(".multiline-field"),r=i.getAvailableSize().subtract(i.getInsets());o.cssHeight(t.HtmlEnvironment.formRowHeight),n.cssHeight(r.height-t.HtmlEnvironment.formRowHeight)},t.SplitBox=function(){t.SplitBox.parent.call(this),this._addAdapterProperties(["firstField","secondField","collapsibleField"]),this.fieldCollapsed=!1,this.collapsibleField,this.splitHorizontal,this._collapseKeyStroke,this._$splitArea,this._$splitter},t.inherits(t.SplitBox,t.CompositeField),t.SplitBox.SPLITTER_POSITION_TYPE_RELATIVE="relative",t.SplitBox.SPLITTER_POSITION_TYPE_ABSOLUTE_FIRST="absoluteFirst",t.SplitBox.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND="absoluteSecond",t.SplitBox.prototype._init=function(e){t.SplitBox.parent.prototype._init.call(this,e),this._syncCollapseKeyStroke(this.collapseKeyStroke),this._updateCollapseHandle()},t.SplitBox.prototype._render=function(e){function i(e){function i(e){if(e.clientX!==n.x||e.clientY!==n.y)if(n={x:e.clientX,y:e.clientY},this.splitHorizontal){var i=e.pageX-r.left,o=l.width/2;i<p?(i=0,o=0):s.width-i<p&&(i=s.width,o=l.width),h.cssLeft(i-o),d=i-o-t.HtmlEnvironment.fieldMandatoryIndicatorWidth,this.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_RELATIVE?d/=s.width-l.width-t.HtmlEnvironment.fieldMandatoryIndicatorWidth:this.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND&&(d=s.width-d-l.width)}else{var a=e.pageY-r.top,u=l.height/2;a<p?(a=0,u=0):s.height-a<p&&(a=s.height,u=l.height),h.cssTop(a-u),d=a,this.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_RELATIVE?d/=s.height:this.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND&&(d=s.height-d-l.height)}}function o(t){1===t.which&&(this._$window.off("mousemove.splitbox").off("mouseup.splitbox"),h&&(this._$body.removeClass(this.splitHorizontal?"col-resize":"row-resize"),h.remove(),this._$splitter.removeClass("dragging"),this.newSplitterPosition(d),this.rendered&&this.htmlSplitArea.validateLayout()))}if(1===e.which){if(this.splitterEnabled){var n={x:e.clientX,y:e.clientY};this._$window.on("mousemove.splitbox",i.bind(this)).on("mouseup.splitbox",o.bind(this)),this._$body.addClass(this.splitHorizontal?"col-resize":"row-resize");var r=this._$splitArea.offset(),s=t.graphics.getSize(this._$splitArea,!0),a=this._$splitter.offset(),l=t.graphics.getSize(this._$splitter,!0),h=this._$splitArea.appendDiv("temp-splitter").addClass(this.splitHorizontal?"x-axis":"y-axis");this.splitHorizontal?h.cssLeft(a.left-r.left):h.cssTop(a.top-r.top),this._$splitter.addClass("dragging")}var d=this.splitterPosition,p=25;return!1}}function o(t){t.changedProperties.indexOf("visible")!==-1&&this.htmlSplitArea.invalidateLayoutTree(!1)}this.addContainer(e,"split-box"),this._$splitArea=e.makeDiv("split-area"),this.addField(this._$splitArea),this.htmlSplitArea=t.HtmlComponent.install(this._$splitArea,this.session),this.htmlSplitArea.setLayout(new t.SplitBoxLayout(this)),this._$window=e.window(),this._$body=e.body(),this.firstField&&(this.firstField.render(this._$splitArea),this.firstField.$container.addClass("first-field").addClass(this.splitHorizontal?"x-axis":"y-axis"),this.firstField.on("propertyChange",o.bind(this)),this.secondField&&(this._$splitter=this._$splitArea.appendDiv("splitter").addClass(this.splitHorizontal?"x-axis":"y-axis").on("mousedown",i.bind(this)),this.secondField.render(this._$splitArea),this.secondField.$container.addClass("second-field").addClass(this.splitHorizontal?"x-axis":"y-axis"),this.secondField.on("propertyChange",o.bind(this))))},t.SplitBox.prototype._renderProperties=function(){t.SplitBox.parent.prototype._renderProperties.call(this),this._renderSplitterPosition(),this._renderSplitterEnabled(),this._renderCollapsibleField(),this._renderCollapseHandle()},t.SplitBox.prototype._syncSplitterPosition=function(t){this._setProperty("splitterPosition",t),this._oldSplitterPositionType=null},t.SplitBox.prototype._renderSplitterPosition=function(){this.newSplitterPosition(this.splitterPosition)},t.SplitBox.prototype._syncSplitterPositionType=function(t){this.rendered&&!this._oldSplitterPositionType&&(this._oldSplitterPositionType=this.splitterPositionType),this._setProperty("splitterPositionType",t)},t.SplitBox.prototype._renderSplitterPositionType=function(){if(this._oldSplitterPositionType){var e=this.htmlSplitArea.getSize(),i=this.splitterPosition,o=t.graphics.getVisibleSize(this._$splitter,!0),n=0;n=this.splitHorizontal?e.width-o.width:e.height-o.height;var r=this._oldSplitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_RELATIVE,s=this.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_RELATIVE,a=!r,l=!s;r&&l?i=this.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND?n-n*i:n*i:a&&s?this._oldSplitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND?i=(n-i)/n:i/=n:a&&l&&(i=n-i),this._oldSplitterPositionType=null,this.newSplitterPosition(i)}},t.SplitBox.prototype._renderSplitterEnabled=function(){this._$splitter&&this._$splitter.setEnabled(this.splitterEnabled)},t.SplitBox.prototype.setFieldCollapsed=function(t){this.setProperty("fieldCollapsed",t),this._updateCollapseHandleButtons()},t.SplitBox.prototype._renderFieldCollapsed=function(){this._renderCollapsibleField()},t.SplitBox.prototype.setCollapsibleField=function(t){this.setProperty("collapsibleField",t),this._updateCollapseHandle()},t.SplitBox.prototype._updateCollapseHandle=function(){this.collapseKeyStroke&&this.unregisterKeyStrokes(this.collapseKeyStroke),this.collapsibleField?(this._collapseHandle||(this._collapseHandle=t.create("CollapseHandle",{parent:this}),this._collapseHandle.on("action",this.toggleFieldCollapsed.bind(this)),this.collapseKeyStroke&&this.registerKeyStrokes(this.collapseKeyStroke)),this._updateCollapseHandleButtons()):this._collapseHandle&&(this._collapseHandle.destroy(),this._collapseHandle=null)},t.SplitBox.prototype._updateCollapseHandleButtons=function(){var t,e,i=this.fieldCollapsed;this.collapsibleField===this.firstField?(t=!i,e=i):(t=i,e=!i),this._collapseHandle.setLeftVisible(t),this._collapseHandle.setRightVisible(e)},t.SplitBox.prototype._renderCollapsibleField=function(){this.firstField&&this.firstField.$container.removeClass("collapsed"),this.secondField&&this.secondField.$container.removeClass("collapsed"),this.collapsibleField&&this.fieldCollapsed&&this.collapsibleField.$container.addClass("collapsed"),this.rendered&&this.htmlSplitArea.invalidateLayoutTree(!1)},t.SplitBox.prototype._syncCollapseKeyStroke=function(e){e&&(this.collapseKeyStroke instanceof t.KeyStroke&&this.unregisterKeyStrokes(this.collapseKeyStroke),this.collapseKeyStroke=new t.SplitBoxCollapseKeyStroke(this,e),this._collapseHandle&&this.registerKeyStrokes(this.collapseKeyStroke))},t.SplitBox.prototype._renderCollapseHandle=function(){this._collapseHandle&&this._collapseHandle.render(this.$container)},t.SplitBox.prototype.newSplitterPosition=function(e){e=this.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_RELATIVE?Math.max(0,Math.min(1,e)):Math.max(0,e);var i=this.splitterPosition!==e;this.splitterPosition=e,i&&this.trigger("positionChange",{position:e}),this.htmlSplitArea.invalidateLayoutTree(!1)},t.SplitBox.prototype.toggleFieldCollapsed=function(){this.setFieldCollapsed(!this.fieldCollapsed)},t.SplitBox.prototype.getFields=function(){var t=[];return this.firstField&&t.push(this.firstField),this.secondField&&t.push(this.secondField),t},t.SplitBoxAdapter=function(){t.SplitBoxAdapter.parent.call(this),this._addAdapterProperties(["firstField","secondField","collapsibleField"]),this._addRemoteProperties(["collapsibleField","fieldCollapsed"])},t.inherits(t.SplitBoxAdapter,t.CompositeFieldAdapter),t.SplitBoxAdapter.prototype._onWidgetPositionChange=function(t){this._send("setSplitterPosition",{splitterPosition:t.position})},t.SplitBoxAdapter.prototype._onWidgetEvent=function(e){"positionChange"===e.type?this._onWidgetPositionChange(e):t.SplitBoxAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.SplitBoxCollapseKeyStroke=function(e,i){t.SplitBoxCollapseKeyStroke.parent.call(this),this.field=e,this.parseAndSetKeyStroke(i)},t.inherits(t.SplitBoxCollapseKeyStroke,t.KeyStroke),t.SplitBoxCollapseKeyStroke.prototype.handle=function(t){this.field.toggleFieldCollapsed()},t.SplitBoxCollapseKeyStroke.prototype._postRenderKeyBox=function(t,e){var i,o=this.field._collapseHandle.$container;e.addClass("split-box-collapse-key-box"),i=o.offsetTo(this.field.$container),e.cssLeft(i.left-e.outerWidth()).cssTop(i.top)},t.SplitBoxLayout=function(e){t.SplitBoxLayout.parent.call(this),this._splitBox=e},t.inherits(t.SplitBoxLayout,t.AbstractLayout),t.SplitBoxLayout.prototype.layout=function(e){var i=t.HtmlComponent.get(e),o=e.children(".splitter"),n=e.children(".form-field"),r=t.HtmlComponent.optGet(n.eq(0)),s=t.HtmlComponent.optGet(n.eq(1)),a=this._splitBox.splitHorizontal;o.removeClass("hidden");var l,h,d,p,u=t.graphics.getVisibleSize(o,!0),c=i.getAvailableSize().subtract(i.getInsets()),f=r&&r.isVisible(),y=s&&s.isVisible(),g=f&&y,m=!g&&(f||y),_=this._splitBox.splitterPosition,b=new t.Dimension(c);if(g&&(a?b.width-=u.width:b.height-=u.height),g)l=new t.Dimension(b),h=new t.Dimension(b),a?this._splitBox.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_RELATIVE?(l.width*=_,h.width*=1-_):(_=Math.min(_,b.width),this._splitBox.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND?(l.width=b.width-_,h.width=_):(l.width=_,h.width=b.width-_)):this._splitBox.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_RELATIVE?(l.height*=_,h.height*=1-_):(_=Math.min(_,b.height),this._splitBox.splitterPositionType===t.SplitBox.SPLITTER_POSITION_TYPE_ABSOLUTE_SECOND?(l.height=b.height-_,h.height=_):(l.height=_,h.height=b.height-_)),l=l.subtract(r.getMargins()),h=h.subtract(s.getMargins()),d=new t.Rectangle(0,0,l.width,l.height),p=new t.Rectangle(0,0,h.width,h.height),a?(o.cssLeft(d.width),p.x=d.width+u.width):(o.cssTop(d.height),p.y=d.height+u.height),r.setBounds(d),s.setBounds(p);else{if(m){var v=f?r:s,C=c.subtract(v.getMargins());v.setBounds(new t.Rectangle(0,0,C.width,C.height))}o.addClass("hidden")}if(this._splitBox._collapseHandle){var w,T=this._splitBox._collapseHandle.$container,S=t.graphics.getSize(T);w=this._splitBox.collapsibleField===this._splitBox.firstField?f?d.width-S.width:0:y?c.width-p.width:c.width-S.width;var x=new t.Point(w,c.height-S.height);t.graphics.setLocation(T,x)}},t.SplitBoxLayout.prototype.preferredLayoutSize=function(e){var i=t.HtmlComponent.get(e),o=e.children(".splitter"),n=e.children(".form-field"),r=t.HtmlComponent.optGet(n.eq(0)),s=t.HtmlComponent.optGet(n.eq(1)),a=this._splitBox.splitHorizontal,l=t.graphics.getVisibleSize(o,!0),h=new t.Dimension(0,0);r&&(h=r.getPreferredSize().add(r.getMargins()));var d=new t.Dimension(0,0);s&&(d=s.getPreferredSize().add(s.getMargins()));var p;return p=a?new t.Dimension(h.width+d.width+l.width,Math.max(h.height,d.height)):new t.Dimension(Math.max(h.width,d.width),h.height+d.height+l.height),p=p.add(i.getInsets())},t.StringField=function(){t.StringField.parent.call(this),this.inputMasked=!1,this.multilineText=!1,this.updateDisplayTextOnModify=!1,this.maxLength=4e3,this._onSelectionChangingActionHandler=this._onSelectionChangingAction.bind(this)},t.inherits(t.StringField,t.BasicField),t.StringField.FORMAT={LOWER:"a",UPPER:"A"},t.StringField.TRIM_REGEXP=new RegExp("^(\\s*)(.*?)(\\s*)$"),t.StringField.prototype._initKeyStrokeContext=function(){t.StringField.parent.prototype._initKeyStrokeContext.call(this),this.keyStrokeContext.registerKeyStroke([new t.StringFieldEnterKeyStroke(this),new t.StringFieldCtrlEnterKeyStroke(this)])},t.StringField.prototype._createKeyStrokeContext=function(){return new t.InputFieldKeyStrokeContext},t.StringField.prototype._render=function(e){this.addContainer(e,"string-field"),this.addLabel(),this.addMandatoryIndicator();var i;if(this.multilineText){var o=function(){this.mouseClicked=!0}.bind(this);i=e.makeElement("<textarea>").on("DOMMouseScroll mousewheel",function(t){t.stopPropagation()}).on("mousedown",o).on("focus",function(t){this.$field.off("mousedown",o),this.mouseClicked||setTimeout(function(){this.rendered&&(this._renderSelectionStart(),this._renderSelectionEnd())}.bind(this)),this.mouseClicked=!1}.bind(this)).on("focusout",function(){this.$field.on("mousedown",o)}.bind(this))}else i=t.fields.makeTextField(e);i.on("blur",this._onFieldBlur.bind(this)),this.addField(i),this.addStatus()},t.StringField.prototype._onFieldBlur=function(){t.StringField.parent.prototype._onFieldBlur.call(this),this.multilineText&&this._updateSelection()},t.StringField.prototype._renderProperties=function(){t.StringField.parent.prototype._renderProperties.call(this),this._renderInputMasked(),this._renderWrapText(),this._renderFormat(),this._renderSpellCheckEnabled(),this._renderHasAction(),this._renderMaxLength(),this._renderSelectionTrackingEnabled(),this._renderDropType()},t.StringField.prototype._renderMaxLength=function(){this.$field[0].maxLength?this.$field.attr("maxlength",this.maxLength):this.$field.on("keyup paste",function(t){setTimeout(function(){var t=this.$field.val();t.length>this.maxLength&&this.$field.val(t.slice(0,this.maxLength))}.bind(this),0)}.bind(this))},t.StringField.prototype._renderSelectionStart=function(){null!==t.nvl(this.selectionStart,null)&&(this.$field[0].selectionStart=this.selectionStart)},t.StringField.prototype._renderSelectionEnd=function(){null!==t.nvl(this.selectionEnd,null)&&(this.$field[0].selectionEnd=this.selectionEnd)},t.StringField.prototype._renderSelectionTrackingEnabled=function(){this.$field.off("select",this._onSelectionChangingActionHandler).off("mousedown",this._onSelectionChangingActionHandler).off("keydown",this._onSelectionChangingActionHandler).off("input",this._onSelectionChangingActionHandler),this.selectionTrackingEnabled&&this.$field.on("select",this._onSelectionChangingActionHandler).on("mousedown",this._onSelectionChangingActionHandler).on("keydown",this._onSelectionChangingActionHandler).on("input",this._onSelectionChangingActionHandler)},t.StringField.prototype._renderInputMasked=function(){this.multilineText||this.$field.attr("type",this.inputMasked?"password":"text")},t.StringField.prototype._renderHasAction=function(){this.hasAction?(this.$container.addClass("has-action"),this.addIcon(),this.invalidateLayoutTree(!1)):this.$icon&&(this.$icon.remove(),this.$container.removeClass("has-action"))},t.StringField.prototype._renderFormat=function(){this.format===t.StringField.FORMAT.LOWER?this.$field.css("text-transform","lowercase"):this.format===t.StringField.FORMAT.UPPER&&this.$field.css("text-transform","uppercase")},t.StringField.prototype._renderSpellCheckEnabled=function(){this.spellCheckEnabled?this.$field.attr("spellcheck","true"):this.$field.attr("spellcheck","false")},t.StringField.prototype._renderDisplayText=function(){var e=t.strings.nvl(this.displayText),i=t.strings.nvl(this.$field.val()),o=this._getSelection();if(t.StringField.parent.prototype._renderDisplayText.call(this),this.trimText&&i!==e){var n=i.match(t.StringField.TRIM_REGEXP);n&&n[2]===e&&this._setSelection({start:Math.max(o.start-n[1].length,0),end:Math.min(o.end-n[1].length,e.length)})}},t.StringField.prototype._renderInsertText=function(){if(this.insertText){var e=this.$field.val();if(this.insertText.length+e.length>this.maxLength)return void t.create("DesktopNotification",{parent:this,id:t.numbers.randomId(),desktop:this.session.desktop,duration:3e3,status:{message:this.session.text("ui.CannotInsertTextTooLong"),severity:t.Status.Severity.WARNING}}).show();var i=this._getSelection();e=e.slice(0,i.start)+this.insertText+e.slice(i.end),this.$field.val(e),this._setSelection(i.start+this.insertText.length),this.updateDisplayTextOnModify&&this.acceptInput(!0),this.acceptInput()}},t.StringField.prototype._renderWrapText=function(){this.$field.attr("wrap",this.wrapText?"soft":"off")},t.StringField.prototype._renderTrimText=function(){},t.StringField.prototype._renderGridData=function(){t.StringField.parent.prototype._renderGridData.call(this),this.updateInnerAlignment({useHorizontalAlignment:!this.multilineText})},t.StringField.prototype._onIconClick=function(e){this.acceptInput(),t.StringField.parent.prototype._onIconClick.call(this,e),this.trigger("action")},t.StringField.prototype._onSelectionChangingAction=function(t){"mousedown"===t.type?this.$field.window().one("mouseup.stringfield",function(){setTimeout(this._updateSelection.bind(this))}.bind(this)):"keydown"===t.type?setTimeout(this._updateSelection.bind(this)):this._updateSelection()},t.StringField.prototype._getSelection=function(){var e=t.nvl(this.$field[0].selectionStart,null),i=t.nvl(this.$field[0].selectionEnd,null);return null!==e&&null!==i||(e=0,i=0),{start:e,end:i}},t.StringField.prototype._setSelection=function(e,i){"number"==typeof e?i=t.nvl(i,e):"object"==typeof e&&(i=e.end,e=e.start),this.$field[0].selectionStart=e,this.$field[0].selectionEnd=i,this._updateSelection()},t.StringField.prototype._updateSelection=function(){var t=this.selectionStart,e=this.selectionEnd;if(this.selectionStart=this.$field[0].selectionStart,this.selectionEnd=this.$field[0].selectionEnd,this.selectionTrackingEnabled){var i=this.selectionStart!==t||this.selectionEnd!==e;i&&this.triggerSelectionChange()}},t.StringField.prototype.triggerSelectionChange=function(){this.trigger("selectionChange",{selectionStart:this.selectionStart,selectionEnd:this.selectionEnd})},t.StringField.prototype._validateValue=function(e){return this.trimText&&(e=e.trim()),t.StringField.parent.prototype._validateValue(e)},t.StringField.prototype._updateEmpty=function(){this.empty=t.strings.empty(this.value)},t.StringFieldAdapter=function(){t.StringFieldAdapter.parent.call(this)},t.inherits(t.StringFieldAdapter,t.BasicFieldAdapter),t.StringFieldAdapter.prototype._onWidgetSelectionChange=function(t){this._send("selectionChanged",{selectionStart:t.selectionStart,selectionEnd:t.selectionEnd},{delay:500,coalesce:function(t){return this.id===t.id&&this.type===t.type}})},t.StringFieldAdapter.prototype._onWidgetAction=function(t){this._send("callAction")},t.StringFieldAdapter.prototype._onWidgetEvent=function(e){"selectionChange"===e.type?this._onWidgetSelectionChange(e):"action"===e.type?this._onWidgetAction(e):t.StringFieldAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.StringFieldEnterKeyStroke=function(e){t.StringFieldEnterKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.ENTER],this.renderingHints.render=!1,this.preventDefault=!1},t.inherits(t.StringFieldEnterKeyStroke,t.KeyStroke),t.StringFieldEnterKeyStroke.prototype._applyPropagationFlags=function(e){t.StringFieldEnterKeyStroke.parent.prototype._applyPropagationFlags.call(this,e);var i=this.field.$container.activeElement(!0);this.preventInvokeAcceptInputOnActiveValueField=!e.isPropagationStopped()&&"textarea"===i.tagName.toLowerCase(),this.preventInvokeAcceptInputOnActiveValueField&&e.stopPropagation()},t.StringFieldEnterKeyStroke.prototype.handle=function(t){},t.StringFieldCtrlEnterKeyStroke=function(e){t.StringFieldCtrlEnterKeyStroke.parent.call(this),this.field=e,this.which=[t.keys.ENTER],this.ctrl=!0},t.inherits(t.StringFieldCtrlEnterKeyStroke,t.KeyStroke),t.StringFieldCtrlEnterKeyStroke.prototype._accept=function(e){var i=t.StringFieldCtrlEnterKeyStroke.parent.prototype._accept.call(this,e);return i&&this.field.hasAction},t.StringFieldCtrlEnterKeyStroke.prototype.handle=function(t){this.field._onIconClick()},t.TabAreaLayout=function(e){t.TabAreaLayout.parent.call(this),this._tabBox=e,this._$ellipsis,this._overflowTabs=[]},t.inherits(t.TabAreaLayout,t.AbstractLayout),t.TabAreaLayout.prototype.layout=function(i){this._ellipsisBounds||(this._createAndRenderEllipsis(i),this._ellipsisBounds=t.graphics.bounds(this._$ellipsis,!0,!0)),this._destroyEllipsis(),this._tabBox.rebuildTabs();var o,n=i[0],r=n.clientWidth-t.graphics.getInsets(i).horizontal(),s=n.scrollWidth,a=this._tabBox.menuBar,l=this._tabBox.$status,h=0,d=this._tabBox.statusPosition;if(r-=t.graphics.getSize(a.$container,!0).width,d===t.FormField.STATUS_POSITION_TOP&&(l&&l.isVisible()&&(h=l.outerWidth(!0)),h>0&&(r-=h,a.$container.cssRight(h))),this._overflowTabs=[],r<s){var p,u,c,f=[],y=[],g=[],m=-1;for(p=0;p<this._tabBox.tabItems.length;p++)u=this._tabBox.tabItems[p],u.visible&&(o=t.graphics.bounds(u.$tabContainer,!0,!0),f.push(u),y.push(o),u._tabActive&&(m=f.length-1));if(c=f.length,m>=0){if(g.push(m),o=y[m],r>o.width){var _=t.graphics.getInsets(i).horizontal(),b=o.width,v=o.x-_,C=!1;if(m<c-1)for(p=m+1;p<c;p++)o=y[p],b=o.x-v+o.width+this._ellipsisBounds.width,b<r?g.push(p):C=!0;if(!C&&m>0)for(p=m-1;p>=0;p--)o=y[p],b+v-o.x<r&&g.push(p)}for(p=0;p<c;p++)u=f[p],g.indexOf(p)===-1&&(e.log.debug("Overflow tab="+u),this._overflowTabs.push(u),u.removeTab())}}this._overflowTabs.length>0&&this._createAndRenderEllipsis(i)},t.TabAreaLayout.prototype._createAndRenderEllipsis=function(t){this._$ellipsis=t.appendDiv("overflow-tab-item").click(this._onClickEllipsis.bind(this))},t.TabAreaLayout.prototype._destroyEllipsis=function(){this._$ellipsis&&(this._$ellipsis.remove(),this._$ellipsis=null)},t.TabAreaLayout.prototype._onClickEllipsis=function(i){var o,n,r=[],s=this._tabBox;this._overflowTabs.forEach(function(i){o=t.create("Menu",{parent:s,text:i.label,tabItem:i,visible:i.visible}),o.on("doAction",function(t){e.log.debug("(TabAreaLayout#_onClickEllipsis) tabItem="+i),s._syncSelectedTab(i),n.one("remove",function(t){i.session.focusManager.requestFocus(i.$tabContainer)})}),r.push(o)}),n=t.create("ContextMenuPopup",{parent:s,menuItems:r,cloneMenuItems:!1,location:{x:i.pageX,y:i.pageY}}),n.open()},t.TabBox=function(){t.TabBox.parent.call(this),this._addAdapterProperties(["tabItems","selectedTab"]),this._addPreserveOnPropertyChangeProperties(["selectedTab"]),this.selectedTab,this._$tabArea,this._$tabContent,this._tabItemPropertyChangeHandler=function(e){var i=e.changedProperties.length;1===i&&"enabled"===e.changedProperties[0]||i>0&&t.HtmlComponent.get(this._$tabArea).invalidateLayoutTree()}.bind(this)},t.inherits(t.TabBox,t.CompositeField),t.TabBox.prototype._init=function(e){t.TabBox.parent.prototype._init.call(this,e),this.selectedTab&&this.selectedTab.setTabActive(!0),this.menuBar=t.create("MenuBar",{parent:this,menuOrder:new t.GroupBoxMenuItemsOrder}),this._updateMenuBar(this.menus)},t.TabBox.prototype._render=function(e){this.addContainer(e,"tab-box",new t.TabBoxLayout(this)),this._$tabArea=this.$container.appendDiv("tab-area").on("keydown",this._onKeyDown.bind(this)),this.addStatus();var i=t.HtmlComponent.install(this._$tabArea,this.session);i.setLayout(new t.TabAreaLayout(this)),this.menuBar.render(this._$tabArea),this._$tabContent=this.$container.appendDiv("tab-content");var o=t.HtmlComponent.install(this._$tabContent,this.session);o.setLayout(new t.SingleLayout)},t.TabBox.prototype._renderProperties=function(){t.TabBox.parent.prototype._renderProperties.call(this),this._renderTabs(),this._renderTabContent()};t.TabBox.prototype._remove=function(){t.TabBox.parent.prototype._remove.call(this),this._removeTabs(),this._removeTabContent()};t.TabBox.prototype._renderTabs=function(){this.tabItems.forEach(function(t){t.renderTab(this._$tabArea),t.on("propertyChange",this._tabItemPropertyChangeHandler)},this)},t.TabBox.prototype._removeTabs=function(){this.tabItems.forEach(function(t){t.removeTab(),t.off("propertyChange",this._tabItemPropertyChangeHandler)},this)},t.TabBox.prototype._removeTabContent=function(){this.tabItems.forEach(function(t){t.remove()},this)},t.TabBox.prototype.rebuildTabs=function(){var t=e(document.activeElement),i=null;t.is(".tab-item")&&(i=t.data("tabItem")),this.tabItems.forEach(function(t){t._tabRendered&&t.removeTab()},this),this._renderTabs(),i&&this.session.focusManager.requestFocus(i.$tabContainer)},t.TabBox.prototype.selectTabById=function(t){var e=this.getTabItem(t);if(!e)throw new Error("Tab with ID '"+t+"' does not exist");this.setSelectedTab(e)},t.TabBox.prototype.setSelectedTab=function(t){this.setProperty("selectedTab",t)},t.TabBox.prototype._syncSelectedTab=function(i,o){if(this.selectedTab!==i){e.log.debug("(TabBox#_selectTab) tab="+i);var n=this.selectedTab,r=i;n&&n.setTabActive(!1),r&&r.setTabActive(!0),this._setProperty("selectedTab",r),this.rendered&&(this.selectedTab&&this.selectedTab._tabRendered||t.HtmlComponent.get(this._$tabArea).revalidateLayoutTree(),this.selectedTab&&this.selectedTab.focusTab(),n&&n.detach(),this._renderTabContent())}},t.TabBox.prototype._onKeyDown=function(e){var i=e.which===t.keys.LEFT||e.which===t.keys.RIGHT;if(!i)return!0;e.preventDefault(),e.stopPropagation();var o=this._getNextVisibleTabForKeyStroke(e.which);o&&o._tabRendered&&this.setSelectedTab(o)},t.TabBox.prototype._getNextVisibleTabForKeyStroke=function(e){for(var i,o=e===t.keys.LEFT?-1:1,n=this.tabItems.indexOf(this.selectedTab)+o;n>=0&&n<this.tabItems.length;){if(i=this.tabItems[n],i.visible)return i;n+=o}return null},t.TabBox.prototype._renderTabContent=function(){var e=this.selectedTab;e&&(e.rendered&&!e.attached?e.attach():e.render(this._$tabContent)),this.rendered&&t.HtmlComponent.get(this._$tabContent).revalidateLayoutTree()},t.TabBox.prototype._syncMenus=function(e){t.TabBox.parent.prototype._syncMenus.call(this,e),this.menuBar&&this._updateMenuBar(e)},t.TabBox.prototype._removeMenus=function(){},t.TabBox.prototype._updateMenuBar=function(e){var i=t.menus.filter(this.menus,["TabBox.Header"]);this.menuBar.setMenuItems(i)},t.TabBox.prototype._renderStatusPosition=function(){this.statusPosition===t.FormField.STATUS_POSITION_TOP?this.$status.appendTo(this._$tabArea):this.$status.appendTo(this.$container),
this.invalidateLayoutTree()},t.TabBox.prototype.getFields=function(){return this.tabItems},t.TabBox.prototype.getTabItem=function(e){return t.arrays.find(this.tabItems,function(t){return t.id===e})},t.TabBoxAdapter=function(){t.TabBoxAdapter.parent.call(this),this._addAdapterProperties(["tabItems","selectedTab"]),this._addRemoteProperties(["selectedTab"])},t.inherits(t.TabBoxAdapter,t.CompositeFieldAdapter),t.TabBoxAdapter.prototype.exportAdapterData=function(e){return e=t.TabBoxAdapter.parent.prototype.exportAdapterData.call(this,e),delete e.selectedTab,e},t.TabBoxLayout=function(e){t.TabBoxLayout.parent.call(this),this._tabBox=e,this._statusWidth=t.HtmlEnvironment.fieldStatusWidth},t.inherits(t.TabBoxLayout,t.AbstractLayout),t.TabBoxLayout.prototype.layout=function(e){var i,o,n,r,s=t.HtmlComponent.get(e),a=t.HtmlComponent.get(this._tabBox._$tabContent),l=t.HtmlComponent.get(this._tabBox._$tabArea),h=0,d=0,p=new t.Dimension,u=this._tabBox.$status,c=this._tabBox.statusPosition;i=s.getAvailableSize().subtract(s.getInsets()),l.isVisible()&&(n=l.getMargins(),d=l.getPreferredSize().height,h=i.subtract(n).width,u&&u.isVisible()&&(this._layoutStatus(),c===t.FormField.STATUS_POSITION_DEFAULT&&(h-=u.outerWidth(!0))),r=new t.Dimension(h,d),l.setSize(r),p=r.add(n)),o=i.subtract(a.getMargins()),o.height-=p.height,a.setSize(o)},t.TabBoxLayout.prototype._layoutStatus=function(){var e=this._tabBox.htmlComp,i=e.getInsets({includeBorder:!1}),o=i.top,n=i.right,r=this._tabBox._$tabArea,s=r.innerHeight(),a=this._tabBox.$status,l=t.graphics.getMargins(a),h=o,d=this._tabBox.statusPosition,p=s-l.vertical();d===t.FormField.STATUS_POSITION_DEFAULT?h+=r.cssMarginTop():p-=a.cssBorderWidthY(),a.cssWidth(this._statusWidth).cssTop(h).cssRight(n).cssHeight(p).cssLineHeight(p)},t.TabBoxLayout.prototype.preferredLayoutSize=function(e){var i=t.HtmlComponent.get(e),o=t.HtmlComponent.get(this._tabBox._$tabContent),n=t.HtmlComponent.get(this._tabBox._$tabArea),r=new t.Dimension,s=new t.Dimension;return n.isVisible()&&(r=n.getPreferredSize().add(n.getMargins())),s=o.getPreferredSize().add(i.getInsets()).add(o.getMargins()),new t.Dimension(Math.max(r.width,s.width),s.height+r.height)},t.TabItem=function(){t.TabItem.parent.call(this),this.$tabContainer,this._tabRendered=!1,this._tabActive=!1,this.selectionKeystroke},t.inherits(t.TabItem,t.GroupBox),t.TabItem.prototype._init=function(e){t.TabItem.parent.prototype._init.call(this,e),this._syncStatusVisible(this.statusVisible),this._syncMenusVisible(this.menusVisible)},t.TabItem.prototype._removeCssClass=function(){this.$container&&t.TabItem.parent.prototype._removeCssClass.call(this),this.$tabContainer.removeClass(this.cssClass)},t.TabItem.prototype._renderCssClass=function(){this.$container&&t.TabItem.parent.prototype._renderCssClass.call(this),this.$tabContainer.addClass(this.cssClass)},t.TabItem.prototype._createLayout=function(){return new t.TabItemLayout(this)},t.TabItem.prototype.renderTab=function(e){if(this._tabRendered)throw new Error("Tab already rendered");this.$tabContainer=e.appendDiv("tab-item").data("tabItem",this).on("mousedown",this._onTabMouseDown.bind(this)),this.tabHtmlComp=t.HtmlComponent.install(this.$tabContainer,this.session),this.addLabel(),this.addStatus(),this._renderTabActive(),this._renderLabel(),this._renderMarked(),this._renderVisible(),this._renderCssClass(),this._renderTooltipText(),this._renderErrorStatus(),this._tabRendered=!0},t.TabItem.prototype._onTabMouseDown=function(t){return this._preventTabActivation?void(this._preventTabActivation=!1):(this.parent.setSelectedTab(this),void(this.session.focusManager.active||this.$tabContainer.focus()))},t.TabItem.prototype._onStatusMousedown=function(e){t.TabItem.parent.prototype._onStatusMousedown.call(this,e),this._preventTabActivation=!0,e.preventDefault()},t.TabItem.prototype.focusTab=function(){this._tabRendered&&this.session.focusManager.requestFocus(this.$tabContainer)},t.TabItem.prototype.setTabActive=function(t){var e=this._tabActive;this._tabActive=t,this._tabRendered&&e!==t&&this._renderTabActive()},t.TabItem.prototype._renderTabActive=function(){this.$tabContainer.select(this._tabActive),this.$tabContainer.setTabbable(this._tabActive&&!t.device.supportsTouch())},t.TabItem.prototype.removeTab=function(){this._tabRendered&&(this.$tabContainer.remove(),this.$tabContainer=null,this._removeStatus(),this._removeLabel(),this._tabRendered=!1)},t.TabItem.prototype.setMarked=function(t){if(this.marked!==t)return this._setProperty("marked",t),this._tabRendered&&this._renderMarked(),!1},t.TabItem.prototype._renderMarked=function(t){this.$tabContainer.toggleClass("marked",this.marked)},t.TabItem.prototype.setVisible=function(t){if(this.visible!==t)return this._setProperty("visible",t),this._tabRendered&&this._renderVisible(),!1},t.TabItem.prototype._renderVisible=function(){this.$container&&t.TabItem.parent.prototype._renderVisible.call(this),this.$tabContainer.setVisible(this.visible)},t.TabItem.prototype.setLabel=function(t){this.label!==t&&(this._setProperty("label",t),this._tabRendered&&this._renderLabel())},t.TabItem.prototype._renderLabel=function(){this.$label.textOrNbsp(this.label)},t.TabItem.prototype._renderLabelVisible=function(){t.TabItem.parent.prototype._renderLabelVisible.call(this,!1)},t.TabItem.prototype.addLabel=function(){this.$label||(this.$label=this.$tabContainer.appendSpan("label"))},t.TabItem.prototype.addStatus=function(){this.$status||(this.$status=this.$tabContainer.appendSpan("status").on("mousedown",this._onStatusMousedown.bind(this)).cssWidth(t.HtmlEnvironment.fieldStatusWidth))},t.TabItem.prototype._syncStatusVisible=function(){this._setProperty("statusVisible",!1)},t.TabItem.prototype._renderStatusPosition=function(){t.TabItem.parent.parent.prototype._renderStatusPosition.call(this)},t.TabItem.prototype._renderTooltipText=function(){this.$container?t.TabItem.parent.prototype._renderTooltipText.call(this):this._updateStatusVisible();var e=t.strings.hasText(this.tooltipText);this.$tabContainer.toggleClass("has-tooltip",e)},t.TabItem.prototype._renderErrorStatus=function(){var e=!!this.errorStatus,i=e?this.errorStatus.cssClass():"";this.$container&&(this.$container.removeClass(t.Status.cssClasses),this.$container.addClass(i,e)),this.$tabContainer.removeClass(t.Status.cssClasses),this.$tabContainer.addClass(i,e),this._updateStatusVisible(),e?this._showStatusMessage():this._hideStatusMessage()},t.TabItem.prototype._renderStatusVisible=function(){var e=this.$status.isVisible();t.TabItem.parent.prototype._renderStatusVisible.call(this),this.rendered&&e!==this._computeStatusVisible()&&this.tabHtmlComp.invalidateLayoutTree()},t.TabItem.prototype._syncMenusVisible=function(){this._setProperty("menusVisible",!1)},t.TabItem.prototype._attach=function(){this.$parent.append(this.$container),this.session.detachHelper.afterAttach(this.$container),t.TabItem.parent.prototype._attach.call(this)},t.TabItem.prototype._detach=function(){this.session.detachHelper.beforeDetach(this.$container,{storeFocus:!1}),this.$container.detach(),t.TabItem.parent.prototype._detach.call(this)},t.TabItemAdapter=function(){t.TabItemAdapter.parent.call(this)},t.inherits(t.TabItemAdapter,t.GroupBoxAdapter),t.TabItemLayout=function(e){t.TabItemLayout.parent.call(this,e)},t.inherits(t.TabItemLayout,t.GroupBoxLayout),t.TabItemLayout.prototype._layoutStatus=function(){},t.TabItemLayout.prototype._menuBarSize=function(e,i,o){var n=t.MenuBarLayout.size(e,i),r=this._groupBox.parent;return n.width=r._$tabArea.outerWidth(),n},t.TableField=function(){t.TableField.parent.call(this),this._addAdapterProperties(["table"]),this._tableChangedHandler,this._deletedRows=[],this._insertedRows=[],this._updatedRows=[],this._checkedRows=[]},t.inherits(t.TableField,t.FormField),t.TableField.TABLE_CHANGE_EVENTS="rowsInserted rowsDeleted allRowsDeleted rowsUpdated rowsChecked",t.TableField.prototype._init=function(e){t.TableField.parent.prototype._init.call(this,e),this._delegatePropertyChange("enabled"),this._delegatePropertyChange("disabledStyle"),this._tableChangedHandler=this._onTableChanged.bind(this),this.table&&this.table.on(t.TableField.TABLE_CHANGE_EVENTS,this._tableChangedHandler)},t.TableField.prototype._delegatePropertyChange=function(t){this.on("propertyChange",function(e){e.newProperties.hasOwnProperty(t)&&this.table.setProperty(t,e.newProperties[t])}.bind(this))},t.TableField.prototype._render=function(t){this.addContainer(t,"table-field"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this._renderTable()},t.TableField.prototype._syncTable=function(e){this.table&&this.table.off(t.TableField.TABLE_CHANGE_EVENTS,this._tableChangedHandler),this._setProperty("table",e),e&&e.on(t.TableField.TABLE_CHANGE_EVENTS,this._tableChangedHandler)},t.TableField.prototype.setTable=function(t){this.setProperty("table",t)},t.TableField.prototype._renderTable=function(){this.table&&(this.table.render(this.$container),this.addField(this.table.$container))},t.TableField.prototype._removeTable=function(){this.table&&this.table.remove(),this._removeField()},t.TableField.prototype.computeRequiresSave=function(){return this._deletedRows.length>0||this._insertedRows.length>0||this._updatedRows.length>0||this._checkedRows.length>0},t.TableField.prototype._onTableChanged=function(e){return t.isOneOf(e.type,"rowsDeleted","allRowsDeleted")?(t.arrays.pushAll(this._deletedRows,e.rows),void this._updateInsertedRows()):"rowsInserted"===e.type?void t.arrays.pushAll(this._insertedRows,e.rows):"rowsUpdated"===e.type?void t.arrays.pushAll(this._updatedRows,e.rows):void("rowsChecked"===e.type&&this._toggleCheckedRows(e.rows))},t.TableField.prototype._updateInsertedRows=function(){var e=[];this._deletedRows.forEach(function(t){this._insertedRows.indexOf(t)!==-1&&e.push(t)},this),e.forEach(function(e){t.arrays.remove(this._deletedRows,e),t.arrays.remove(this._insertedRows,e)},this)},t.TableField.prototype._toggleCheckedRows=function(e){e.forEach(function(e){var i=t.arrays.remove(this._checkedRows,e);i||this._checkedRows.push(e)},this)},t.TableField.prototype.markAsSaved=function(){t.TableField.parent.prototype.markAsSaved.call(this),this._deletedRows=[],this._insertedRows=[],this._updatedRows=[],this._checkedRows=[]},t.TableFieldAdapter=function(){t.TableFieldAdapter.parent.call(this),this._addAdapterProperties(["table"])},t.inherits(t.TableFieldAdapter,t.FormFieldAdapter),t.TreeBox=function(){t.TreeBox.parent.call(this),this._addAdapterProperties(["tree","filterBox"])},t.inherits(t.TreeBox,t.ValueField),t.TreeBox.prototype._init=function(e){t.TreeBox.parent.prototype._init.call(this,e),this.filterBox&&(this.filterBox.enabledComputed=!0,this.filterBox.recomputeEnabled(!0))},t.TreeBox.prototype._render=function(e){this.addContainer(e,"tree-box"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this.addFieldContainer(e.makeDiv());var i=t.HtmlComponent.install(this.$fieldContainer,this.session);i.setLayout(new t.TreeBoxLayout(this,this.tree,this.filterBox)),this.tree&&this._renderTree(),this.filterBox&&(this._renderFilterBox(),this.tree.htmlComp.pixelBasedSizing=!0)},t.TreeBox.prototype._renderTree=function(t){this.tree.render(this.$fieldContainer),this.addField(this.tree.$container)},t.TreeBox.prototype._renderFilterBox=function(t){this.filterBox.render(this.$fieldContainer)},t.TreeBoxAdapter=function(){t.TreeBoxAdapter.parent.call(this),this._addAdapterProperties(["tree","filterBox"])},t.inherits(t.TreeBoxAdapter,t.ValueFieldAdapter),t.TreeBoxLayout=function(e,i,o){t.TreeBoxLayout.parent.call(this),this.tree=i,this.filterBox=o,this.treeBox=e},t.inherits(t.TreeBoxLayout,t.AbstractLayout),t.TreeBoxLayout.prototype.layout=function(e){var i,o=t.HtmlComponent.get(e),n=o.getSize(),r=n.height;this.filterBox&&this.filterBox.rendered&&this.filterBox.$container.isVisible()&&(i=t.HtmlComponent.get(this.filterBox.$container).getPreferredSize().height,r-=i),r=Math.max(r,20);var s=t.HtmlComponent.get(this.tree.$container);if(s.setSize(new t.Dimension(n.width,r)),this.filterBox&&this.filterBox.rendered&&this.filterBox.$container.isVisible()){var a=t.HtmlComponent.get(this.filterBox.$container);a.setSize(new t.Dimension(n.width,i))}},t.TreeBoxLayout.prototype.preferredLayoutSize=function(e){var i,o,n,r,s=0,a=t.HtmlComponent.get(e),l=t.HtmlEnvironment.formRowHeight,h=this.treeBox;return h.$label&&h.labelVisible&&(s+=t.HtmlEnvironment.fieldLabelWidth),h.$mandatory&&(s+=h.$mandatory.outerWidth(!0)),h.$status&&h.statusVisible&&(s+=h.$status.outerWidth(!0)),n=t.HtmlComponent.optGet(this.tree.$container),i=n?n.getPreferredSize().add(a.getInsets()).add(n.getMargins()):this.naturalSize(h),r=t.HtmlComponent.optGet(this.filterBox.$container),r?o=r.getPreferredSize().add(a.getInsets()).add(r.getMargins()):i=this.naturalSize(h),s+=Math.max(i.width,o.width),l=Math.max(l,i.height+o.height),new t.Dimension(s,l)},t.TreeBoxLayout.prototype.naturalSize=function(e){return new t.Dimension(e.$fieldContainer.width(),e.$fieldContainer.height())},t.TreeField=function(){t.TreeField.parent.call(this),this._addAdapterProperties(["tree"])},t.inherits(t.TreeField,t.FormField),t.TreeField.prototype._render=function(t){this.addContainer(t,"tree-field"),this.addLabel(),this.addMandatoryIndicator(),this.addStatus(),this.tree&&this._renderTree()},t.TreeField.prototype._renderTree=function(){this.tree.render(this.$container),this.addField(this.tree.$container)},t.TreeField.prototype._removeTree=function(){this.tree.remove(),this._removeField()},t.TreeFieldAdapter=function(){t.TreeFieldAdapter.parent.call(this),this._addAdapterProperties(["tree"])},t.inherits(t.TreeFieldAdapter,t.FormFieldAdapter),t.WizardProgressField=function(){t.WizardProgressField.parent.call(this),this.steps=[],this.previousActiveStepIndex,this.stepsMap={}},t.inherits(t.WizardProgressField,t.FormField),t.WizardProgressField.prototype._init=function(e){t.WizardProgressField.parent.prototype._init.call(this,e),this._updateStepsMap()},t.WizardProgressField.prototype._render=function(e){if(this.addContainer(e,"wizard-progress-field",new t.WizardProgressFieldLayout(this)),this.addField(e.makeDiv("wizard-steps")),this.addStatus(),this.addLabel(),this.$wizardStepsBody=this.$field.appendDiv("wizard-steps-body"),t.scrollbars.install(this.$field,{parent:this,axis:"x"}),this.parent instanceof t.GroupBox&&this.parent.controls[0]===this&&this.parent.parent instanceof t.Form){var i=this.parent.parent;i.$container.addClass("wizard-container-form")}},t.WizardProgressField.prototype._renderProperties=function(){t.WizardProgressField.parent.prototype._renderProperties.call(this),this._renderSteps(),this._renderActiveStepIndex()},t.WizardProgressField.prototype._syncSteps=function(t){this._setProperty("steps",t),this._updateStepsMap()},t.WizardProgressField.prototype._renderSteps=function(){this.$wizardStepsBody.empty(),this.steps.forEach(function(e,i){var o=this.$wizardStepsBody.appendDiv("wizard-step").addClass(e.cssClass).data("wizard-step",e);e.$step=o,this.enabledComputed&&e.enabled&&e.actionEnabled?(o.addClass("action-enabled"),o.on("click",this._onStepClick.bind(this))):this.enabledComputed&&e.enabled||o.addClass("disabled"),t.strings.hasText(e.tooltipText)&&t.tooltips.install(o,{parent:this,text:e.tooltipText,tooltipPosition:"bottom"}),this._updateStepClasses(e),this.session.inspector&&(t.inspector.applyInfo(e,o),o.attr("data-step-index",e.index));var n=o.appendDiv("wizard-step-content");if(e.iconId){var r=n.appendDiv("wizard-step-content-icon");r.icon(e.iconId)}var s=n.appendDiv("wizard-step-content-text");s.appendDiv("wizard-step-title").textOrNbsp(e.title),e.subTitle&&s.appendDiv("wizard-step-sub-title").textOrNbsp(e.subTitle),i<this.steps.length-1&&o.appendDiv("wizard-step-separator")}.bind(this)),this.invalidateLayoutTree(!1)},t.WizardProgressField.prototype._syncActiveStepIndex=function(e){this.previousActiveStepIndex=this.activeStepIndex,this._setProperty("activeStepIndex",t.nvl(e,-1))},t.WizardProgressField.prototype._renderActiveStepIndex=function(){this.steps.forEach(function(t){this._updateStepClasses(t)}.bind(this)),this.steps.length>0&&this.$wizardStepsBody.css("background-color",this.steps[this.steps.length-1].$step.css("background-color")),this.invalidateLayoutTree(!1)},t.WizardProgressField.prototype._updateStepClasses=function(t){var e=t.$step;e.removeClass("active before-active after-active left-of-active right-of-active first last");var i=this.steps.indexOf(t),o=this.steps.indexOf(this.stepsMap[this.activeStepIndex]);i>=0&&o>=0&&(i<o?(e.addClass("before-active"),i===o-1&&e.addClass("left-of-active")):i>o?(e.addClass("after-active"),i===o+1&&e.addClass("right-of-active")):e.addClass("active"),0===i&&e.addClass("first"),i===this.steps.length-1&&e.addClass("last"))},t.WizardProgressField.prototype._stepIndex=function(t){if(t){var e=t.data("wizard-step");if(e)return e.index}return-1},t.WizardProgressField.prototype._updateStepsMap=function(){this.stepsMap={},this.steps.forEach(function(t){this.stepsMap[t.index]=t}.bind(this))},t.WizardProgressField.prototype._resolveStep=function(t){for(var e=0;e<this.steps.length;e++){var i=this.steps[e];if(i.index===t)return i}return null},t.WizardProgressField.prototype._onStepClick=function(t){var i=e(t.currentTarget),o=this._stepIndex(i);o>=0&&o!==this.activeStepIndex&&this.trigger("stepAction",{stepIndex:o})},t.WizardProgressField.prototype.scrollToActiveStep=function(){var e=this.stepsMap[this.activeStepIndex];if(e){var i=e.$step,o=this.$field.scrollLeft(),n=i.position().left,r=i.width(),s=this.$field.width(),a=this.previousActiveStepIndex>this.activeStepIndex,l=o+Math.floor(s*(a?.25:.75)),h=n+Math.floor(r/2);(a&&h<l||!a&&h>l)&&t.scrollbars.scrollLeft(this.$field,o+(h-l))}},t.WizardProgressFieldAdapter=function(){t.WizardProgressFieldAdapter.parent.call(this)},t.inherits(t.WizardProgressFieldAdapter,t.FormFieldAdapter),t.WizardProgressFieldAdapter.prototype._onWidgetStepAction=function(t){this._send("doStepAction",{stepIndex:t.stepIndex})},t.WizardProgressFieldAdapter.prototype._onWidgetEvent=function(e){"stepAction"===e.type?this._onWidgetStepAction(e):t.WizardProgressFieldAdapter.parent.prototype._onWidgetEvent.call(this,e)},t.WizardProgressFieldLayout=function(e){t.WizardProgressFieldLayout.parent.call(this,e)},t.inherits(t.WizardProgressFieldLayout,t.FormFieldLayout),t.WizardProgressFieldLayout.prototype.layout=function(e){t.WizardProgressFieldLayout.parent.prototype.layout.call(this,e);var i=this.formField.$field.scrollLeft(),o=this.formField.$wizardStepsBody;o.width("auto");var n=o[0].scrollWidth;o.width(n),this.formField.$field.scrollLeft(i),this.formField.scrollToActiveStep()},t.WrappedFormField=function(){t.WrappedFormField.parent.call(this),this._addAdapterProperties(["innerForm"]),this.initialFocusEnabled=!1},t.inherits(t.WrappedFormField,t.FormField),t.WrappedFormField.prototype._render=function(t){this.addContainer(t,"wrapped-form-field"),this.addLabel(),this.addStatus()},t.WrappedFormField.prototype._renderProperties=function(){t.WrappedFormField.parent.prototype._renderProperties.call(this),this._renderInnerForm()},t.WrappedFormField.prototype._renderInnerForm=function(){this.innerForm&&(this.innerForm.displayHint=t.Form.DisplayHint.VIEW,this.innerForm.modal=!1,this.innerForm.renderInitialFocusEnabled=this.initialFocusEnabled,this.innerForm.render(this.$container),this.addField(this.innerForm.$container),this.innerForm.invalidateLayoutTree(),this._renderInitialFocusEnabled())},t.WrappedFormField.prototype._renderInitialFocusEnabled=function(){this.innerForm&&this.initialFocusEnabled&&this.innerForm.renderInitialFocus()},t.WrappedFormField.prototype._removeInnerForm=function(){this.innerForm&&this.innerForm.remove(),this._removeField()},t.WrappedFormFieldAdapter=function(){t.WrappedFormFieldAdapter.parent.call(this),this._addAdapterProperties(["innerForm"])},t.inherits(t.WrappedFormFieldAdapter,t.FormFieldAdapter),t.login={init:function(t){var i=this._bootstrap();e.when.apply(e,i).done(this._init.bind(this,t))},_bootstrap:function(){var e=[t.logging.bootstrap()],i=[];return e.forEach(function(t){Array.isArray(t)?i.concat(t):t&&i.push(t)}),i},_init:function(i){i=i||{},i.texts=e.extend({},t.texts.readFromDOM(),i.texts),t.prepareDOM(),t.objectFactory.init();var o=t.create("LoginBox",i);o.render(e("body"))}},t.LoginBox=function(){t.LoginBox.parent.call(this),this.ajaxOptions={type:"POST"},this.authUrl="auth",this.onPostDoneFunc=this.redirect.bind(this),this.redirectUrl,this.logoUrl="res/logo.png",this.userDataKey="user",this.passwordDataKey="password",this.additionalData={},this.prepareRedirectUrlFunc=t.LoginBox.prepareRedirectUrl,this.messageKey,this.texts={"ui.Login":"Login","ui.LoginFailed":"Login failed","ui.User":"Username","ui.Password":"Password"}},t.inherits(t.LoginBox,t.Box),t.LoginBox.prototype.init=function(i){i=i||{},i.texts=new t.TextMap(e.extend(this.texts,i.texts)),i.ajaxOptions=e.extend(this.ajaxOptions,i.ajaxOptions),e.extend(this,i)},t.LoginBox.prototype.render=function(i){t.LoginBox.parent.prototype.render.call(this,i),this.$container.addClass("login-box"),this.$content.addClass("login-box-content "),this.$form=e("<form>").attr("action",this.authUrl).attr("method","post").submit(this._onLoginFormSubmit.bind(this)).appendTo(this.$content),this.messageKey&&(this.$message=e("<div>").attr("id","message-box").text(this.texts.get(this.messageKey)).appendTo(this.$form)),this.$user=e("<input>").attr("type","text").attr("autocapitalize","off").attr("autocorrect","off").placeholder(this.texts.get("ui.User")).appendTo(this.$form),this.$password=e("<input>").attr("type","password").placeholder(this.texts.get("ui.Password")).appendTo(this.$form),this.$button=e("<button>").attr("type","submit").addClass("login-button button default").text(this.texts.get("ui.Login")).appendTo(this.$form),this.$user.focus()},t.LoginBox.prototype._resetButtonText=function(){this.$button.text(this.texts.get("ui.Login")).removeClass("login-error")},t.LoginBox.prototype.data=function(){var t={};return t[this.userDataKey]=this.$user.val(),t[this.passwordDataKey]=this.$password.val(),e.extend(t,this.additionalData),t},t.LoginBox.prototype._onLoginFormSubmit=function(i){i.preventDefault();var o=this.$form.attr("action"),n=this.data();this.$button.removeClass("login-error").setEnabled(!1),this.$user.off("input.resetLoginError"),this.$password.off("input.resetLoginError"),t.device.supportsCssAnimation()&&this.$button.html("").append(e("<div>").addClass("login-button-loading"));var r=e.extend({},this.ajaxOptions,{url:o,data:n});e.ajax(r).done(this._onPostDone.bind(this)).fail(this._onPostFail.bind(this))},t.LoginBox.prototype.redirect=function(t){var e=this.redirectUrl;e||(e=(window.location.href||"").trim(),e=this.prepareRedirectUrlFunc(e)),e?window.location.href=e:window.location.reload()},t.LoginBox.prototype._onPostDone=function(t){this.remove(),this.onPostDoneFunc.call(this,t)},t.LoginBox.prototype._onPostFail=function(t,e,i){setTimeout(this._onPostFailImpl.bind(this,t,e,i),300)},t.LoginBox.prototype._onPostFailImpl=function(t,e,i){this.$button.setEnabled(!0).html("").text(this.texts.get("ui.LoginFailed")).addClass("login-error"),this.$user.val("").focus().one("input.resetLoginError",this._resetButtonText.bind(this)),this.$password.val("").one("input.resetLoginError",this._resetButtonText.bind(this))},t.LoginBox.prepareRedirectUrl=function(t){var e=/^([^?#]*)(\?[^#]*)?(#.*)?$/.exec(t||""),i=e[1].replace(/login.html$/,"").replace(/login$/,"").replace(/logout$/,"");return i+(e[2]?e[2]:"")+(e[3]?e[3]:"")},t.logout={init:function(t){var i=this._bootstrap();e.when.apply(e,i).done(this._init.bind(this,t))},_bootstrap:function(){var e=[t.logging.bootstrap()],i=[];return e.forEach(function(t){Array.isArray(t)?i.concat(t):t&&i.push(t)}),i},_init:function(i){i=i||{},i.texts=e.extend({},t.texts.readFromDOM(),i.texts),t.prepareDOM(),t.objectFactory.init();var o=t.create("LogoutBox",i);o.render(e("body"))}},t.LogoutBox=function(){t.LogoutBox.parent.call(this)},t.inherits(t.LogoutBox,t.Box),t.LogoutBox.prototype.init=function(i){var o={loginUrl:sessionStorage.getItem("scout:loginUrl")||"./",logoUrl:"res/logo.png"};this.options=e.extend({},o,i);var n={"ui.LogoutSuccessful":"Good bye!","ui.LoginAgain":"Login again"};this.options.texts=e.extend({},n,i.texts),this.texts=new t.TextMap(this.options.texts),this.loginUrl=this.options.loginUrl,this.logoUrl=this.options.logoUrl},t.LogoutBox.prototype.render=function(i){t.LogoutBox.parent.prototype.render.call(this,i),this.$content.addClass("small centered").appendDiv().html(t.strings.nl2br(this.texts.get("ui.LogoutSuccessful"))),this.$buttonBar=e("<div>").addClass("button-bar").appendTo(this.$content),e("<button>").addClass("button").text(this.texts.get("ui.LoginAgain")).on("click",this._loginAgain.bind(this)).appendTo(this.$buttonBar)},t.LogoutBox.prototype._loginAgain=function(){window.location=this.loginUrl},t.DesktopFormController=function(i,o){t.DesktopFormController.parent.call(this,i,o),this.desktop=i,this._popupWindows=[],this._documentPopupWindowReadyHandler=this._onDocumentPopupWindowReady.bind(this),e(document).on("popupWindowReady",this._documentPopupWindowReadyHandler)},t.inherits(t.DesktopFormController,t.FormController),t.DesktopFormController.instanceCounter=0,t.DesktopFormController.prototype.render=function(){t.DesktopFormController.parent.prototype.render.call(this);var e;if(this.desktop.activeForm){var i=this.desktop.activeForm;i.isDialog()?e=this._findActiveSelectablePart(i):i.isView()&&(e=i)}e?this.desktop.bench.activateView(e):this.desktop.bringOutlineToFront(),this.desktop.bench&&this.desktop.bench.postRender()},t.DesktopFormController.prototype._findActiveSelectablePart=function(t){if(t.parent.isView&&t.parent.isDialog){if(t.parent.isView())return t.parent;if(t.parent.isDialog())return this._findActiveSelectablePart(t.parent)}return null},t.DesktopFormController.prototype._renderPopupWindow=function(i){var o,n,r=i.cacheBounds?t.PopupWindow.readWindowBounds(i):null;if(r)o="left="+r.x+",top="+r.y+",width="+r.width+",height="+r.height,n=!1;else{var s=e(document),a=new t.Dimension(s.width(),s.height());o="left=0,top=0,width="+a.width+",height="+a.height,n=!0}o+=",location=no,toolbar=no,menubar=no,resizable=yes";var l=new t.PopupBlockerHandler(this.session),h="popup-window.html?formId="+i.id,d=l.openWindow(h,"_blank",o);d?this._addPopupWindow(d,i,n):(e.log.warn("Popup-blocker detected! Show link to open window manually"),l.showNotification(function(){d=window.open(h,"_blank",o),this._addPopupWindow(d,i,n)}.bind(this)))},t.DesktopFormController.prototype._addPopupWindow=function(i,o,n){var r=new t.PopupWindow(i,o);r.resizeToPrefSize=n,r.events.on("popupWindowUnload",this._onPopupWindowUnload.bind(this)),this._popupWindows.push(r),e.log.debug("Opened new popup window for form ID "+o.id)},t.DesktopFormController.prototype._onDocumentPopupWindowReady=function(t,i){e.log.debug("(FormController#_onDocumentPopupWindowReady) data="+i);var o;if(i.formId){var n,r=i.formId;for(e.log.debug("Popup window for form ID "+r+" has been reloaded"),n=0;n<this._popupWindows.length&&(o=this._popupWindows[n],o.form.id!==r);n++);if(!o)throw new Error("Couldn't find popupWindow reference while popup window was reloaded")}else{if(!i.popupWindow)throw new Error("Neither property 'formId' nor 'popupWindow' exists on data parameter");o=i.popupWindow}o._onReady()},t.DesktopFormController.prototype._onPopupWindowUnload=function(t){var i=t.form;e.log.debug("Popup window for form ID "+i.id+" is unloaded - don't know if its closed or reloaded yet"),i.remove(),setTimeout(function(){t.isClosed()&&(e.log.debug("Popup window for form ID "+i.id+" has been closed"),i.close())}.bind(this),250)},t.DesktopFormController.prototype.closePopupWindows=function(){this._popupWindows.forEach(function(t){this._removePopupWindow(t.form)},this),this._popupWindows=[]},t.DesktopFormController.prototype._removePopupWindow=function(e){var i=e.popupWindow;if(!i)throw new Error("Form has no popupWindow reference");delete e.popupWindow,t.arrays.remove(this._popupWindows,i),e.rendered&&(e.remove(),i.close())},t.DesktopFormController.prototype.dispose=function(){e(document).off("popupWindowReady",this._documentPopupWindowReadyHandler)},t.FilterFieldsGroupBox=function(){t.FilterFieldsGroupBox.parent.call(this)},t.inherits(t.FilterFieldsGroupBox,t.GroupBox),t.FilterFieldsGroupBox.prototype._init=function(e){t.FilterFieldsGroupBox.parent.prototype._init.call(this,e),this.filter=e.filter,this.filter.addFilterFields(this),this.cssClass="filter-fields"},t.FilterFieldsGroupBox.prototype._render=function(e){t.FilterFieldsGroupBox.parent.prototype._render.call(this,e),this.filter.modifyFilterFields()},t.FilterFieldsGroupBox.prototype.addFilterField=function(e,i,o){var n=t.create(e,{parent:this,label:this.session.text(i),statusVisible:!1,labelWidthInPixel:50,maxLength:100,gridData:{y:o},updateDisplayTextOnModify:!0});return this.addField0(n),n},t.FilterFieldsGroupBox.prototype.addField0=function(t){this.fields.push(t),this._prepareFields()}}(window.scout=window.scout||{},jQuery);